<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>🚩MySQL - </title><meta name=author content="都将会"><meta name=author-link content><meta name=description content="是用得最多的数据库了"><meta name=keywords content="MySQL,interview,面试"><meta itemprop=name content="🚩MySQL"><meta itemprop=description content="是用得最多的数据库了"><meta itemprop=datePublished content="2023-10-07T08:08:08+08:00"><meta itemprop=dateModified content="2023-10-07T08:08:08+08:00"><meta itemprop=wordCount content="4416"><meta itemprop=image content="https://leni.fun/images/avatar.jpg"><meta itemprop=keywords content="MySQL,"><meta property="og:title" content="🚩MySQL"><meta property="og:description" content="是用得最多的数据库了"><meta property="og:type" content="article"><meta property="og:url" content="https://leni.fun/mysql/"><meta property="og:image" content="https://leni.fun/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-07T08:08:08+08:00"><meta property="article:modified_time" content="2023-10-07T08:08:08+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leni.fun/images/avatar.jpg"><meta name=twitter:title content="🚩MySQL"><meta name=twitter:description content="是用得最多的数据库了"><meta name=application-name content="都将会的 APP"><meta name=apple-mobile-web-app-title content="都将会的 APP"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leni.fun/mysql/><link rel=prev href=https://leni.fun/java_base/><link rel=next href=https://leni.fun/microservice/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"🚩MySQL","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leni.fun\/mysql\/"},"genre":"posts","keywords":"MySQL","wordcount":4416,"url":"https:\/\/leni.fun\/mysql\/","datePublished":"2023-10-07T08:08:08+08:00","dateModified":"2023-10-07T08:08:08+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"都将会"},"description":"是用得最多的数据库了"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=关键词搜索 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=关键词搜索 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title>主页</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>🚩MySQL</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>🚩MySQL</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=都将会 data-alt=都将会 class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;都将会</span></span>
<span class=post-category>收录于 <a href=/categories/202310/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 202310</a>&ensp;<a href=/categories/interview/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> interview</a></span></div><div class=post-meta-line><span title="发布于 2023-10-07 08:08:08"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-10-07>2023-10-07</time></span>&nbsp;<span title="更新于 2023-10-07 08:08:08"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-10-07>2023-10-07</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4416 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 9 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=🚩MySQL>
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img loading=lazy src=/images/pic20.jpg srcset="/images/pic20.jpg, /images/pic20.jpg 1.5x, /images/pic20.jpg 2x" sizes=auto data-title=是用得最多的数据库了 data-alt=/images/pic20.jpg width=856 height=556 style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#索引>索引</a><ul><li><a href=#-什么是聚簇索引>🌟 什么是聚簇索引？</a></li><li><a href=#索引分类>索引分类</a><ul><li><a href=#选择索引列>选择索引列</a></li><li><a href=#不选择索引情况>不选择索引情况</a></li></ul></li><li><a href=#索引失效情况>🌟索引失效情况？</a></li></ul></li><li><a href=#事务>事务</a><ul><li><a href=#事务执行过程>事务执行过程</a></li><li><a href=#隔离级别>隔离级别</a></li><li><a href=#事务特性-acid>事务特性 ACID</a></li></ul></li><li><a href=#优化>优化</a><ul><li><a href=#sql-优化经验>🌟SQL 优化经验？</a></li><li><a href=#如何使用慢-sql-优化>如何使用慢 SQL 优化？</a></li></ul></li><li><a href=#应用>应用</a><ul><li><a href=#连接池对比>连接池对比</a></li><li><a href=#分库分表---sharding-sphere-中间件>分库分表 - sharding-sphere 中间件</a></li><li><a href=#数据迁移>数据迁移</a></li></ul></li><li><a href=#基础概念>基础概念</a><ul><li><a href=#结构化查询语言的-6-个部分>结构化查询语言的 6 个部分</a></li><li><a href=#mysql-中的锁>MySQL 中的锁</a></li></ul></li><li><a href=#区别>区别</a><ul><li><a href=#binlog-redolog-和-undolog-的区别>binlog 、redolog 和 undolog 的区别？</a></li><li><a href=#innodb-和-myisam-的区别>Innodb 和 MyISAM 的区别？</a></li><li><a href=#b树与-b-树的区别>B+树与 B 树的区别？</a></li><li><a href=#deletetruncatedrop-的区别>delete/truncate/drop 的区别？</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=索引>索引</h2><h3 id=-什么是聚簇索引>🌟 什么是聚簇索引？</h3><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg data-sub-html="<h2>https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678155173320-852872be-de47-4708-bcdb-0b3afdf3ccf8-20230808082056230.jpeg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><p>对于每张表，每个索引都对应一个独立的 B+ 树：</p><ul><li>聚簇索引（一个）：叶子节点保存了行数据，有且只有一个聚簇索引。<ul><li>主键 pk > 唯一索引 unique > 自动生成 row_id</li></ul></li><li>非聚簇索引（多个）：叶子节点关联主键，指向了数据的对应行，若没有覆盖索引则需要回表走聚簇索引。</li></ul><p>在可重复读（RR）隔离级别下：聚簇索引更新 = 替换，非聚簇索引更新 = 删除+新建</p><p>聚簇索引的优点：</p><ol><li>在操作系统中，采用的是按页存储，聚簇索引的主键和行数据是一起被载入内存的。当访问叶子节点的时候，这一页就已经加载到了 Buffer 中，可以直接叶子节点中拿到行数据，减少访问磁盘的时间。</li><li>辅助索引使用主键作为"指针"，而不是使用地址值作为指针的好处是，当出现页分裂的时候，不需要去维护地址值，相当于是一个空间换时间的思想。</li><li>适用于排序的场合、取出范围数据的场合。</li><li>在业务上，可以通过表主键id来聚合数据，通过聚簇索引可以减少磁盘I/O</li></ol><h3 id=索引分类>索引分类</h3><ul><li><p>逻辑维度</p><ul><li>唯一索引 unique：可以为空，但最多一个空</li><li>联合索引：最左匹配原则</li><li>全文索引 full text ：支持文本模糊查询用于 char、varchar、text</li><li>前缀索引：可以选择在 varchar(128)的列上选择前 32 个字符作为索引</li><li>主键索引 primary key：不能为空</li></ul></li><li><p>物理维度分为聚簇/非聚簇：叶子节点是否存储行数据</p></li><li><p>覆盖索引：索引包含某次查询的所有列</p></li><li><p>哈希索引：Innodb 和 MyISAM 都不适用，Memory 引擎支持。</p></li></ul><h4 id=选择索引列>选择索引列</h4><ol><li>数据量大、查询频繁的表，涉及 where、orderby、groupby 频繁的字段</li><li>区分度高的字段建立唯一索引或放在左边</li><li>字符串类型优先使用前缀索引，占用空间更小</li><li><code>not null</code> 约束</li></ol><h4 id=不选择索引情况>不选择索引情况</h4><ol><li>被频繁更新的字段</li><li>长期未使用的索引：sys 库的<code>schema_unused_indexes</code>视图</li></ol><h3 id=索引失效情况>🌟索引失效情况？</h3><ol><li>没有覆盖索引，如 select *</li><li>联合索引未遵循最左前缀原则<ol><li>Mysql 从左到右的使用索引中的字段，一个查询可以只使用索引中的一部份，但只能是最左侧部分</li><li>例如索引是 key index （a,b,c）。 可以支持 a 、a,b 、a,b,c 3 种组合进行查找，但不支持 b,c 进行查找。</li></ol></li><li>范围查询右边的列会失效，范围过大也会导致全表扫描</li><li>在索引列上运算操作</li><li>like &lsquo;%abc&rsquo;</li><li>or 的前后条件中有一个列没有索引，涉及的索引也失效</li><li>in()查询时，应该尽可能减少值列表的长度，避免查询转化成过长的 OR 子句，以及避免在查询中使用 NULL 值。</li></ol><h2 id=事务>事务</h2><h3 id=事务执行过程>事务执行过程</h3><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png data-sub-html="<h2>image.png</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691041539662-bce37b97-6a2f-4a4f-9de9-89cb088faa79-20230808082056219.png 2x" sizes=auto data-title=image.png data-alt=image.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><p>宕机情形：</p><ul><li>在 redo log 刷新到磁盘（事务提交）之前，都是回滚 undo log。</li><li>如果在 redo log 已经刷新到磁盘，在 MySQL 重启之后就会回放这个 redo log，以纠正数据库里的数据。</li></ul><h3 id=隔离级别>隔离级别</h3><ul><li>脏读：读到其他事务未提交的数据</li><li>不可重复读：同一事务内，先后读取的数据不同，因为其他事务 update 或 delete 会影响结果集。</li><li>幻读：同一事务内，先后读取的 count 不同。例如，查询时没有某 id，插入时 id 已存在。<ul><li>原因：加锁后，不锁定间隙，其他事务可以 INSERT，导致相同的查询在不同的时间得到不同的结果。</li><li>解决方案：使用<strong>临键锁</strong>，对于使用了唯一索引等唯一查询条件，InnoDB 只锁定索引记录，不锁定间隙；对于其他查询条件，InnoDB 会<strong>锁定扫描到的索引范围</strong>，通过临键锁来阻止其他会话在这个范围中插入新值。</li></ul></li><li><u>RU 读未提交</u>：脏读、不可重复读、幻读都会出现</li><li><u>RC 读已提交</u>：解决脏读，每一次快照读时生成 ReadView 读取自己的新快照<ul><li>多数数据库默认</li><li>仅支持基于行的 bin log</li><li>当一个事务启动时，数据库会为该事务创建一个版本链，该版本链包含了数据库中所有数据对象的所有版本。当事务读取数据时，数据库会根据事务的启动时间戳选择相应的版本，并且在版本链中添加一个新的版本，以保证该事务所读取的数据不会被其他事务修改。</li></ul></li><li><u>RR 可重复读</u>：解决不可重复读，<strong>仅第一次生成 ReadView 的活跃事务 m_ids，后续复用（一致性快照）</strong><ul><li>MVCC = multiple version concurrent control 多版本并发控制<ul><li>目的：高并发场景下，锁的性能差，MVCC 可以避免读写阻塞</li><li><strong>DB_ROW_ID：隐藏列</strong></li><li><strong>DB_ROLL_PIR：回滚指针</strong>，指向这条记录的上一版本<ul><li>版本链存储在 undo log 中</li></ul></li><li><strong>DB_TRX_ID：最近修改的事务 id</strong></li></ul></li><li><strong>理论上 RR 存在幻读，但 MySQL 临键锁 next key lock 解决了幻读问题</strong></li><li><strong>问：如何保证 REPEATABLE READ 级别绝对不产⽣幻读？</strong><ul><li><strong>答</strong>：在 SQL 中加⼊for update (排他锁) 或 lock in share mode (共享锁)语句实现。就是锁住了可能造成幻读的数据，阻⽌数据的写⼊操作。</li></ul></li></ul></li><li><u>Serializable 串行化</u><ul><li>加锁读：在每一行数据上都加锁，导致大量的超时和锁争用的问题，只有在非常需要确保数据一致性并且可以接受没有并发的情况下，才考虑采用该级别</li></ul></li></ul><h3 id=事务特性-acid>事务特性 ACID</h3><ul><li>Atomic 原子性<ul><li>一个事务要么全部提交，要么全部回滚</li><li>通过 <strong>undo log 记录逻辑日志</strong>，回滚时通过逆操作来恢复<ul><li>保存位置：system tablespace(mysql5.7) 或 undo tablespaces(mysql8.0)</li></ul></li></ul></li><li>Consistent 一致性<ul><li>事务总是由一种状态转换为另一种状态，而不会停留在执行中的某个状态</li><li>A、I、D 同时作用，保证了 C（一致性）</li></ul></li><li>Isolate 隔离性<ul><li><strong>读写隔离：MVCC，undo log 版本链（从最新记录依次指向最旧记录的链表），ReadView 在 RC 和 RR 的不同</strong></li><li>写写隔离：锁</li></ul></li><li>Ddurable 持久性<ul><li>事务只要提交了，那么数据库中的数据也永久的发生了变化</li><li>通过 <strong>redo log 增量</strong>记录数据页的<strong>物理</strong>变化，<strong>服务宕机时用来同步数据，先写日志，再写磁盘</strong></li><li>日志文件：【ib_logfile0】【ib_logfile1】</li><li>日志缓冲：innodb_logh_buffer_size</li><li>强刷：fsync()</li></ul></li></ul><h2 id=优化>优化</h2><h3 id=sql-优化经验>🌟SQL 优化经验？</h3><ol><li>只检索需要的列，避免 select *，主查询聚簇索引，子查询覆盖索引</li><li>将 HAVING 中部分条件提前到 WHERE 里</li><li>将 RR 降低为 RC，避免临键锁引发死锁，提高性能。<ol><li>可以通过缓存第一次数据，来避免第二次查询，来保证几乎全部事务内部对某一数据都只读取一次</li><li>可以单独指定 Session 或者事务的隔离级别。</li></ol></li><li>减小事务粒度，常 COMMIT，尽早释放锁</li><li>**用 union all **代替 union（去重、排序消耗性能）</li><li>where 语句中不使用表达式，防止索引失效</li><li>能<strong>用 inner join</strong>（优先以小表驱动大表） 就不用 left/right join。</li><li>用 EXPLAIN 返回的预估行数</li></ol><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT rows FROM (EXPLAIN SELECT * FROM xxx WHERE uid = 123) a;</span></span></code></pre></td></tr></table></div></div><ol start=9><li>使用视图</li><li>用IN代替OR</li></ol><h3 id=如何使用慢-sql-优化>如何使用慢 SQL 优化？</h3><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>开启慢查询日志</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>slow_query_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ON&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>蛮查询日志存放位置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>slow_query_log_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;var/lib/mysql/slow_query.log&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>未被索引的记录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>log_queries_not_using_indexes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ON&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>慢查询阈值（秒）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=n>long_query_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>慢查询记录扫描行数阈值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=n>min_examined_row_limit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>找到慢 SQL 之后，用 <code>EXPLAIN</code> 命令分析：</p><ol><li>possible_key：可能用到的索引</li><li><u>key</u>：实际命中的索引</li><li><u>key_len</u>：索引占用的大小</li><li>rows：扫描的行数</li><li>filtered：所需数据占 rows 的比例</li><li>extra：额外的优化建议<ol><li>Using where；Using Index 用到索引，不用回表</li><li>Using index condition 用到索引，需要<strong>回表</strong></li></ol></li><li><u>type</u>：性能从好到差<ol><li>system：mysql 自带的表</li><li>const：根据主键查询</li><li>eq_ref：主键索引/唯一索引</li><li>ref：索引查询</li><li>range：范围查询</li><li>index：索引树扫描</li><li>all：全盘扫描</li></ol></li></ol><h2 id=应用>应用</h2><h3 id=连接池对比>连接池对比</h3><ul><li>HikariCP： SpringBoot 框架的默认连接池，性能好</li><li>Druid：Alibaba 开源的连接池，能防 SQL 注入，带有监控功能</li></ul><h3 id=分库分表---sharding-sphere-中间件>分库分表 - sharding-sphere 中间件</h3><p>原因：数据库遇到了性能瓶颈。</p><ul><li>水平分库：应对大数据，对性能要求不同的数据进行分库 <code>sync_binlog = 0/1</code></li><li>垂直分库：根据业务进行拆分微服务</li><li><strong>垂直分表：冷热数据分离（零零播项目中的 user、streamer、owner）</strong></li></ul><p>读写分离：主库写，从库读。会涉及一致性问题，解决方案：主从自动切换（keepAlived、云服务提供）</p><h3 id=数据迁移>数据迁移</h3><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>db_name</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=err>&#39;</span><span class=n>Desktop</span><span class=o>/</span><span class=n>test</span><span class=p>.</span><span class=na>sql</span><span class=err>&#39;</span></span></span></code></pre></td></tr></table></div></div><ol><li>加快导入速度</li></ol><ul><li>关闭唯一性检查</li><li>开启 extended-insert 将多行合并为一个 INSERT 语句</li><li>关闭 binlog，迁移后再开启</li><li>调整 redolog 时机</li></ul><ol start=2><li>数据校验<ol><li>先读 binlog，不一致再读源表，以源表为准。</li><li>先读从库，不一致再读主库，以主库为准。</li></ol></li><li>增量同步数据</li></ol><ul><li>时间戳</li><li>binlog</li></ul><h2 id=基础概念>基础概念</h2><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png data-sub-html="<h2>image.png</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681975245174-4b0669a4-d72e-4d09-aca5-d4df06397181.png 2x" sizes=auto data-title=image.png data-alt=image.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h3 id=结构化查询语言的-6-个部分>结构化查询语言的 6 个部分</h3><ul><li><p>DDL：Data Define Language，数据定义语言</p><ul><li>CREATE、ALTER、DROP</li></ul></li><li><p>DML：Data Manipulation Language，数据操作语言</p><ul><li>INSERT、UPDATE、DELETE</li></ul></li><li><p>DQL：Data Query Language，数据查询语言</p><ul><li>SELECT、WHERE、ORDER BY、GROUP BY、HAVING</li></ul></li><li><p>TCL：Transactional Control Language，事务控制语言，确保 DML 影响的所有行及时得以更新</p><ul><li>COMMIT、SAVEPOINT、ROLLBACK</li></ul></li><li><p>DCL：Data Control Language，数据控制语言，实现权限控制</p><ul><li>GRANT、REVOKE</li></ul></li><li><p>CCL：Cursor Control Language，指针控制语言</p><ul><li>DECLARE CURSOR、FETCH INTO、UPDATE WHERE CURRENT</li></ul></li></ul><h3 id=mysql-中的锁>MySQL 中的锁</h3><p>InnoDB 引擎加锁的本质是锁住索引记录（可以理解为 B+树的叶子节点）。在可重复读 RR 的隔离级别下，</p><ul><li>一般都加临键锁，左开右闭 （防止幻读）</li><li>上界无穷间隙锁</li><li>唯一索引等值查询记录锁</li></ul><h2 id=区别>区别</h2><h3 id=binlog-redolog-和-undolog-的区别>binlog 、redolog 和 undolog 的区别？</h3><p>binlog 是二进制日志，redolog 和 undolog 是事务日志。</p><ul><li>binlog： 所有引擎<strong>增量记录逻辑日志（二进制）</strong><ul><li>数据库还原</li><li>🌟主从同步（Canal 类中间件本质是把自己伪装成从节点）：<ul><li>主库提交，将 <u>DDL 与 DML</u> 数据写入 binlog；</li><li>从库上启动复制</li><li>创建IO线程连接主库</li><li>主库创建 binlog dump 线程读取数据库事件并发送给 IO线程</li><li>从库的IO线程获取到事件数据后，更新从库的中继日志 <u>relay log</u></li><li>从库上的SQL线程读取中继日志 relay log中更新的数据库事件，并应用</li></ul></li><li><code>sync_binlog = 0</code>：写入 page cache 就算成功（默认）</li><li><code>sync_binlog = N</code>：每提交 N 次就刷新到磁盘，N 越小性能越差。默认是 1，可以调大，改善性能，但需要承受数据丢失的风险。</li></ul></li><li>redolog：InnoDB <strong>循环记录物理日志</strong>（某个页的修改），大小固定，写到结尾时(<code>write pos</code> 追上 <code>check point</code>)，会回到开头循环写日志，提供了<u>崩溃恢复能力</u>，保证了<u>持久性</u>。<ul><li>先更新 buffer pool，再写 redo log，等事务结束后刷盘到磁盘</li><li>顺序写，性能优于随机写</li><li><code>innodb_flush_log_at_trx_commit</code> = 1 默认，表示事务提交后刷盘，最安全，其次 2,0，但性能会更好。</li></ul></li><li>undolog： 记录逻辑相反操作逻辑日志，用于回滚<ul><li>delete：记录主键逻辑删除</li><li>insert：记录主键</li><li>update<ul><li>没有更新主键：主键+原值</li><li>更新主键：delete+insert</li></ul></li></ul></li></ul><h3 id=innodb-和-myisam-的区别>Innodb 和 MyISAM 的区别？</h3><ol><li>innodb 支持事务和外键</li><li>innodb 默认表锁，使用索引检索条件时是行锁，而 myisam 是表锁（每次更新增加删除都会锁住表）</li><li>innodb 和 myisam 的索引都是基于 b+树，但 innodb 的 b+树的叶子节点是存放数据的，<strong>myisam 的 b+树的叶子节点是存放指针的</strong></li><li><strong>innodb 是聚簇索引，必须要有主键，一定会基于主键查询，但是辅助索引就会查询两次，myisam 是非聚簇索引，索引和数据是分离的，索引里保存的是数据地址的指针，主键索引和辅助索引是分开的。</strong></li><li>innodb 不存储表的行数，所以 select count( _ )的时候会全表查询，而 myisam 会存放表的行数，select count(_）的时候会查的很快。</li><li><strong>MyISAM 存储限制 256TB，更适合低并发、弱一致性场景；Innodb 存储限制 64TB，更适合高并发、更新频繁的场景。</strong></li></ol><h3 id=b树与-b-树的区别>B+树与 B 树的区别？</h3><ul><li>B 树中每个节点都存储数据，B+树只有叶子节点存储数据 =》 IO 次数少<ul><li>聚簇索引：行数据</li><li>辅助索引：行的主键</li><li>非聚簇索引：行所在的地址</li></ul></li><li>B+树的键可能会在非叶子节点重复出现</li><li>B+树的叶子节点之间通过双向链表连接 =》 适合范围查询</li></ul><h3 id=deletetruncatedrop-的区别>delete/truncate/drop 的区别？</h3><ul><li>DELETE 删除表中的行，不删除表本身<ul><li>项目中一般使用逻辑删除，增加 deleted 字段</li></ul></li><li>TRUNCATE 删除表，再创建一个空表<ul><li>初始化数据</li></ul></li><li>DROP 删除表</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-10-07 08:08:08">更新于 2023-10-07&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://leni.fun/mysql/ data-title=🚩MySQL data-image=/images/pic20.jpg><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/mysql/ class=post-tag>MySQL</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/java_base/ class=post-nav-item rel=prev title="🚩Java 基础"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>🚩Java 基础</a>
<a href=/microservice/ class=post-nav-item rel=next title=🚩MicroService>🚩MicroService<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright order-5" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>都将会</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://beian.miit.gov.cn target=_blank>浙ICP备2023023782号</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor order-4"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/hihihiman/hihihiman.github.io title=博客源码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;bottom:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/pink/pace-theme-center-atom.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:1024},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":"的博客           ","typeit-header-subtitle-mobile":"的博客           "},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!0,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,useExtendedSearch:!0},siteTime:"2021-08-26T23:31:00+08:00",typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,loop:!0,speed:150}}</script><script src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>