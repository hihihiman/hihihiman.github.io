# ğŸš©Linux é¢è¯•é¢˜


<!--more-->

### jstack çš„ä½¿ç”¨æ–¹å¼/å¦‚ä½•æ’æŸ¥ CPU é£™å‡é—®é¢˜ï¼Ÿ

<!--more-->

1. `jps -l`ï¼šå…ˆæ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„ Java è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚
2. `jstack -l 1234 > thread_dump.txt`ï¼šç”Ÿæˆ Java è¿›ç¨‹çš„çº¿ç¨‹å¿«ç…§ï¼ŒåŒ…æ‹¬æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€çº¿ç¨‹çŠ¶æ€ã€é”ä¿¡æ¯ç­‰ï¼Œä½¿ç”¨ `>` è¾“å‡ºåˆ°æ–‡ä»¶
   1. ä½¿ç”¨ `-l`è¾“å‡ºé”çš„ä¿¡æ¯
   2. ä½¿ç”¨ `-gc` è¾“å‡º gc ä¿¡æ¯
3. ä½¿ç”¨ **VisualVM** è¯»å–ä»¥ä¸Šæ–‡ä»¶ï¼Œè¿›è¡Œå¯è§†åŒ–åˆ†æã€‚
#### CPU å ç”¨ 100% å¯èƒ½æ˜¯ä»€ä¹ˆå¼•èµ·çš„ï¼Ÿ
CPUå¯†é›†å‹æ“ä½œï¼š

1. é¢‘ç¹çš„GC; å¦‚æœè®¿é—®é‡å¾ˆé«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„GCç”šè‡³FGCã€‚å½“è°ƒç”¨é‡å¾ˆå¤§æ—¶ï¼Œå†…å­˜åˆ†é…å°†å¦‚æ­¤ä¹‹å¿«ä»¥è‡³äºGCçº¿ç¨‹å°†è¿ç»­æ‰§è¡Œï¼Œè¿™å°†å¯¼è‡´CPUé£™å‡ã€‚
2. åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å½“ç¨‹åºæ‰§è¡Œxmlè§£ææ—¶ï¼Œè°ƒç”¨é‡ä¼šå¢åŠ ï¼Œä»è€Œå¯¼è‡´CPUå˜æ»¡ã€‚
3. æ­£åˆ™è¡¨è¾¾å¼ã€‚æˆ‘é‡åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼ä½¿CPUå……æ»¡çš„æƒ…å†µ; åŸå› å¯èƒ½æ˜¯Javaæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨çš„å¼•æ“å®ç°æ˜¯NFAè‡ªåŠ¨æœºï¼Œå®ƒå°†åœ¨å­—ç¬¦åŒ¹é…æœŸé—´æ‰§è¡Œå›æº¯ã€‚
4. çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢; æœ‰è®¸å¤šå·²å¯åŠ¨çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹çš„çŠ¶æ€åœ¨Blockedï¼ˆé”å®šç­‰å¾…ï¼ŒIOç­‰å¾…ç­‰ï¼‰å’ŒRunningä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚å½“é”äº‰ç”¨æ¿€çƒˆæ—¶ï¼Œè¿™ç§æƒ…å†µå¾ˆå®¹æ˜“å‘ç”Ÿã€‚
5. æœ‰äº›çº¿ç¨‹æ­£åœ¨æ‰§è¡Œéé˜»å¡æ“ä½œï¼Œä¾‹å¦‚ `while(true)`è¯­å¥ã€‚å¦‚æœåœ¨ç¨‹åºä¸­è®¡ç®—éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œåˆ™å¯ä»¥ä½¿çº¿ç¨‹ä¼‘çœ ã€‚
### å¦‚ä½•åˆ‡æ¢ jdk ç‰ˆæœ¬ï¼Ÿ
`sudo update-alternatives --config java`
### å¦‚ä½•æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Ÿ

- `df -h`ï¼šå…¶ä¸­ -h é€‰é¡¹å¯ä»¥å°†ç£ç›˜å¤§å°ã€å·²ç”¨ç©ºé—´ã€å¯ç”¨ç©ºé—´ä»¥ GB æˆ– MB æ˜¾ç¤º
- `du -h`ï¼šé€’å½’åœ°è®¡ç®—ç›®å½•å’Œæ–‡ä»¶çš„å¤§å°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾ç£ç›˜ç©ºé—´å ç”¨å¤§çš„æ–‡ä»¶å’Œç›®å½•
   - `du --max-depth=1 -h` åªçœ‹ç›®å½•å ç”¨å¤§å°
### æŸ¥çœ‹æ—¥å¿—çš„å‘½ä»¤

- å®æ—¶ç›‘æ§æ—¥å¿—æœ€å 100 è¡Œ
   - tail -n 100 -f xxx.log
- æŒ‰è¡Œå·æŸ¥è¯¢
   - æ”¶å°¾ 100 è¡Œï¼šhead/tail -n 100
   - ç¬¬ 100-300 è¡Œï¼šcat xx.log | tail -n +100 | head -n 200
- æŒ‰æ—¥æœŸæŸ¥è¯¢
   - sed -n'/2023-06-17 08:00:000/,/2023-06-23 17:00:000/p' xx.log
   - ä»¥ä¸Šä¸¤ä¸ªæ—¶é—´å¿…é¡»åœ¨æ—¥å¿—ä¸­å‡ºç°è¿‡
- æŸ¥è¯¢å¹¶è¾“å‡ºæ—¥å¿—
   - cat -n xx.log | grep "error" | error.txt

çº¿ä¸Šè¯Šæ–­ï¼šArthasï¼ŒæŒ‡å®š ip+port å³å¯


---

> ä½œè€…: éƒ½å°†ä¼š  
> URL: https://leni.fun/linux/  

