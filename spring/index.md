# ğŸš©Spring




### ğŸŒŸAOPï¼ˆAspect Oriented Programmingï¼‰é¢å‘åˆ‡é¢ç¼–ç¨‹

<!--more-->

ä½œç”¨ï¼šåœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šä¸ºå…¶è¿›è¡ŒåŠŸèƒ½**å¢å¼º**ã€‚ï¼ˆæ— ä¾µå…¥å¼ï¼‰
#### AOP åŸºæœ¬æ¦‚å¿µ
åœ¨ pom.xml ä¸­å¯¼å…¥ aspectjweaver ï¼Œé…ç½® @EnableAspectJAutoProxy

-  è¿æ¥ç‚¹ï¼ˆJoinPointï¼‰ï¼šæ–¹æ³•ã€å¯åˆ©ç”¨çš„æœºä¼šã€‘ 
-  åˆ‡å…¥ç‚¹ï¼ˆPointCutï¼‰ï¼šæ˜¯è¿æ¥ç‚¹çš„å­é›†ï¼Œè¦è¿½åŠ åŠŸèƒ½çš„æ–¹æ³• ã€è§£å†³äº†åˆ‡é¢ç¼–ç¨‹ä¸­çš„ Where é—®é¢˜ï¼Œè®©ç¨‹åºå¯ä»¥çŸ¥é“å“ªäº›æœºä¼šç‚¹å¯ä»¥åº”ç”¨æŸä¸ªåˆ‡é¢åŠ¨ä½œã€‘
   - [@Pointcut("execution(void ](/Pointcut() com.dao.xxxDao.update())") ä¿®é¥°çš„æ–¹æ³• pt() 
-  é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šæœ‰å…±æ€§çš„åŠŸèƒ½ ã€æ˜ç¡®äº†åˆ‡é¢ç¼–ç¨‹ä¸­çš„ Whatï¼Œä¹Ÿå°±æ˜¯åšä»€ä¹ˆï¼›åŒæ—¶é€šè¿‡æŒ‡å®š Beforeã€After æˆ–è€… Aroundï¼Œå®šä¹‰äº† Whenï¼Œä¹Ÿå°±æ˜¯ä»€ä¹ˆæ—¶å€™åšã€‚ã€‘
   -  @Before("pt()") 
      - å½¢å‚ï¼šJoinPoint
   -  @After("pt()") 
   -  @Around  ("pt()") public void around(**ProceedingJoinPoint** pjp) throws Throwable{ pjp.proceed();} ï¼ˆé‡ç‚¹ï¼Œå¸¸ç”¨ï¼‰ 
      -  å½¢å‚ï¼šProceedingJoinPointï¼ˆå¿…é¡»æ”¾åœ¨å‚æ•°çš„ç¬¬ä¸€ä½ï¼‰ 
      -  è¦æ³¨æ„è¿”å›å€¼å’ŒåŸå§‹æ–¹æ³•ä¸€è‡´ã€‚ 
      -  å¦‚æœä¸æ‰§è¡Œpjp.proceed()ï¼Œå¯ä»¥å®ç°å¯¹åŸå§‹æ–¹æ³•çš„éš”ç¦»ï¼ˆæƒé™æ ¡éªŒï¼‰ 
```java
@Component
@Aspect
public class ProjectAdvice{
  @Pointcut("execution(* com.edu.zjut.service.*Service.*(..))")
  private void servicePt(){}
  
  @Around("ProjectAdvice.servicePt()")
  public void runSpeed(ProceedingJoinPoint pjp) throws Throwable{
    Signature signature = pjp.getSignature();
    String className = signature.getDeclaringTypeNmae();
    String methodName = signature.getName();
    long start = System.currentTimeMillis();
    for(int i=0;i<10000;i++){
      pjp.proceed();
    }
    long end = System.currentTimeMillis();
    System.out.println("ä¸šåŠ¡å±‚æ¥å£ä¸‡æ¬¡æ‰§è¡Œ"+ className + "." + methodName + "------>" + (end-start)+"ms");
  }
}
```

   -  AfterReturning("pt()") åªæœ‰ä¸æŠ›å¼‚å¸¸æ‰è¿è¡Œ 
   -  AfterThrowing("pt()")åªæœ‰æŠ›å¼‚å¸¸æ‰è¿è¡Œ 
-  åˆ‡é¢ï¼ˆAspectï¼‰ï¼šé€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„è”ç³»ï¼ˆå¤šå¯¹å¤šï¼‰ 
-  é€šçŸ¥ç±»ï¼šå®šä¹‰é€šçŸ¥çš„ç±» 
   - [@Aspect ](/Aspect ) 
#### AOP å·¥ä½œæµç¨‹
AOPçš„æœ¬è´¨æ˜¯**ä»£ç†æ¨¡å¼**

1. Springå®¹å™¨å¯åŠ¨
2. è¯»å–åˆ‡é¢ä¸­é…ç½®çš„åˆ‡å…¥ç‚¹
3. åˆå§‹åŒ–beanï¼Œè‹¥ç±»ä¸­æ–¹æ³•åŒ¹é…åˆ°åˆ‡å…¥ç‚¹ï¼Œåˆ™åˆ›å»º**ä»£ç†å¯¹è±¡**
4. è·å–beanæ‰§è¡Œæ–¹æ³•
#### åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
æ ‡å‡†æ ¼å¼ï¼š`execution(è¿”å›å€¼ åŒ….ç±».æ¥å£ï¼ˆæ¨èï¼‰/å®ç°ç±».æ–¹æ³•())`
é€šé…ç¬¦ï¼š`*`åŒ¹é…ä»»æ„ç¬¦å·ï¼Œ`..åŒ¹é…å¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¦‚ï¼š`execution(_ _.._Service+._(..))`åŒ¹é…ä¸šåŠ¡å±‚æ‰€æœ‰æ¥å£
ä¹¦å†™æŠ€å·§ï¼š

1. æ‰€æœ‰ç±»å‘½åéœ€è§„èŒƒï¼Œå¦åˆ™ä»¥ä¸‹å¤±æ•ˆ
2. æè¿°åˆ‡å…¥ç‚¹é€šå¸¸æè¿°æ¥å£ï¼Œè€Œä¸æè¿°å®ç°ç±»
3. å¢åˆ æ”¹ç±»ä½¿ç”¨ç²¾å‡†ç±»å‹åŠ é€ŸåŒ¹é…ï¼ŒæŸ¥è¯¢ç±»ä½¿ç”¨*é€šé…å¿«é€Ÿæè¿°
4. æ–¹æ³•åä»¥åŠ¨è¯è¿›è¡Œç²¾å‡†åŒ¹é…
5. åŒ…åä¹¦å†™å°½é‡ä¸ä½¿ç”¨ .. åŒ¹é…ï¼Œæ•ˆç‡å¤ªä½ï¼Œå¸¸ç”¨ * åšå•ä¸ªåŒ…æè¿°åŒ¹é…
6. ä¸ä½¿ç”¨å¼‚å¸¸ä½œä¸ºåŒ¹é…è§„åˆ™
### ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼Ÿ
åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ã€åŠ¨æ€å¤„ç†ä»£ç†æ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œå¾ˆå¤šåœºæ™¯éƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼æœºåˆ¶åšåˆ°çš„ï¼Œæ¯”å¦‚ç”¨æ¥åŒ…è£… RPC è°ƒç”¨ã€é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼Œæœ‰ä¸¤ç§å®ç°ï¼š

- **JDKï¼šå®ç°æ¥å£**ï¼Œè¿ç”¨åå°„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼ŒSpring AOPå°†ä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¥ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚ä»£ç†å¯¹è±¡å®ç°äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚JDKåŠ¨æ€ä»£ç†æ˜¯é€šè¿‡java.lang.reflect.Proxyç±»å’Œjava.lang.reflect.InvocationHandleræ¥å£å®ç°çš„ã€‚
- **cglibï¼šä¿®æ”¹å­—èŠ‚ç **ï¼Œç”Ÿæˆå­ç±»ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ŒSpring AOPå°†ä½¿ç”¨CGLIBåº“ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚CGLIBä»£ç†é€šè¿‡ç»§æ‰¿ç›®æ ‡å¯¹è±¡çš„å­ç±»æ¥ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç„¶ååœ¨å­ç±»ä¸­ç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚CGLIBä»£ç†å¯ä»¥å¤„ç†æ²¡æœ‰æ¥å£çš„ç›®æ ‡å¯¹è±¡ã€‚
   - åŸºäº **ASMï¼Œå¯ä»¥ç›´æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶**ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸º
### Spring äº‹åŠ¡

- ç¼–ç¨‹å¼ï¼šTransactionTemplate å¯¹ä¸šåŠ¡æœ‰ä¾µå…¥æ€§ï¼Œå°‘ç”¨ã€‚
- å£°æ˜å¼ï¼š@EnableTransactionManagement + @TranSactional
   - é€šè¿‡ AOP å°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼ˆæ–¹æ³•å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•åé…Œæƒ…å›æ»šï¼‰
#### äº‹åŠ¡å¤±æ•ˆåœºæ™¯

1. å¼‚å¸¸æ•è· => åœ¨ catch ä¸­ throw å¼‚å¸¸
2. æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ => æŒ‡å®š rollbackforï¼Œå› ä¸ºé»˜è®¤åªå›æ»šéæ£€æŸ¥å¼‚å¸¸
3. é public æ–¹æ³•
### å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿä¸‰çº§ç¼“å­˜ or @lazy
ä¸‰çº§ç¼“å­˜åªèƒ½è§£å†³åˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„å¾ªç¯ä¾èµ–ï¼š

- ä¸€çº§ singletonObjectsï¼šå•ä¾‹æ± ï¼Œå­˜æ”¾å·²åˆå§‹åŒ–å®Œæˆçš„ bean
- äºŒçº§ earlySingletonObjectsï¼šå­˜æ”¾ç”Ÿå‘½å‘¨æœŸæœªèµ°å®Œçš„ bean
- ä¸‰çº§ singletonFactoriesï¼šå¯¹è±¡å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡

å¯¹äºæ„é€ æ–¹æ³•ä¸­çš„å¾ªç¯ä¾èµ–ï¼Œé‡‡ç”¨ @lazy è¿›è¡Œæ‡’åŠ è½½
### Spring Cloud æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼Ÿ

1.  RestTemplateæ–¹å¼è°ƒç”¨ 
   1. æ³¨å…¥ RestTemplate çš„beanï¼Œæ·»åŠ @Beanæ³¨è§£
   2. è°ƒç”¨ `.getForObject()` æˆ– `.postForObject()` æ–¹æ³•
2.  Feignæ–¹å¼è°ƒç”¨ 
   1.  æ·»åŠ  pom ä¾èµ– 
   2.  å¯åŠ¨ç±»æ·»åŠ  [@EnableFeignClients ](/EnableFeignClients ) æ³¨è§£  
   3.  å†™æ¥å£ï¼š 
```java
@FeignClient("userservice")
public interface UserClient{
  @GetMapping("/user/{id}")
  User findById(@PathVariable("id") Long id);
}
```

   4.  ä½¿ç”¨ FeignClient ä¸­å®šä¹‰çš„æ–¹æ³•å–ä»£ RestTemplateï¼ˆå¹¶é›†æˆäº† ribbonï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡ï¼‰
      IRule æ¥å£å†³å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶é€‰æ‹©æŸä¸ªæœåŠ¡ï¼š 
      1. **ZoneAvoidanceRule**ï¼ˆé»˜è®¤ï¼‰ï¼šå¯¹ZoneåŒºåŸŸå†…å¤šä¸ªæœåŠ¡è½®è¯¢ï¼Œzoneå€¼å¯é…ç½®
      2. RoundRobinRuleï¼šè½®è¯¢
      3. WeightedResponseTimeRuleï¼šæœåŠ¡å“åº”æ—¶é—´è¶Šé•¿ï¼ŒæœåŠ¡å™¨æƒé‡å°±è¶Šå°ï¼Œæ¦‚ç‡å°±è¶Šä½
      4. RandomRuleï¼šéšæœº
### SpringMVC æ‰§è¡Œæµç¨‹ï¼Ÿ
ä¸ DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ ä¾æ¬¡äº¤äº’çš„æœ‰ï¼š

- HandlerMapping ï¼ˆå¤„ç†å™¨æ˜ å°„å™¨ï¼‰ï¼šæ‰¾åˆ°ç±»å#æ–¹æ³•å
- HandlerAdaptorï¼ˆé€‚é…å™¨ï¼‰ï¼šå¤„ç†å‚æ•°ã€è¿”å›å€¼
- ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼Œç”¨äº JSPï¼‰ï¼šé€»è¾‘è§†å›¾ -> è§†å›¾

å¯¹äºå‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ  @ResponseBodyï¼Œé€šè¿‡ HttpMessageConverter å“åº” JSON æ•°æ®
@RestController = @Controller + @ResponseBody

### JWT
#### JWT æ•°æ®ç»“æ„ï¼Ÿ

- head
- payload
   - ç”¨æˆ·ä¿¡æ¯
   - åŠ å¯†ä¿¡æ¯
   - è¿‡æœŸæ—¶é—´
- signature
#### JWT å’Œ token çš„åŒºåˆ«ï¼Ÿ
token éœ€è¦æŸ¥æ•°æ®åº“ï¼ŒJWT ä¸éœ€è¦ã€‚
#### securityå’Œjwtæ€ä¹ˆèåˆï¼Ÿ

- è®¤è¯ï¼šä¸»è¦ jwt çš„ token å®ç°
- é‰´æƒï¼šspringSecurityå®ç°ï¼ŒRBAC = Role-Based Access Control
#### ä»cookieåˆ°jwtè§£å†³äº†ä»€ä¹ˆï¼Ÿ

1. å¯ä»¥è½¬åŒ–ä¸º json ä¸²ï¼Œå¯è¯»æ€§å¼ºï¼›
2. RESTful è®¾è®¡åŸåˆ™ï¼Œé¿å…åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯çŠ¶æ€ï¼Œé™ä½äº†æœåŠ¡å™¨ç«¯çš„è´Ÿæ‹…ï¼›
3. ç­¾åæœºåˆ¶ï¼Œå®‰å…¨æ€§å¼ºã€‚
#### token æ³„éœ²æ€ä¹ˆå¤„ç†ï¼Ÿ
é‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼šç»™å‰ç«¯ä¸€ä¸ªå…¬é’¥ï¼ŒåŠ å¯†æ•°æ®ä¼ åˆ°åå°ï¼Œç”¨ç§é’¥è§£å¯†åå¤„ç†æ•°æ®ã€‚
### Springbootçš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ
#### @SpringbootApplication

- @SpringBootConfiguration å£°æ˜å½“å‰ç±»ä¸ºé…ç½®ç±»
- @ComponentScan ç»„ä»¶æ‰«æ
- @EnableAutoConfiguration è‡ªåŠ¨åŒ–é…ç½®
   - @Import è¯»å–äº†é¡¹ç›®å’Œé¡¹ç›®å¼•ç”¨çš„ jar åŒ…ï¼Œä½äº classpath è·¯å¾„ä¸‹ META-INF/spring.factories æ–‡ä»¶
   - @ConditionalOnClass æœ‰åˆ™åŠ è½½
#### æ³¨å…¥æ–¹å¼
å¯¹äºå¼•ç”¨ç±»å‹ï¼š

1. æŒ‰ç±»å‹ byTypeï¼ˆæ¨èï¼‰ï¼š[**@Autowired **](/Autowired )** ** ä½¿ç”¨çš„æ˜¯æš´åŠ›åå°„ï¼Œä¸éœ€è¦ setteræ–¹æ³•
2. æŒ‰åç§° byNameï¼ˆå˜é‡åä¸é…ç½®è€¦åˆï¼Œä¸æ¨èï¼‰ 
   1. [@Autowired ](/Autowired ) + @Qualifier("beanName ") 
   2. @Resource("åç§°")
3. æŒ‰æ„é€ æ–¹æ³•ï¼ˆä¸å¸¸ç”¨ï¼‰

å¯¹äºç®€å•å±æ€§ï¼šä½¿ç”¨ @Value("xxx")æ³¨å…¥ï¼Œå¯ä»¥æ¥è‡ªå¤–éƒ¨ propertyï¼Œå†™æ³•ï¼š`@Value("${name}")`
åŠ è½½å¤–éƒ¨properties ä½¿ç”¨ @PropertySource("classpath:jdbc.properties")ï¼Œä¸å¯ä»¥ä½¿ç”¨æ˜Ÿå·`*`


### è°ˆè°ˆSpring Beançš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼Ÿ
#### ç”Ÿå‘½å‘¨æœŸ

1. å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒSpring ä¼šä½¿ç”¨é…ç½®å…ƒæ•°æ®ï¼ˆXMLã€æ³¨è§£æˆ–Javaé…ç½®ï¼‰æ¥åˆ›å»º Bean çš„å®ä¾‹ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°æ¥å®Œæˆçš„ã€‚
2. å±æ€§èµ‹å€¼ï¼ˆPopulationï¼‰ï¼šåœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpring å°†ä¼šé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰æˆ–å±æ€§èµ‹å€¼çš„æ–¹å¼æ¥è®¾ç½® Bean çš„å±æ€§å’Œä¾èµ–ã€‚è¿™å¯ä»¥é€šè¿‡ setter æ–¹æ³•æ³¨å…¥æˆ–ä½¿ç”¨å­—æ®µæ³¨å…¥æ¥å®ç°ã€‚
3. åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šåœ¨å±æ€§èµ‹å€¼å®Œæˆåï¼ŒSpring å°†ä¼šè°ƒç”¨ Bean çš„åˆå§‹åŒ–å›è°ƒæ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¼€å‘è€…å¯ä»¥åœ¨ Bean ä¸­å®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œä½¿ç”¨ @PostConstruct æ³¨è§£æˆ–å®ç° InitializingBean æ¥å£æ¥æŒ‡å®šåˆå§‹åŒ–é€»è¾‘ã€‚
4. ä½¿ç”¨ï¼ˆIn Useï¼‰ï¼šåœ¨åˆå§‹åŒ–å®Œæˆåï¼ŒBean å¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨ã€‚æ­¤æ—¶ï¼ŒBean å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¯ä»¥è¢«å…¶ä»–ç»„ä»¶æˆ–è€…åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
5. é”€æ¯ï¼ˆDestructionï¼‰ï¼šå½“åº”ç”¨ç¨‹åºå…³é—­æˆ–è€…ä¸å†éœ€è¦æŸä¸ª Bean æ—¶ï¼ŒSpring ä¼šè°ƒç”¨é”€æ¯å›è°ƒæ–¹æ³•æ¥è¿›è¡Œèµ„æºé‡Šæ”¾æˆ–æ¸…ç†æ“ä½œã€‚å¼€å‘è€…å¯ä»¥åœ¨ Bean ä¸­å®šä¹‰é”€æ¯æ–¹æ³•ï¼Œä½¿ç”¨ @PreDestroy æ³¨è§£æˆ–å®ç° DisposableBean æ¥å£æ¥æŒ‡å®šé”€æ¯é€»è¾‘ã€‚

ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼å®ç°ï¼š

1. å®ä¾‹åŒ– Beanï¼šé¦–å…ˆï¼ŒSpringä¼šå®ä¾‹åŒ– Beanï¼Œå³åˆ›å»º Bean çš„å¯¹è±¡ã€‚
2. Awareæ¥å£å›è°ƒï¼šå¦‚æœ Bean å®ç°äº†ä»»ä½• Aware æ¥å£ï¼ˆä¾‹å¦‚ BeanNameAwareã€BeanFactoryAwareã€ApplicationContextAwareï¼‰ï¼Œåœ¨å®ä¾‹åŒ–ä¹‹åä½†åœ¨å±æ€§èµ‹å€¼ä¹‹å‰ï¼ŒSpringä¼šè°ƒç”¨ç›¸åº”çš„ Aware æ¥å£å›è°ƒæ–¹æ³•ï¼Œå°†ç›¸å…³çš„å¼•ç”¨æˆ–èµ„æºä¼ é€’ç»™ Beanã€‚
3. å±æ€§èµ‹å€¼ï¼šåœ¨ Aware æ¥å£å›è°ƒä¹‹åï¼ŒSpringä¼šè¿›è¡Œå±æ€§èµ‹å€¼ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼Œå°†é…ç½®æˆ–æ³¨å…¥çš„å±æ€§å€¼è®¾ç½®åˆ° Bean ä¸­ã€‚
4. BeanPostProcessorå‰ç½®å¤„ç†ï¼šåœ¨å±æ€§èµ‹å€¼ä¹‹åï¼ŒSpringä¼šè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor çš„ postProcessBeforeInitialization æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…åœ¨ Bean çš„åˆå§‹åŒ–ä¹‹å‰è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚
5. åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ï¼šå¦‚æœ Bean å®šä¹‰äº†åˆå§‹åŒ–æ–¹æ³•ï¼ˆä¾‹å¦‚é€šè¿‡ @PostConstruct æ³¨è§£æˆ–å®ç° InitializingBean æ¥å£ï¼‰ï¼Œåœ¨å‰ç½®å¤„ç†ä¹‹åï¼ŒSpringä¼šè°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ã€‚
6. BeanPostProcessoråç½®å¤„ç†ï¼šåœ¨åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹åï¼ŒSpringä¼šå†æ¬¡è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor çš„ postProcessAfterInitialization æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…åœ¨ Bean çš„åˆå§‹åŒ–ä¹‹åè¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚
7. Bean å¯ç”¨ï¼šæ­¤æ—¶ï¼ŒBeanå·²ç»å®Œæˆäº†åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚
#### äº”ä¸ªä½œç”¨åŸŸ
å…¶ä¸­æœ€åŸºç¡€çš„æœ‰ä¸‹é¢ä¸¤ç§ï¼š

1. Singletonï¼Œè¿™æ˜¯ Spring çš„é»˜è®¤ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ª IOC å®¹å™¨åˆ›å»ºå”¯ä¸€çš„ä¸€ä¸ª Bean å®ä¾‹ã€‚ã€é€‚åˆæ— çŠ¶æ€ã€‘
2. Prototypeï¼Œé’ˆå¯¹æ¯ä¸ª getBean è¯·æ±‚ï¼Œå®¹å™¨éƒ½ä¼šå•ç‹¬åˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚ã€é€‚åˆæœ‰çŠ¶æ€ã€‘

å¦‚æœæ˜¯ Web å®¹å™¨ï¼š

1. Requestï¼Œä¸ºæ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºå•ç‹¬çš„ Bean å®ä¾‹ã€‚
2. Sessionï¼Œå¾ˆæ˜¾ç„¶ Bean å®ä¾‹çš„ä½œç”¨åŸŸæ˜¯ Session èŒƒå›´ã€‚
3. GlobalSessionï¼Œç”¨äº Portlet å®¹å™¨ï¼Œå› ä¸ºæ¯ä¸ª Portlet æœ‰å•ç‹¬çš„ Sessionï¼ŒGlobalSession æä¾›ä¸€ä¸ªå…¨å±€æ€§çš„ HTTP Sessionã€‚
### IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬
ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œä¸å†é€šè¿‡ new äº§ç”Ÿå¯¹è±¡ï¼Œåˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè½¬ç§»åˆ°**å¤–éƒ¨**çš„IoCå®¹å™¨ï¼ˆApplicationContextï¼Œæ¥å£ï¼‰
bean ä¹‹é—´çš„ä¾èµ–æ³¨å…¥æ–¹å¼

1. setteræ³¨å…¥ï¼ˆå»ºè®®ï¼‰ï¼šæ›´åŠ çµæ´»ï¼Œå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºä»¥ååŠ¨æ€æ›´æ”¹ä¾èµ–å…³ç³»
2. æ„é€ æ–¹æ³•æ³¨å…¥ï¼šä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œä¾èµ–å…³ç³»å°±ä¸èƒ½å†æ”¹å˜

### Qï¼šæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸è¿‡æ»¤å™¨ï¼ˆFilterï¼‰çš„åŒºåˆ«ï¼Ÿ

Aï¼š

- å½’å±ä¸åŒï¼šFilterå±äºServletæŠ€æœ¯ï¼ŒInterceptorå±äºSpringMVCæŠ€æœ¯
- æ‹¦æˆªå†…å®¹ä¸åŒï¼šFilterå¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œå¢å¼ºï¼ŒInterceptorä»…é’ˆå¯¹SpringMVCçš„è®¿é—®è¿›è¡Œå¢å¼º

#### æ‰§è¡Œæµç¨‹

1. preHandleï¼ˆreturn true æ‰èµ°ä¸‹ä¸€æ­¥ï¼Œfalseç»“æŸï¼‰
2. controller
3. postHandle
4. AfterCompletion

#### æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰

æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œä½œç”¨ï¼š

1. åœ¨æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç 
2. ç»„ç»‡åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ

```java
// preHandle æ–¹æ³•ä¸­å¯ä»¥æ ¹æ®è¿”å›å€¼å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œæ–¹æ³•
// å¹¶ä¸”å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‹¦æˆªæ–¹æ³•ï¼Œè¿›è¡Œæ›´å¤šæ“ä½œ
HandlerMethod hm = (HandlerMethod) handler;
hm.getMethod();
```

#### æ‹¦æˆªå™¨é“¾

preHandleåœ¨å‰çš„æ‹¦æˆªå™¨ï¼ŒpostHandle å’Œ afterCompletion åœ¨åã€‚

- 123 éƒ½ä¸º trueï¼špre 123 -> controller -> post 321 -> after 321
- 12 true 3 falseï¼špre12 -> after 21
- 13 true 2 falseï¼š pre1  -> after 1
- 23 true 1 falseï¼šéƒ½ä¸æ‰§è¡Œ

### å…¨å±€å¼‚å¸¸å¤„ç†

è¡¨ç°å±‚é€šè¿‡AOPå¤„ç†

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = Exception.class)
    public CommonResult handleUnknownException(Exception e) {
        return CommonResult.failed(ResultCode.UNKN0OWN_FAILED,"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•ï¼");
    }
}
```

- ä¸šåŠ¡å¼‚å¸¸ï¼šæé†’ç”¨æˆ·è§„èŒƒæ“ä½œ
- ç³»ç»Ÿå¼‚å¸¸ï¼šå®‰æŠšç”¨æˆ·ï¼Œé€šçŸ¥è¿ç»´ï¼Œè®°å½•æ—¥å¿—

### RESTé£æ ¼ï¼ˆRepresentational State Transferï¼‰è¡¨ç°å½¢å¼çŠ¶æ€è½¬æ¢

èµ„æºåç§°é‡‡ç”¨å¤æ•°ï¼Œå¦‚usersã€books

- GETï¼šæŸ¥è¯¢
- POSTï¼šæ–°å¢
- PUTï¼šä¿®æ”¹
- DELETEï¼šåˆ é™¤

### Qï¼šå¦‚ä½•é¿å…SpringåŠ è½½SpringMVCå·²åŠ è½½çš„Controllerï¼Ÿ

Aï¼šåŠ è½½Springæ§åˆ¶çš„beançš„æ—¶å€™ï¼Œæ’é™¤æ‰SpringMVCæ§åˆ¶çš„beanã€‚

1. `@ComponentScan(value = "edu.zjut",excludeFilters=@ComponentScan.Filter(type=FilterType.ANNOTATION,classes=Controller.class))`æŒ‰ç…§æ³¨è§£æ’é™¤
2. `@ComponentScan({"edu.zjut.service","edu.zjut.dao"})`
3. ä¸åŒºåˆ†Springå’ŒSpringMVCçš„ç¯å¢ƒï¼Œéƒ½åŠ è½½

### å‚æ•°ä¼ é€’

- @RequestParam("xxx")ï¼šè¯·æ±‚å‚æ•°å’Œå½¢å‚ä¸åŒæ—¶éœ€é…ç½®ï¼Œä¸å†™çš„è¯é»˜è®¤å–ç›¸åŒã€‚
- [@RequestParam ]() ä¿®é¥° List å°±å¯ä»¥å®ç°é›†åˆä¼ å‚ã€‚ 
- å‚æ•°å¯¹è±¡ä¸­æœ‰å¯¹è±¡æ—¶é‡‡ç”¨ `address.city=beijing` è¿™ç§å½¢å¼ã€‚
- @RequestBodyï¼šè®¾ç½®controlleræ–¹æ³•è¿”å›å€¼ä¸ºå“åº”ä½“ã€‚ä¼ å­—ç¬¦ä¸²ï¼ˆjsonï¼‰ç”¨ 

- - HttpMessageConverter

- æ—¥æœŸå‚æ•°ï¼šæ¥æ”¶å¯ä»¥ç”¨ Date æ¥ï¼ŒåŠ ä¸Š [@DateTimeFormat(pattern ]() = "yyyy-MM-dd") 
- [@PathVariable ]() ä»è·¯å¾„ä¸­å–å€¼ 

### SpringMVC

åŸºäº Java å®ç° MVC æ¨¡å‹çš„è½»é‡çº§ web æ¡†æ¶ã€‚

åç«¯æœåŠ¡å™¨ï¼š

- è¡¨ç°å±‚ï¼šSpringMVCï¼ˆå–ä»£ Servletï¼‰ï¼Œå°è£…æ•°æ®ï¼ˆcodeã€msgã€dataï¼‰ï¼Œç”¨postmanæµ‹è¯•
- ä¸šåŠ¡å±‚ï¼šSpringï¼Œç”¨JUnitæµ‹è¯• 

- - @RunWith(SpringJUnit4ClassRunner.class)
  - [@ContextConfiguration(classes ]() = SpringConfig.class) 

- æ•°æ®å±‚ï¼šMybatis

è¿”å› json æ•°æ®ï¼Œéœ€è¦åŠ  [@ResponseBody ]() æ³¨è§£ã€‚ 

### ğŸŒŸQï¼šå¦‚ä½•ä¿è¯æ— è®ºè½¬è´¦æ˜¯å¦æˆåŠŸéƒ½è®°å½•æ—¥å¿—ç•™ç—•ï¼Ÿ

Aï¼šæ—¥å¿—å¯¹åº”çš„äº‹åŠ¡ä¸è¦åŠ å…¥è½¬è´¦çš„äº‹åŠ¡ä¸­ï¼Œåœ¨æ’å…¥æ—¥å¿—çš„æ–¹æ³•ä¸ŠåŠ ä¸Š `@Transactional(propagation = Propagation.REQUIRES_NEW)`

äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šä½œä¸ºåè°ƒå‘˜ï¼Œ

- REQUIREDï¼ˆé»˜è®¤ï¼‰ï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡äº‹åŠ¡å°±æ–°å»º
- REQUIRED_NEWï¼šæ— è®ºå¦‚ä½•éƒ½æ–°å»ºäº‹åŠ¡
- SUPPORTSï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ç®—äº†
- NOT_SUPPORTSï¼šæ— ä¹±å¦‚ä½•éƒ½ä¸æ”¯æŒäº‹åŠ¡
- MANDATORYï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ¥é”™
- NEVERï¼šäº‹åŠ¡ç®¡ç†å‘˜æ²¡äº‹åŠ¡æ²¡å…³ç³»ï¼Œæœ‰äº‹åŠ¡å°±æŠ¥é”™
- NESTEDï¼šè®¾ç½® savePoint


---

> ä½œè€…: éƒ½å°†ä¼š  
> URL: https://leni.fun/spring/  

