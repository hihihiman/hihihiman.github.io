# 🚩Raft




### Raft 协议的基本原理是什么？

Raft 协议的基本原理是通过选举一个 leader 节点来管理整个集群，并通过 leader 节点向其他节点发送心跳信号和日志复制等信息来保持数据的一致性。当 leader 节点失效时，其他节点会重新选举出新的 leader 节点。

<!--more-->

### Raft 协议中有哪些角色？
Raft 协议中有三种角色：leader、follower 和 candidate。其中，leader 负责管理整个集群，follower 和 candidate 则负责接收 leader 的指令和提交日志等操作。
### Raft 协议中的选举过程是怎样的？
Raft 协议的选举过程分为两个阶段：选举阶段和日志复制阶段。在选举阶段，follower 节点会向其他节点发送 RequestVote 请求，请求其他节点投票支持自己成为 candidate 节点。当一个 candidate 节点获得了大多数节点的投票时，就会成为新的 leader 节点，并开始向其他节点发送心跳信号和日志复制等操作。
### Raft 协议如何保证数据的一致性？
Raft 协议通过 leader 节点向其他节点发送心跳信号和日志复制等信息来保持数据的一致性。当 leader 节点接收到客户端的请求时，会将请求转换成一条日志，并将该日志复制到其他节点上，以保证所有节点上的数据都是一致的。
### Raft 协议中如何处理网络分区问题？
Raft 协议中通过选举机制来避免网络分区问题。当一个节点与其余节点失去联系时，其余节点会重新选举出新的 leader 节点，从而保证整个集群的正常运行。当网络分区问题解决后，失去联系的节点会重新加入集群中，同步最新的数据。
### Raft 和 zab 协议的区别？
相同点：

1. 一致性都由 quorum（仲裁集，少数服从多数）来保证，zookeeper实现了带权重的quorum
2. 都由 leader 来发起写操作
3. 心跳机制检测存货行
4. leader election 选举都采用先到先得都投票方式

不同点：

1. zab 用的是 epoch(时代，纪元) 和 count 的组合来唯一表示一个值, 而 raft 用的是 term 和 index。
2. zab 的 follower 在投票给一个 leader 之前必须和 leader 的日志达成一致,而 raft 的 follower则简单地说是谁的 term 高就投票给谁。
3. raft 协议数据只有单向地从 leader 到 follower(成为 leader 的条件之一就是拥有最新的 log)。而 zab 协议在 discovery 阶段, 一个 prospective(潜在的) leader 需要将自己的 log 更新为 quorum 里面最新的 log,然后才好在 synchronization 阶段将 quorum 里的其他机器的 log 都同步到一致。
### Paxos vs Raft？
Paxos算法和Raft协议都是分布式一致性算法，用于解决分布式系统中节点之间的数据一致性问题。它们的基本思想和目标是相同的，但是在实现细节和应用场景上有一些不同。

1. 实现难度

Paxos算法相对于Raft协议更加复杂，更加难以理解和实现。Paxos算法的实现需要考虑多个复杂的情况，包括多个阶段的消息协议、多个角色的状态转换、多个副本之间的数据同步等。Raft协议相对来说更加简单易懂，实现起来也更加容易理解和维护。

2. 可扩展性

Paxos算法在节点数量较大时，消息通信和数据同步的效率会降低，因此它的可扩展性相对较差。Raft协议在节点数量较大时，依然能够保持较好的性能和可扩展性。

3. 选举机制

Paxos算法的选举机制是基于**提案（proposal）**的，每个节点都可以提出一个提案，并通过协商过程来选出一个最终的提案。Raft协议的选举机制是基于角色的，只有一个节点能够成为leader，其他节点则成为follower或candidate。

4. 可读性

Raft协议相对于Paxos算法具有更好的可读性。Raft协议中的角色和消息通信比较直观和易懂，容易让人理解和记忆。
总的来说，Paxos算法和Raft协议都是分布式一致性算法，它们的目标和基本思想相同，但是在实现细节、可扩展性、选举机制和可读性等方面有所不同。在实际应用中，需要根据具体的场景和需求选择适合的算法。
### 如何选择一致性算法？
在实际应用中，选择合适的分布式一致性算法需要考虑多个因素，包括数据一致性要求、系统规模、可用性、性能等方面。
1. 数据一致性要求
首先需要根据实际需求来确定数据一致性的要求，包括强一致性、弱一致性或最终一致性等。如果数据一致性要求较高，需要选择能够提供强一致性的算法，如Paxos算法或Raft协议。如果数据一致性要求较低，可以选择提供最终一致性的算法，如Gossip协议或CRDT算法。
2. 系统规模
其次需要考虑系统规模，包括节点数量、数据量、数据分布等方面。如果系统规模较小，可以选择一些简单易懂、易于实现的算法，如Raft协议。如果系统规模较大，需要选择能够提供高性能和可扩展性的算法，如Paxos算法或Gossip协议。
3. 可用性
还需要考虑系统的可用性，即在节点故障、网络分区等情况下，系统是否能够继续正常运行。如果可用性要求较高，需要选择能够提供高可用性的算法，如Raft协议。如果可用性要求较低，可以选择一些性能更高的算法，如Paxos算法。
4. 性能
最后需要考虑系统的性能，包括吞吐量、延迟、负载均衡等方面。如果性能要求较高，需要选择能够提供高性能的算法，如Paxos算法或Gossip协议。如果性能要求较低，可以选择一些简单易懂、易于实现的算法，如Raft协议。
总的来说，在实际应用中，选择合适的分布式一致性算法需要综合考虑数据一致性要求、系统规模、可用性和性能等方面，根据具体需求选择适合的算法。同时，需要根据实际情况进行测试和调优，以保证系统的稳定性和性能。



---

> 作者: 都将会  
> URL: https://leni.fun/raft/  

