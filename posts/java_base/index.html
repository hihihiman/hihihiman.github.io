<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>🚩Java 基础 -</title><meta name=author content="都将会"><meta name=author-link content><meta name=description content="学习 Java 必须掌握的基础知识"><meta name=keywords content="Java,interview,面试"><meta itemprop=name content="🚩Java 基础"><meta itemprop=description content="学习 Java 必须掌握的基础知识"><meta itemprop=datePublished content="2023-08-08T15:09:51+08:00"><meta itemprop=dateModified content="2023-08-08T15:09:51+08:00"><meta itemprop=wordCount content="234"><meta itemprop=image content="https://leni.fun/images/avatar.jpg"><meta itemprop=keywords content="Java,"><meta property="og:title" content="🚩Java 基础"><meta property="og:description" content="学习 Java 必须掌握的基础知识"><meta property="og:type" content="article"><meta property="og:url" content="https://leni.fun/posts/java_base/"><meta property="og:image" content="https://leni.fun/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-08T15:09:51+08:00"><meta property="article:modified_time" content="2023-08-08T15:09:51+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leni.fun/images/avatar.jpg"><meta name=twitter:title content="🚩Java 基础"><meta name=twitter:description content="学习 Java 必须掌握的基础知识"><meta name=application-name content="都将会的 APP"><meta name=apple-mobile-web-app-title content="都将会的 APP"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leni.fun/posts/java_base/><link rel=prev href=https://leni.fun/posts/linux/><link rel=next href=https://leni.fun/posts/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"🚩Java 基础","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leni.fun\/posts\/java_base\/"},"genre":"posts","keywords":"Java","wordcount":234,"url":"https:\/\/leni.fun\/posts\/java_base\/","datePublished":"2023-08-08T15:09:51+08:00","dateModified":"2023-08-08T15:09:51+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"都将会"},"description":"学习 Java 必须掌握的基础知识"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=/images/avatar.jpg data-alt=/images/avatar.jpg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=输入关键词搜索 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=/images/avatar.jpg data-alt=/images/avatar.jpg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=输入关键词搜索 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title>Home</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>🚩Java 基础</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>🚩Java 基础</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=都将会 data-alt=都将会 class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;都将会</span></span>
<span class=post-category>included in <a href=/categories/interview/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> interview</a></span></div><div class=post-meta-line><span title="published on 2023-08-08 15:09:51"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-08-08>2023-08-08</time></span>&nbsp;<span title="Updated on 2023-08-08 15:09:51"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-08-08>2023-08-08</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>234 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>2 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#元注解>元注解</a></li><li><a href=#反射>反射</a></li><li><a href=#api-vs-spi>API vs SPI？</a></li><li><a href=#happens-before规则>happens-before规则？</a></li><li><a href=#为什么金额不能使用double要使用bigdecimal>为什么金额不能使用double，要使用BigDecimal？</a></li><li><a href=#强引用软引用弱引用幻象引用有什么区别>强引用、软引用、弱引用、幻象引用有什么区别？</a></li><li><a href=#nio>NIO</a></li><li><a href=#todo什么是零拷贝>todo：什么是零拷贝？</a></li><li><a href=#jit>JIT</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681107594592-f7815896-a369-4941-972a-44a823f91a30.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681107594592-f7815896-a369-4941-972a-44a823f91a30.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681107594592-f7815896-a369-4941-972a-44a823f91a30.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681107594592-f7815896-a369-4941-972a-44a823f91a30.png 2x" sizes=auto data-title=image.png data-alt=image.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h3 id=元注解>元注解</h3><ul><li><p><code>@Retention</code>用于标明注解被保留的阶段 RetentionPolicy</p></li><li><ul><li>SOURCE 源文件保留</li><li>CLASS 编译期保留，默认值（.class：RuntimeInvisibleAnnotations）</li><li>RUNTIME 运行期保留，可通过反射去获取注解信息（.class： RuntimeVisibleAnnotations）</li></ul></li><li><p><code>@Target</code>用于标明注解使用的范围 ElementType</p></li><li><p><code>@Inherited</code>用于标明注解可继承</p></li></ul><h3 id=反射>反射</h3><ol><li><p>反射类及反射方法的获取，都是通过从列表中搜寻查找匹配的方法，所以查找性能会随类的大小方法多少而变化；</p></li><li><p>每个类都会有一个与之对应的Class实例，从而每个类都可以获取method反射方法，并作用到其他实例身上；</p></li><li><p>反射也是考虑了线程安全的，放心使用；</p></li><li><p>反射使用软引用relectionData缓存class信息，避免每次重新从jvm获取带来的开销；</p></li><li><p>反射调用多次生成新代理Accessor, 而通过字节码生存的则考虑了卸载功能，所以会使用独立的类加载器；</p></li><li><ol><li>invoke时，是通过 MethodAccessor 进行调用的，而 MethodAccessor 是个接口，在第一次时调用 acquireMethodAccessor() 进行新创建。</li><li>进行 ma.invoke(obj, args); 调用时，调用 DelegatingMethodAccessorImpl.invoke();最后被委托到 NativeMethodAccessorImpl.invoke()</li><li>在ClassDefiner.defineClass方法实现中，每被调用一次都会生成一个DelegatingClassLoader类加载器对象 ，这里每次都生成新的类加载器，是为了性能考虑，在某些情况下可以卸载这些生成的类，因为类的卸载是只有在类加载器可以被回收的情况下才会被回收的，如果用了原来的类加载器，那可能导致这些新创建的类一直无法被卸载。而反射生成的类，有时候可能用了就可以卸载了，所以使用其独立的类加载器，从而使得更容易控制反射类的生命周期。</li></ol></li><li><p>当找到需要的方法，都会copy一份出来，而不是使用原来的实例，从而保证数据隔离；</p></li><li><p>调度反射方法，最终是由jvm执行invoke0()执行；</p></li></ol><h3 id=api-vs-spi>API vs SPI？</h3><h4 id=spi---接口位于调用方所在的包中>SPI - “接口”位于“调用方”所在的“包”中</h4><ul><li>概念上更依赖调用方。</li><li>组织上位于调用方所在的包中。</li><li>实现位于独立的包中。</li><li>常见的例子是：插件模式的插件。</li></ul><p>使用SPI机制的缺陷：</p><ul><li>不能按需加载，需要遍历所有的实现，并实例化，然后在循环中才能找到我们需要的实现。如果不想用某些实现类，或者某些类实例化很耗时，它也被载入并实例化了，这就造成了浪费。</li><li>获取某个实现类的方式不够灵活，只能通过 Iterator 形式获取，不能根据某个参数来获取对应的实现类。</li><li>多个并发多线程使用 ServiceLoader 类的实例是不安全的。</li></ul><h4 id=api---接口位于实现方所在的包中>API - “接口”位于“实现方”所在的“包”中</h4><ul><li>概念上更接近实现方。</li><li>组织上位于实现方所在的包中。</li><li>实现和接口在一个包中。</li></ul><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053223670-932f3da0-7bbc-456b-86bd-7acbd1b6c5a0.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053223670-932f3da0-7bbc-456b-86bd-7acbd1b6c5a0.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053223670-932f3da0-7bbc-456b-86bd-7acbd1b6c5a0.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053223670-932f3da0-7bbc-456b-86bd-7acbd1b6c5a0.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053230525-0cbb49d9-8962-4f69-866b-3ff9d3cbb2b7.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053230525-0cbb49d9-8962-4f69-866b-3ff9d3cbb2b7.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053230525-0cbb49d9-8962-4f69-866b-3ff9d3cbb2b7.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1691053230525-0cbb49d9-8962-4f69-866b-3ff9d3cbb2b7.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h3 id=happens-before规则>happens-before规则？</h3><p>Java 虚拟机在进行代码<strong>编译优化</strong>时，会出现<strong>指令重排</strong>序问题，为了避免编译优化对并发编程安全性的影响，Java 虚拟机需要 happens-before 规则限制或禁止编译优化的场景，保证系统<strong>并发</strong>的安全性。</p><h3 id=为什么金额不能使用double要使用bigdecimal>为什么金额不能使用double，要使用BigDecimal？</h3><p>浮点数不精确的根本原因在于<strong>尾数部分的位数</strong>是固定的，一旦需要表示的数字的精度高于浮点数的精度，那么必然产生误差！这在处理金融数据的情况下是绝对不允许存在的。</p><h3 id=强引用软引用弱引用幻象引用有什么区别>强引用、软引用、弱引用、幻象引用有什么区别？</h3><ul><li><p>强引用，就是我们最常见的普通对象引用，只要还有强引用指向一个对象，就能表明对象还“活着”，垃圾收集器不会碰这种对象。对于一个普通的对象，如果没有其他的引用关系，只要超过了引用的作用域或者显式地将相应（强）引用赋值为 null，就是可以被垃圾收集的了，当然具体回收时机还是要看垃圾收集策略。</p></li><li><p><strong>软引用</strong>（SoftReference），是一种相对强引用弱化一些的引用，可以<strong>让对象豁免一些垃圾收集</strong>，只有当 JVM 认为<strong>内存不足时</strong>，才会去试图回收软引用指向的对象。JVM 会确保在抛出 OutOfMemoryError 之前，清理软引用指向的对象。软引用通常用来实现内存敏感的缓存，如果还有空闲内存，就可以暂时保留缓存，当内存不足时清理掉，这样就保证了使用缓存的同时，不会耗尽内存。</p></li><li><ul><li>反射使用软引用relectionData缓存class信息，避免每次重新从jvm获取带来的开销；</li></ul></li><li><p><strong>弱引用</strong>（WeakReference）并不能使对象豁免垃圾收集，仅仅是提供一种访问在弱引用状态下对象的途径。这就可以用来构建一种没有特定约束的关系，比如，维护一种非强制性的映射关系，如果试图获取时对象还在，就使用它，否则重现实例化。它同样是很多<strong>缓存实现</strong>的选择。</p></li><li><p><strong>虚引用</strong>，你不能通过它访问对象。幻象引用仅仅是<strong>提供了一种确保对象被 finalize 以后，做某些事情的机制</strong>，比如，通常用来做所谓的 <strong>Post-Mortem 清理机制</strong>，我在专栏上一讲中介绍的 Java 平台自身 Cleaner 机制等，也有人<strong>利用幻象引用监控对象的创建和销毁</strong>。</p></li></ul><h3 id=nio>NIO</h3><ul><li><code>Buffer</code>：高效的数据容器，<strong>除了布尔类型，所有原始数据类型都有相应的 Buffer 实现</strong>。</li><li><code>Channel</code>：类似在 Linux 之类操作系统上看到的文件描述符，是 NIO 中被用来支持批量式 IO 操作的一种抽象。<strong>File 或者 Socket，通常被认为是比较高层次的抽象</strong>，而 Channel 则是更加操作系统底层的一种抽象，这也使得 NIO 得以充分利用现代操作系统底层机制，获得特定场景的性能优化，例如，DMA（Direct Memory Access）等。不同层次的抽象是相互关联的，我们可以通过 Socket 获取 Channel，反之亦然。</li><li><code>Selector</code>：是 NIO 实现多路复用的基础，它提供了一种高效的机制，<strong>可以检测到注册在 Selector 上的多个 Channel 中，是否有 Channel 处于就绪状态</strong>，进而实现了<strong>单线程对多 Channel 的高效管理</strong>。</li><li><code>Charset</code>：提供 Unicode 字符串定义，NIO 也提供了相应的<strong>编解码器</strong>等</li></ul><p>NIO 引入的多路复用机制，可作为线程池机制的平替：</p><div class=highlight id=id-1><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NIOServer</span> <span style=color:#66d9ef>extends</span> Thread <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>(</span>Selector selector <span style=color:#f92672>=</span> Selector<span style=color:#f92672>.</span><span style=color:#a6e22e>open</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>             ServerSocketChannel serverSocket <span style=color:#f92672>=</span> ServerSocketChannel<span style=color:#f92672>.</span><span style=color:#a6e22e>open</span><span style=color:#f92672>();)</span> <span style=color:#f92672>{</span><span style=color:#75715e>// 创建Selector和Channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            serverSocket<span style=color:#f92672>.</span><span style=color:#a6e22e>bind</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> InetSocketAddress<span style=color:#f92672>(</span>InetAddress<span style=color:#f92672>.</span><span style=color:#a6e22e>getLocalHost</span><span style=color:#f92672>(),</span> 8888<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Q：为什么我们要明确配置非阻塞模式呢？
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            serverSocket<span style=color:#f92672>.</span><span style=color:#a6e22e>configureBlocking</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 注册到Selector，并说明关注点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            serverSocket<span style=color:#f92672>.</span><span style=color:#a6e22e>register</span><span style=color:#f92672>(</span>selector<span style=color:#f92672>,</span> SelectionKey<span style=color:#f92672>.</span><span style=color:#a6e22e>OP_ACCEPT</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                selector<span style=color:#f92672>.</span><span style=color:#a6e22e>select</span><span style=color:#f92672>();</span><span style=color:#75715e>// 阻塞等待就绪的Channel，这是关键点之一
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                Set<span style=color:#f92672>&lt;</span>SelectionKey<span style=color:#f92672>&gt;</span> selectedKeys <span style=color:#f92672>=</span> selector<span style=color:#f92672>.</span><span style=color:#a6e22e>selectedKeys</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                Iterator<span style=color:#f92672>&lt;</span>SelectionKey<span style=color:#f92672>&gt;</span> iter <span style=color:#f92672>=</span> selectedKeys<span style=color:#f92672>.</span><span style=color:#a6e22e>iterator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>iter<span style=color:#f92672>.</span><span style=color:#a6e22e>hasNext</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    SelectionKey key <span style=color:#f92672>=</span> iter<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                   <span style=color:#75715e>// 生产系统中一般会额外进行就绪状态检查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    sayHelloWorld<span style=color:#f92672>((</span>ServerSocketChannel<span style=color:#f92672>)</span> key<span style=color:#f92672>.</span><span style=color:#a6e22e>channel</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                    iter<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sayHelloWorld</span><span style=color:#f92672>(</span>ServerSocketChannel server<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>(</span>SocketChannel client <span style=color:#f92672>=</span> server<span style=color:#f92672>.</span><span style=color:#a6e22e>accept</span><span style=color:#f92672>();)</span> <span style=color:#f92672>{</span>          client<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>Charset<span style=color:#f92672>.</span><span style=color:#a6e22e>defaultCharset</span><span style=color:#f92672>().</span><span style=color:#a6e22e>encode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello world!&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 省略了与前面类似的main
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span></span></span></code></pre></div><p>A：这是因为阻塞模式下，注册操作是不允许的，会抛出 IllegalBlockingModeException 异常。</p><h3 id=todo什么是零拷贝>todo：什么是零拷贝？</h3><p>定义：计算机执行IO操作时，CPU不需要将数据从一个存储区域复制到另一个存储区域，从而可以减少上下文切换和CPU的拷贝时间，是一种IO操作优化技术。</p><p>传统拷贝：</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681822652912-36957f87-070c-4535-a5bf-b86c4f88a332.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681822652912-36957f87-070c-4535-a5bf-b86c4f88a332.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681822652912-36957f87-070c-4535-a5bf-b86c4f88a332.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681822652912-36957f87-070c-4535-a5bf-b86c4f88a332.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ul><li>内核空间：操作系统内核访问的区域，是受保护的内存空间，主要提供进程调度、内存分配、连接硬件资源等功能；</li><li>用户空间：用户应用程序访问的内存区域。（fopen、fwrite、fread）</li><li>系统调用：从用户态进入内核态，发生CPU上下文的切换（open、write、read）</li></ul><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823052470-c9dd89a8-9192-467b-aae3-79c1f6d328d9.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823052470-c9dd89a8-9192-467b-aae3-79c1f6d328d9.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823052470-c9dd89a8-9192-467b-aae3-79c1f6d328d9.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823052470-c9dd89a8-9192-467b-aae3-79c1f6d328d9.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823116070-e2abf203-530a-4f67-9a0c-3ed86ba4cf50.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823116070-e2abf203-530a-4f67-9a0c-3ed86ba4cf50.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823116070-e2abf203-530a-4f67-9a0c-3ed86ba4cf50.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823116070-e2abf203-530a-4f67-9a0c-3ed86ba4cf50.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>零拷贝的三种实现方式：</p><ol><li>mmap+write</li></ol><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823314702-bb14671b-cf83-4146-b79c-63b60111487c.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823314702-bb14671b-cf83-4146-b79c-63b60111487c.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823314702-bb14671b-cf83-4146-b79c-63b60111487c.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823314702-bb14671b-cf83-4146-b79c-63b60111487c.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ol><li>sendfile</li></ol><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823652051-af9d254a-a87c-45a3-b4a9-f540f8b942da.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823652051-af9d254a-a87c-45a3-b4a9-f540f8b942da.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823652051-af9d254a-a87c-45a3-b4a9-f540f8b942da.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823652051-af9d254a-a87c-45a3-b4a9-f540f8b942da.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ol><li>带有DMA收集拷贝功能的sendfile</li></ol><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823717817-ff5505fa-add5-439d-8151-ac7d814c572e.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823717817-ff5505fa-add5-439d-8151-ac7d814c572e.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823717817-ff5505fa-add5-439d-8151-ac7d814c572e.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823717817-ff5505fa-add5-439d-8151-ac7d814c572e.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>Java中的零拷贝：</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823780707-2855779e-328f-4cb0-927e-56d2cacabb24-20230808151622819.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823780707-2855779e-328f-4cb0-927e-56d2cacabb24-20230808151622819.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823780707-2855779e-328f-4cb0-927e-56d2cacabb24-20230808151622819.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823780707-2855779e-328f-4cb0-927e-56d2cacabb24-20230808151622819.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823799067-ef522533-0c5f-4e34-aeec-129cb1b948f1-20230808151542249.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823799067-ef522533-0c5f-4e34-aeec-129cb1b948f1-20230808151542249.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823799067-ef522533-0c5f-4e34-aeec-129cb1b948f1-20230808151542249.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681823799067-ef522533-0c5f-4e34-aeec-129cb1b948f1-20230808151542249.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681461882041-144b97e3-8c62-4c49-b99e-691b48fc8d27-20230808151548842.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681461882041-144b97e3-8c62-4c49-b99e-691b48fc8d27-20230808151548842.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681461882041-144b97e3-8c62-4c49-b99e-691b48fc8d27-20230808151548842.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681461882041-144b97e3-8c62-4c49-b99e-691b48fc8d27-20230808151548842.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h3 id=jit>JIT</h3><p>引入JIT（Just-In-Time）编译的主要目的是提高程序的执行性能。传统的编译方式是提前将源代码编译成机器码，然后在运行时执行。而JIT编译是在程序运行时将部分代码进行动态编译成机器码，以提高执行效率。</p><p>JIT编译器会在运行时对热点代码进行监测和分析，热点代码指的是频繁执行的代码块或方法。一旦确定某段代码是热点代码，JIT编译器会将其编译成机器码，并缓存起来，以便下次执行时直接使用。这样可以避免每次执行都需要进行解释和执行源代码的性能损耗。</p><h4 id=逃逸分析>逃逸分析</h4><p>是一种静态分析技术，用于确定程序中的对象是否逃逸出方法的作用域。逃逸指的是对象在方法外被引用或传递给其他方法使用的情况</p><ul><li>栈上分配和标量替换。栈上分配将对象分配在线程栈上，减少堆内存的使用。</li><li>标量替换将对象拆分为独立的字段，存储在寄存器或栈上。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2023-08-08 15:09:51">Updated on 2023-08-08&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://leni.fun/posts/java_base/ data-title="🚩Java 基础"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/java/ class=post-tag>Java</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/linux/ class=post-nav-item rel=prev title="🚩Linux 面试题"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>🚩Linux 面试题</a>
<a href=/posts/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/ class=post-nav-item rel=next title=《Java8实战》笔记>《Java8实战》笔记<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=/>都将会</a></span><span class="license footer-divider">Back-End Engineer</span></div><div class="footer-line statistics"><span class=site-time title='Website running ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">Website running ...</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title='Total visitors'><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title='Total visits'><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/hihihiman/hihihiman.github.io title=博客源码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;bottom:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>Theme FixIt works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/pink/pace-theme-center-atom.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"Copy to clipboard",editLockTitle:"Lock editable code block",editUnLockTitle:"Unlock editable code block",editable:!0,maxShownLines:64},comment:{enable:!1},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":"的博客","typeit-header-subtitle-mobile":"的博客"},enablePWA:!0,pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!0,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"No results found",snippetLength:50,threshold:.3,useExtendedSearch:!0},siteTime:"2023-08-06T23:31:00+08:00",typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,loop:!0,speed:100}}</script><script src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>