<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>JVM 杂记（一） - </title><meta name=author content="都将会"><meta name=author-link content><meta name=description content="关于 JVM 的笔记草稿"><meta name=keywords content='JVM,interview,面试'><meta itemprop=name content="JVM 杂记（一）"><meta itemprop=description content="关于 JVM 的笔记草稿"><meta itemprop=datePublished content="2022-03-18T08:08:08+08:00"><meta itemprop=dateModified content="2022-03-18T08:08:08+08:00"><meta itemprop=wordCount content="3265"><meta itemprop=image content="https://leni.fun/images/avatar.jpg"><meta itemprop=keywords content="JVM,"><meta property="og:title" content="JVM 杂记（一）"><meta property="og:description" content="关于 JVM 的笔记草稿"><meta property="og:type" content="article"><meta property="og:url" content="https://leni.fun/jvm_draft_1/"><meta property="og:image" content="https://leni.fun/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-18T08:08:08+08:00"><meta property="article:modified_time" content="2022-03-18T08:08:08+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leni.fun/images/avatar.jpg"><meta name=twitter:title content="JVM 杂记（一）"><meta name=twitter:description content="关于 JVM 的笔记草稿"><meta name=application-name content="都将会的 APP"><meta name=apple-mobile-web-app-title content="都将会的 APP"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leni.fun/jvm_draft_1/><link rel=prev href=https://leni.fun/jvm_draft_2/><link rel=next href=https://leni.fun/zookeeper_draft/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"JVM 杂记（一）","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leni.fun\/jvm_draft_1\/"},"genre":"posts","keywords":"JVM","wordcount":3265,"url":"https:\/\/leni.fun\/jvm_draft_1\/","datePublished":"2022-03-18T08:08:08+08:00","dateModified":"2022-03-18T08:08:08+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"都将会"},"description":"关于 JVM 的笔记草稿"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=关键词搜索 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=关键词搜索 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title>主页</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>JVM 杂记（一）</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>JVM 杂记（一）</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=都将会 data-alt=都将会 class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;都将会</span></span>
<span class=post-category>收录于 <a href=/categories/draft/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Draft</a></span></div><div class=post-meta-line><span title="发布于 2022-03-18 08:08:08"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2022-03-18>2022-03-18</time></span>&nbsp;<span title="更新于 2022-03-18 08:08:08"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2022-03-18>2022-03-18</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 3265 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 7 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="JVM 杂记（一）">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#jvm-架构模型>JVM 架构模型</a><ul><li><a href=#jvm-生命周期>JVM 生命周期</a></li></ul></li><li><a href=#运行时数据区>运行时数据区</a><ul><li><a href=#元空间-metaspace进程拥有线程间共享>元空间 Metaspace（进程拥有，线程间共享）</a><ul><li><a href=#为什么永久代要被元空间替换>为什么永久代要被元空间替换？</a></li></ul></li><li><a href=#堆进程拥有线程间共享数据存储>🌟堆（进程拥有，线程间共享）——数据存储</a><ul><li><a href=#设置参数>设置参数</a></li><li><a href=#年轻代与老年代>年轻代与老年代</a></li><li><a href=#gc--garbage-collection>GC = Garbage Collection</a></li><li><a href=#为对象分配内存tlab线程私有->为对象分配内存：TLAB（线程私有  ）</a></li><li><a href=#堆不是分配对象的唯一选择>堆不是分配对象的唯一选择</a></li></ul></li><li><a href=#程序计数器每个线程拥有>程序计数器（每个线程拥有）</a></li><li><a href=#虚拟机栈每个线程拥有程序运行>🌟虚拟机栈（每个线程拥有）——程序运行</a></li><li><a href=#本地方法栈每个线程拥有>🌟本地方法栈（每个线程拥有）</a></li></ul></li><li><a href=#java-守护线程>Java 守护线程</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2022-03-18，文中内容可能已过时。</div></div></div><h3 id=jvm-架构模型>JVM 架构模型</h3><p>Java 编译器输入的指令流基本上时一种<strong>基于栈的指令集架构</strong>，适用于资源受限的系统，大部分是零地址指令，指令集更小，编译器容易实现，不需要硬件支持，可移植性好，更好实现跨平台。</p><h4 id=jvm-生命周期>JVM 生命周期</h4><ul><li>启动：通过引导类加载器(bootstrap class loader)创建一个初始类（initial class）</li><li>执行：JVM 进程</li><li>退出：某线程调用Runtime类的exit或halt方法是其中一种</li></ul><h3 id=运行时数据区>运行时数据区</h3><p>栈、堆、元空间的交互关系：</p><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png data-sub-html="<h2>https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/bd310105758401745ce81e60e173e461.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h4 id=元空间-metaspace进程拥有线程间共享>元空间 Metaspace（进程拥有，线程间共享）</h4><p>又名非堆，常看作是一块独立于 Java 堆的内存空间，不在虚拟机设置的内存中，而是使用本地内存。</p><ul><li>类型信息（class、interface、enum、annotation）、<ul><li>域（Field）信息<ul><li>域名称</li><li>域类型</li><li>域修饰符（public、private、p rotected、static、final、volatile、transient）</li></ul></li><li>方法信息<ul><li>方法名</li><li>方法返回类型（包括void）</li><li>方法参数（按顺序）</li><li>方法修饰符</li><li>方法字节码、操作数栈、局部变量表及大小（abstact和native方法除外）</li><li>异常表</li></ul></li><li>包名、类名</li><li>父类名</li><li>修饰符（public、abstract、final）</li><li>这个类型直接接口的有序列表</li></ul></li><li>运行时常量池：在类加载后，存放编译生成的各种字面量与符号引用</li><li>静态变量</li><li>即时编译器（JIT）编译后的代码缓存</li></ul><h5 id=为什么永久代要被元空间替换>为什么永久代要被元空间替换？</h5><ol><li>为永久代设置空间大小是很难确定的。</li><li>对永久代进行调优是很困难的。</li></ol><h4 id=堆进程拥有线程间共享数据存储>🌟堆（进程拥有，线程间共享）——数据存储</h4><p>字符串常量池、静态变量仍然在堆。</p><h5 id=设置参数>设置参数</h5><ul><li>-X：jvm的运行参数<ul><li>ms：memory start，初始内存大小，默认电脑内存/64</li><li>mx：memory max，最大内存大小，默认电脑内存/4</li><li>mn：新生代大小</li></ul></li><li>-XX:<ul><li>NewRatio（老年代/新生代）=2（默认）：表示新生代占1，老年代占2，新生代占整个堆的1/3</li><li>SurvivorRatio（eden区/survivor区）=8（默认）：表示eden区占8，survivor区各占1，有时需要显式指定才生效</li><li>【+用-不用】UseAdaptiveSizePolicy：使用自适应的内存分配策略</li><li>Max TenuringThreshold=15（默认）：表示age==16时晋升至老年代<ul><li>对象大小大于To Space可用内存时直接晋升</li><li>如果 Survivor 区中相同年龄的所有对象大小的总和占比超过一半，则大于等于该年龄的对象直接晋升</li></ul></li><li>HandlePromotionFailure=true（默认）：空间分配担保，在发生Minor GC之前，检查<strong>老年代最大可用连续空间是否大于新生代所有对象的总空间</strong>，如果大于，则此次Minor GC 是安全的，否则查看HandlePromotionFailure值，如果为false改为执行 Full GC，如果为true，继续检查<strong>老年代最大可用空间是否大于历次晋升老年代对象的平均大小</strong><ul><li>如果大于，执行Minor GC（仍有风险）</li><li>如果小于，执行Full GC</li><li>JDK7以后改为两次检验结果大于有一个成立就 Minor GC，否则Full GC。</li></ul></li><li>【+用-不用】PrintGCDetails：显示 GC 细节信息(简略版去掉Details)</li><li>【+用-不用】PrintFlagsInitial：查看所有参数的默认初始值</li><li>【+用-不用】PrintFlagsFinal：查看所有参数的最终值</li><li>【+用-不用】UseTLAB：使用 TLAB</li><li>TLABWasteTargetPercent：设置 TLAB 占用 Eden 空间的百分比，默认1%</li><li>【+用-不用】DoEscapeAnalysis：打开逃逸分析（jdk7+默认打开）</li><li>【+用-不用】PrintEscapeAnalysis：查看逃逸分析的筛选结果<ul><li>【Error: VM option &lsquo;PrintEscapeAnalysis&rsquo; is notproduct and is available only in debug version of VM.】</li></ul></li><li>【+用-不用】EliminateAllocations：打开标量替换</li><li>MetaspaceSize=20.75M（默认）：设置元空间初始分配空间，建议设置一个较高的值，避免频繁Full GC</li><li>MaxMetaspaceSize：设置元空间最大空间（默认无限制）</li></ul></li><li>jps：查看当前运行中的进程</li><li>jinfo<ul><li>-flag SurvivorRatio 进程id：查看某个进程的某个参数情况</li></ul></li></ul><h5 id=年轻代与老年代>年轻代与老年代</h5><ul><li>YoungGen<ul><li>Eden：几乎所有Java对象都是在这里被 new 出来的，绝大部分（80%）对象的销毁都在新生代进行了</li><li>survivor 0</li><li>survivor 1</li></ul></li><li>OldGen：大对象直接分配到老年代（所以要少创建大对象）</li></ul><h5 id=gc--garbage-collection>GC = Garbage Collection</h5><p>频繁收集年轻代，较少收集老年代，几乎不动元空间。</p><ul><li>Young GC/Minor GC：对新生代GC。<ul><li>在Eden区满时触发，Survivor区满时不触发。</li><li>会引发STW，暂停其它用户的线程，直到GC结束才恢复。</li></ul></li><li>Old GC/Major GC：对老年代GC。<ul><li>老年代空间不足时，会先尝试触发Minor GC，如果之后空间还不足，则触发 Major GC，如果还不足就报错：OOM</li></ul></li><li>Mixed GC：对新生代以及部分老年代GC。只有 G1 GC 会有这种行为，按照 region 小区域划分。</li><li>Full GC：对 Java 整个堆和元空间GC，在开发中应尽量避免。<ul><li>调用System.gc()时，系统建议执行Full GC，但不是必然执行</li><li>老年代或元空间内存不足</li><li>晋升对象大小大于老年代的可用内存</li></ul></li></ul><h5 id=为对象分配内存tlab线程私有->为对象分配内存：TLAB（线程私有  ）</h5><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png data-sub-html="<h2>https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e8efe0c31c6f1f2b8d6e6990996efb8b.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><p>尽管不是所有对象实例都能在 TLAB 中成功分配内存，但 JVM 确实将 TLAB 作为内存分配的首选。</p><p>对象分配优先级：TLAB>Eden区其他空间>老年代</p><h5 id=堆不是分配对象的唯一选择>堆不是分配对象的唯一选择</h5><p>逃逸分析（Escape Analysis）：可以有效减少 Java 程序中同步负载和内存堆分配压力的跨函数全局数据流分析算法。逃逸分析的基本行为就是分析对象动态作用域：当一个对象在方法中被定义，</p><ul><li>在方法内部使用，则没有逃逸。——可能被优化成栈上分配。</li><li>被外部方法所引用，则发生逃逸（new 的对象实体在方法外被调用）</li></ul><p>标量替换：用对多个标量的操作代替对聚合量的操作。</p><h4 id=程序计数器每个线程拥有>程序计数器（每个线程拥有）</h4><p>全称程序计数寄存器（Program Counter Register），也称为程序钩子。用来存储指向下一条指令的地址，由执行引擎读取下一条指令。它是唯一一个在JVM 规范中没有规定任何OOM异常的区域。它并非广义上所指的物理寄存器，而是对物理 PC 寄存器的一种抽象模拟。</p><h4 id=虚拟机栈每个线程拥有程序运行>🌟虚拟机栈（每个线程拥有）——程序运行</h4><p>栈帧（Stack Frame），一一对应执行的方法。</p><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png data-sub-html="<h2>https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/2023/08/08/e0d3206cb0cc82b18754be31d2a1a51f.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><ul><li>🌟局部变量表 Local Variables</li><li>🌟操作数栈 Operand Stack，表达式栈：32bit占一个深度（int），64bit占两个深度（double）</li><li>动态链接 Dynamic Linking，指向运行时常量池的方法引用：在 Java 源文件被编译到字节码文件中时，所有的变量和方法引用都作为符号引用保存在 class 文件的常量池里。动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用。</li><li>方法返回地址 Return Address：方法正常退出（PC计数器的值，即该方法指令的下一条指令地址）或异常退出（查询异常表）的定义</li><li>附加信息</li><li>静态链接：编译期可知【早期绑定】<ul><li>非虚方法：在编译期就确定了具体的调用版本，这个版本在运行时不可变<ul><li>invokestatic：static</li><li>invokespecial：private、final、实例构造器(<code>&lt;init></code> 方法)、父类方法</li></ul></li></ul></li><li>动态链接：编译期未知，运行期可知【晚期绑定】<ul><li>invokevitual：调用虚方法</li><li>invokeinterface：调用接口</li><li>invokedynamic：动态解析方法，然后执行（Lambda表达式的出现使得该指令可以直接生成）</li></ul></li></ul><p>Java 是静态语言，但 Lambda 表达式使它具备动态语言的特点。（invokedynamic）</p><p>在字节码文件中，构造器和方法等价。Java 中任何一个puts的方法其实都具备c++中虚函数的特征（多态：允许父类指针指向子类实例），除非用 final 修饰。</p><p>变量类型：</p><ul><li>成员变量<ul><li>类变量，prepare阶段默认赋值，initial阶段显式赋值</li><li>实例变量，随着对象的创建，在堆空间中分配空间，进行赋值</li></ul></li><li>局部变量：必须显式赋值，否则编译不通过</li></ul><h4 id=本地方法栈每个线程拥有>🌟本地方法栈（每个线程拥有）</h4><p>与 Java 外面的环境交互。</p><p>本地方法：一个 Java 程序调用非 Java 代码（比如C）的接口。</p><h3 id=java-守护线程>Java 守护线程</h3><ul><li>虚拟机线程：JVM 达到安全点时出现。</li><li>周期任务线程</li><li>GC 线程</li><li>编译线程：将字节码编译成本地代码</li><li>信号调度线程：接收信号</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2022-03-18 08:08:08">更新于 2022-03-18&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://leni.fun/jvm_draft_1/ data-title="JVM 杂记（一）"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/jvm/ class=post-tag>JVM</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/jvm_draft_2/ class=post-nav-item rel=prev title="JVM 杂记（二）"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>JVM 杂记（二）</a>
<a href=/zookeeper_draft/ class=post-nav-item rel=next title="Zookeeper 杂记">Zookeeper 杂记<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright order-5" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>都将会</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://beian.miit.gov.cn target=_blank>浙ICP备2023023782号</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor order-4"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/hihihiman/hihihiman.github.io title=博客源码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;bottom:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/pink/pace-theme-center-atom.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:1024},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":"的博客           ","typeit-header-subtitle-mobile":"的博客           "},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!0,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,useExtendedSearch:!0},siteTime:"2021-08-26T23:31:00+08:00",typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,loop:!0,speed:150}}</script><script src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>