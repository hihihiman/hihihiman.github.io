# ðŸš©NetWork - è®¡ç®—æœºç½‘ç»œ


<!--more-->

### OSI ä¸ƒå±‚æ¨¡åž‹ï¼Ÿ

1. åº”ç”¨å±‚ï¼šä¸ºè®¡ç®—æœºç”¨æˆ·æä¾›æœåŠ¡ HTTP
   1. ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼šã€Nginx çš„ server/udpã€‘è¯»å–æŠ¥æ–‡æ•°æ®éƒ¨åˆ†ï¼Œæ ¹æ®æ•°æ®å†…å®¹åšå‡ºè´Ÿè½½å‡è¡¡å†³ç­–ï¼Œæ›´çµæ´»
2. è¡¨ç¤ºå±‚ï¼šæ•°æ®åŠ å¯†è§£å¯†
3. ä¼šè¯å±‚ï¼šç®¡ç†åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¼šè¯
4. ä¼ è¾“å±‚ï¼šé€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ TCP/UDP
   1. å››å±‚è´Ÿè½½å‡è¡¡ï¼šã€Nginx çš„ upstreamã€‘é€šè¿‡ ip+portï¼Œè½¬å‘åˆ°çœŸå®žæœåŠ¡å™¨ï¼Œæ€§èƒ½å¥½
5. ç½‘ç»œå±‚ï¼šè·¯ç”±å’Œå¯»å€
6. æ•°æ®é“¾è·¯å±‚ï¼šå¸§ç¼–ç å’Œå·®é”™æ ¡éªŒ
   1. VLANï¼šé€»è¾‘åˆ’åˆ†æ•°æ®ï¼Œå°†ä¸€ä¸ªç‰©ç†å±€åŸŸç½‘åˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼Œæ¯ä¸ª VLAN éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¹¿æ’­åŸŸã€‚
7. ç‰©ç†å±‚ï¼šé€æ˜Žä¼ è¾“æ¯”ç‰¹æµ

### TCP/IP å››å±‚æ¨¡åž‹ï¼Ÿ

1. åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰ï¼šæä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®äº¤æ¢ï¼ŒåŒ…æ‹¬DNSï¼ˆåŸºäºŽ UDPï¼‰ã€HTTPã€FTPã€SMTPç­‰åè®®ã€‚
2. ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰ï¼šè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬TCPï¼ˆä¼ è¾“æŽ§åˆ¶åè®®ï¼‰å’ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ã€‚
3. ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰ï¼šå¤„ç†ç½‘ç»œé—´çš„æ•°æ®ä¼ è¾“å’Œè·¯å¾„é€‰æ‹©ï¼ŒåŒ…æ‹¬IPï¼ˆç½‘é™…åè®®ï¼‰å’ŒICMPï¼ˆInternetæŽ§åˆ¶æ¶ˆæ¯åè®®ï¼‰ã€‚
4. é“¾è·¯å±‚ï¼ˆLink Layerï¼‰ï¼šè´Ÿè´£ç‰©ç†ç½‘ç»œä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬ä»¥å¤ªç½‘ã€Wi-Fiç­‰ã€‚
### è¯·æ±‚è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«ï¼Ÿ
è½¬å‘ï¼ˆForwardï¼‰ï¼š

- æœåŠ¡å™¨è¡Œä¸º
- åœ°å€æ è·¯å¾„ä¸å˜
- æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽï¼Œç›´æŽ¥è®¿é—®ç›®æ ‡åœ°å€çš„URLï¼ŒæŠŠé‚£ä¸ªURLçš„å“åº”å†…å®¹è¿”å›žç»™æµè§ˆå™¨
- **äº‹æƒ…æœªåšå®Œ**ï¼Œæ•°æ®å…±äº«
- å¦‚ï¼šæœ‰äº›ç½‘é¡µè½¬å‘å¤©æ°”é¢„æŠ¥ä¿¡æ¯

é‡å®šå‘ï¼ˆRedirectï¼‰ï¼š

- å®¢æˆ·ç«¯è¡Œä¸º
- åœ°å€æ è·¯å¾„æ”¹å˜
- æœåŠ¡ç«¯æ ¹æ®é€»è¾‘,å‘é€ä¸€ä¸ªçŠ¶æ€ç ,å‘Šè¯‰æµè§ˆå™¨é‡æ–°åŽ»è¯·æ±‚é‚£ä¸ªåœ°å€ï¼Œæ‰€ä»¥åœ°å€æ æ˜¾ç¤ºçš„æ˜¯æ–°çš„URL
- **äº‹æƒ…å·²åšå®Œ**ï¼Œæ•°æ®ä¸å…±äº«
- å¦‚ï¼šç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚
### ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ
#### ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡ï¼Ÿ
ä¸ºäº†**é˜²æ­¢å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå¯¼è‡´èµ„æºå»ºç«‹æ— æ„ä¹‰çš„è¿žæŽ¥**ã€‚
å‡è®¾ä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦serverå¯¹ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µå‘å‡ºç¡®è®¤ï¼Œæ–°çš„è¿žæŽ¥å°±å»ºç«‹äº†ã€‚ä½†æ­¤æ—¶çš„clientå¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šç†ç¬serverçš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¼šå‘serverå‘é€æ•°æ®ã€‚ä½†serverå´ä»¥ä¸ºæ–°çš„è¿è¾“è¿žæŽ¥å·²ç»å»ºç«‹ï¼Œå¹¶ä¸€ç›´ç­‰å¾…clientå‘æ¥æ•°æ®ã€‚è¿™æ ·serverçš„å¾ˆå¤šèµ„æºå°±ç™½ç™½æµªè´¹æŽ‰äº†ã€‚é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„è¯ï¼Œserverç”±äºŽæ”¶ä¸åˆ°ç¡®è®¤çš„æ—¶å€™ï¼Œå°±çŸ¥é“clientå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿žæŽ¥ï¼Œè¿™å°±æœ‰æ•ˆçš„é˜²æ­¢äº†æœåŠ¡å™¨ç«¯çš„ä¸€ç›´ç­‰å¾…è€Œæµªè´¹èµ„æºã€‚
#### ä¸ºä»€ä¹ˆä¸ç”¨å››æ¬¡ï¼Ÿ
å› ä¸ºæ¡æ‰‹çš„ç›®çš„æ˜¯ä¸ºäº†è¯æ˜ŽæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å…·æœ‰æŽ¥æ”¶å’Œå‘é€æ•°æ®çš„èƒ½åŠ›ï¼Œåœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡ç«¯å‘é€çš„ack=seq+1è¯æ˜Žäº†å®¢æˆ·ç«¯çš„ç½‘ç»œè”é€šæ€§ï¼Œå¹¶ä¸”å‘é€äº†è‡ªå·±çš„seqï¼Œåªéœ€è¦ç­‰å¾…ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ack=seq+1å°±èƒ½è¯æ˜ŽæœåŠ¡ç«¯çš„ç½‘ç»œè”é€šæ€§ï¼Œå¯ä»¥ä¸‰æ¬¡åšåˆ°çš„ï¼Œå°±ä¸ç”¨ç¬¬å››æ¬¡äº†ï¼ŒèŠ‚çº¦èµ„æºã€‚
### HTTPS çš„åŽŸç†ï¼Ÿ
#### HTTPSå’ŒHTTPçš„åŒºåˆ«ï¼Ÿ

- HTTPS å¢žåŠ äº†ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆTransport Layer Securityï¼ŒTLSï¼‰
- ç«¯å£ä¸åŒï¼šhttp æ˜¯ 80 ç«¯å£ï¼Œhttps æ˜¯ 443 ç«¯å£
- ä½¿ç”¨ HTTPS åè®®éœ€è¦åˆ° **CA**ï¼ˆCertificate Authorityï¼Œæ•°å­—è¯ä¹¦è®¤è¯æœºæž„ï¼‰ ç”³è¯·è¯ä¹¦ï¼Œå¯ä»¥é˜²æ­¢â€ä¸­é—´äººâ€œæ”»å‡»ã€‚ä¸€èˆ¬å…è´¹è¯ä¹¦è¾ƒå°‘ï¼Œå› è€Œéœ€è¦ä¸€å®šè´¹ç”¨ã€‚
#### ä¸¤ä¸ªé˜¶æ®µï¼Ÿ
åˆ†æˆè¯ä¹¦éªŒè¯é˜¶æ®µï¼ˆéžå¯¹ç§°åŠ å¯†ï¼‰å’Œæ•°æ®ä¼ è¾“é˜¶æ®µï¼ˆå¯¹ç§°åŠ å¯†ï¼Œä¿è¯æ•ˆçŽ‡ï¼‰
#### ä½¿ç”¨ HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ
ä¼šï¼ŒHTTPS åªé˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡è¢«ç›‘å¬ï¼Œå¦‚æžœç”¨æˆ·ä¸»åŠ¨æŽˆä¿¡ï¼Œæ˜¯å¯ä»¥æž„å»ºâ€œä¸­é—´äººâ€ç½‘ç»œï¼Œä»£ç†è½¯ä»¶å¯ä»¥å¯¹ä¼ è¾“å†…å®¹è¿›è¡Œè§£å¯†ã€‚
#### ä¸ºä»€ä¹ˆ HTTPS åè®®éœ€è¦ 9 å€æ—¶å»¶æ‰èƒ½å®Œæˆé€šä¿¡ï¼Ÿ
HTTP é¡µé¢å“åº”é€Ÿåº¦æ¯” HTTPS å¿«ï¼Œä¸»è¦æ˜¯å› ä¸º HTTP ä½¿ç”¨ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿žæŽ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦äº¤æ¢ 3 ä¸ªåŒ…ï¼Œè€Œ HTTPSé™¤äº† TCP çš„ä¸‰ä¸ªåŒ…ï¼Œè¿˜è¦åŠ ä¸Š ssl æ¡æ‰‹éœ€è¦çš„ 9 ä¸ªåŒ…ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯ 12 ä¸ªåŒ…ã€‚

1. TCP åè®®éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ TCP è¿žæŽ¥ä¿è¯é€šä¿¡çš„å¯é æ€§ï¼ˆ1.5-RTTï¼‰ï¼›
2. TLS åè®®ä¼šåœ¨ TCP åè®®ä¹‹ä¸Šé€šè¿‡å››æ¬¡æ¡æ‰‹å»ºç«‹ TLS è¿žæŽ¥ä¿è¯é€šä¿¡çš„å®‰å…¨æ€§ï¼ˆ2-RTTï¼‰ï¼›
3. HTTP åè®®ä¼šåœ¨ TCP å’Œ TLS ä¸Šé€šè¿‡ä¸€æ¬¡å¾€è¿”å‘é€è¯·æ±‚å¹¶æŽ¥æ”¶å“åº”ï¼ˆ1-RTTï¼‰ï¼›
### æµè§ˆå™¨è¾“å…¥urlä¹‹åŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

1. é€šè¿‡ DNS å°†åŸŸåè§£æžä¸ºipåœ°å€
2. é€šè¿‡ipå’Œç«¯å£å·å‘æœåŠ¡å™¨å‘é€GETè¯·æ±‚
3. å¦‚æžœé…ç½®äº†Nginxï¼Œå¯èƒ½ä¼šå‘ç”Ÿè´Ÿè½½å‡è¡¡ï¼Œè½¬å‘åˆ°å…¶ä»–ipåœ°å€
4. ä¼ è¾“å±‚è¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹
5. èŽ·å¾—å“åº”æ•°æ®ï¼ŒåŠ ä¸Šjsä»£ç æ¸²æŸ“é¡µé¢
6. ä¼ è¾“å®ŒæˆåŽå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿žæŽ¥
### getè¯·æ±‚å’Œpostè¯·æ±‚çš„åŒºåˆ«ï¼Ÿ
GETå’ŒPOSTæœ¬è´¨ä¸Šæ²¡åŒºåˆ«éƒ½æ˜¯ä¾èµ–TCP/IPé“¾æŽ¥ã€‚HTTPä¹‹æ‰€ä»¥åˆ’åˆ†å‡ºGET, POST, PUT, DELETEç­‰è¯·æ±‚ç±»åž‹ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚é‚£ä½ è‚¯å®šåˆæœ‰ç–‘é—®äº†ï¼šåº•å±‚éƒ½æ˜¯TCPï¼Œé‚£æ€Žä¹ˆå®žçŽ°ä»¥ä¸Šä¸åŒçš„å‘¢ï¼Ÿæ¯”å¦‚GETè¯·æ±‚çš„æœ€å¤§2KBæ˜¯åœ¨å“ªéªŒè¯çš„å‘¢ï¼Ÿ
GET, POST, PUT, DELETEç­‰ä¸åŒè¯·æ±‚ç±»åž‹çš„ä¸åŒå¤„ç†ç­–ç•¥æ˜¯é€šè¿‡æ•°æ®åŒ…æŽ§åˆ¶çš„ã€‚
æ¯”å¦‚ï¼šGETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…ï¼›POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ã€‚
å¯¹äºŽGETæ–¹å¼çš„è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæŠŠheaderå’Œdataä¸€å¹¶å‘é€å‡ºåŽ»ï¼ŒæœåŠ¡å™¨å“åº”200ï¼ˆè¿”å›žæ•°æ®ï¼‰ï¼›è€Œå¯¹äºŽPOSTï¼Œæµè§ˆå™¨å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œæµè§ˆå™¨å†å‘é€dataï¼ŒæœåŠ¡å™¨å“åº”200 okï¼ˆè¿”å›žæ•°æ®ï¼‰ã€‚
GETä¸€èˆ¬ç”¨äºŽèŽ·å–/æŸ¥è¯¢èµ„æºä¿¡æ¯ï¼Œè€ŒPOSTä¸€èˆ¬ç”¨äºŽæ›´æ–°èµ„æºä¿¡æ¯ã€‚
#### ä¸ºä»€ä¹ˆåˆ é™¤ä¸èƒ½ç”¨getè¯·æ±‚
é€šè¿‡åŽ†å²è®°å½•æˆ–ä¹¦ç­¾ï¼Œå¾ˆå®¹æ˜“åœ¨æ²¡æœ‰æ„è¯†åˆ°çš„æƒ…å†µä¸‹é‡æ–°è¾“å…¥GETè¯·æ±‚ã€‚å¦‚æžœGETæ˜¯ç ´åæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æ•°æ®ä¸¢å¤±ã€‚
### ä½ äº†è§£Javaåº”ç”¨å¼€å‘ä¸­çš„æ³¨å…¥æ”»å‡»å—ï¼Ÿ

1. SQLæ³¨å…¥ï¼šor 1=1
2. æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼šJava è¯­è¨€æä¾›äº†ç±»ä¼¼ Runtime.exec(â€¦) çš„ API
3. XML æ³¨å…¥æ”»å‡»ï¼šJava æ ¸å¿ƒç±»åº“æä¾›äº†å…¨é¢çš„ XML å¤„ç†ã€è½¬æ¢ç­‰å„ç§ APIï¼Œè€Œ XML è‡ªèº«æ˜¯å¯ä»¥åŒ…å«åŠ¨æ€å†…å®¹çš„

å¦‚ä½•ä¿è¯å®‰å…¨ï¼š

1. è¿è¡Œæ—¶å®‰å…¨æœºåˆ¶ã€‚å¯ä»¥ç®€å•è®¤ä¸ºï¼Œå°±æ˜¯é™åˆ¶ Java è¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œä¸è¦åšè¶Šæƒæˆ–è€…ä¸é è°±çš„äº‹æƒ…ã€‚ä»ŽåŽŸåˆ™ä¸Šæ¥è¯´ï¼ŒJava çš„ GC ç­‰èµ„æºå›žæ”¶ç®¡ç†æœºåˆ¶ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯è¿è¡Œæ—¶å®‰å…¨çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æžœç›¸åº”æœºåˆ¶å¤±æ•ˆï¼Œå°±ä¼šå¯¼è‡´ JVM å‡ºçŽ° OOM ç­‰é”™è¯¯ï¼Œå¯çœ‹ä½œæ˜¯å¦ç±»çš„æ‹’ç»æœåŠ¡ã€‚
2. Java æä¾›çš„å®‰å…¨æ¡†æž¶ APIï¼Œè¿™æ˜¯æž„å»ºå®‰å…¨é€šä¿¡ç­‰åº”ç”¨çš„åŸºç¡€ã€‚åŠ å¯†ç®—æ³•ã€HTTPS
3. JDK é›†æˆçš„å„ç§å®‰å…¨å·¥å…·ã€‚å°½é‡ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ JDKï¼Œå¹¶ä½¿ç”¨æŽ¨èçš„å®‰å…¨æœºåˆ¶å’Œæ ‡å‡†
### å…¬é’¥å’Œç§é’¥ï¼Ÿ
å‡è®¾ (public key,private key) ä»£è¡¨ä¸€ä¸ªè´¦æˆ·

-  é€šä¿¡ï¼šæ‹¿å¯¹æ–¹çš„å…¬é’¥åŠ å¯†ï¼Œå‘é€ä¿¡æ¯ï¼Œå¯¹æ–¹æ”¶åˆ°åŽæ‹¿è‡ªå·±çš„å¯†é’¥è§£å¯†ã€‚ 
-  ç­¾åï¼šæ‹¿è‡ªå·±çš„å¯†é’¥åŠ å¯†ï¼Œå…¶ä»–äººæ‹¿è‡ªå·±çš„å…¬é’¥éªŒè¯ã€‚ 
### TCP åè®®

![TCP åè®®æ ¼å¼](https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1690034790132-27a2bd76-3924-48dc-90ad-059cc7bdef5d-20230810091130736.png)


TCP å¤´éƒ¨ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

1. æºç«¯å£å·ï¼ˆSource Portï¼‰ï¼š16 ä½ï¼Œç”¨äºŽæ ‡è¯†å‘é€ç«¯å£å·ã€‚
2. ç›®çš„ç«¯å£å·ï¼ˆDestination Portï¼‰ï¼š16 ä½ï¼Œç”¨äºŽæ ‡è¯†æŽ¥æ”¶ç«¯å£å·ã€‚
3. åºåˆ—å·ï¼ˆSequence Numberï¼‰ï¼š32 ä½ï¼Œç”¨äºŽæ ‡è¯†è¯¥æ•°æ®æ®µçš„åºåˆ—å·ï¼Œç”¨äºŽä¿è¯æ•°æ®çš„æœ‰åºä¼ è¾“ã€‚
4. ç¡®è®¤å·ï¼ˆAcknowledgment Numberï¼‰ï¼š32 ä½ï¼Œç”¨äºŽæ ‡è¯†æœŸæœ›æŽ¥æ”¶çš„ä¸‹ä¸€ä¸ªæ•°æ®æ®µçš„åºåˆ—å·ã€‚
5. æ•°æ®åç§»ï¼ˆData Offsetï¼‰ï¼š4 ä½ï¼Œç”¨äºŽæ ‡è¯† TCP å¤´éƒ¨çš„é•¿åº¦ï¼Œä»¥ 4 å­—èŠ‚ä¸ºå•ä½ã€‚
6. ä¿ç•™ï¼ˆReservedï¼‰ï¼š6 ä½ï¼Œä¿ç•™æœªä½¿ç”¨ã€‚
7. æ ‡å¿—ä½ï¼ˆFlagsï¼‰ï¼š6 ä½ï¼Œç”¨äºŽæ ‡è¯† TCP çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ URGã€ACKã€PSHã€RSTã€SYNã€FIN ç­‰ã€‚
8. çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰ï¼š16 ä½ï¼Œç”¨äºŽæ ‡è¯†æŽ¥æ”¶æ–¹èƒ½å¤ŸæŽ¥æ”¶çš„æ•°æ®é‡å¤§å°ã€‚
9. æ ¡éªŒå’Œï¼ˆChecksumï¼‰ï¼š16 ä½ï¼Œç”¨äºŽæ£€éªŒ TCP å¤´éƒ¨å’Œæ•°æ®çš„æ­£ç¡®æ€§ã€‚
10. ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ï¼š16 ä½ï¼Œç”¨äºŽæ ‡è¯† TCP æ•°æ®ä¸­çš„ç´§æ€¥æ•°æ®çš„ä½ç½®ã€‚
11. é€‰é¡¹ï¼ˆOptionsï¼‰ï¼šå¯é€‰ï¼Œç”¨äºŽä¼ è¾“ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æœ€å¤§æ®µå¤§å°ï¼ˆMSSï¼‰ã€æ—¶é—´æˆ³ï¼ˆTimestampï¼‰ç­‰ã€‚

#### æµé‡æŽ§åˆ¶å’Œæ‹¥å¡žæŽ§åˆ¶çš„åŒºåˆ«ï¼Ÿ

TCP æµé‡æŽ§åˆ¶å’Œæ‹¥å¡žæŽ§åˆ¶çš„æœ€å¤§åŒºåˆ«åœ¨äºŽå®ƒä»¬çš„æŽ§åˆ¶å¯¹è±¡å’Œç›®çš„ä¸åŒã€‚

- TCP æµé‡æŽ§åˆ¶çš„æŽ§åˆ¶å¯¹è±¡æ˜¯æŽ¥æ”¶æ–¹ï¼Œå…¶ç›®çš„æ˜¯æŽ§åˆ¶å‘é€æ–¹å‘æŽ¥æ”¶æ–¹å‘é€æ•°æ®çš„é€ŸçŽ‡ï¼Œä»¥é¿å…æŽ¥æ”¶æ–¹ç¼“å†²åŒºæº¢å‡ºã€‚TCP æµé‡æŽ§åˆ¶æ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æœºåˆ¶ï¼ŒåŠ¨æ€è°ƒæ•´çª—å£å¤§å°æ¥æŽ§åˆ¶å‘é€æ–¹çš„å‘é€é€ŸçŽ‡ï¼Œä»¥ä¿è¯æŽ¥æ”¶æ–¹å¯ä»¥é¡ºåˆ©æŽ¥æ”¶æ•°æ®ã€‚
- TCP æ‹¥å¡žæŽ§åˆ¶çš„æŽ§åˆ¶å¯¹è±¡æ˜¯ç½‘ç»œï¼Œå…¶ç›®çš„æ˜¯æŽ§åˆ¶å‘é€æ–¹å‘é€æ•°æ®çš„é€ŸçŽ‡ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å¡žå’Œæ•°æ®ä¸¢å¤±ã€‚TCP æ‹¥å¡žæŽ§åˆ¶æ˜¯é€šè¿‡æ£€æµ‹ç½‘ç»œæ‹¥å¡žæƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´æ‹¥å¡žçª—å£å¤§å°æ¥æŽ§åˆ¶å‘é€æ–¹çš„å‘é€é€ŸçŽ‡ï¼Œä»¥ä¿è¯ç½‘ç»œçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚

å› æ­¤ï¼ŒTCP æµé‡æŽ§åˆ¶å’Œæ‹¥å¡žæŽ§åˆ¶çš„æœ€å¤§åŒºåˆ«åœ¨äºŽå®ƒä»¬çš„æŽ§åˆ¶å¯¹è±¡å’Œç›®çš„ä¸åŒã€‚TCP æµé‡æŽ§åˆ¶æ˜¯ä¸ºäº†ä¿è¯æŽ¥æ”¶æ–¹çš„æ•°æ®æŽ¥æ”¶æ•ˆçŽ‡å’Œå¯é æ€§ï¼Œè€Œ TCP æ‹¥å¡žæŽ§åˆ¶æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚
### æœåŠ¡ç«¯å‡ºçŽ°å¤§é‡close_waitçŠ¶æ€ï¼Œå¯èƒ½çš„æƒ…å†µï¼Ÿ

1. æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºæœªæ­£ç¡®å…³é—­å¥—æŽ¥å­—è¿žæŽ¥ï¼šCLOSE_WAITçŠ¶æ€è¡¨ç¤ºæœåŠ¡å™¨å·²ç»å…³é—­äº†è¿žæŽ¥ï¼Œä½†æ˜¯ä»ç„¶åœ¨ç­‰å¾…æœ€åŽä¸€æ–¹ï¼ˆé€šå¸¸æ˜¯å®¢æˆ·ç«¯ï¼‰å‘é€å…³é—­è¿žæŽ¥çš„è¯·æ±‚ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®å…³é—­å¥—æŽ¥å­—è¿žæŽ¥ï¼Œå¯¼è‡´è¿žæŽ¥å¤„äºŽæœªæ­£å¸¸å…³é—­çš„çŠ¶æ€ã€‚
2. å®¢æˆ·ç«¯æœªå‘é€å…³é—­è¿žæŽ¥è¯·æ±‚ï¼šCLOSE_WAITçŠ¶æ€ä¹Ÿå¯èƒ½æ˜¯ç”±äºŽå®¢æˆ·ç«¯æ²¡æœ‰å‘é€å…³é—­è¿žæŽ¥è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡å™¨ç«¯ä¸€ç›´ç­‰å¾…ç€ã€‚è¿™å¯èƒ½æ˜¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­çš„bugæˆ–è€…ç½‘ç»œé€šä¿¡é—®é¢˜å¯¼è‡´çš„ã€‚
3. æœåŠ¡å™¨èµ„æºä¸è¶³æˆ–å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼šå¦‚æžœæœåŠ¡å™¨ç«¯çš„èµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€çº¿ç¨‹ç­‰ï¼‰ä¸è¶³æˆ–è€…å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶å¤„ç†å…³é—­è¿žæŽ¥çš„è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„CLOSE_WAITçŠ¶æ€ç§¯ç´¯ã€‚
4. ç½‘ç»œä¸­çš„é—®é¢˜ï¼šåœ¨ç½‘ç»œä¸­å­˜åœ¨é—®é¢˜ï¼Œå¦‚ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ã€æ‹¥å¡žç­‰ï¼Œå¯èƒ½å¯¼è‡´è¿žæŽ¥å…³é—­çš„è¯·æ±‚æœªèƒ½åŠæ—¶åˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼Œä»Žè€Œå¯¼è‡´CLOSE_WAITçŠ¶æ€çš„ç§¯ç´¯ã€‚


---

> ä½œè€…: éƒ½å°†ä¼š  
> URL: https://leni.fun/network/  

