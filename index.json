[{"categories":["å»ºç«™è®°å½•"],"content":"æ–¹æ¡ˆ çœæµç‰ˆ ä¸»é¢˜ï¼šHugo + FixIt éƒ¨ç½²ï¼šGit + GitHub Workflows å›¾åºŠï¼šPicgo + Aliyun OSS åŸŸåï¼šGitHub Pages + Netlify + Aliyun è¯„è®ºï¼šGiscus å®Œæ•´ç‰ˆ ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶ç»“åˆ GitHub Workflows å®ç°äº†è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œè´ªé£Ÿè›‡æ•ˆæœã€‚ ä½¿ç”¨äº† Picgo ä½œä¸ºå›¾åºŠå·¥å…·ï¼Œå¹¶å°†å›¾ç‰‡ä¸Šä¼ è‡³é˜¿é‡Œäº‘ OSSï¼ˆå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼‰ã€‚ èµ·åˆä½¿ç”¨ GitHub Pages ä½œä¸ºåšå®¢çš„æ‰˜ç®¡å¹³å°ï¼Œå¹¶å°†è‡ªå®šä¹‰åŸŸåç»‘å®šåˆ° GitHub Pagesï¼›åæ¥ä½¿ç”¨ Netlify ä½œä¸º CDNï¼Œåšå®¢é¡µé¢çš„å¹³å‡åŠ è½½æ—¶é—´ç¼©çŸ­äº†çº¦ 50%ï¼Œæé«˜äº†ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦ã€‚ é›†æˆäº† Giscus è¯„è®ºç³»ç»Ÿï¼ŒåŸºäºGitHub Issuesï¼Œæä¾›äº†ä¸€ä¸ªç®€æ´ä¸”æ˜“äºä½¿ç”¨çš„è¯„è®ºåŠŸèƒ½ã€‚ ","date":"2023-08-09","objectID":"/blog_beautify/:0:1","tags":["hugo"],"title":"FixItä¸»é¢˜ç¾åŒ–","uri":"/blog_beautify/"},{"categories":["å»ºç«™è®°å½•"],"content":"åˆ†äº«å‡ ä¸ªé“¾æ¥å§ é’ˆå¯¹ LoveIt ä¸»é¢˜ï¼ˆFixIt çš„å‰èº«ï¼‰ï¼šhttps://lewky.cn/posts/hugo-3.html/ åŸºäº Hexos Fluid çš„å¾ˆå¥½çœ‹çš„åšå®¢ï¼šhttps://nyimac.gitee.io/ æˆ‘çš„ FixIt ä¸»é¢˜åšå®¢å¾ˆå¤šåœ°æ–¹éƒ½å€Ÿé‰´äº†æ¯•å°‘ä¾ ï¼šhttp://geekswg.js.cool/ Github è´ªé£Ÿè›‡åˆ¶ä½œæŒ‡å—ï¼šhttps://cloud.tencent.com/developer/article/1935739 markdown å†™ä½œä¸­çš„emojiè¡¨æƒ…åŒ…ï¼šhttps://hugoloveit.com/zh-cn/emoji-support/ é€šè¿‡Netlifyé…ç½®é˜¿é‡Œäº‘åŸŸåï¼šhttps://blog.csdn.net/mqdxiaoxiao/article/details/96365253 é€šè¿‡ giscus é…ç½®è¯„è®ºåŒºï¼šhttps://www.jianshu.com/p/a8a4dc99c0c7 æœ€ç»ˆè¿˜æ˜¯å–æ¶ˆäº†ï¼Œä¸ºä»€ä¹ˆè¯„è®ºç³»ç»Ÿéƒ½éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Ÿï¼ è´ªé£Ÿè›‡æ•ˆæœ æˆ‘è‚¯å®šä¸æ˜¯æ²¡æ€ä¹ˆå†™ä»£ç ï¼Œè€Œæ˜¯è¢«è´ªé£Ÿè›‡åƒæ‰äº†! ","date":"2023-08-09","objectID":"/blog_beautify/:0:2","tags":["hugo"],"title":"FixItä¸»é¢˜ç¾åŒ–","uri":"/blog_beautify/"},{"categories":null,"content":"éƒ½å°†ä¼š's friends","date":"2023-08-10","objectID":"/friends/","tags":null,"title":"Index","uri":"/friends/"},{"categories":null,"content":"Base info - nickname: Lruihao avatar: https://lruihao.cn/images/avatar.jpg url: https://lruihao.cn description: Lruihao's Note ","date":"2023-08-10","objectID":"/friends/:1:0","tags":null,"title":"Index","uri":"/friends/"},{"categories":null,"content":"Friendly Reminder Notice If you want to exchange link, please leave a comment in the above format. (personal non-commercial blogs / websites only) Â Website failure, stop maintenance and improper content may be unlinked! Those websites that do not respect other peopleâ€™s labor achievements, reprint without source, or malicious acts, please do not come to exchange. ","date":"2023-08-10","objectID":"/friends/:2:0","tags":null,"title":"Index","uri":"/friends/"},{"categories":["interview"],"content":"çº¢é»‘æ ‘ ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤ç­‰å¯èƒ½ä¼šç ´åæ ‘çš„å¹³è¡¡çš„æ“ä½œæ—¶ï¼Œéœ€è¦é‡æ–°è‡ªå¤„ç†è¾¾åˆ°å¹³è¡¡çŠ¶æ€ã€‚ æ ¹å’Œå¶å­èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œæ’å…¥çš„èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ å¶å­èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹ã€‚ æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹å¿…æœ‰é»‘è‰²å­èŠ‚ç‚¹ã€‚ ä»»æ„ä¸€ç»“ç‚¹åˆ°æ¯ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„éƒ½åŒ…å«æ•°é‡ç›¸åŒçš„é»‘ç»“ç‚¹ã€‚ é€šè¿‡å·¦æ—‹ã€å³æ—‹å’Œå˜è‰²æ¥å®ç°è‡ªå¹³è¡¡ï¼š å·¦æ—‹åªå½±å“æ—‹è½¬ç»“ç‚¹å’Œå…¶å³å­æ ‘çš„ç»“æ„ï¼ŒæŠŠå³å­æ ‘çš„ç»“ç‚¹å¾€å·¦å­æ ‘æŒªäº†ã€‚å³æ—‹åªå½±å“æ—‹è½¬ç»“ç‚¹å’Œå…¶å·¦å­æ ‘çš„ç»“æ„ï¼ŒæŠŠå·¦å­æ ‘çš„ç»“ç‚¹å¾€å³å­æ ‘æŒªäº†ã€‚ çº¢é»‘æ ‘æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ çº¢é»‘æ ‘æ˜¯æ•ˆç‡ç›¸å¯¹è¾ƒé«˜çš„å½“æˆ‘ä»¬æ’å…¥å’Œåˆ é™¤æ•°æ®ç›¸å¯¹é¢‘ç¹çš„æ—¶å€™ æŸ¥è¯¢æ€§èƒ½ç•¥å¾®é€Šè‰²äºAVLæ ‘ çº¢é»‘æ ‘æ˜¯è‡ªæˆ‘å¹³è¡¡çš„æ‰€æœ‰æ“ä½œçš„å¤æ‚åº¦æœ€å¤šæ˜¯O(logn) ä¸ç®¡æ€ä¹ˆå˜åŒ–ï¼Œåªæœ‰çº¢é»‘ä¸¤ä¸ªå¸¸æ•°ï¼Œä»»ä½•ä¸å¹³è¡¡éƒ½ä¼šåœ¨ä¸‰æ¬¡æ—‹è½¬ä¹‹å†…è§£å†³ çº¢é»‘æ ‘åœºæ™¯ TreeSetã€TreeMapã€HashMap ","date":"2023-08-09","objectID":"/ds/:0:1","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"æ¯”è¾ƒä¸åŒçš„æ ‘ äºŒå‰æŸ¥æ‰¾æ ‘(BST) ï¼šè§£å†³äº†æ’åºçš„åŸºæœ¬é—®é¢˜ï¼Œä½†æ˜¯ç”±äºæ— æ³•ä¿è¯å¹³è¡¡ï¼Œå¯èƒ½é€€åŒ–ä¸ºé“¾è¡¨ï¼› å¹³è¡¡äºŒå‰æ ‘(AVL) ï¼šé€šè¿‡æ—‹è½¬è§£å†³äº†å¹³è¡¡çš„é—®é¢˜ï¼Œä½†æ˜¯æ—‹è½¬æ“ä½œæ•ˆç‡å¤ªä½ï¼› çº¢é»‘æ ‘ ï¼šé€šè¿‡èˆå¼ƒä¸¥æ ¼çš„å¹³è¡¡å’Œå¼•å…¥çº¢é»‘èŠ‚ç‚¹ï¼Œè§£å†³äº† AVL æ—‹è½¬æ•ˆç‡è¿‡ä½çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨ç£ç›˜ç­‰åœºæ™¯ä¸‹ï¼Œæ ‘ä»ç„¶å¤ªé«˜ï¼ŒIO æ¬¡æ•°å¤ªå¤šï¼› B æ ‘ ï¼šé€šè¿‡å°†äºŒå‰æ ‘æ”¹ä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œè§£å†³äº†æ ‘è¿‡é«˜çš„é—®é¢˜ï¼› B+æ ‘ ï¼šåœ¨ B æ ‘çš„åŸºç¡€ä¸Š å°†éå¶èŠ‚ç‚¹æ”¹é€ ä¸ºä¸å­˜å‚¨æ•°æ®çš„çº¯ç´¢å¼•èŠ‚ç‚¹ï¼Œé€‚åˆæ”¾å…¥å†…å­˜ä¸­ï¼› è¿›ä¸€æ­¥é™ä½äº†æ ‘çš„é«˜åº¦ï¼ŒæŸ¥è¯¢æ€§èƒ½å¥½ï¼› å¶èŠ‚ç‚¹ä½¿ç”¨æŒ‡é’ˆè¿æ¥æˆé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢æ›´åŠ é«˜æ•ˆã€‚ è·³è¡¨ï¼šç”¨äº Redis çš„ zsetï¼Œè§£å†³äº†é“¾è¡¨æŸ¥è¯¢æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:2","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"Queue æœ‰å“ªäº›ï¼Ÿ BlockingQueueï¼šæä¾›äº†çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—è®¿é—®æ–¹å¼ PriorityQueueï¼šä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¯ä»¥æ’åºçš„é˜Ÿåˆ— Dequeï¼šä¸€ä¸ªçº¿æ€§ collectionï¼Œæ”¯æŒåœ¨ä¸¤ç«¯æ’å…¥å’Œç§»é™¤å…ƒç´ ã€‚åç§° deque æ˜¯â€œdouble ended queueï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰â€çš„ç¼©å†™ï¼Œé€šå¸¸è¯»ä¸ºâ€œdeckâ€ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:3","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"Set æœ‰å“ªäº›ç»“æ„ï¼Ÿ HashSetï¼šå“ˆå¸Œè¡¨ï¼Œæ— åº LinkedHashSetï¼šåº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨ï¼Œæœ‰åºã€‚ç”±é“¾è¡¨ä¿è¯å…ƒç´ æœ‰åºï¼Œç”±å“ˆå¸Œè¡¨ä¿è¯å…ƒç´ å”¯ä¸€ã€‚ TreeSetï¼šåº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œå†…éƒ¨å®ç°æ’åºï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ’åºè§„åˆ™ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:4","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"ğŸŒŸArrayList æºç åˆ†æ é»˜è®¤å¤§å°ä¸º 10ï¼ˆåˆå§‹ä¸º 0ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å˜ä¸º 10ï¼‰ æ¯æ¬¡æ‰©å®¹ 1.5 å€ï¼š0 -\u003e 10 -\u003e 15 -\u003e 22 -\u003e 33 -\u003e 49 â€¦ æ•°ç»„ -\u003e listï¼šArrays.asList() æ˜¯æµ…æ‹·è´ï¼Œä¿®æ”¹æ•°ç»„ä¼šå½±å“ listï¼Œå› ä¸ºæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ list -\u003e æ•°ç»„ï¼šlist.toArray() æ˜¯æ·±æ‹·è´ï¼Œè°ƒç”¨ Arrays.copyOf(data,size) ArrayList æ˜¯åŠ¨æ€æ•°ç»„ï¼ŒLinkedList æ˜¯åŒå‘é“¾è¡¨ï¼Œéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé™¤é Collections.synchronizedList() ","date":"2023-08-09","objectID":"/ds/:0:5","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"ğŸŒŸHashMap æºç åˆ†æ JDK8 èµ·ï¼Œ é“¾è¡¨ -\u003e çº¢é»‘æ ‘ï¼šé“¾è¡¨é•¿åº¦ \u003e= 8 \u0026\u0026 æ•°ç»„é•¿åº¦ \u003e= 64 æ—¶ çº¢é»‘æ ‘ -\u003e é“¾è¡¨ï¼šresizeï¼ˆï¼‰æ‰©å®¹æ—¶ï¼Œæ ‘èŠ‚ç‚¹\u003c=6 put æ–¹æ³•ï¼š table ä¸ºç©ºæˆ– ++size \u003e *threshold(é»˜è®¤ 12 = æ•°ç»„é•¿åº¦ï¼ˆé»˜è®¤ 16ï¼‰ 0.75) **æ—¶è§¦å‘æ‰©å®¹æœºåˆ¶ resize() æ¯æ¬¡æ‰©å®¹ Â«1 ï¼ˆå³*2ï¼‰ jdk8 ä¹‹å‰å¤´æ’æ³•ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œjdk8 é‡‡ç”¨å°¾æ’æ³•ï¼Œé¿å…æ‰©å®¹ resize() è¿ç§»æ—¶çš„æ­»å¾ªç¯ hash(key) å¾—åˆ°æ•°ç»„ç´¢å¼• æ‰°åŠ¨ç®—æ³• (hash^hashÂ»\u003e16)å¼‚æˆ–æ“ä½œä½¿ hash å€¼æ›´å‡åŒ€ï¼Œå‡å°‘ hash å†²çª hash\u0026(n-1), n ä¸º 2n ï¼Œç­‰ä»·äº hash%n ï¼Œä½è¿ç®—æ€§èƒ½æ›´å¥½ key å­˜åœ¨åˆ™ä¿®æ”¹ï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ  ","date":"2023-08-09","objectID":"/ds/:0:6","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"ConcurrentHashMap æºç åˆ†æ é”åˆ†æ®µæŠ€æœ¯ï¼Ÿ åŸç†ï¼šæŠŠæ•°æ®åˆ†æˆå¾ˆå¤šæ®µå‚¨å­˜ï¼Œæ¯ä¸€æ®µéƒ½å¯¹åº”ä¸€æŠŠé”ï¼Œè¯»å–æ•°æ®ä¸åŠ é”ï¼Œå†™æ“ä½œæ—¶èƒ½å¤Ÿå°†é”çš„ç²’åº¦ä¿æŒå°½é‡çš„å°ï¼Œä¸ç”¨å¯¹æ•´ä¸ªConcurrentHashMapåŠ é”ã€‚ JDK7ï¼šSegment + HashEntry æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ ã€ä¸å¯æ‰©å®¹ã€‘ Segment extends ReentrantLockï¼ˆç»§æ‰¿å¯é‡å…¥é”ï¼‰ HashEntryåˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ® ä¸€ä¸ªSegmenté‡ŒåŒ…å«ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œæ¯ä¸ªHashEntryæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œæ¯ä¸ªSegmentå®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹HashEntryæ•°ç»„ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»å…ˆè·å¾—å®ƒå¯¹åº”çš„Segmenté” JDK8ï¼šCAS + synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå‡å°‘äº†é”çš„ç²’åº¦ æ•°ç»„+é“¾è¡¨ï¼šç±»ä¼¼ HashMapï¼Œé•¿åº¦\u003e8 å˜ä¸ºçº¢é»‘æ ‘ã€å¤„ç†å“ˆå¸Œå†²çªã€‘ transient volatile int countï¼švolatileçš„è¯­ä¹‰å¯ä»¥ä¿è¯å†™æ“ä½œåœ¨è¯»æ“ä½œä¹‹å‰ï¼Œä¹Ÿå°±ä¿è¯äº†å†™æ“ä½œå¯¹åç»­çš„è¯»æ“ä½œéƒ½æ˜¯å¯è§çš„ï¼Œè¿™æ ·åé¢getçš„åç»­æ“ä½œå°±å¯ä»¥æ‹¿åˆ°å®Œæ•´çš„å…ƒç´ å†…å®¹ å¯¹æ¯ä¸ªæ•°ç»„å…ƒç´ NodeåŠ é”ï¼Œé”çš„ç²’åº¦æ›´ç»†ï¼Œå¹¶å‘åº¦æ›´é«˜ï¼ˆåªè¦ hash ä¸å†²çªå°±æ— å¹¶å‘é—®é¢˜ï¼‰ã€‚ ã€getã€‘ä¸ºä»€ä¹ˆè¯»æ“ä½œä¸åŠ é”ï¼Ÿ å› ä¸ºNodeçš„å…ƒç´ å’ŒæŒ‡é’ˆæ˜¯ç”¨volatileä¿®é¥°çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çº¿ç¨‹Aä¿®æ”¹ç»“ç‚¹çš„valæˆ–è€…æ–°å¢èŠ‚ç‚¹çš„æ—¶å€™æ˜¯å¯¹çº¿ç¨‹Bå¯è§çš„ã€‚æ­¤å¤–ï¼Œvolatileä¿®é¥°æ•°ç»„å¯¹getæ“ä½œæ²¡æœ‰æ•ˆæœï¼Œä½†å¯ä»¥åœ¨æ‰©å®¹çš„æ—¶å€™å¯¹å…¶ä»–çº¿ç¨‹å…·æœ‰å¯è§æ€§ã€‚ volatileå…³é”®å­—ï¼šé€šè¿‡ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œä¿è¯å¯è§æ€§ã€æœ‰åºæ€§ã€‚ä½†ä¸ä¿è¯åŸå­æ€§ã€‚ä½¿ç”¨volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼Œå¹¶å¯¼è‡´ç¼“å­˜å˜é‡çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚ ä½†æ˜¯ï¼Œå½“èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘çš„æ—¶å€™ï¼Œå¦‚æœæ ‘æ­£åœ¨å˜è‰²æ—‹è½¬å¹¶ä¸”é”™æŸ¥è¯¢çš„å€¼ä¸æ˜¯çº¢é»‘æ ‘çš„å¤´èŠ‚ç‚¹ï¼Œä¼šåŠ è¯»å†™é”ã€‚ ã€putã€‘å¦‚ä½•ä¿è¯æ’å…¥æ•°æ®çº¿ç¨‹å®‰å…¨ï¼Ÿ é¦–å…ˆåˆ¤ç©ºï¼Œéç©ºæƒ…å†µä¸‹ä½¿ç”¨**æ‰°åŠ¨å‡½æ•°ï¼ˆé«˜16ä½ä¸ä½16ä½åšå¼‚æˆ–ï¼Œå†å’ŒHash_bitåšä¸è¿ç®—ï¼‰**è®¡ç®—keyçš„hashå€¼ï¼Œ åˆå§‹åŒ–æ•°ç»„é‡‡ç”¨æ‡’æ±‰å¼ï¼ˆç¬¬ä¸€æ¬¡putæ—¶æ‰åˆå§‹åŒ–ï¼‰ï¼Œçº¿ç¨‹å®‰å…¨é€šè¿‡ä¸€ä¸ªvolatileä¿®é¥°çš„å˜é‡sizeCtlç»“åˆCASæ¥å®ç° å½“å¯»å€åçš„æ•°ç»„ä½ç½®æ²¡æœ‰è¢«å ç”¨æ—¶ï¼Œç›´æ¥åŸºäºä¸»å†…å­˜åœ°å€ï¼Œé€šè¿‡CASå°†åˆ›å»ºçš„NodeèŠ‚ç‚¹æ’å…¥åˆ°å½“å‰ä½ç½® å½“å¯»å€åˆ°çš„ä½ç½®æ­£åœ¨è¿›è¡Œæ‰©å®¹/è¿ç§»æ“ä½œæ—¶ï¼ˆhash=MOVED=-1ï¼‰ï¼Œæ‰§è¡ŒhelpTransferæ¥ååŠ©å…¶ä»–çº¿ç¨‹è¿›è¡Œæ‰©å®¹/è¿ç§» å½“ sizeCtl ä¸ºè´Ÿå€¼(-(1+n))æ—¶ï¼Œè¡¨ç¤ºæœ‰ n ä¸ªçº¿ç¨‹æ­£åœ¨æ‰©å®¹ è¿ç§»ï¼šå…ˆè®¡ç®—å½“å‰çº¿ç¨‹éœ€è¦è½¬ç§»å¯¹èŠ‚ç‚¹èŒƒå›´ï¼Œå†è¿›è¡Œæ•°æ®è¿ç§» å½“å‡ºç°hashå†²çªæ—¶ï¼Œå¯¹å•ä¸ªæ•°ç»„å…ƒç´ åŠ  synchronized é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°å°†èŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼ˆé“¾è¡¨é•¿\u003e8æ—¶è°ƒç”¨treeifyBin(tab,iï¼‰è½¬çº¢é»‘æ ‘)ä¸­ï¼Œè‹¥keyå­˜åœ¨æ›¿æ¢æ—§å€¼ï¼Œè‹¥keyä¸å­˜åœ¨å°†kvè¿½åŠ åˆ°é“¾è¡¨å°¾éƒ¨ ConcurrentHashMapè¿­ä»£å™¨æ˜¯å¼ºä¸€è‡´æ€§è¿˜æ˜¯å¼±ä¸€è‡´æ€§ï¼ŸHashMapå‘¢ï¼Ÿ è¿­ä»£å™¨iteratoræ˜¯å¼±ä¸€è‡´æ€§çš„ï¼Œå› ä¸ºåœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯ä»¥å‘mapä¸­æ·»åŠ å…ƒç´ ï¼›è€ŒHashMapæ˜¯å¼ºä¸€è‡´æ€§çš„ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:7","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"æ’åºç®—æ³•æ¯”è¾ƒ ç¨³å®šæ’åºç®—æ³•çš„ä¼˜ç‚¹åœ¨äºå¯ä»¥ä¿æŒç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹é¡ºåºï¼Œè¿™åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹éå¸¸é‡è¦ï¼Œä¾‹å¦‚æŒ‰ç…§å¹´é¾„å’Œå§“åå¯¹å­¦ç”Ÿåå•æ’åºæ—¶ï¼Œå¦‚æœå¹´é¾„ç›¸åŒï¼Œåˆ™åº”è¯¥æŒ‰ç…§å§“åçš„å­—æ¯é¡ºåºæ’åºï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ç¨³å®šæ’åºç®—æ³•ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:8","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"è´ªå¿ƒç®—æ³• vs åŠ¨æ€è§„åˆ’ï¼Ÿ ç«™åœ¨å…¨å±€è§’åº¦æ¥çœ‹ï¼Œå¯¹äºæ¯ä¸ªå¯é€‰é¡¹ï¼Œè´ªå¿ƒç®—æ³•æ˜¯åªä¿ç•™ä¸€ç§å†³ç­–ï¼ˆè¦ä¹ˆæœ€ä¼˜ï¼Œè¦ä¹ˆéæœ€ä¼˜ï¼‰ ï¼ŒåŠ¨æ€è§„åˆ’ä¿ç•™äº†å®ƒçš„ä¸€ä¸ªå†³ç­–é›†ï¼Œä»ä¸­å–æœ€ä¼˜ã€‚ å½“ç„¶ï¼Œç®—æ³•æœ‰ä¼˜åŠ¿å°±æœ‰åŠ£åŠ¿ï¼Œè´ªå¿ƒç®—æ³•è™½ç„¶é€‚ç”¨æ¡ä»¶è‹›åˆ»ï¼Œä½†å¤æ‚åº¦ä½ï¼Œå½“å¯é€‰é›†å¤ªå¤§æ—¶ï¼ŒåŠ¨æ€è§„åˆ’è¿™ç§ç©·ä¸¾ç­–ç•¥ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè€Œè´ªå¿ƒç®—æ³•è™½ç„¶å¹¶ä¸ä¸€å®šèƒ½æ‰¾åˆ°æœ€ä¼˜è§£ï¼Œä½†ä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ¥è¿‘æœ€ä¼˜è§£çš„è§£ã€‚ ç»¼ä¸Šï¼Œè´ªå¿ƒç®—æ³•é€‰çš„æ˜¯å½“å‰æœ€ä¼˜è§£ï¼Œè€ŒåŠ¨æ€è§„åˆ’æ˜¯é€šè¿‡å­é—®é¢˜çš„æœ€ä¼˜è§£æ¨å‡ºå½“å‰çš„æœ€ä¼˜è§£ã€‚ ","date":"2023-08-09","objectID":"/ds/:0:9","tags":["DS"],"title":"ğŸš©DS - æ•°æ®ç»“æ„","uri":"/ds/"},{"categories":["interview"],"content":"OSI ä¸ƒå±‚æ¨¡å‹ï¼Ÿ åº”ç”¨å±‚ï¼šä¸ºè®¡ç®—æœºç”¨æˆ·æä¾›æœåŠ¡ HTTP ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼šã€Nginx çš„ server/udpã€‘è¯»å–æŠ¥æ–‡æ•°æ®éƒ¨åˆ†ï¼Œæ ¹æ®æ•°æ®å†…å®¹åšå‡ºè´Ÿè½½å‡è¡¡å†³ç­–ï¼Œæ›´çµæ´» è¡¨ç¤ºå±‚ï¼šæ•°æ®åŠ å¯†è§£å¯† ä¼šè¯å±‚ï¼šç®¡ç†åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¼šè¯ ä¼ è¾“å±‚ï¼šé€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ TCP/UDP å››å±‚è´Ÿè½½å‡è¡¡ï¼šã€Nginx çš„ upstreamã€‘é€šè¿‡ ip+portï¼Œè½¬å‘åˆ°çœŸå®æœåŠ¡å™¨ï¼Œæ€§èƒ½å¥½ ç½‘ç»œå±‚ï¼šè·¯ç”±å’Œå¯»å€ æ•°æ®é“¾è·¯å±‚ï¼šå¸§ç¼–ç å’Œå·®é”™æ ¡éªŒ VLANï¼šé€»è¾‘åˆ’åˆ†æ•°æ®ï¼Œå°†ä¸€ä¸ªç‰©ç†å±€åŸŸç½‘åˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼Œæ¯ä¸ª VLAN éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¹¿æ’­åŸŸã€‚ ç‰©ç†å±‚ï¼šé€æ˜ä¼ è¾“æ¯”ç‰¹æµ ","date":"2023-08-09","objectID":"/network/:0:1","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"TCP/IP å››å±‚æ¨¡å‹ï¼Ÿ åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰ï¼šæä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®äº¤æ¢ï¼ŒåŒ…æ‹¬DNSï¼ˆåŸºäº UDPï¼‰ã€HTTPã€FTPã€SMTPç­‰åè®®ã€‚ ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰ï¼šè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ã€‚ ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰ï¼šå¤„ç†ç½‘ç»œé—´çš„æ•°æ®ä¼ è¾“å’Œè·¯å¾„é€‰æ‹©ï¼ŒåŒ…æ‹¬IPï¼ˆç½‘é™…åè®®ï¼‰å’ŒICMPï¼ˆInternetæ§åˆ¶æ¶ˆæ¯åè®®ï¼‰ã€‚ é“¾è·¯å±‚ï¼ˆLink Layerï¼‰ï¼šè´Ÿè´£ç‰©ç†ç½‘ç»œä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬ä»¥å¤ªç½‘ã€Wi-Fiç­‰ã€‚ ","date":"2023-08-09","objectID":"/network/:0:2","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"è¯·æ±‚è½¬å‘ï¼ˆForwardï¼‰å’Œé‡å®šå‘ï¼ˆRedirectï¼‰çš„åŒºåˆ«ï¼Ÿ è½¬å‘ï¼ˆForwardï¼‰ï¼š æœåŠ¡å™¨è¡Œä¸º åœ°å€æ è·¯å¾„ä¸å˜ æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç›´æ¥è®¿é—®ç›®æ ‡åœ°å€çš„URLï¼ŒæŠŠé‚£ä¸ªURLçš„å“åº”å†…å®¹è¿”å›ç»™æµè§ˆå™¨ äº‹æƒ…æœªåšå®Œï¼Œæ•°æ®å…±äº« å¦‚ï¼šæœ‰äº›ç½‘é¡µè½¬å‘å¤©æ°”é¢„æŠ¥ä¿¡æ¯ é‡å®šå‘ï¼ˆRedirectï¼‰ï¼š å®¢æˆ·ç«¯è¡Œä¸º åœ°å€æ è·¯å¾„æ”¹å˜ æœåŠ¡ç«¯æ ¹æ®é€»è¾‘,å‘é€ä¸€ä¸ªçŠ¶æ€ç ,å‘Šè¯‰æµè§ˆå™¨é‡æ–°å»è¯·æ±‚é‚£ä¸ªåœ°å€ï¼Œæ‰€ä»¥åœ°å€æ æ˜¾ç¤ºçš„æ˜¯æ–°çš„URL äº‹æƒ…å·²åšå®Œï¼Œæ•°æ®ä¸å…±äº« å¦‚ï¼šç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ ","date":"2023-08-09","objectID":"/network/:0:3","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡ï¼Ÿ ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå¯¼è‡´èµ„æºå»ºç«‹æ— æ„ä¹‰çš„è¿æ¥ã€‚ å‡è®¾ä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦serverå¯¹ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µå‘å‡ºç¡®è®¤ï¼Œæ–°çš„è¿æ¥å°±å»ºç«‹äº†ã€‚ä½†æ­¤æ—¶çš„clientå¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šç†ç¬serverçš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¼šå‘serverå‘é€æ•°æ®ã€‚ä½†serverå´ä»¥ä¸ºæ–°çš„è¿è¾“è¿æ¥å·²ç»å»ºç«‹ï¼Œå¹¶ä¸€ç›´ç­‰å¾…clientå‘æ¥æ•°æ®ã€‚è¿™æ ·serverçš„å¾ˆå¤šèµ„æºå°±ç™½ç™½æµªè´¹æ‰äº†ã€‚é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„è¯ï¼Œserverç”±äºæ”¶ä¸åˆ°ç¡®è®¤çš„æ—¶å€™ï¼Œå°±çŸ¥é“clientå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿æ¥ï¼Œè¿™å°±æœ‰æ•ˆçš„é˜²æ­¢äº†æœåŠ¡å™¨ç«¯çš„ä¸€ç›´ç­‰å¾…è€Œæµªè´¹èµ„æºã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å››æ¬¡ï¼Ÿ å› ä¸ºæ¡æ‰‹çš„ç›®çš„æ˜¯ä¸ºäº†è¯æ˜æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å…·æœ‰æ¥æ”¶å’Œå‘é€æ•°æ®çš„èƒ½åŠ›ï¼Œåœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡ç«¯å‘é€çš„ack=seq+1è¯æ˜äº†å®¢æˆ·ç«¯çš„ç½‘ç»œè”é€šæ€§ï¼Œå¹¶ä¸”å‘é€äº†è‡ªå·±çš„seqï¼Œåªéœ€è¦ç­‰å¾…ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ack=seq+1å°±èƒ½è¯æ˜æœåŠ¡ç«¯çš„ç½‘ç»œè”é€šæ€§ï¼Œå¯ä»¥ä¸‰æ¬¡åšåˆ°çš„ï¼Œå°±ä¸ç”¨ç¬¬å››æ¬¡äº†ï¼ŒèŠ‚çº¦èµ„æºã€‚ ","date":"2023-08-09","objectID":"/network/:0:4","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"HTTPS çš„åŸç†ï¼Ÿ HTTPSå’ŒHTTPçš„åŒºåˆ«ï¼Ÿ HTTPS å¢åŠ äº†ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆTransport Layer Securityï¼ŒTLSï¼‰ ç«¯å£ä¸åŒï¼šhttp æ˜¯ 80 ç«¯å£ï¼Œhttps æ˜¯ 443 ç«¯å£ ä½¿ç”¨ HTTPS åè®®éœ€è¦åˆ° CAï¼ˆCertificate Authorityï¼Œæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ ç”³è¯·è¯ä¹¦ï¼Œå¯ä»¥é˜²æ­¢â€ä¸­é—´äººâ€œæ”»å‡»ã€‚ä¸€èˆ¬å…è´¹è¯ä¹¦è¾ƒå°‘ï¼Œå› è€Œéœ€è¦ä¸€å®šè´¹ç”¨ã€‚ ä¸¤ä¸ªé˜¶æ®µï¼Ÿ åˆ†æˆè¯ä¹¦éªŒè¯é˜¶æ®µï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰å’Œæ•°æ®ä¼ è¾“é˜¶æ®µï¼ˆå¯¹ç§°åŠ å¯†ï¼Œä¿è¯æ•ˆç‡ï¼‰ ä½¿ç”¨ HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ ä¼šï¼ŒHTTPS åªé˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡è¢«ç›‘å¬ï¼Œå¦‚æœç”¨æˆ·ä¸»åŠ¨æˆä¿¡ï¼Œæ˜¯å¯ä»¥æ„å»ºâ€œä¸­é—´äººâ€ç½‘ç»œï¼Œä»£ç†è½¯ä»¶å¯ä»¥å¯¹ä¼ è¾“å†…å®¹è¿›è¡Œè§£å¯†ã€‚ ä¸ºä»€ä¹ˆ HTTPS åè®®éœ€è¦ 9 å€æ—¶å»¶æ‰èƒ½å®Œæˆé€šä¿¡ï¼Ÿ HTTP é¡µé¢å“åº”é€Ÿåº¦æ¯” HTTPS å¿«ï¼Œä¸»è¦æ˜¯å› ä¸º HTTP ä½¿ç”¨ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦äº¤æ¢ 3 ä¸ªåŒ…ï¼Œè€Œ HTTPSé™¤äº† TCP çš„ä¸‰ä¸ªåŒ…ï¼Œè¿˜è¦åŠ ä¸Š ssl æ¡æ‰‹éœ€è¦çš„ 9 ä¸ªåŒ…ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯ 12 ä¸ªåŒ…ã€‚ TCP åè®®éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ TCP è¿æ¥ä¿è¯é€šä¿¡çš„å¯é æ€§ï¼ˆ1.5-RTTï¼‰ï¼› TLS åè®®ä¼šåœ¨ TCP åè®®ä¹‹ä¸Šé€šè¿‡å››æ¬¡æ¡æ‰‹å»ºç«‹ TLS è¿æ¥ä¿è¯é€šä¿¡çš„å®‰å…¨æ€§ï¼ˆ2-RTTï¼‰ï¼› HTTP åè®®ä¼šåœ¨ TCP å’Œ TLS ä¸Šé€šè¿‡ä¸€æ¬¡å¾€è¿”å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼ˆ1-RTTï¼‰ï¼› ","date":"2023-08-09","objectID":"/network/:0:5","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"æµè§ˆå™¨è¾“å…¥urlä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ é€šè¿‡ DNS å°†åŸŸåè§£æä¸ºipåœ°å€ é€šè¿‡ipå’Œç«¯å£å·å‘æœåŠ¡å™¨å‘é€GETè¯·æ±‚ å¦‚æœé…ç½®äº†Nginxï¼Œå¯èƒ½ä¼šå‘ç”Ÿè´Ÿè½½å‡è¡¡ï¼Œè½¬å‘åˆ°å…¶ä»–ipåœ°å€ ä¼ è¾“å±‚è¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹ è·å¾—å“åº”æ•°æ®ï¼ŒåŠ ä¸Šjsä»£ç æ¸²æŸ“é¡µé¢ ä¼ è¾“å®Œæˆåå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ ","date":"2023-08-09","objectID":"/network/:0:6","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"getè¯·æ±‚å’Œpostè¯·æ±‚çš„åŒºåˆ«ï¼Ÿ GETå’ŒPOSTæœ¬è´¨ä¸Šæ²¡åŒºåˆ«éƒ½æ˜¯ä¾èµ–TCP/IPé“¾æ¥ã€‚HTTPä¹‹æ‰€ä»¥åˆ’åˆ†å‡ºGET, POST, PUT, DELETEç­‰è¯·æ±‚ç±»å‹ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚é‚£ä½ è‚¯å®šåˆæœ‰ç–‘é—®äº†ï¼šåº•å±‚éƒ½æ˜¯TCPï¼Œé‚£æ€ä¹ˆå®ç°ä»¥ä¸Šä¸åŒçš„å‘¢ï¼Ÿæ¯”å¦‚GETè¯·æ±‚çš„æœ€å¤§2KBæ˜¯åœ¨å“ªéªŒè¯çš„å‘¢ï¼Ÿ GET, POST, PUT, DELETEç­‰ä¸åŒè¯·æ±‚ç±»å‹çš„ä¸åŒå¤„ç†ç­–ç•¥æ˜¯é€šè¿‡æ•°æ®åŒ…æ§åˆ¶çš„ã€‚ æ¯”å¦‚ï¼šGETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…ï¼›POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ã€‚ å¯¹äºGETæ–¹å¼çš„è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæŠŠheaderå’Œdataä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”200ï¼ˆè¿”å›æ•°æ®ï¼‰ï¼›è€Œå¯¹äºPOSTï¼Œæµè§ˆå™¨å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œæµè§ˆå™¨å†å‘é€dataï¼ŒæœåŠ¡å™¨å“åº”200 okï¼ˆè¿”å›æ•°æ®ï¼‰ã€‚ GETä¸€èˆ¬ç”¨äºè·å–/æŸ¥è¯¢èµ„æºä¿¡æ¯ï¼Œè€ŒPOSTä¸€èˆ¬ç”¨äºæ›´æ–°èµ„æºä¿¡æ¯ã€‚ ä¸ºä»€ä¹ˆåˆ é™¤ä¸èƒ½ç”¨getè¯·æ±‚ é€šè¿‡å†å²è®°å½•æˆ–ä¹¦ç­¾ï¼Œå¾ˆå®¹æ˜“åœ¨æ²¡æœ‰æ„è¯†åˆ°çš„æƒ…å†µä¸‹é‡æ–°è¾“å…¥GETè¯·æ±‚ã€‚å¦‚æœGETæ˜¯ç ´åæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æ•°æ®ä¸¢å¤±ã€‚ ","date":"2023-08-09","objectID":"/network/:0:7","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"ä½ äº†è§£Javaåº”ç”¨å¼€å‘ä¸­çš„æ³¨å…¥æ”»å‡»å—ï¼Ÿ SQLæ³¨å…¥ï¼šor 1=1 æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼šJava è¯­è¨€æä¾›äº†ç±»ä¼¼ Runtime.exec(â€¦) çš„ API XML æ³¨å…¥æ”»å‡»ï¼šJava æ ¸å¿ƒç±»åº“æä¾›äº†å…¨é¢çš„ XML å¤„ç†ã€è½¬æ¢ç­‰å„ç§ APIï¼Œè€Œ XML è‡ªèº«æ˜¯å¯ä»¥åŒ…å«åŠ¨æ€å†…å®¹çš„ å¦‚ä½•ä¿è¯å®‰å…¨ï¼š è¿è¡Œæ—¶å®‰å…¨æœºåˆ¶ã€‚å¯ä»¥ç®€å•è®¤ä¸ºï¼Œå°±æ˜¯é™åˆ¶ Java è¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œä¸è¦åšè¶Šæƒæˆ–è€…ä¸é è°±çš„äº‹æƒ…ã€‚ä»åŸåˆ™ä¸Šæ¥è¯´ï¼ŒJava çš„ GC ç­‰èµ„æºå›æ”¶ç®¡ç†æœºåˆ¶ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯è¿è¡Œæ—¶å®‰å…¨çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœç›¸åº”æœºåˆ¶å¤±æ•ˆï¼Œå°±ä¼šå¯¼è‡´ JVM å‡ºç° OOM ç­‰é”™è¯¯ï¼Œå¯çœ‹ä½œæ˜¯å¦ç±»çš„æ‹’ç»æœåŠ¡ã€‚ Java æä¾›çš„å®‰å…¨æ¡†æ¶ APIï¼Œè¿™æ˜¯æ„å»ºå®‰å…¨é€šä¿¡ç­‰åº”ç”¨çš„åŸºç¡€ã€‚åŠ å¯†ç®—æ³•ã€HTTPS JDK é›†æˆçš„å„ç§å®‰å…¨å·¥å…·ã€‚å°½é‡ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ JDKï¼Œå¹¶ä½¿ç”¨æ¨èçš„å®‰å…¨æœºåˆ¶å’Œæ ‡å‡† ","date":"2023-08-09","objectID":"/network/:0:8","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"å…¬é’¥å’Œç§é’¥ï¼Ÿ å‡è®¾ (public key,private key) ä»£è¡¨ä¸€ä¸ªè´¦æˆ· é€šä¿¡ï¼šæ‹¿å¯¹æ–¹çš„å…¬é’¥åŠ å¯†ï¼Œå‘é€ä¿¡æ¯ï¼Œå¯¹æ–¹æ”¶åˆ°åæ‹¿è‡ªå·±çš„å¯†é’¥è§£å¯†ã€‚ ç­¾åï¼šæ‹¿è‡ªå·±çš„å¯†é’¥åŠ å¯†ï¼Œå…¶ä»–äººæ‹¿è‡ªå·±çš„å…¬é’¥éªŒè¯ã€‚ ","date":"2023-08-09","objectID":"/network/:0:9","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"TCP åè®® TCP å¤´éƒ¨ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å­—æ®µï¼š æºç«¯å£å·ï¼ˆSource Portï¼‰ï¼š16 ä½ï¼Œç”¨äºæ ‡è¯†å‘é€ç«¯å£å·ã€‚ ç›®çš„ç«¯å£å·ï¼ˆDestination Portï¼‰ï¼š16 ä½ï¼Œç”¨äºæ ‡è¯†æ¥æ”¶ç«¯å£å·ã€‚ åºåˆ—å·ï¼ˆSequence Numberï¼‰ï¼š32 ä½ï¼Œç”¨äºæ ‡è¯†è¯¥æ•°æ®æ®µçš„åºåˆ—å·ï¼Œç”¨äºä¿è¯æ•°æ®çš„æœ‰åºä¼ è¾“ã€‚ ç¡®è®¤å·ï¼ˆAcknowledgment Numberï¼‰ï¼š32 ä½ï¼Œç”¨äºæ ‡è¯†æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªæ•°æ®æ®µçš„åºåˆ—å·ã€‚ æ•°æ®åç§»ï¼ˆData Offsetï¼‰ï¼š4 ä½ï¼Œç”¨äºæ ‡è¯† TCP å¤´éƒ¨çš„é•¿åº¦ï¼Œä»¥ 4 å­—èŠ‚ä¸ºå•ä½ã€‚ ä¿ç•™ï¼ˆReservedï¼‰ï¼š6 ä½ï¼Œä¿ç•™æœªä½¿ç”¨ã€‚ æ ‡å¿—ä½ï¼ˆFlagsï¼‰ï¼š6 ä½ï¼Œç”¨äºæ ‡è¯† TCP çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ URGã€ACKã€PSHã€RSTã€SYNã€FIN ç­‰ã€‚ çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰ï¼š16 ä½ï¼Œç”¨äºæ ‡è¯†æ¥æ”¶æ–¹èƒ½å¤Ÿæ¥æ”¶çš„æ•°æ®é‡å¤§å°ã€‚ æ ¡éªŒå’Œï¼ˆChecksumï¼‰ï¼š16 ä½ï¼Œç”¨äºæ£€éªŒ TCP å¤´éƒ¨å’Œæ•°æ®çš„æ­£ç¡®æ€§ã€‚ ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent Pointerï¼‰ï¼š16 ä½ï¼Œç”¨äºæ ‡è¯† TCP æ•°æ®ä¸­çš„ç´§æ€¥æ•°æ®çš„ä½ç½®ã€‚ é€‰é¡¹ï¼ˆOptionsï¼‰ï¼šå¯é€‰ï¼Œç”¨äºä¼ è¾“ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æœ€å¤§æ®µå¤§å°ï¼ˆMSSï¼‰ã€æ—¶é—´æˆ³ï¼ˆTimestampï¼‰ç­‰ã€‚ æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„åŒºåˆ«ï¼Ÿ TCP æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„æœ€å¤§åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ§åˆ¶å¯¹è±¡å’Œç›®çš„ä¸åŒã€‚ TCP æµé‡æ§åˆ¶çš„æ§åˆ¶å¯¹è±¡æ˜¯æ¥æ”¶æ–¹ï¼Œå…¶ç›®çš„æ˜¯æ§åˆ¶å‘é€æ–¹å‘æ¥æ”¶æ–¹å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥é¿å…æ¥æ”¶æ–¹ç¼“å†²åŒºæº¢å‡ºã€‚TCP æµé‡æ§åˆ¶æ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æœºåˆ¶ï¼ŒåŠ¨æ€è°ƒæ•´çª—å£å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿç‡ï¼Œä»¥ä¿è¯æ¥æ”¶æ–¹å¯ä»¥é¡ºåˆ©æ¥æ”¶æ•°æ®ã€‚ TCP æ‹¥å¡æ§åˆ¶çš„æ§åˆ¶å¯¹è±¡æ˜¯ç½‘ç»œï¼Œå…¶ç›®çš„æ˜¯æ§åˆ¶å‘é€æ–¹å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å¡å’Œæ•°æ®ä¸¢å¤±ã€‚TCP æ‹¥å¡æ§åˆ¶æ˜¯é€šè¿‡æ£€æµ‹ç½‘ç»œæ‹¥å¡æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´æ‹¥å¡çª—å£å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿç‡ï¼Œä»¥ä¿è¯ç½‘ç»œçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚ å› æ­¤ï¼ŒTCP æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„æœ€å¤§åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ§åˆ¶å¯¹è±¡å’Œç›®çš„ä¸åŒã€‚TCP æµé‡æ§åˆ¶æ˜¯ä¸ºäº†ä¿è¯æ¥æ”¶æ–¹çš„æ•°æ®æ¥æ”¶æ•ˆç‡å’Œå¯é æ€§ï¼Œè€Œ TCP æ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚ ","date":"2023-08-09","objectID":"/network/:0:10","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"æœåŠ¡ç«¯å‡ºç°å¤§é‡close_waitçŠ¶æ€ï¼Œå¯èƒ½çš„æƒ…å†µï¼Ÿ æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºæœªæ­£ç¡®å…³é—­å¥—æ¥å­—è¿æ¥ï¼šCLOSE_WAITçŠ¶æ€è¡¨ç¤ºæœåŠ¡å™¨å·²ç»å…³é—­äº†è¿æ¥ï¼Œä½†æ˜¯ä»ç„¶åœ¨ç­‰å¾…æœ€åä¸€æ–¹ï¼ˆé€šå¸¸æ˜¯å®¢æˆ·ç«¯ï¼‰å‘é€å…³é—­è¿æ¥çš„è¯·æ±‚ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®å…³é—­å¥—æ¥å­—è¿æ¥ï¼Œå¯¼è‡´è¿æ¥å¤„äºæœªæ­£å¸¸å…³é—­çš„çŠ¶æ€ã€‚ å®¢æˆ·ç«¯æœªå‘é€å…³é—­è¿æ¥è¯·æ±‚ï¼šCLOSE_WAITçŠ¶æ€ä¹Ÿå¯èƒ½æ˜¯ç”±äºå®¢æˆ·ç«¯æ²¡æœ‰å‘é€å…³é—­è¿æ¥è¯·æ±‚ï¼Œå¯¼è‡´æœåŠ¡å™¨ç«¯ä¸€ç›´ç­‰å¾…ç€ã€‚è¿™å¯èƒ½æ˜¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­çš„bugæˆ–è€…ç½‘ç»œé€šä¿¡é—®é¢˜å¯¼è‡´çš„ã€‚ æœåŠ¡å™¨èµ„æºä¸è¶³æˆ–å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼šå¦‚æœæœåŠ¡å™¨ç«¯çš„èµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€çº¿ç¨‹ç­‰ï¼‰ä¸è¶³æˆ–è€…å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶å¤„ç†å…³é—­è¿æ¥çš„è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„CLOSE_WAITçŠ¶æ€ç§¯ç´¯ã€‚ ç½‘ç»œä¸­çš„é—®é¢˜ï¼šåœ¨ç½‘ç»œä¸­å­˜åœ¨é—®é¢˜ï¼Œå¦‚ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ã€æ‹¥å¡ç­‰ï¼Œå¯èƒ½å¯¼è‡´è¿æ¥å…³é—­çš„è¯·æ±‚æœªèƒ½åŠæ—¶åˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼Œä»è€Œå¯¼è‡´CLOSE_WAITçŠ¶æ€çš„ç§¯ç´¯ã€‚ ","date":"2023-08-09","objectID":"/network/:0:11","tags":["NetWork"],"title":"ğŸš©NetWork - è®¡ç®—æœºç½‘ç»œ","uri":"/network/"},{"categories":["interview"],"content":"è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰å“ªå‡ ç§ï¼Ÿ æ— åç®¡é“( pipe )ï¼šçˆ¶å­è¿›ç¨‹é€šä¿¡ é«˜çº§ç®¡é“(popen)ï¼šå°†å¦ä¸€ä¸ªç¨‹åºå½“åšä¸€ä¸ªæ–°çš„è¿›ç¨‹åœ¨å½“å‰ç¨‹åºè¿›ç¨‹ä¸­å¯åŠ¨ï¼Œåˆ™å®ƒç®—æ˜¯å½“å‰ç¨‹åºçš„å­è¿›ç¨‹ æœ‰åç®¡é“ (named pipe)ï¼šå®ƒå…è®¸æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡ æ¶ˆæ¯é˜Ÿåˆ—( message queue )ï¼šå…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘ã€ç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ã€‚ ä¿¡å·é‡( semophore )ï¼šä½œä¸ºä¸€ç§é”æœºåˆ¶ ä¿¡å· ( sinal )ï¼šç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿ å…±äº«å†…å­˜( shared memory )ï¼šæ˜ å°„ä¸€æ®µèƒ½è¢«å…¶ä»–è¿›ç¨‹æ‰€è®¿é—®çš„å†…å­˜ï¼Œè¿™æ®µå…±äº«å†…å­˜ç”±ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºï¼Œä½†å¤šä¸ªè¿›ç¨‹éƒ½å¯ä»¥è®¿é—® å¥—æ¥å­—( socket )ï¼šå¯ç”¨äºä¸åŒæœºå™¨é—´çš„è¿›ç¨‹é€šä¿¡ ","date":"2023-08-09","objectID":"/os/:0:1","tags":["OS"],"title":"ğŸš©OS - æ“ä½œç³»ç»Ÿ","uri":"/os/"},{"categories":["interview"],"content":"ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€çš„åŒºåˆ«ï¼Ÿ Linuxç³»ç»Ÿä»…é‡‡ç”¨ring 0 å’Œ ring 3 è¿™2ä¸ªæƒé™: ring 0 æƒé™æœ€é«˜ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰ C P U æŒ‡ä»¤é›† ring 3 æƒé™æœ€ä½ï¼Œä»…èƒ½ä½¿ç”¨å¸¸è§„ C P U æŒ‡ä»¤é›†ï¼Œä¸èƒ½ä½¿ç”¨æ“ä½œç¡¬ä»¶èµ„æºçš„ C P U æŒ‡ä»¤é›†ï¼Œæ¯”å¦‚ I O è¯»å†™ã€ç½‘å¡è®¿é—®ã€ç”³è¯·å†…å­˜éƒ½ä¸è¡Œã€‚ ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„æ¦‚å¿µå°±æ˜¯C P U æŒ‡ä»¤é›†æƒé™çš„åŒºåˆ«ï¼Œè¿›ç¨‹ä¸­è¦è¯»å†™ I Oï¼Œå¿…ç„¶ä¼šç”¨åˆ° ring 0 çº§åˆ«çš„ C P U æŒ‡ä»¤é›†ï¼Œè€Œæ­¤æ—¶ C P U çš„æŒ‡ä»¤é›†æ“ä½œæƒé™åªæœ‰ ring 3ï¼Œä¸ºäº†å¯ä»¥æ“ä½œring 0 çº§åˆ«çš„ C P U æŒ‡ä»¤é›†ï¼Œ C P U åˆ‡æ¢æŒ‡ä»¤é›†æ“ä½œæƒé™çº§åˆ«ä¸º ring 0ï¼ŒC P Uå†æ‰§è¡Œç›¸åº”çš„ring 0 çº§åˆ«çš„ C P U æŒ‡ä»¤é›†ï¼ˆå†…æ ¸ä»£ç ï¼‰ï¼Œæ‰§è¡Œçš„å†…æ ¸ä»£ç ä¼šä½¿ç”¨å½“å‰è¿›ç¨‹çš„å†…æ ¸æ ˆã€‚ ","date":"2023-08-09","objectID":"/os/:0:2","tags":["OS"],"title":"ğŸš©OS - æ“ä½œç³»ç»Ÿ","uri":"/os/"},{"categories":["draft"],"content":"å®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹ã€‚","date":"2023-08-08","objectID":"/docker_draft/","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"åŸºç¡€çŸ¥è¯† ","date":"2023-08-08","objectID":"/docker_draft/:1:0","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"dockerçš„ä¼˜ç‚¹ è½»é‡çº§å’Œå¯ç§»æ¤æ€§ï¼šDocker å®¹å™¨éå¸¸è½»é‡çº§ï¼Œç›¸æ¯”äºè™šæ‹Ÿæœºï¼Œå®ƒä»¬åªéœ€è¦å°‘é‡çš„ç³»ç»Ÿèµ„æºå’Œè¿è¡Œæ—¶é—´ï¼Œå› æ­¤å¯ä»¥æ›´å¿«åœ°å¯åŠ¨å’Œåœæ­¢ã€‚Docker å®¹å™¨è¿˜å…·æœ‰é«˜åº¦çš„å¯ç§»æ¤æ€§ï¼Œå¯ä»¥åœ¨ä»»ä½•è¿è¡Œ Docker çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œæ— éœ€æ‹…å¿ƒä¾èµ–é¡¹æˆ–ç¯å¢ƒé…ç½®çš„é—®é¢˜ã€‚ ç®€åŒ–åº”ç”¨ç¨‹åºéƒ¨ç½²ï¼šDocker ä½¿å¾—åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚é€šè¿‡å°†åº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–é¡¹æ‰“åŒ…æˆå®¹å™¨ï¼Œå¯ä»¥å°†å…¶è½»æ¾åœ°éƒ¨ç½²åˆ°ä»»ä½•ç¯å¢ƒä¸­ï¼Œä»è€Œç®€åŒ–äº†æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ã€‚ é«˜åº¦å¯å®šåˆ¶æ€§ï¼šDocker å…è®¸ç”¨æˆ·æ„å»ºè‡ªå·±çš„ Docker é•œåƒï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨ç¨‹åºéœ€æ±‚åˆ›å»ºå®šåˆ¶åŒ–çš„å®¹å™¨é•œåƒï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯å®šåˆ¶æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å®¹å™¨åŒ–åº”ç”¨ç¨‹åºéš”ç¦»ï¼šDocker å®¹å™¨æä¾›äº†éš”ç¦»çš„ç¯å¢ƒï¼Œå¯ä»¥é¿å…åº”ç”¨ç¨‹åºä¹‹é—´çš„å†²çªå’Œå¹²æ‰°ã€‚æ¯ä¸ªå®¹å™¨éƒ½å…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€å†…å­˜å’Œ CPU èµ„æºï¼Œå¯ä»¥æœ‰æ•ˆåœ°éš”ç¦»åº”ç”¨ç¨‹åºä¹‹é—´çš„èµ„æºã€‚ æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ï¼šDocker å®¹å™¨å¯ä»¥å…±äº«ä¸»æœºæ“ä½œç³»ç»Ÿçš„å†…æ ¸å’Œå…¶ä»–èµ„æºï¼Œä»è€Œæé«˜äº†èµ„æºåˆ©ç”¨ç‡ã€‚ä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker å®¹å™¨å¯ä»¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ ","date":"2023-08-08","objectID":"/docker_draft/:1:1","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"docker çš„ç¼ºç‚¹ å®¹å™¨åªæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé€šè¿‡Linux Namespaceæœºåˆ¶è¿›è¡Œéš”ç¦»ï¼Œä½†æ˜¯éš”ç¦»å¾—ä¸å½»åº•ï¼Œå¤šä¸ªå®¹å™¨ä½¿ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼š åœ¨å®¹å™¨é‡Œæ‰§è¡Œ top æŒ‡ä»¤,æ˜¾ç¤ºçš„ä¿¡æ¯å±…ç„¶æ˜¯å®¿ä¸»æœºçš„ CPU å’Œå†…å­˜æ•°æ®ï¼Œè€Œä¸æ˜¯å½“å‰å®¹å™¨çš„æ•°æ® å¾ˆå¤šèµ„æºå’Œå¯¹è±¡æ— æ³•è¢« Namespace åŒ–ï¼Œå¦‚â€œæ—¶é—´â€ ","date":"2023-08-08","objectID":"/docker_draft/:1:2","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"Docker Compose å’Œ Dockerfile çš„åŒºåˆ«ï¼Ÿ Dockerfileï¼šæ˜¯ä¸€ç§æ–‡æœ¬æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®šä¹‰ Docker é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚Dockerfile ä¸­åŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤ï¼Œç”¨äºæŒ‡å®šåŸºç¡€é•œåƒã€å®‰è£…è½¯ä»¶ã€æ‹·è´æ–‡ä»¶ã€é…ç½®ç¯å¢ƒå˜é‡ç­‰æ“ä½œï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚Dockerfile å¯ä»¥é€šè¿‡ docker build å‘½ä»¤æ‰§è¡Œï¼Œå°† Dockerfile è½¬æ¢ä¸º Docker é•œåƒã€‚ FROMï¼Œè¯¥å‘½ä»¤æŒ‡å®šåŸºäºå“ªä¸ªåŸºç¡€é•œåƒï¼Œå› ä¸ºä½ è¦æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒæ‰èƒ½åŸºäºè¿™ä¸ªé•œåƒä¹‹ä¸Šè¿›è¡Œå…¶ä»–æ“ä½œï¼ŒDockerFileç¬¬ä¸€æ¡å¿…é¡»ä¸ºFromæŒ‡ä»¤ã€‚å¦‚æœåŒä¸€ä¸ªDockerFileåˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä½¿ç”¨å¤šä¸ªFromæŒ‡ä»¤ï¼ˆæ¯ä¸ªé•œåƒä¸€æ¬¡ï¼‰ MAINTAINERï¼ŒæŒ‡å®šä½œè€…ä¿¡æ¯ CMD EXPOSE ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æš´éœ²ç«¯å£çš„ ENV ï¼Œæ˜¯ç”¨äºå®šä¹‰ç¯å¢ƒå˜é‡ VOLUMEï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æŒ‡å®šæŒ‚è½½ç‚¹ï¼ˆä¹Ÿå¯ä»¥åœ¨ideaé…ç½®ï¼‰ Docker Composeï¼šç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šä¸ªå®¹å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Docker Compose ä¸­ä½¿ç”¨ YAML æ–‡ä»¶æ ¼å¼ï¼Œå®šä¹‰äº†åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡ã€ç½‘ç»œã€å·ç­‰èµ„æºï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»å’Œä¾èµ–å…³ç³»ã€‚Docker Compose å¯ä»¥é€šè¿‡ docker-compose å‘½ä»¤é›†æˆç®¡ç†å¤šä¸ªå®¹å™¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDocker Compose å’Œ Dockerfile å¹¶ä¸æ˜¯äº’æ–¥çš„æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼ŒDockerfile å®šä¹‰å®¹å™¨é•œåƒçš„æ„å»ºè¿‡ç¨‹ï¼ŒDocker Compose å®šä¹‰å®¹å™¨ä¹‹é—´çš„å…³ç³»å’Œä¾èµ–å…³ç³»ï¼Œå¯ä»¥ä¸€èµ·ååŒå·¥ä½œï¼Œå®ç°æ›´åŠ çµæ´»å’Œé«˜æ•ˆçš„å®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²å’Œç®¡ç†ã€‚ ","date":"2023-08-08","objectID":"/docker_draft/:1:3","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"ä½¿ç”¨æ•™ç¨‹ é¦–å…ˆç»™æœåŠ¡å™¨ä¸Šçš„é˜²ç«å¢™æ‰“å¼€ç«¯å£ï¼š ","date":"2023-08-08","objectID":"/docker_draft/:2:0","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"1. portainerï¼ˆå¯è§†åŒ–å·¥å…·ï¼‰ # dockeræœç´¢ docker search portainer # dockeræ‹‰å–é•œåƒ docker pull portainer/portainer:latest # åˆ›å»ºæ•°æ®å· docker volume create portainer_data # è¿è¡Œå®¹å™¨ docker run --name portainer -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer #-d #å®¹å™¨åœ¨åå°è¿è¡Œ #-p 9000:9000 # å®¿ä¸»æœº9000ç«¯å£æ˜ å°„å®¹å™¨ä¸­çš„9000ç«¯å£ #-v /var/run/docker.sock:/var/run/docker.sock # æŠŠå®¿ä¸»æœºçš„Dockerå®ˆæŠ¤è¿›ç¨‹(docker daemon)é»˜è®¤ç›‘å¬çš„UnixåŸŸå¥—æ¥å­—æŒ‚è½½åˆ°å®¹å™¨ä¸­ #-v # æŠŠå®¿ä¸»æœºç›®å½• æŒ‚è½½åˆ° å®¹å™¨ç›®å½•ï¼› #â€“-name portainer # æŒ‡å®šè¿è¡Œå®¹å™¨çš„åç§° cd /usr/libexec/docker/ sudo ln -s docker-runc-current docker-runc å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1867994 ","date":"2023-08-08","objectID":"/docker_draft/:2:1","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"2. ç”Ÿæˆcaè¯ä¹¦ # åˆ›å»ºcaè¯ä¹¦ mkdir -p /usr/local/ca cd /usr/local/ca/ # åˆ›å»ºå¯†ç ï¼ˆè¾“å…¥ä¸¤æ¬¡ï¼‰ openssl genrsa -aes256 -out ca-key.pem 4096 # ä¾æ¬¡è¾“å…¥å¯†ç ã€å›½å®¶ã€çœã€å¸‚ã€ç»„ç»‡åç§°ç­‰,è¾“å…¥â€˜.â€™ç•¥è¿‡ # common name å¡«æœåŠ¡å™¨ip openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem # ç”ŸæˆæœåŠ¡ç«¯çš„ server-key.pem openssl genrsa -out server-key.pem 4096 # ipåœ°å€æ”¹æˆè‡ªå·±çš„ipæˆ–åŸŸå openssl req -subj \"/CN=124.221.157.240\" -sha256 -new -key server-key.pem -out server.csr # é…ç½®ä»»ä½•ip+è¯ä¹¦å¯ä»¥è®¿é—® echo subjectAltName = IP:124.221.157.240,IP:0.0.0.0 \u003e\u003e extfile.cnf # å¯†é’¥ä»…ç”¨äºæœåŠ¡å™¨èº«ä»½éªŒè¯ echo extendedKeyUsage = serverAuth \u003e\u003e extfile.cnf # ç”Ÿæˆç­¾åè¯ä¹¦ openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out server-cert.pem -extfile extfile.cnf # ç”Ÿæˆå®¢æˆ·ç«¯çš„ key.pem openssl genrsa -out key.pem 4096 openssl req -subj '/CN=client' -new -key key.pem -out client.csr # å¯†é’¥é€‚ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯ echo extendedKeyUsage = clientAuth \u003e extfile-client.cnf # ç”Ÿæˆç­¾åè¯ä¹¦ ä»¥ä¸‹è¡¨ç¤º365å¤©ï¼Œå¯ä»¥æ”¹æˆæ›´é•¿ openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out cert.pem -extfile extfile-client.cnf # åˆ é™¤è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é…ç½®æ–‡ä»¶ rm -v client.csr server.csr extfile.cnf extfile-client.cnf # å¯†é’¥è¯»å†™æƒé™æ”¹ä¸ºè¯»å–æƒé™ # from 0600 (rw-------) to 0400 (r--------) chmod -v 0400 ca-key.pem key.pem server-key.pem # è¯ä¹¦å¯¹å¤–å¯è¯»ï¼Œä¹Ÿå…³é—­å†™æƒé™ # from 0644 (rw-r--r--) to 0444 (r--r--r--) chmod -v 0444 ca.pem server-cert.pem cert.pem # å¤åˆ¶è¯ä¹¦ cp server-*.pem /etc/docker/ cp ca.pem /etc/docker/ # docker å…³è” ca vim /usr/lib/systemd/system/docker.service # ä¿®æ”¹ExecStartè¿™ä¸€è¡Œï¼ˆæ·»åŠ æ²¡æœ‰çš„éƒ¨åˆ†ï¼Œä¸åˆ é™¤åŸæœ‰çš„ï¼‰ ExecStart=/usr/bin/dockerd --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server-cert.pem --tlskey=/etc/docker/server-key.pem -H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock # é‡æ–°åŠ è½½ daemon systemctl daemon-reload # é‡å¯ docker systemctl restart docker # å¼€æ”¾2376ç«¯å£ /sbin/iptables -I INPUT -p tcp --dport 2376 -j ACCEPT # å›åˆ°ä¸»æœºï¼ŒæŠŠcaæ–‡ä»¶æ‹·è´å‡ºæ¥ï¼Œ-r è¡¨ç¤ºæ‹·è´æ–‡ä»¶å¤¹ scp -r ubuntu@124.221.157.240:/usr/local/ca ~/Desktop # è¿™é‡Œé‡åˆ°äº† key.pem æ— æ³•æ‹·è´çš„é—®é¢˜ï¼Œä¸´æ—¶ä¿®æ”¹äº†æƒé™ chmod -v 0444 key.pem # å•ç‹¬æ‹·è´ scp ubuntu@124.221.157.240:/usr/local/ca/key.pem ~/Desktop/ca # å†æ”¹å›æ¥ chmod -v 0400 key.pem # æµ‹è¯•è¯ä¹¦æ¥å£ curl https://124.221.157.240:2376/info --cert ./cert.pem --key ./key.pem --cacert ./ca.pem è¯ä¹¦ç”Ÿæ•ˆäº†ã€‚ å‚è€ƒï¼šhttps://blog.csdn.net/qq_46126559/article/details/118373855 ","date":"2023-08-08","objectID":"/docker_draft/:2:2","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"3. ideaéƒ¨ç½²https resources/docker/dockerFile #FROM openjdk:8-jdk-alpine FROM java:8 RUN mkdir -p /apps # appæ”¹æˆé¡¹ç›®åç§° ADD *.jar /apps/app.jar #å¯¹å¤–æš´éœ²çš„ç«¯å£ EXPOSE 8801 # ç¯å¢ƒã€jaråŒ…è·¯å¾„ # appæ”¹æˆé¡¹ç›®åç§° ENTRYPOINT [\"java\",\"-Xmx512m\",\"-Xms512m\",\"-Dspring.profiles.active=test\",\"-jar\",\"/apps/app.jar\"] RUN echo \"Asia/shanghai\" \u003e /etc/timezone; ENV LANG C.UTF-8 https://124.221.157.240:2376 é€‰æ‹©åŒ…å«cert.pemã€key.pemã€ca.pem çš„æ–‡ä»¶å¤¹ /etc/localtime /usr/share/zoneinfo/Asia/Shanghai /apps ","date":"2023-08-08","objectID":"/docker_draft/:2:3","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"4. Redis å®‰è£… # æ‹‰é•œåƒ docker pull redis:latest # æŒ‚è½½ç›®å½• mkdir /docker-data/redis cd /docker-data/redis # ä¸‹è½½redis.conf wget http://download.redis.io/redis-stable/redis.conf # æƒé™ chmod 777 redis.conf # ä¿®æ”¹é…ç½®ä¿¡æ¯ vim /docker-data/redis/redis.conf bind 127.0.0.1 # è¿™è¡Œè¦æ³¨é‡Šæ‰ï¼Œè§£é™¤æœ¬åœ°è¿æ¥é™åˆ¶ protected-mode no # é»˜è®¤yesï¼Œå¦‚æœè®¾ç½®ä¸ºyesï¼Œåˆ™åªå…è®¸åœ¨æœ¬æœºçš„å›ç¯è¿æ¥ï¼Œå…¶ä»–æœºå™¨æ— æ³•è¿æ¥ã€‚ daemonize no # é»˜è®¤no ä¸ºä¸å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œdockeréƒ¨ç½²ä¸éœ€è¦æ”¹ä¸ºyesï¼Œdocker run -dæœ¬èº«å°±æ˜¯åå°å¯åŠ¨ï¼Œä¸ç„¶ä¼šå†²çª requirepass 123456 # è®¾ç½®å¯†ç  appendonly yes # æŒä¹…åŒ– #å¯åŠ¨ docker run --name redis \\ -p 6379:6379 \\ -v /docker-data/redis/redis.conf:/etc/redis/redis.conf \\ -v /docker-data/redis:/data \\ -d redis redis-server /etc/redis/redis.conf --appendonly yes å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1997596 ","date":"2023-08-08","objectID":"/docker_draft/:2:4","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"5. minio é…ç½® docker run -p 9090:9090 -p 9091:9091 \\ --name minio \\ -d --restart=always \\ -e \"MINIO_ACCESS_KEY=minioadmin\" \\ -e \"MINIO_SECRET_KEY=Josh@123\" \\ -v /home/minio/data:/data \\ -v /home/minio/config:/root/.minio \\ minio/minio server \\ /data --console-address \":9091\" -address \":9090\" 9090æ˜¯æœåŠ¡ç«¯å£ï¼Œ9091æ˜¯å¯è§†åŒ–ç•Œé¢ ","date":"2023-08-08","objectID":"/docker_draft/:2:5","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"ç›‘æ§ç³»ç»Ÿ ","date":"2023-08-08","objectID":"/docker_draft/:3:0","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"å¦‚ä½•é…ç½®ç›‘æ§ç³»ç»Ÿï¼Ÿ å®‰è£…ï¼šç¼–å†™ä¸€ä¸ª docker-compose.yml æ–‡ä»¶ï¼ŒæŒ‡å®š Prometheus å’Œ Grafana çš„é•œåƒã€ç«¯å£ç­‰é…ç½®ï¼Œç„¶åä½¿ç”¨ docker-compose up å‘½ä»¤å¯åŠ¨ Prometheus å’Œ Grafana ã€‚ version: '3' services: prometheus: image: prom/prometheus ports: - \"9090:9090\" volumes: - ./prometheus:/etc/prometheus/ command: - --config.file=/etc/prometheus/prometheus.yml - --storage.tsdb.path=/prometheus restart: always grafana: image: grafana/grafana ports: - \"3000:3000\" volumes: - ./grafana:/var/lib/grafana restart: always é…ç½® Prometheusï¼šåœ¨ Prometheus çš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šéœ€è¦ç›‘æ§çš„ç›®æ ‡ï¼ˆä¾‹å¦‚ Java åº”ç”¨ç¨‹åºï¼‰ï¼Œä»¥åŠéœ€è¦é‡‡é›†çš„æŒ‡æ ‡ï¼ˆä¾‹å¦‚ JVM å†…å­˜ä½¿ç”¨æƒ…å†µã€çº¿ç¨‹æ± æƒ…å†µç­‰ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ Prometheus çš„æŸ¥è¯¢è¯­è¨€ï¼ˆPromQLï¼‰æŸ¥è¯¢æŒ‡æ ‡ï¼Œåœ¨Grafanaé¢æ¿ä¸­ï¼Œç‚¹å‡»â€œApplyâ€æˆ–â€œRefreshâ€æŒ‰é’®ï¼Œå³å¯æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶æ˜¾ç¤ºç»“æœ # è·å–å®ä¾‹çš„ CPU ä½¿ç”¨ç‡ï¼š 100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100) # è·å–å®ä¾‹çš„å†…å­˜ä½¿ç”¨ç‡ï¼š 100 - ((node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes) / node_memory_MemTotal_bytes) * 100 # è·å–å®ä¾‹çš„ç£ç›˜ä½¿ç”¨ç‡ï¼š 100 - (avg by (instance) (node_filesystem_free_bytes{fstype=\"ext4\"} / node_filesystem_size_bytes{fstype=\"ext4\"}) * 100) # è·å– HTTP è¯·æ±‚æ•°é‡ï¼š sum by (job) (http_requests_total) # è·å– HTTP è¯·æ±‚é”™è¯¯æ•°é‡ï¼š sum by (job, status) (http_requests_total{status=~\"5..\"}) # è·å– HTTP è¯·æ±‚å“åº”æ—¶é—´çš„å¹³å‡å€¼ï¼š avg by (job) (http_request_duration_seconds) # è·å– HTTP è¯·æ±‚å“åº”æ—¶é—´çš„ 90% ç™¾åˆ†ä½æ•°ï¼š histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket[5m]))) # è·å–å®¹å™¨ CPU ä½¿ç”¨ç‡ï¼š sum by (container) (rate(container_cpu_usage_seconds_total{container!=\"POD\"}[5m])) * 100 # è·å–å®¹å™¨å†…å­˜ä½¿ç”¨ç‡ï¼š sum by (container) (container_memory_usage_bytes{container!=\"POD\"}) / sum by (container) (container_spec_memory_limit_bytes{container!=\"POD\"}) * 100 é…ç½® Grafanaï¼šåœ¨ Grafana ä¸­ï¼Œé€‰æ‹©â€œPrometheusâ€ä½œä¸ºæ•°æ®æºç±»å‹ï¼Œåˆ›å»ºä»ªè¡¨ç›˜å’Œé¢æ¿ï¼Œä½¿ç”¨ Grafana çš„æŸ¥è¯¢è¯­è¨€ï¼ˆGQLï¼‰æŸ¥è¯¢æŒ‡æ ‡ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœå¯è§†åŒ–å±•ç¤ºã€‚ # è·å–æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„ç›‘æ§æ•°æ® SELECT mean(\"metric_name\") FROM \"measurement_name\" WHERE time \u003e= now() - 1h GROUP BY time(1m) fill(null) # æ•°æ®èšåˆå’Œé‡é‡‡æ · SELECT sum(\"metric_name\") FROM \"measurement_name\" WHERE time \u003e= now() - 1d GROUP BY time(1h) fill(0) # æ ¹æ®æ ‡ç­¾è¿‡æ»¤æ•°æ® SELECT mean(\"metric_name\") FROM \"measurement_name\" WHERE \"tag_name\" =~ /tag_value/ AND time \u003e= now() - 1h GROUP BY time(1m) fill(null) # è·å–æœ€æ–°çš„ç›‘æ§æ•°æ® SELECT last(\"metric_name\") FROM \"measurement_name\" WHERE time \u003e= now() - 1h GROUP BY \"tag_name\" fill(null) # æ•°æ®å»é‡ SELECT distinct(\"tag_name\") FROM \"measurement_name\" # è®¡ç®—ä¸¤ä¸ªæŒ‡æ ‡ä¹‹é—´çš„å…³ç³» SELECT derivative(\"metric1_name\") / derivative(\"metric2_name\") * 100 FROM \"measurement_name\" WHERE time \u003e= now() - 1h GROUP BY time(1m) fill(null) # è®¡ç®—æŒ‡æ ‡çš„ç™¾åˆ†ä½æ•° SELECT percentile(\"metric_name\", 95) FROM \"measurement_name\" WHERE time \u003e= now() - 1h GROUP BY time(1m) fill(null) ","date":"2023-08-08","objectID":"/docker_draft/:3:1","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"Springboot é›†æˆ grafana + Prometheus è·å¾— 99 çº¿å’Œ 999 çº¿ï¼Ÿ æ·»åŠ ä¾èµ– åœ¨ Spring Boot é¡¹ç›®çš„ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š \u003cdependency\u003e \u003cgroupId\u003eio.micrometer\u003c/groupId\u003e \u003cartifactId\u003emicrometer-core\u003c/artifactId\u003e \u003cversion\u003e1.5.9\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eio.micrometer\u003c/groupId\u003e \u003cartifactId\u003emicrometer-registry-prometheus\u003c/artifactId\u003e \u003cversion\u003e1.5.9\u003c/version\u003e \u003c/dependency\u003e å…¶ä¸­ï¼Œmicrometer-core æ˜¯ Micrometer åº“çš„æ ¸å¿ƒä¾èµ–ï¼Œmicrometer-registry-prometheus æ˜¯ Micrometer çš„ Prometheus æ³¨å†Œè¡¨ä¾èµ–ã€‚ é…ç½® Prometheus æ³¨å†Œè¡¨ åœ¨ Spring Boot é¡¹ç›®çš„é…ç½®æ–‡ä»¶ application.yml ä¸­æ·»åŠ  Prometheus æ³¨å†Œè¡¨é…ç½®ï¼š management: endpoints: web: exposure: include: \"*\" metrics: tags: application: ${spring.application.name} distribution: percentiles-histogram: http.server.requests: true export: prometheus: enabled: true step: 10s å…¶ä¸­ï¼Œmanagement.endpoints.web.exposure.include é…ç½®å¼€å¯æ‰€æœ‰çš„ç›‘æ§ç«¯ç‚¹ï¼›management.metrics.tags.application é…ç½®åº”ç”¨ç¨‹åºåç§°ï¼›management.metrics.export.prometheus.enabled é…ç½®å¼€å¯ Prometheus æ³¨å†Œè¡¨ï¼›management.metrics.export.prometheus.step é…ç½®é‡‡é›†æ•°æ®çš„æ—¶é—´é—´éš”ã€‚ é…ç½® Grafana æ•°æ®æº åœ¨ Grafana ä¸­æ·»åŠ  Prometheus æ•°æ®æºï¼Œå¹¶é…ç½®æ•°æ®æº URLã€‚ä¾‹å¦‚ï¼ŒPrometheus æ•°æ®æº URL å¯ä»¥é…ç½®ä¸º http://localhost:9090ã€‚ åˆ›å»º Dashboard åœ¨ Grafana ä¸­åˆ›å»º Dashboardï¼Œå¹¶é…ç½® Panelã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„ Graph Panelï¼Œç„¶ååœ¨ Metrics é€‰é¡¹å¡ä¸­é€‰æ‹© http.server.requests æŒ‡æ ‡å¹¶è®¾ç½® percentiles ä¸º 0.99 å’Œ 0.999ã€‚ æŸ¥çœ‹ 99 çº¿å’Œ 999 çº¿ åœ¨åˆ›å»ºå¥½çš„ Dashboard ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹ http.server.requests æŒ‡æ ‡çš„ 99 çº¿å’Œ 999 çº¿ã€‚è¿™äº›çº¿æ¡å°†æ˜¾ç¤ºåœ¨ Graph Panel ä¸­ï¼Œå¹¶æ˜¾ç¤ºå½“å‰æ—¶é—´èŒƒå›´å†…çš„ 99% å’Œ 99.9% çš„è¯·æ±‚å“åº”æ—¶é—´ã€‚ ä»¥ä¸Šæ˜¯ Spring Boot é›†æˆ Grafana å’Œ Prometheus å¹¶è·å– 99 çº¿å’Œ 999 çº¿çš„æ­¥éª¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“çš„é…ç½®å’Œå®ç°å¯èƒ½å› åº”ç”¨ç¨‹åºçš„å…·ä½“æƒ…å†µè€Œå¼‚ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ã€‚ ","date":"2023-08-08","objectID":"/docker_draft/:3:2","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["draft"],"content":"åŠ¨æ€é…ç½®é™æµé˜ˆå€¼ è¦æ ¹æ® Grafana ç›‘æ§æ•°æ®åŠ¨æ€æ›´æ”¹é™æµé˜ˆå€¼ï¼Œå¯ä»¥ä½¿ç”¨ Grafana çš„ Alerting åŠŸèƒ½å’Œ Spring Boot çš„ Actuator ç«¯ç‚¹ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š åˆ›å»º Grafana Alerting è§„åˆ™ åœ¨ Grafana ä¸­åˆ›å»º Alerting è§„åˆ™ï¼Œä»¥ç›‘æ§è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡ 999 çº¿çš„æƒ…å†µã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š a. åœ¨ Grafana ä¸­åˆ›å»ºä¸€ä¸ª Dashboardï¼Œå¹¶æ·»åŠ ä¸€ä¸ª Graph Panelã€‚ b. åœ¨ Metrics é€‰é¡¹å¡ä¸­é€‰æ‹© http.server.requests æŒ‡æ ‡ï¼Œå¹¶è®¾ç½® percentiles ä¸º 0.999ã€‚ c. åœ¨ Alert é€‰é¡¹å¡ä¸­åˆ›å»ºä¸€ä¸ª Alerting è§„åˆ™ï¼Œå½“è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡ 999 çº¿æ—¶è§¦å‘ã€‚ d. åœ¨ Notifications é€‰é¡¹å¡ä¸­é…ç½® Alert çš„é€šçŸ¥æ–¹å¼ï¼Œä¾‹å¦‚é‚®ä»¶é€šçŸ¥ã€‚ åˆ›å»º Actuator ç«¯ç‚¹ åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­åˆ›å»º Actuator ç«¯ç‚¹ï¼Œç”¨äºæ¥æ”¶æ¥è‡ª Grafana çš„ Alerting é€šçŸ¥ï¼Œå¹¶åŠ¨æ€æ›´æ”¹é™æµé˜ˆå€¼ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š a. åˆ›å»ºä¸€ä¸ªå®ç° Actuator Endpoint æ¥å£çš„ç±»ï¼Œç”¨äºæ¥æ”¶æ¥è‡ª Grafana çš„ Alerting é€šçŸ¥ã€‚ @Component @Endpoint(id = \"my-endpoint\") public class MyEndpoint { @WriteOperation public void setRateLimit(@Selector String route, int rateLimit) { // è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¾‹å¦‚ä½¿ç”¨ Redis ç¼“å­˜ä¿å­˜é˜ˆå€¼ã€‚ } } å…¶ä¸­ï¼ŒsetRateLimit æ–¹æ³•ç”¨äºè®¾ç½®é™æµé˜ˆå€¼ï¼Œä¾‹å¦‚ä½¿ç”¨ Redis ç¼“å­˜ä¿å­˜é˜ˆå€¼ã€‚ b. åœ¨ Spring Boot åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ application.yml ä¸­å¼€å¯ Actuator ç«¯ç‚¹ã€‚ management: endpoints: web: exposure: include: \"*\" endpoint: my-endpoint: enabled: true å®ç°é™æµå™¨ åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°é™æµå™¨ï¼Œç”¨äºæ ¹æ® Actuator ç«¯ç‚¹ä¸­ä¿å­˜çš„é˜ˆå€¼è¿›è¡Œé™æµã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Spring Cloud Gateway çš„ RequestRateLimiter è¿‡æ»¤å™¨è¿›è¡Œé™æµã€‚ @Component public class RateLimiterGatewayFilterFactory extends AbstractGatewayFilterFactory\u003cRateLimiterGatewayFilterFactory.Config\u003e { // ä» Redis ç¼“å­˜ä¸­è·å–é™æµé˜ˆå€¼ private int getRateLimit(String route) { // ä¾‹å¦‚ä½¿ç”¨ Redis ç¼“å­˜ä¿å­˜é˜ˆå€¼ã€‚ } public RateLimiterGatewayFilterFactory() { super(Config.class); } @Override public GatewayFilter apply(Config config) { return (exchange, chain) -\u003e { String route = exchange.getAttribute(ServerWebExchangeUtils.GATEWAY_ROUTE_ATTR); int rateLimit = getRateLimit(route); // ä½¿ç”¨ RequestRateLimiter è¿‡æ»¤å™¨è¿›è¡Œé™æµ return new RequestRateLimiterGatewayFilterFactory().apply(new RequestRateLimiterGatewayFilterFactory.Config().setRateLimiter(new RedisRateLimiter(rateLimit, rateLimit, Duration.ofSeconds(1)))); }; } public static class Config { // é…ç½® } } å…¶ä¸­ï¼ŒRateLimiterGatewayFilterFactory æ˜¯è‡ªå®šä¹‰çš„é™æµå™¨ï¼Œä½¿ç”¨ Redis ç¼“å­˜ä¿å­˜é™æµé˜ˆå€¼ï¼›getRateLimit æ–¹æ³•ç”¨äºä» Redis ç¼“å­˜ä¸­è·å–é™æµé˜ˆå€¼ï¼›ä½¿ç”¨ RequestRateLimiter è¿‡æ»¤å™¨è¿›è¡Œé™æµã€‚ æµ‹è¯• å¯åŠ¨ Spring Boot åº”ç”¨ç¨‹åºï¼Œç„¶ååœ¨ Grafana ä¸­åˆ›å»ºä¸€ä¸ª Alerting è§„åˆ™ï¼Œå½“è¯·æ±‚å“åº”æ—¶é—´è¶…è¿‡ 999 çº¿æ—¶è§¦å‘ã€‚å½“ Alert è§¦å‘æ—¶ï¼ŒGrafana ä¼šå‘ Actuator ç«¯ç‚¹å‘é€é€šçŸ¥ï¼ŒActuator ç«¯ç‚¹ä¼šåŠ¨æ€æ›´æ”¹é™æµé˜ˆå€¼ã€‚é™æµå™¨ä¼šæ ¹æ®æ–°çš„é™æµé˜ˆå€¼è¿›è¡Œé™æµï¼Œä»è€Œæœ‰æ•ˆæ§åˆ¶è¯·æ±‚çš„å¹¶å‘é‡ã€‚ ä»¥ä¸Šæ˜¯æ ¹æ® Grafana ç›‘æ§æ•°æ®åŠ¨æ€æ›´æ”¹é™æµé˜ˆå€¼çš„æ­¥éª¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“çš„å®ç°å’Œé…ç½®å¯èƒ½å› åº”ç”¨ç¨‹åºçš„å…·ä½“æƒ…å†µè€Œå¼‚ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ã€‚ ","date":"2023-08-08","objectID":"/docker_draft/:3:3","tags":["Docker"],"title":"Docker æ‚è®°","uri":"/docker_draft/"},{"categories":["practice"],"content":"ä¸€æ­¥ä¸€ä¸ªè„šå°","date":"2023-08-08","objectID":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/","tags":["LeetCode","å‘¨èµ›ä¸ç¬”è¯•"],"title":"å¾€æœŸå‘¨èµ›ä¸ç¬”è¯•é¢˜è§£","uri":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/"},{"categories":["practice"],"content":"20230709 class Solution { public static int maximumJumps(int[] nums, int target) { int len = nums.length; int[] dp = new int[len]; for (int i = 1; i \u003c len; i++) { for (int j = 0; j \u003c i; j++) { if (Math.abs(nums[j] - nums[i]) \u003c= target){ if (dp[j] == 0 \u0026\u0026 j != 0) continue; dp[i] = Math.max(dp[i], dp[j] + 1); } } } return dp[len - 1] == 0 ? -1 : dp[len - 1]; } } class Solution { public int maxNonDecreasingLength(int[] nums1, int[] nums2) { int n = nums1.length; // dp1[i] è¡¨ç¤ºä»¥ nums1[i] ç»“å°¾çš„æœ€é•¿éé€’å‡å­æ•°ç»„é•¿åº¦ // dp2[i] è¡¨ç¤ºä»¥ nums2[i] ç»“å°¾çš„æœ€é•¿éé€’å‡å­æ•°ç»„é•¿åº¦ int[] dp1 = new int[n], dp2 = new int[n]; Arrays.fill(dp1, 1); Arrays.fill(dp2, 1); for (int i = 1; i \u003c n; i++) { if (nums1[i] \u003e= nums1[i - 1]) { dp1[i] = Math.max(dp1[i], dp1[i - 1] + 1); } if (nums1[i] \u003e= nums2[i - 1]) { dp1[i] = Math.max(dp1[i], dp2[i - 1] + 1); } if (nums2[i] \u003e= nums2[i - 1]) { dp2[i] = Math.max(dp2[i], dp2[i - 1] + 1); } if (nums2[i] \u003e= nums1[i - 1]) { dp2[i] = Math.max(dp2[i], dp1[i - 1] + 1); } } int max1 = IntStream.of(dp1).max().getAsInt(); int max2 = IntStream.of(dp2).max().getAsInt(); return Math.max(max1, max2); } } ","date":"2023-08-08","objectID":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/:0:1","tags":["LeetCode","å‘¨èµ›ä¸ç¬”è¯•"],"title":"å¾€æœŸå‘¨èµ›ä¸ç¬”è¯•é¢˜è§£","uri":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/"},{"categories":["practice"],"content":"20230716 class Solution { public int maximumBeauty(int[] nums, int k) { Arrays.sort(nums); int res = 0; for (int l = 0, r = 0; r \u003c nums.length; r++) { while (nums[r] \u003e nums[l] + 2 * k) { l++; } res = Math.max(res, r - l + 1); } return res; } } public static int minimumIndex(List\u003cInteger\u003e nums) { Map\u003cInteger, Integer\u003e map = new HashMap\u003c\u003e(); int max = nums.get(0); int count = 1; //åˆå§‹åŒ–map,ä»¥åŠæ‰¾å‡ºå‡ºç°æœ€å¤šçš„å…ƒç´ maxï¼Œä»¥åŠå®ƒå‡ºç°çš„æ¬¡æ•°count for (int i = 0; i \u003c nums.size(); ++i) { map.put(nums.get(i), map.get(nums.get(i)) != null ? map.get(nums.get(i)) + 1 : 1); } for (int i : map.keySet()) { if (map.get(i) \u003e count) { max = i; count = map.get(i); } } //ä¸åœ¨éœ€è¦è®°å½•å³è¾¹çš„ï¼Œå› ä¸ºcount_r=count-countL int countL = 0; for (int i = 0; i \u003c nums.size() - 1; ++i) { //å¦‚æœå˜åŠ¨äº†max if (nums.get(i) == max) { countL++; } //åˆ¤æ–­ä¸¤è¾¹æ˜¯å¦æœ‰æ”¯é…å…ƒç´ ä¸”ç›¸åŒ if (2 * countL \u003e i + 1 \u0026\u0026 2 * (count - countL) \u003e nums.size() - i - 1) { return i; } } return -1; } ","date":"2023-08-08","objectID":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/:0:2","tags":["LeetCode","å‘¨èµ›ä¸ç¬”è¯•"],"title":"å¾€æœŸå‘¨èµ›ä¸ç¬”è¯•é¢˜è§£","uri":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/"},{"categories":["practice"],"content":"20230722 class Solution { public long maxScore(int[] nums, int x) { int n = nums.length; long even = -x, odd = -x; if (nums[0] % 2 == 0) even = nums[0]; else odd = nums[0]; for (int i = 1; i \u003c n; ++i) { if (nums[i] % 2 == 0) even = Math.max(even, odd - x) + nums[i]; else odd = Math.max(odd, even - x) + nums[i]; } return Math.max(even, odd); } } public static final int MOD = (int) (1e9 + 7); public static int numberOfWays(int n, int x) { List\u003cInteger\u003e nums = new ArrayList\u003c\u003e();// æ‰€æœ‰å¯èƒ½çš„xçš„å¹‚ for (int i = 1; Math.pow(i, x) \u003c= n; i++) { nums.add((int) Math.pow(i, x)); } // 01èƒŒåŒ…é—®é¢˜ï¼Œä¸å¯é‡å¤ int[] dp = new int[n + 1]; // é€‰æ‹©æŸä¸ªæ•°æœ¬èº« dp[0] = 1; for (int i = 0; i \u003c nums.size(); i++) { for (int j = n; j \u003e= nums.get(i); j--) { // åŠ åˆ° dp[0] ä¸ºæ­¢ dp[j] = (dp[j] + dp[j - nums.get(i)]) % MOD; } } return dp[n]; } ","date":"2023-08-08","objectID":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/:0:3","tags":["LeetCode","å‘¨èµ›ä¸ç¬”è¯•"],"title":"å¾€æœŸå‘¨èµ›ä¸ç¬”è¯•é¢˜è§£","uri":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/"},{"categories":["practice"],"content":"xhsï¼šç»Ÿè®¡è¯é¢‘ \u003e 3çš„è¯è¯­ï¼ŒæŒ‰ç…§è¯é¢‘å€’åºï¼Œç›¸åŒè¯é¢‘æŒ‰å­—å…¸åºè¾“å‡ºè¯æ±‡ã€‚ import java.util.*; public class TreeMapWordFrequencyExample { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªTreeMapå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„Comparatorè¿›è¡Œæ’åº TreeMap\u003cString, Integer\u003e wordFrequencyMap = new TreeMap\u003c\u003e(new Comparator\u003cString\u003e() { @Override public int compare(String word1, String word2) { // è¯é¢‘å€’åº int frequencyCompare = wordFrequencyMap.get(word2).compareTo(wordFrequencyMap.get(word1)); if (frequencyCompare == 0) { // å­—å…¸åºå‡åº return word1.compareTo(word2); } else { return frequencyCompare; } } }); // å‡è®¾æœ‰ä¸€äº›å•è¯ List\u003cString\u003e words = Arrays.asList(\"apple\", \"banana\", \"apple\", \"orange\", \"banana\", \"apple\", \"grape\", \"banana\", \"grape\", \"grape\"); // ç»Ÿè®¡å•è¯çš„è¯é¢‘ for (String word : words) { wordFrequencyMap.put(word, wordFrequencyMap.getOrDefault(word, 0) + 1); } // è¾“å‡ºè¯é¢‘å¤§äº3çš„å•è¯ï¼Œå¹¶æŒ‰ç…§è¯é¢‘å€’åºè¾“å‡º for (Map.Entry\u003cString, Integer\u003e entry : wordFrequencyMap.entrySet()) { if (entry.getValue() \u003e 3) { System.out.println(entry.getKey() + \": \" + entry.getValue()); } } } } ä»¥åçš„é¢˜è§£ä¼šå•ç‹¬å‘åœ¨ TAG = å‘¨èµ›ä¸ç¬”è¯• ä¸­ã€‚ ","date":"2023-08-08","objectID":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/:0:4","tags":["LeetCode","å‘¨èµ›ä¸ç¬”è¯•"],"title":"å¾€æœŸå‘¨èµ›ä¸ç¬”è¯•é¢˜è§£","uri":"/%E5%BE%80%E6%9C%9F%E5%91%A8%E8%B5%9B%E9%A2%98%E8%A7%A3/"},{"categories":["practice","interview"],"content":"ç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚ lv1. ä½ åªèƒ½é€‰æ‹© æŸä¸€å¤© ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­ å–å‡ºè¯¥è‚¡ç¥¨ã€‚ class Solution { public int maxProfit(int[] prices) { int res = 0; int min = Integer.MAX_VALUE; for (int price : prices) { if (price \u003c= min) { min = Math.min(min, price); } else { res = Math.max(res, price - min); } } return res; } } lv2. åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ/æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ åŒä¸€å¤© å‡ºå”®ã€‚ class Solution { public int maxProfit(int[] prices) { if (prices.length \u003c 2) { return 0; } int res = 0; int pre = prices[0]; for (int i = 1; i \u003c prices.length; i++) { int cur = prices[i]; if (cur \u003e pre) { res += cur - pre; } pre = cur; } return res; } } lv3. æ¯æ¬¡äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰éœ€è¦äº¤æ‰‹ç»­è´¹ class Solution { public int maxProfit(int[] prices, int fee) { int n = prices.length; int[][] dp = new int[n][2]; // 0 ä¸æŒæœ‰ 1 æŒæœ‰ dp[0][0] = 0; dp[0][1] = -prices[0]; for (int i = 1; i \u003c n; i++) { // i-1 æ˜¨å¤© dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] + prices[i] - fee); dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]); } return dp[n - 1][0]; } } lv4. ä¸é™æ¬¡æ•°ï¼Œä½†å«å†·å†»æœŸï¼šå–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)ã€‚ class Solution { public int maxProfit(int[] prices) { int n = prices.length; if (n \u003c= 1) return 0; // 0 ä¸æŒæœ‰ï¼Œä¸åœ¨å†·å†»æœŸ // 1 æŒæœ‰ // 2 ä¸æŒæœ‰ï¼Œåœ¨å†·å†»æœŸ - æ˜¨å¤©ä¸€å®šæŒæœ‰ï¼Œä¸”ä»Šå¤©è¦å– int[][] dp = new int[n][3]; dp[0][0] = 0; dp[0][1] = -prices[0]; dp[0][2] = 0; for (int i = 1; i \u003c n; i++) {//ä»[1]...[n-1] dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][2]); dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]); dp[i][2] = dp[i - 1][1] + prices[i]; } return Math.max(dp[n - 1][0], dp[n - 1][2]); } } lv5. æœ€å¤šå¯ä»¥å®Œæˆ ä¸¤ç¬” äº¤æ˜“ï¼Œä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ class Solution { public int maxProfit(int[] prices) { if (prices.length \u003c 2) { return 0; } int n = prices.length; int[][] dp = new int[n][5]; // 0 æ²¡æœ‰ä»»ä½•ä¹°å– // 1 ä¹°å…¥ç¬¬ä¸€æ¬¡ dp[0][1] = -prices[0]; // 2 å–å‡ºç¬¬ä¸€æ¬¡ // 3 ä¹°å…¥ç¬¬äºŒæ¬¡ dp[0][3] = -prices[0]; // 4 å–å‡ºç¬¬äºŒæ¬¡ for (int i = 1; i \u003c n; i++) { // i-1 è¡¨ç¤ºæ˜¨å¤© // ä¹°å…¥èŠ±é’±ï¼Œæ‰€ä»¥æ˜¯ -price[i] dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]); // å–å‡ºå¾—é’±ï¼Œæ‰€ä»¥æ˜¯ +price[i] dp[i][2] = Math.max(dp[i - 1][2], dp[i - 1][1] + prices[i]); dp[i][3] = Math.max(dp[i - 1][3], dp[i - 1][2] - prices[i]); dp[i][4] = Math.max(dp[i - 1][4], dp[i - 1][3] + prices[i]); } // æœ€åä¸€å¤©çš„ç¬¬äºŒæ¬¡å–å‡º return dp[n - 1][4]; } } lv6. ä½ æœ€å¤šå¯ä»¥å®Œæˆ k ç¬”äº¤æ˜“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æœ€å¤šå¯ä»¥ä¹° k æ¬¡ï¼Œå– k æ¬¡ï¼Œä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚ class Solution { public int maxProfit(int k, int[] prices) { int len = prices.length; if (len \u003c 2) { return 0; } // 0 æœªä¹°å…¥ // k+1 ç¬¬ k æ¬¡ä¹°å…¥ - å¥‡æ•° // k+2 ç¬¬ k æ¬¡å–å‡º - å¶æ•° int[][] dp = new int[len][2 * k + 1]; // æ¯ä¸ªæ—¶åˆ»ç¬¬ä¸€æ¬¡ä¹°å…¥çš„åˆå§‹æƒ…å†µ for (int i = 0; i \u003c k; i++) { dp[0][2 * i + 1] = -prices[0]; } for (int i = 1; i \u003c len; i++) { // i-1 è¡¨ç¤ºæ˜¨å¤© for (int j = 1; j \u003c= 2 * k; j++) { if ((j \u0026 1) == 1) { // å½“å¤©è€ƒè™‘ä¹°å…¥ // ä¸ä¹°ï¼Œå»¶ç»­æ˜¨å¤©çš„ // ä¹°ï¼Œè¦åœ¨æ˜¨å¤©ä¸æŒæœ‰çš„åŸºç¡€ä¸Šä¹° dp[i][j] = Math.max(dp[i - 1][j], dp[i - 1][j - 1] - prices[i]); } else { // å½“å¤©è€ƒè™‘å–å‡º // ä¸å–ï¼Œå»¶ç»­æ˜¨å¤©çš„ // å–ï¼Œè¦åœ¨æ˜¨å¤©æŒæœ‰çš„åŸºç¡€ä¸Šå– dp[i][j] = Math.max(dp[i - 1][j], dp[i - 1][j - 1] + prices[i]); } } } return dp[len - 1][2 * k]; } } lv999. é™åˆ¶Kç¬”äº¤æ˜“ï¼Œå†·å†»æœŸ1å¤©ï¼Œæœ‰æ‰‹ç»­è´¹ï¼Ÿ","date":"2023-08-08","objectID":"/%E7%BB%8F%E5%85%B8%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%80%9D%E8%B7%AF/:0:0","tags":["DS","LeetCode"],"title":"ğŸš©ç»å…¸è‚¡ç¥¨é—®é¢˜ - åŠ¨æ€è§„åˆ’æ€è·¯","uri":"/%E7%BB%8F%E5%85%B8%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%80%9D%E8%B7%AF/"},{"categories":["practice","interview"],"content":"è¿™ä¹ˆç»å…¸ï¼Œå²‚ä¸é»˜å†™ï¼Ÿ","date":"2023-08-08","objectID":"/leetcode-%E5%85%B8%E4%B8%AD%E5%85%B8/","tags":["DS","LeetCode"],"title":"ğŸš©LeetCode å…¸ä¸­å…¸","uri":"/leetcode-%E5%85%B8%E4%B8%AD%E5%85%B8/"},{"categories":["practice","interview"],"content":" public class QuickSort { public static void quickSort(int[] nums, int left, int right) { if (left \u003c right) { int pivotIndex = partition(nums, left, right); quickSort(nums, left, pivotIndex - 1); quickSort(nums, pivotIndex + 1, right); } } private static int partition(int[] nums, int left, int right) { int pivot = nums[right]; int i = left - 1; for (int j = left; j \u003c right; j++) { if (nums[j] \u003c pivot) { i++; swap(nums, i, j); } } swap(nums, i + 1, right); return i + 1; } private static void swap(int[] nums, int i, int j) { int temp = nums[i]; nums[i] = nums[j]; nums[j] = temp; } } public List\u003cInteger\u003e inorderTraversal(TreeNode root) { List\u003cInteger\u003e res = new LinkedList\u003c\u003e(); Deque\u003cTreeNode\u003e stack = new LinkedList\u003c\u003e(); for (TreeNode cur = root; cur != null || !stack.isEmpty(); cur = cur.right) { // ä¸€ç›´ä¸‹åˆ°æœ€å·¦ while (cur != null) { stack.push(cur); cur = cur.left; } cur = stack.pop();// æ¯æ¬¡å‡ºæ ˆçš„å°±æ˜¯ä¸­åºéå†é¡ºåºçš„èŠ‚ç‚¹ï¼Œç„¶ååœ¨ä»¥ä¸‹è¿›è¡Œå¯¹åº”æ“ä½œ res.add(cur.val); // æœ€åå‘å³ä¸€æ­¥ } return res; } public class BinaryTreePreorderTraversal { public List\u003cInteger\u003e preorderTraversal(TreeNode root) { List\u003cInteger\u003e result = new ArrayList\u003c\u003e(); if (root == null) { return result; } Deque\u003cTreeNode\u003e stack = new LinkedList\u003c\u003e(); stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); result.add(node.val); if (node.right != null) { stack.push(node.right); } if (node.left != null) { stack.push(node.left); } } return result; } } public List\u003cInteger\u003e postorderTraversal(TreeNode root) { List\u003cInteger\u003e result = new ArrayList\u003c\u003e(); if (root == null) { return result; } Deque\u003cTreeNode\u003e stack = new LinkedList\u003c\u003e(); stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); result.add(0, node.val); // æ’å…¥åˆ°ç»“æœåˆ—è¡¨çš„é¦–éƒ¨ if (node.left != null) { stack.push(node.left); } if (node.right != null) { stack.push(node.right); } } return result; } ","date":"2023-08-08","objectID":"/leetcode-%E5%85%B8%E4%B8%AD%E5%85%B8/:0:0","tags":["DS","LeetCode"],"title":"ğŸš©LeetCode å…¸ä¸­å…¸","uri":"/leetcode-%E5%85%B8%E4%B8%AD%E5%85%B8/"},{"categories":["practice","interview"],"content":"è·Ÿç€ debug è°ƒè¯•ä¸€ä¸‹","date":"2023-08-08","objectID":"/lfu/","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice","interview"],"content":"[460]LFU ç¼“å­˜.java è¯·ä½ ä¸º æœ€ä¸ç»å¸¸ä½¿ç”¨ï¼ˆLFUï¼‰ç¼“å­˜ç®—æ³•è®¾è®¡å¹¶å®ç°æ•°æ®ç»“æ„ã€‚ å®ç° LFUCache ç±»ï¼š LFUCache(int capacity) - ç”¨æ•°æ®ç»“æ„çš„å®¹é‡ capacity åˆå§‹åŒ–å¯¹è±¡ int get(int key) - å¦‚æœé”®å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–é”®çš„å€¼ï¼Œå¦åˆ™è¿”å› -1ã€‚ void put(int key, int value) - å¦‚æœé”®å·²å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶å€¼ï¼›å¦‚æœé”®ä¸å­˜åœ¨ï¼Œè¯·æ’å…¥é”®å€¼å¯¹ã€‚å½“ç¼“å­˜è¾¾åˆ°å…¶å®¹é‡æ—¶ï¼Œåˆ™åº”è¯¥åœ¨æ’å…¥æ–°é¡¹ä¹‹å‰ï¼Œä½¿æœ€ä¸ç»å¸¸ä½¿ç”¨çš„é¡¹æ— æ•ˆã€‚åœ¨æ­¤é—®é¢˜ä¸­ï¼Œå½“å­˜åœ¨å¹³å±€ï¼ˆå³ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªé”®å…·æœ‰ç›¸åŒä½¿ç”¨é¢‘ç‡ï¼‰æ—¶ï¼Œåº”è¯¥å»é™¤ æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ çš„é”®ã€‚ æ³¨æ„ã€Œé¡¹çš„ä½¿ç”¨æ¬¡æ•°ã€å°±æ˜¯è‡ªæ’å…¥è¯¥é¡¹ä»¥æ¥å¯¹å…¶è°ƒç”¨ get å’Œ put å‡½æ•°çš„æ¬¡æ•°ä¹‹å’Œã€‚ä½¿ç”¨æ¬¡æ•°ä¼šåœ¨å¯¹åº”é¡¹è¢«ç§»é™¤åç½®ä¸º 0 ã€‚ ä¸ºäº†ç¡®å®šæœ€ä¸å¸¸ä½¿ç”¨çš„é”®ï¼Œå¯ä»¥ä¸ºç¼“å­˜ä¸­çš„æ¯ä¸ªé”®ç»´æŠ¤ä¸€ä¸ª ä½¿ç”¨è®¡æ•°å™¨ ã€‚ä½¿ç”¨è®¡æ•°æœ€å°çš„é”®æ˜¯æœ€ä¹…æœªä½¿ç”¨çš„é”®ã€‚ å½“ä¸€ä¸ªé”®é¦–æ¬¡æ’å…¥åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œå®ƒçš„ä½¿ç”¨è®¡æ•°å™¨è¢«è®¾ç½®ä¸º 1 (ç”±äº put æ“ä½œ)ã€‚å¯¹ç¼“å­˜ä¸­çš„é”®æ‰§è¡Œ get æˆ– put æ“ä½œï¼Œä½¿ç”¨è®¡æ•°å™¨çš„å€¼å°†ä¼šé€’å¢ã€‚ ","date":"2023-08-08","objectID":"/lfu/:1:0","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice","interview"],"content":"æ€è·¯ éœ€è¦ 3 ä¸ª Map æ¥å®ç°ä¸‰å¯¹æ˜ å°„å…³ç³»å…¶ä¸­ï¼Œä¸€ä¸ª key å¯èƒ½å¯¹åº”å¤šä¸ªé¢‘ç‡ï¼Œåœ¨ Java è¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨ LinkedHashSetï¼› key -\u003e value é”®æ˜ å°„å€¼ï¼Œ key -\u003e freq é”®æ˜ å°„é¢‘ç‡ï¼Œ freq -\u003e key é¢‘ç‡æ˜ å°„é”®ï¼Œ LFU çš„æ ¸å¿ƒåœ¨äºè¦åŒæ­¥æ›´æ–°ä¸‰ä¸ª mapï¼Œæ‰€ä»¥ç»†èŠ‚çš„æŠŠæ¡éå¸¸é‡è¦ï¼› get æ–¹æ³•æ ¹æ® key å» key-value çš„ Map ä¸­æ‰¾ï¼Œå¹¶å¢åŠ è¯¥ key çš„é¢‘ç‡ï¼› put æ–¹æ³•éœ€è¦è€ƒè™‘ç¼“å­˜å¤§å°è¶…å‡ºç»™å®šå®¹é‡çš„æƒ…å†µï¼Œè‹¥ key æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆ™éœ€è¦æ·˜æ±°ä¸€ä¸ªé¢‘ç‡æœ€å°çš„ keyï¼Œå¹¶æ·»åŠ æ–°çš„ key-value å¯¹ï¼›è‹¥åŸæœ¬å°±å­˜åœ¨ keyï¼Œåˆ™æ›´æ–°å®ƒçš„ valueï¼Œå¹¶è‡ªå¢å®ƒçš„é¢‘ç‡ã€‚ ","date":"2023-08-08","objectID":"/lfu/:1:1","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice","interview"],"content":"ä»£ç  class LFUCache { // key åˆ° val çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º KV è¡¨ HashMap\u003cInteger, Integer\u003e keyToVal; // key åˆ° freq çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º KF è¡¨ HashMap\u003cInteger, Integer\u003e keyToFreq; // freq åˆ° key åˆ—è¡¨çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º FK è¡¨ HashMap\u003cInteger, LinkedHashSet\u003cInteger\u003e\u003e freqToKeys; // è®°å½•æœ€å°çš„é¢‘æ¬¡ int minFreq; // è®°å½• LFU ç¼“å­˜çš„æœ€å¤§å®¹é‡ int capacity; public LFUCache(int capacity) { keyToVal = new HashMap\u003c\u003e(); keyToFreq = new HashMap\u003c\u003e(); freqToKeys = new HashMap\u003c\u003e(); this.capacity = capacity; this.minFreq = 0; } public int get(int key) { if (!keyToVal.containsKey(key)) { return -1; } increaseFreq(key); return keyToVal.get(key); } public void put(int key, int value) { if (this.capacity \u003c= 0) { return; } /* è‹¥ key å·²å­˜åœ¨ï¼Œä¿®æ”¹å¯¹åº”çš„ val å³å¯ */ if (keyToVal.containsKey(key)) { keyToVal.put(key, value); // key å¯¹åº”çš„ freq åŠ ä¸€ increaseFreq(key); return; } /* key ä¸å­˜åœ¨ï¼Œéœ€è¦æ’å…¥ */ /* å®¹é‡å·²æ»¡çš„è¯éœ€è¦æ·˜æ±°ä¸€ä¸ª freq æœ€å°çš„ key */ if (this.capacity \u003c= keyToVal.size()) { removeMinFreqKey(); } /* æ’å…¥ key å’Œ valï¼Œå¯¹åº”çš„ freq ä¸º 1 */ // æ’å…¥ KV è¡¨ keyToVal.put(key, value); // æ’å…¥ KF è¡¨ keyToFreq.put(key, 1); // æ’å…¥ FK è¡¨ freqToKeys.putIfAbsent(1, new LinkedHashSet\u003c\u003e()); freqToKeys.get(1).add(key); // æ’å…¥æ–° key åæœ€å°çš„ freq è‚¯å®šæ˜¯ 1 this.minFreq = 1; } private void increaseFreq(int key) { int freq = keyToFreq.get(key); /* æ›´æ–° KF è¡¨ */ keyToFreq.put(key, freq + 1); /* æ›´æ–° FK è¡¨ */ // å°† key ä» freq å¯¹åº”çš„åˆ—è¡¨ä¸­åˆ é™¤ freqToKeys.get(freq).remove(key); // å°† key åŠ å…¥ freq + 1 å¯¹åº”çš„åˆ—è¡¨ä¸­ freqToKeys.putIfAbsent(freq + 1, new LinkedHashSet\u003c\u003e()); freqToKeys.get(freq + 1).add(key); // å¦‚æœ freq å¯¹åº”çš„åˆ—è¡¨ç©ºäº†ï¼Œç§»é™¤è¿™ä¸ª freq if (freqToKeys.get(freq).isEmpty()) { freqToKeys.remove(freq); // å¦‚æœè¿™ä¸ª freq æ°å¥½æ˜¯ minFreqï¼Œæ›´æ–° minFreq if (freq == this.minFreq) { this.minFreq++; } } } private void removeMinFreqKey() { // freq æœ€å°çš„ key åˆ—è¡¨ LinkedHashSet\u003cInteger\u003e keyList = freqToKeys.get(this.minFreq); // å…¶ä¸­æœ€å…ˆè¢«æ’å…¥çš„é‚£ä¸ª key å°±æ˜¯è¯¥è¢«æ·˜æ±°çš„ key int deletedKey = keyList.iterator().next(); /* æ›´æ–° FK è¡¨ */ keyList.remove(deletedKey); if (keyList.isEmpty()) { freqToKeys.remove(this.minFreq); // é—®ï¼šè¿™é‡Œéœ€è¦æ›´æ–° minFreq çš„å€¼å—ï¼Ÿ } /* æ›´æ–° KV è¡¨ */ keyToVal.remove(deletedKey); /* æ›´æ–° KF è¡¨ */ keyToFreq.remove(deletedKey); } } ","date":"2023-08-08","objectID":"/lfu/:1:2","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice","interview"],"content":"å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(1) ç©ºé—´å¤æ‚åº¦ï¼šO(capacity) ","date":"2023-08-08","objectID":"/lfu/:1:3","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice","interview"],"content":"è°ƒè¯•ä»£ç  import org.apache.commons.lang.StringUtils; import java.util.*; import java.util.concurrent.TimeUnit; public class Demo { public static void main(String[] args) throws InterruptedException { Scanner scanner = new Scanner(System.in); LFUCache lfuCache = new LFUCache(5) {{ put(1); put(2); put(3); put(4); put(0); }}; for (int i = 0; i \u003c 10; i++) { int nextInt = new Random().nextInt(5); System.out.println(\"random visit = \" + nextInt); TimeUnit.SECONDS.sleep(1); lfuCache.get(nextInt); lfuCache.look(); } for (int i = 5; i \u003c 10; i++) { System.out.println(\"new key = \" + i); lfuCache.put(i); } } static class LFUCache { // key åˆ° val çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º KV è¡¨ HashMap\u003cInteger, Integer\u003e keyToVal; // key åˆ° freq çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º KF è¡¨ HashMap\u003cInteger, Integer\u003e keyToFreq; // freq åˆ° key åˆ—è¡¨çš„æ˜ å°„ï¼Œæˆ‘ä»¬åæ–‡ç§°ä¸º FK è¡¨ HashMap\u003cInteger, LinkedHashSet\u003cInteger\u003e\u003e freqToKeys; // è®°å½•æœ€å°çš„é¢‘æ¬¡ int minFreq; // è®°å½• LFU ç¼“å­˜çš„æœ€å¤§å®¹é‡ int capacity; public LFUCache(int capacity) { keyToVal = new HashMap\u003c\u003e(); keyToFreq = new HashMap\u003c\u003e(); freqToKeys = new HashMap\u003c\u003e(); this.capacity = capacity; this.minFreq = 0; } public int get(int key) { if (!keyToVal.containsKey(key)) { return -1; } increaseFreq(key); return keyToVal.get(key); } public void put(int key) { put(key, key * 10); } public void put(int key, int value) { if (this.capacity \u003c= 0) { return; } /* è‹¥ key å·²å­˜åœ¨ï¼Œä¿®æ”¹å¯¹åº”çš„ val å³å¯ */ if (keyToVal.containsKey(key)) { keyToVal.put(key, value); // key å¯¹åº”çš„ freq åŠ ä¸€ increaseFreq(key); return; } /* key ä¸å­˜åœ¨ï¼Œéœ€è¦æ’å…¥ */ /* å®¹é‡å·²æ»¡çš„è¯éœ€è¦æ·˜æ±°ä¸€ä¸ª freq æœ€å°çš„ key */ if (this.capacity \u003c= keyToVal.size()) { removeMinFreqKey(); } /* æ’å…¥ key å’Œ valï¼Œå¯¹åº”çš„ freq ä¸º 1 */ // æ’å…¥ KV è¡¨ keyToVal.put(key, value); // æ’å…¥ KF è¡¨ keyToFreq.put(key, 1); // æ’å…¥ FK è¡¨ freqToKeys.putIfAbsent(1, new LinkedHashSet\u003c\u003e()); freqToKeys.get(1).add(key); // æ’å…¥æ–° key åæœ€å°çš„ freq è‚¯å®šæ˜¯ 1 this.minFreq = 1; look(); } // kf,fk çš„æ›´æ–° private void increaseFreq(int key) { int freq = keyToFreq.get(key); /* æ›´æ–° KF è¡¨ */ keyToFreq.put(key, freq + 1); /* æ›´æ–° FK è¡¨ */ // å°† key ä» freq å¯¹åº”çš„åˆ—è¡¨ä¸­åˆ é™¤ freqToKeys.get(freq).remove(key); // å°† key åŠ å…¥ freq + 1 å¯¹åº”çš„åˆ—è¡¨ä¸­ freqToKeys.putIfAbsent(freq + 1, new LinkedHashSet\u003c\u003e()); freqToKeys.get(freq + 1).add(key); // å¦‚æœ freq å¯¹åº”çš„åˆ—è¡¨ç©ºäº†ï¼Œç§»é™¤è¿™ä¸ª freq if (freqToKeys.get(freq).isEmpty()) { freqToKeys.remove(freq); // å¦‚æœè¿™ä¸ª freq æ°å¥½æ˜¯ minFreqï¼Œæ›´æ–° minFreq if (freq == this.minFreq) { this.minFreq++; } } } private void removeMinFreqKey() { // freq æœ€å°çš„ key åˆ—è¡¨ LinkedHashSet\u003cInteger\u003e keyList = freqToKeys.get(this.minFreq); // å…¶ä¸­æœ€å…ˆè¢«æ’å…¥çš„é‚£ä¸ª key å°±æ˜¯è¯¥è¢«æ·˜æ±°çš„ key int deletedKey = keyList.iterator().next(); /* æ›´æ–° FK è¡¨ */ keyList.remove(deletedKey); if (keyList.isEmpty()) { freqToKeys.remove(this.minFreq); System.out.println(\"é—®ï¼šè¿™é‡Œéœ€è¦æ›´æ–° minFreq çš„å€¼å—ï¼Ÿ\"); // Qï¼šè¿™é‡Œéœ€è¦æ›´æ–° minFreq çš„å€¼å—ï¼Ÿ // A: ä¸éœ€è¦ï¼Œå› ä¸ºæ‰§è¡Œå®Œè¯¥æ–¹æ³•åï¼ŒminFreq ä¼šè¢«èµ‹å€¼ä¸º1 } /* æ›´æ–° KV è¡¨ */ keyToVal.remove(deletedKey); /* æ›´æ–° KF è¡¨ */ keyToFreq.remove(deletedKey); } public void look() { System.out.println(\"capacity = \" + capacity); System.out.println(\"minFreq = \" + minFreq); System.out.print(\"-----kv------\"); Iterator\u003cInteger\u003e iterator = keyToVal.keySet().iterator(); while (iterator.hasNext()) { Integer k = iterator.next(); System.out.print(k + \",\" + keyToVal.get(k) + \"; \"); } System.out.println(); System.out.print(\"-----kf------\"); Iterator\u003cInteger\u003e iterator2 = keyToFreq.keySet().iterator(); while (iterator2.hasNext()) { Integer k = iterator2.next(); System.out.print(k + \",\" + keyToFreq.get(k) + \"; \"); } System.out.println(); System.out.print(\"-----fk------\"); Iterator\u003cInteger\u003e iterator3 = freqToKeys.keySet().iterator(); while (iterator3.hasNext()) { Integer k = iterator3.next(); System.out.print(k + \",[\" + StringUtils.join(freqToKeys.get(k), \",\") + \"]; \"); } System.out.println(); System.out.println(\"==================\"); } } } ","date":"2023-08-08","objectID":"/lfu/:1:4","tags":["DS","LeetCode"],"title":"LFU","uri":"/lfu/"},{"categories":["practice"],"content":"å¸¸å›æ¥çœ‹çœ‹","date":"2023-08-08","objectID":"/leetcode/","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æ•°ç»„ ","date":"2023-08-08","objectID":"/leetcode/:1:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[560]å’Œä¸ºKçš„å­æ•°ç»„.java ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œä½ éœ€è¦æ‰¾åˆ°è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚ æ€è·¯ é‡‡ç”¨ç©ºé—´æ¢æ—¶é—´ç­–ç•¥ï¼Œç”¨ map è®°å½•å‰åºå’Œã€‚ ä»£ç  class Solution { public int subarraySum(int[] nums, int k) { int count = 0, sum = 0; Map\u003cInteger, Integer\u003e map = new HashMap\u003c\u003e() {{ put(0, 1); }}; for (int num : nums) { sum += num; count += map.getOrDefault(sum - k, 0); map.put(sum, map.getOrDefault(sum, 0) + 1); } return count; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:1:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[304]äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜.java ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ matrixï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„å·¦ä¸Šè§’ä¸º (row1, col1) ï¼Œå³ä¸‹è§’ä¸º (row2, col2) ã€‚ å®ç° NumMatrix ç±»ï¼š NumMatrix(int matrix) ç»™å®šæ•´æ•°çŸ©é˜µ matrix è¿›è¡Œåˆå§‹åŒ– int sumRegion(int row1, int col1, int row2, int col2) è¿”å›å·¦ä¸Šè§’ (row1, col1) ã€å³ä¸‹è§’(row2, col2) çš„å­çŸ©é˜µçš„å…ƒç´ æ€»å’Œã€‚ æ€è·¯ ä»£ç  class NumMatrix { // å­˜å‚¨å·¦ä¸Šè§’åŒºåŸŸå’Œ private int[][] preSum; public NumMatrix(int[][] matrix) { int m = matrix.length; int n = matrix[0].length; preSum = new int[m][n]; preSum[0][0] = matrix[0][0]; for (int i = 1; i \u003c m; i++) { preSum[i][0] = preSum[i - 1][0] + matrix[i][0]; } for (int i = 1; i \u003c n; i++) { preSum[0][i] = preSum[0][i - 1] + matrix[0][i]; } for (int i = 1; i \u003c m; i++) { for (int j = 1; j \u003c n; j++) { preSum[i][j] = matrix[i][j] + preSum[i - 1][j] + preSum[i][j - 1] - preSum[i - 1][j - 1]; } } } public int sumRegion(int row1, int col1, int row2, int col2) { int leftCol = (col1 == 0) ? 0 : preSum[row2][col1 - 1]; int upRow = (row1 == 0) ? 0 : preSum[row1 - 1][col2]; int leftUpArea = (row1 == 0 || col1 == 0) ? 0 : preSum[row1 - 1][col1 - 1]; return preSum[row2][col2] - leftCol - upRow + leftUpArea; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ç©ºé—´å¤æ‚åº¦ï¼šO(n^2) ","date":"2023-08-08","objectID":"/leetcode/:1:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[1094]æ‹¼è½¦.java å‡è®¾ä½ æ˜¯ä¸€ä½é¡ºé£è½¦å¸æœºï¼Œè½¦ä¸Šæœ€åˆæœ‰ capacity ä¸ªç©ºåº§ä½å¯ä»¥ç”¨æ¥è½½å®¢ã€‚ç”±äºé“è·¯çš„é™åˆ¶ï¼Œè½¦ åªèƒ½ å‘ä¸€ä¸ªæ–¹å‘è¡Œé©¶ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸æ‰å¤´æˆ–æ”¹å˜æ–¹å‘ï¼Œä½ å¯ä»¥å°†å…¶æƒ³è±¡ä¸ºä¸€ä¸ªå‘é‡ï¼‰ã€‚ è¿™å„¿æœ‰ä¸€ä»½ä¹˜å®¢è¡Œç¨‹è®¡åˆ’è¡¨ tripsï¼Œå…¶ä¸­ trips[i] = [num_passengers, start_location, end_location] åŒ…å«äº†ç¬¬ i ç»„ä¹˜å®¢çš„è¡Œç¨‹ä¿¡æ¯ï¼š å¿…é¡»æ¥é€çš„ä¹˜å®¢æ•°é‡ï¼› ä¹˜å®¢çš„ä¸Šè½¦åœ°ç‚¹ï¼› ä»¥åŠä¹˜å®¢çš„ä¸‹è½¦åœ°ç‚¹ã€‚ è¿™äº›ç»™å‡ºçš„åœ°ç‚¹ä½ç½®æ˜¯ä»ä½ çš„ åˆå§‹ å‡ºå‘ä½ç½®å‘å‰è¡Œé©¶åˆ°è¿™äº›åœ°ç‚¹æ‰€éœ€çš„è·ç¦»ï¼ˆå®ƒä»¬ä¸€å®šåœ¨ä½ çš„è¡Œé©¶æ–¹å‘ä¸Šï¼‰ã€‚ è¯·ä½ æ ¹æ®ç»™å‡ºçš„è¡Œç¨‹è®¡åˆ’è¡¨å’Œè½¦å­çš„åº§ä½æ•°ï¼Œæ¥åˆ¤æ–­ä½ çš„è½¦æ˜¯å¦å¯ä»¥é¡ºåˆ©å®Œæˆæ¥é€æ‰€æœ‰ä¹˜å®¢çš„ä»»åŠ¡ï¼ˆå½“ä¸”ä»…å½“ä½ å¯ä»¥åœ¨æ‰€æœ‰ç»™å®šçš„è¡Œç¨‹ä¸­æ¥é€æ‰€æœ‰ä¹˜å®¢æ—¶ï¼Œè¿”å› trueï¼Œå¦åˆ™è¯·è¿”å› falseï¼‰ã€‚ æ€è·¯ åˆ©ç”¨å·®åˆ†æ•°ç»„ï¼Œä¸Šè½¦åŠ ä¹˜å®¢æ•°ï¼Œä¸‹è½¦å‡ä¹˜å®¢æ•°ï¼Œæœ€åéå†ä¸€æ¬¡æ£€éªŒæ˜¯å¦æœ‰è¶…è½½æƒ…å†µã€‚ ä»£ç  class Solution { public boolean carPooling(int[][] trips, int capacity) { // å·®åˆ†æ•°ç»„ int[] diff = new int[1001]; // ç»Ÿè®¡æ¯ä¸€ç«™å‡€ä¸Šè½¦äººæ•° for (int[] trip : trips) { int passengers = trip[0]; int start = trip[1]; int end = trip[2]; diff[start] += passengers; diff[end] -= passengers; } // æ’æŸ¥æ˜¯å¦æœ‰è¶…è½½æƒ…å†µ int cur = 0; for (int i : diff) { cur += i; if (cur \u003e capacity) { return false; } } return true; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:1:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[1109]èˆªç­é¢„è®¢ç»Ÿè®¡.java è¿™é‡Œæœ‰ n ä¸ªèˆªç­ï¼Œå®ƒä»¬åˆ†åˆ«ä» 1 åˆ° n è¿›è¡Œç¼–å·ã€‚ æœ‰ä¸€ä»½èˆªç­é¢„è®¢è¡¨ bookings ï¼Œè¡¨ä¸­ç¬¬ i æ¡é¢„è®¢è®°å½• bookings[i] = [firsti, lasti, seatsi] æ„å‘³ç€åœ¨ä» firsti åˆ° lasti ï¼ˆåŒ…å« firsti å’Œ lasti ï¼‰çš„ æ¯ä¸ªèˆªç­ ä¸Šé¢„è®¢äº† seatsi ä¸ªåº§ä½ã€‚ è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ answerï¼Œå…¶ä¸­ answer[i] æ˜¯èˆªç­ i ä¸Šé¢„è®¢çš„åº§ä½æ€»æ•°ã€‚ æ€è·¯ åˆ©ç”¨å·®åˆ†æ•°ç»„ï¼Œæ ¹æ®æ¯ä¸€æ¡æ•°æ®ï¼Œåœ¨ first å¤„åŠ åº§ä½æ•°ï¼Œåœ¨ last +1 å¤„å‡åº§ä½æ•°ï¼Œæœ€åéå†ç´¯åŠ å¾—åˆ° answer æ•°ç»„ã€‚ ä»£ç  class Solution { public int[] corpFlightBookings(int[][] bookings, int n) { int[] diff = new int[n]; int[] answer = new int[n]; for (int[] booking : bookings) { int first = booking[0]; int last = booking[1]; int seats = booking[2]; diff[first - 1] += seats; if (last \u003c n) { // å®é™…ä¸Šæ˜¯ last+1-1 // +1 æ˜¯å› ä¸ºåº§ä½åœ¨ä¸‹ä¸€ç«™æ‰è…¾å‡ºæ¥ // -1 æ˜¯å› ä¸ºèˆªç­ä» 1 å¼€å§‹ç¼–å·ï¼Œè€Œæ•°ç»„ä» 0 å¼€å§‹ç¼–å· diff[last] -= seats; } } answer[0] = diff[0]; for (int i = 1; i \u003c n; i++) { answer[i] = answer[i - 1] + diff[i]; } return answer; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:1:4","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"äºŒåˆ†æœç´¢æ¨¡æ¿ int binary_search(int[] nums, int target) { int left = 0, right = nums.length - 1; while(left \u003c= right) { int mid = left + (right - left) / 2; if (nums[mid] \u003c target) { left = mid + 1; } else if (nums[mid] \u003e target) { right = mid - 1; } else if(nums[mid] == target) { // ç›´æ¥è¿”å› return mid; } } // ç›´æ¥è¿”å› return -1; } å¯»æ‰¾å·¦è¾¹ç•Œ int left_bound(int[] nums, int target) { int left = 0, right = nums.length - 1; while (left \u003c= right) { int mid = left + (right - left) / 2; if (nums[mid] \u003c target) { left = mid + 1; } else if (nums[mid] \u003e target) { right = mid - 1; } else if (nums[mid] == target) { // åˆ«è¿”å›ï¼Œé”å®šå·¦ä¾§è¾¹ç•Œ right = mid - 1; } } // æœ€åè¦æ£€æŸ¥ left è¶Šç•Œçš„æƒ…å†µ if (left \u003e= nums.length || nums[left] != target) return -1; return left; } å¯»æ‰¾å³è¾¹ç•Œ int right_bound(int[] nums, int target) { int left = 0, right = nums.length - 1; while (left \u003c= right) { int mid = left + (right - left) / 2; if (nums[mid] \u003c target) { left = mid + 1; } else if (nums[mid] \u003e target) { right = mid - 1; } else if (nums[mid] == target) { // åˆ«è¿”å›ï¼Œé”å®šå³ä¾§è¾¹ç•Œ left = mid + 1; } } // æœ€åè¦æ£€æŸ¥ right è¶Šç•Œçš„æƒ…å†µ if (right \u003c 0 || nums[right] != target) return -1; return right; } ","date":"2023-08-08","objectID":"/leetcode/:1:5","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[875]çˆ±åƒé¦™è•‰çš„ç‚ç‚.java ç‚ç‚å–œæ¬¢åƒé¦™è•‰ã€‚è¿™é‡Œæœ‰ N å †é¦™è•‰ï¼Œç¬¬ i å †ä¸­æœ‰ piles[i] æ ¹é¦™è•‰ã€‚è­¦å«å·²ç»ç¦»å¼€äº†ï¼Œå°†åœ¨ H å°æ—¶åå›æ¥ã€‚ ç‚ç‚å¯ä»¥å†³å®šå¥¹åƒé¦™è•‰çš„é€Ÿåº¦ K ï¼ˆå•ä½ï¼šæ ¹/å°æ—¶ï¼‰ã€‚æ¯ä¸ªå°æ—¶ï¼Œå¥¹å°†ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œä»ä¸­åƒæ‰ K æ ¹ã€‚å¦‚æœè¿™å †é¦™è•‰å°‘äº K æ ¹ï¼Œå¥¹å°†åƒæ‰è¿™å †çš„æ‰€æœ‰é¦™è•‰ï¼Œç„¶åè¿™ä¸€å°æ—¶å†…ä¸ä¼šå†åƒæ›´å¤šçš„é¦™è•‰ã€‚ ç‚ç‚å–œæ¬¢æ…¢æ…¢åƒï¼Œä½†ä»ç„¶æƒ³åœ¨è­¦å«å›æ¥å‰åƒæ‰æ‰€æœ‰çš„é¦™è•‰ã€‚ è¿”å›å¥¹å¯ä»¥åœ¨ H å°æ—¶å†…åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ Kï¼ˆK ä¸ºæ•´æ•°ï¼‰ã€‚ æ€è·¯ ä»¥é€Ÿåº¦ä¸ºè‡ªå˜é‡ï¼ŒèŠ±è´¹æ—¶é—´ä¸ºåº”å˜é‡ï¼Œæ„é€ å‡½æ•°ï¼Œå®šä¹‰åŸŸåœ¨ [1,10^9] æ‰€æ±‚ä¸ºæœ€å°é€Ÿåº¦ï¼Œè½¬æ¢ä¸ºå¯»æ‰¾å·¦è¾¹ç•Œ èŠ±è´¹æ—¶é—´è¿‡é•¿ï¼Œåº”å½“åŠ å¤§é€Ÿåº¦ï¼Œæ‰©å¤§ left è¾¹ç•Œï¼›èŠ±è´¹æ—¶é—´ç›¸ç­‰æˆ–è¶³å¤Ÿå°ï¼Œä¸ç›´æ¥è¿”å›ï¼Œè€Œæ˜¯ç¼©å° right è¾¹ç•Œ é€€å‡ºå¾ªç¯å‰ï¼Œleft==right \u0026\u0026 f(piles,mid)==h ï¼Œ æ­¤æ—¶ä½äºå·¦è¾¹ç•Œï¼Œright = mid -1 åé€€å‡ºå¾ªç¯ï¼Œå› æ­¤æœ€ç»ˆè¿”å› left ä»£ç  class Solution { public int minEatingSpeed(int[] piles, int h) { int left = 1, right = 1000000000; while (left \u003c= right) { int mid = left + (right - left) / 2; if (f(piles, mid) \u003e h) { left = mid + 1; } else { // åˆ«è¿”å›ï¼Œé”å®šå·¦ä¾§è¾¹ç•Œ right = mid - 1; } } return left; } private int f(int[] piles, int v) { int hours = 0; for (int pile : piles) { hours += pile / v; if (pile % v \u003e 0) { hours++; } } return hours; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:1:6","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[1011]åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›.java ä¼ é€å¸¦ä¸Šçš„åŒ…è£¹å¿…é¡»åœ¨ D å¤©å†…ä»ä¸€ä¸ªæ¸¯å£è¿é€åˆ°å¦ä¸€ä¸ªæ¸¯å£ã€‚ ä¼ é€å¸¦ä¸Šçš„ç¬¬ i ä¸ªåŒ…è£¹çš„é‡é‡ä¸º weights[i]ã€‚æ¯ä¸€å¤©ï¼Œæˆ‘ä»¬éƒ½ä¼šæŒ‰ç»™å‡ºé‡é‡çš„é¡ºåºå¾€ä¼ é€å¸¦ä¸Šè£…è½½åŒ…è£¹ã€‚æˆ‘ä»¬è£…è½½çš„é‡é‡ä¸ä¼šè¶…è¿‡èˆ¹çš„æœ€å¤§è¿è½½é‡é‡ã€‚ è¿”å›èƒ½åœ¨ D å¤©å†…å°†ä¼ é€å¸¦ä¸Šçš„æ‰€æœ‰åŒ…è£¹é€è¾¾çš„èˆ¹çš„æœ€ä½è¿è½½èƒ½åŠ›ã€‚ æ€è·¯ ä»¥æ‰¿è½½é‡ä¸ºè‡ªå˜é‡ï¼ŒèŠ±è´¹å¤©æ•°ä¸ºåº”å˜é‡ï¼Œæ„é€ å‡½æ•°ï¼Œæ‰¿è½½é‡ä¸‹é™ä¸ºæœ€å¤§çš„é‚£ä¸ªåŒ…è£¹çš„é‡é‡ï¼Œä¸Šé™ä¸ºæ‰€æœ‰åŒ…è£¹åŠ èµ·æ¥çš„é‡é‡ã€‚ æ‰€æ±‚ä¸ºæœ€å°æ‰¿è½½é‡ï¼Œè½¬æ¢ä¸ºå¯»æ‰¾å·¦è¾¹ç•Œ èŠ±è´¹æ—¶é—´è¿‡é•¿ï¼Œåº”å½“åŠ å¤§æ‰¿è½½é‡ï¼Œæ‰©å¤§ left è¾¹ç•Œï¼›èŠ±è´¹æ—¶é—´ç›¸ç­‰æˆ–è¶³å¤Ÿå°ï¼Œä¸ç›´æ¥è¿”å›ï¼Œè€Œæ˜¯ç¼©å° right è¾¹ç•Œ é€€å‡ºå¾ªç¯å‰ï¼Œleft==right \u0026\u0026 f(weights,mid)==days ï¼Œ æ­¤æ—¶ä½äºå·¦è¾¹ç•Œï¼Œright = mid -1 åé€€å‡ºå¾ªç¯ï¼Œå› æ­¤æœ€ç»ˆè¿”å› left ä»£ç  class Solution { public int shipWithinDays(int[] weights, int days) { int left = 1, right = 1; for (int weight : weights) { if (weight \u003e left) { left = weight; } right += weight; } while (left \u003c= right) { int mid = left + (right - left) / 2; if (f(weights, mid) \u003e days) { left = mid + 1; } else { right = mid - 1; } } return left; } private int f(int[] weights, int capacity) { int days = 1; int todayCapacity = capacity; for (int weight : weights) { if (weight \u003e todayCapacity) { // ä»Šå¤©ä¸å¤Ÿè£…äº†ï¼Œæ˜å¤©ä¸€æ¥å°±è£…è¿™ä¸ªåŒ…è£¹ days++; todayCapacity = capacity - weight; } else { // ä»Šå¤©è£…ä¸‹è¿™ä¸ªåŒ…è£¹æ²¡é—®é¢˜ todayCapacity -= weight; } } return days; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:1:7","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼ˆå¾ªç¯æœç´¢ï¼‰ class Solution { public int[] nextGreaterElements(int[] nums) { int[] res = new int[nums.length]; Stack\u003cInteger\u003e stack = new Stack\u003c\u003e(); // ä»åå¾€å‰éå† for (int i = nums.length - 1; i \u003e= 0; i--) { while (!stack.isEmpty() \u0026\u0026 nums[i] \u003e= stack.peek()) { // æ ˆé¡¶å…ƒç´ å³å°†è¢« nums[i] æŒ¡ä½ stack.pop(); } if (stack.isEmpty()) { res[i] = -1; // åé¢æ‰¾ä¸åˆ°äº†ï¼Œå»å‰é¢æ‰¾æ‰¾çœ‹ for (int j = 0; j \u003c i; j++) { if (nums[j] \u003e nums[i]) { res[i] = nums[j]; break; } } } else { res[i] = stack.peek(); } stack.push(nums[i]); } return res; } } ","date":"2023-08-08","objectID":"/leetcode/:1:8","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æœç´¢äºŒç»´çŸ©é˜µ ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š æ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰å‡åºæ’åˆ—ã€‚æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚ class Solution { public boolean searchMatrix(int[][] matrix, int target) { int m = matrix.length, n = matrix[0].length; int low = 0, high = m * n - 1; while (low \u003c= high) { int mid = (high - low) / 2 + low; int x = matrix[mid / n][mid % n]; if (x \u003c target) { low = mid + 1; } else if (x \u003e target) { high = mid - 1; } else { return true; } } return false; } } ","date":"2023-08-08","objectID":"/leetcode/:1:9","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æŠ˜çº¿å›¾çš„æœ€å°‘çº¿æ®µæ•° ç»™ä½ ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ stockPrices ï¼Œå…¶ä¸­ stockPrices[i] = [dayi, pricei] è¡¨ç¤ºè‚¡ç¥¨åœ¨ dayi çš„ä»·æ ¼ä¸º pricei ã€‚æŠ˜çº¿å›¾ æ˜¯ä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šçš„è‹¥å¹²ä¸ªç‚¹ç»„æˆçš„å›¾ï¼Œæ¨ªåæ ‡è¡¨ç¤ºæ—¥æœŸï¼Œçºµåæ ‡è¡¨ç¤ºä»·æ ¼ï¼ŒæŠ˜çº¿å›¾ç”±ç›¸é‚»çš„ç‚¹è¿æ¥è€Œæˆã€‚æ¯”æ–¹è¯´ä¸‹å›¾æ˜¯ä¸€ä¸ªä¾‹å­ï¼š è¯·ä½ è¿”å›è¦è¡¨ç¤ºä¸€ä¸ªæŠ˜çº¿å›¾æ‰€éœ€è¦çš„ æœ€å°‘çº¿æ®µæ•° ã€‚ class Solution { public int minimumLines(int[][] stockPrices) { if (stockPrices.length \u003c= 1) { return 0; } Arrays.sort(stockPrices, (a, b) -\u003e { if (a[0] == b[0]) { return a[1] - b[1]; } else { return a[0] - b[0]; } }); int count = 1; String k = getK(stockPrices[1][1] - stockPrices[0][1], stockPrices[1][0] - stockPrices[0][0]); for (int i = 2; i \u003c stockPrices.length; i++) { int dy = stockPrices[i][1] - stockPrices[i - 1][1]; int dx = stockPrices[i][0] - stockPrices[i - 1][0]; if (dy == 0 \u0026\u0026 dx == 0) { continue; } String tempK = getK(dy, dx); if (!k.equals(tempK)) { count++; k = tempK; } } return count; } private String getK(int dy, int dx) { if (dx == 0) { return \"wx\"; } //äºŒè€…æœ€å¤§å…¬çº¦æ•°ï¼Œå°†ä¸¤æ•°åŒ–ä¸ºæœ€ç®€ï¼Œæ–¹ä¾¿æ¯”è¾ƒ int gcd = gcd(Math.abs(dy), Math.abs(dx)); dy /= gcd; dx /= gcd; return dy + \"/\" + dx; } /** * æ±‚æœ€å¤§å…¬çº¦æ•° * * @param a * @param b * @return */ private int gcd(int a, int b) { if (b != 0) { return gcd(b, a % b); } return a; } } ","date":"2023-08-08","objectID":"/leetcode/:1:10","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"ä¸‰æ•°ä¹‹å’Œ ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚ ä»£ç ï¼ˆåŒæŒ‡é’ˆï¼‰ class Solution { public List\u003cList\u003cInteger\u003e\u003e threeSum(int[] nums) { List\u003cList\u003cInteger\u003e\u003e res = new ArrayList\u003c\u003e(); if (nums == null || nums.length \u003c 3) { return res; } Arrays.sort(nums); for (int i = 0; i \u003c nums.length - 2; i++) { //å‡æ if (nums[i] \u003e 0) { break; } //å»é‡ if (i \u003e 0 \u0026\u0026 nums[i] == nums[i - 1]) { continue; } //åä¸¤æ•°ä¹‹å’Œç­‰äºç¬¬ä¸€ä¸ªæ•°çš„ç›¸åæ•° int target = -nums[i]; int left = i + 1, right = nums.length - 1; while (left \u003c right) { if (nums[left] + nums[right] == target) { res.add(Arrays.asList(nums[i], nums[left++], nums[right--])); while (left \u003c right \u0026\u0026 nums[left] == nums[left - 1]) { left++; } while (left \u003c right \u0026\u0026 nums[right] == nums[right + 1]) { right--; } } else if (nums[left] + nums[right] \u003c target) { left++; } else { right--; } } } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ç©ºé—´å¤æ‚åº¦ï¼š$$ \\begin{cases} O(logn)ï¼Œä¸å…è®¸æ”¹å˜å‚æ•°\\ O(1)ï¼Œå…è®¸æ”¹å˜å‚æ•° \\end{cases} $$ ","date":"2023-08-08","objectID":"/leetcode/:1:11","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"é¢œè‰²åˆ†ç±»ï¼ˆè·å…°å›½æ——é—®é¢˜ï¼‰ ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚ æ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚ ä»£ç  class Solution { public void sortColors(int[] nums) { int left = 0, right = nums.length - 1; for (int i = 0; i \u003c= right; i++) { if (nums[i] == 0) { //iæŠŠ0ç»™äº†leftï¼Œleftåªå¯èƒ½æŠŠ0ç»™i swap(nums, left++, i); } else if (nums[i] == 2) { //iæŠŠ2ç»™äº†rightï¼Œrightå¯èƒ½æŠŠ0æˆ–1ç»™iï¼Œæ‰€ä»¥iä¸èƒ½ç«‹åˆ»è‡ªå¢ swap(nums, right--, i--); } } } private void swap(int[] nums, int index1, int index2) { int a = nums[index1]; nums[index1] = nums[index2]; nums[index2] = a; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:1:12","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[31]ä¸‹ä¸€ä¸ªæ’åˆ—.java //æ•´æ•°æ•°ç»„çš„ä¸€ä¸ª æ’åˆ— å°±æ˜¯å°†å…¶æ‰€æœ‰æˆå‘˜ä»¥åºåˆ—æˆ–çº¿æ€§é¡ºåºæ’åˆ—ã€‚ //// // ä¾‹å¦‚ï¼Œarr = [1,2,3] ï¼Œä»¥ä¸‹è¿™äº›éƒ½å¯ä»¥è§†ä½œ arr çš„æ’åˆ—ï¼š[1,2,3]ã€[1,3,2]ã€[3,1,2]ã€[2,3,1] ã€‚ // //// æ•´æ•°æ•°ç»„çš„ ä¸‹ä¸€ä¸ªæ’åˆ— æ˜¯æŒ‡å…¶æ•´æ•°çš„ä¸‹ä¸€ä¸ªå­—å…¸åºæ›´å¤§çš„æ’åˆ—ã€‚æ›´æ­£å¼åœ°ï¼Œå¦‚æœæ•°ç»„çš„æ‰€æœ‰æ’åˆ—æ ¹æ®å…¶å­—å…¸é¡ºåºä»å°åˆ°å¤§æ’åˆ—åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œé‚£ä¹ˆæ•°ç»„çš„ ä¸‹ä¸€ä¸ªæ’åˆ— å°±æ˜¯åœ¨è¿™ä¸ªæœ‰åºå®¹å™¨ä¸­æ’åœ¨å®ƒåé¢çš„é‚£ä¸ªæ’åˆ—ã€‚å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å¿…é¡»é‡æ’ä¸ºå­—å…¸åºæœ€å°çš„æ’åˆ—ï¼ˆå³ï¼Œå…¶å…ƒç´ æŒ‰å‡åºæ’åˆ—ï¼‰ã€‚ //// // ä¾‹å¦‚ï¼Œarr = [1,2,3] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,3,2] ã€‚ // ç±»ä¼¼åœ°ï¼Œarr = [2,3,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [3,1,2] ã€‚ // è€Œ arr = [3,2,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,2,3] ï¼Œå› ä¸º [3,2,1] ä¸å­˜åœ¨ä¸€ä¸ªå­—å…¸åºæ›´å¤§çš„æ’åˆ—ã€‚ // //// ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡º nums çš„ä¸‹ä¸€ä¸ªæ’åˆ—ã€‚ //// å¿…é¡» åŸåœ° ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚ class Solution { public void nextPermutation(int[] nums) { int len = nums.length; int i = len - 2; // ä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‡åºçš„æ•°å­— while (i \u003e= 0 \u0026\u0026 nums[i] \u003e= nums[i + 1]) { i--; } // å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™è¯´æ˜æ˜¯æœ€å°çš„æ’åˆ—ï¼Œéœ€è¦é‡æ’ if (i \u003e= 0) { int j = len - 1; // ä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”iå¤§çš„æ•°å­— while (nums[i] \u003e= nums[j]) { j--; } // äº¤æ¢iå’Œj swap(nums, i, j); } // åè½¬åé¢çš„æ•°å­—:ä»é™åºå˜æˆå‡åº reverse(nums, i + 1); } public void swap(int[] nums, int i, int j) { int temp = nums[i]; nums[i] = nums[j]; nums[j] = temp; } public void reverse(int[] nums, int start) { int len = nums.length; int i = start, j = len - 1; while (i \u003c j) { swap(nums, i++, j--); } } } ","date":"2023-08-08","objectID":"/leetcode/:1:13","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[200]å²›å±¿æ•°é‡.java ç»™ä½ ä¸€ä¸ªç”± â€˜1â€™ï¼ˆé™†åœ°ï¼‰å’Œ â€˜0â€™ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚ å²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚ class Solution { public int numIslands(char[][] grid) { int count = 0; for (int i = 0; i \u003c grid.length; i++) { for (int j = 0; j \u003c grid[i].length; j++) { if (grid[i][j] == '1') { count++; callBFS(grid, i, j); } } } return count; } private void callBFS(char[][] grid, int i, int j) { if (i \u003c 0 || i \u003e= grid.length || j \u003c 0 || j \u003e= grid[i].length || grid[i][j] == '0') { return; } grid[i][j] = '0'; callBFS(grid, i + 1, j); callBFS(grid, i - 1, j); callBFS(grid, i, j + 1); callBFS(grid, i, j - 1); } } ","date":"2023-08-08","objectID":"/leetcode/:1:14","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[695]å²›å±¿çš„æœ€å¤§é¢ç§¯.java //ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º m x n çš„äºŒè¿›åˆ¶çŸ©é˜µ grid ã€‚ //// å²›å±¿ æ˜¯ç”±ä¸€äº›ç›¸é‚»çš„ 1 (ä»£è¡¨åœŸåœ°) æ„æˆçš„ç»„åˆï¼Œè¿™é‡Œçš„ã€Œç›¸é‚»ã€è¦æ±‚ä¸¤ä¸ª 1 å¿…é¡»åœ¨ æ°´å¹³æˆ–è€…ç«–ç›´çš„å››ä¸ªæ–¹å‘ä¸Š ç›¸é‚»ã€‚ä½ å¯ä»¥å‡è®¾ grid çš„å››ä¸ªè¾¹ç¼˜éƒ½//è¢« 0ï¼ˆä»£è¡¨æ°´ï¼‰åŒ…å›´ç€ã€‚ //// å²›å±¿çš„é¢ç§¯æ˜¯å²›ä¸Šå€¼ä¸º 1 çš„å•å…ƒæ ¼çš„æ•°ç›®ã€‚ //// è®¡ç®—å¹¶è¿”å› grid ä¸­æœ€å¤§çš„å²›å±¿é¢ç§¯ã€‚å¦‚æœæ²¡æœ‰å²›å±¿ï¼Œåˆ™è¿”å›é¢ç§¯ä¸º 0 ã€‚ class Solution { boolean visited[][]; public int maxAreaOfIsland(int[][] grid) { int res = 0; int rows = grid.length; int cols = grid[0].length; visited = new boolean[rows][cols]; for (int i = 0; i \u003c rows; i++) { for (int j = 0; j \u003c cols; j++) { res = Math.max(res, area(i, j, grid)); } } return res; } public int area(int row, int column, int[][] grid) { if (row \u003c 0 || row \u003e= grid.length || column \u003c 0 || column \u003e= grid[row].length || visited[row][column] || grid[row][column] == 0) { return 0; } visited[row][column] = true; return 1 + area(row + 1, column, grid) + area(row - 1, column, grid) + area(row, column + 1, grid) + area(row, column - 1, grid); } } ","date":"2023-08-08","objectID":"/leetcode/:1:15","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[79]å•è¯æœç´¢.java //ç»™å®šä¸€ä¸ª m x n äºŒç»´å­—ç¬¦ç½‘æ ¼ board å’Œä¸€ä¸ªå­—ç¬¦ä¸²å•è¯ word ã€‚å¦‚æœ word å­˜åœ¨äºç½‘æ ¼ä¸­ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚ //// å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚ class Solution { boolean[][] visited; public boolean exist(char[][] board, String word) { final int rows = board.length; final int cols = board[0].length; visited = new boolean[rows][cols]; for (int i = 0; i \u003c rows; i++) { for (int j = 0; j \u003c cols; j++) { if (dfs(board, word, 0, i, j)) { return true; } } } return false; } private boolean dfs(char[][] board, String word, int index, int i, int j) { if (index == word.length()) { return true; } if (i \u003c 0 || i \u003e= board.length || j \u003c 0 || j \u003e= board[0].length || visited[i][j] || board[i][j] != word.charAt(index)) { return false; } visited[i][j] = true; boolean res = dfs(board, word, index + 1, i + 1, j) || dfs(board, word, index + 1, i - 1, j) || dfs(board, word, index + 1, i, j + 1) || dfs(board, word, index + 1, i, j - 1); visited[i][j] = false; return res; } } ","date":"2023-08-08","objectID":"/leetcode/:1:16","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"é“¾è¡¨ ","date":"2023-08-08","objectID":"/leetcode/:2:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[21]åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨.java class Solution { // éé€’å½’ public ListNode mergeTwoLists(ListNode l1, ListNode l2) { // ä¼ªå¤´ç»“ç‚¹ ListNode dummyHead = new ListNode(-1); ListNode cur = dummyHead; while (l1 != null \u0026\u0026 l2 != null) { if (l1.val \u003c l2.val) { cur.next = l1; l1 = l1.next; } else { cur.next = l2; l2 = l2.next; } cur = cur.next; } // å‰©ä½™éƒ¨åˆ† cur.next = l1 == null ? l2 : l1; return dummyHead.next; } } ","date":"2023-08-08","objectID":"/leetcode/:2:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"åè½¬é“¾è¡¨ ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚ ä»£ç  class Solution { public ListNode reverseList(ListNode head) { ListNode pre = null, cur = head, next; while (cur != null) { next = cur.next; cur.next = pre; pre = cur; cur = next; } //cur==null é€€å‡ºå¾ªç¯ï¼Œpreæ­¤æ—¶æŒ‡å‘ä¹‹å‰çš„å°¾èŠ‚ç‚¹ï¼Œç°åœ¨çš„å¤´èŠ‚ç‚¹ã€‚ return pre; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:2:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[92]åè½¬é“¾è¡¨ II.java ç»™ä½ å•é“¾è¡¨çš„å¤´æŒ‡é’ˆ head å’Œä¸¤ä¸ªæ•´æ•° left å’Œ right ï¼Œå…¶ä¸­ left \u003c= right ã€‚è¯·ä½ åè½¬ä»ä½ç½® left åˆ°ä½ç½® right çš„é“¾è¡¨èŠ‚ç‚¹ï¼Œè¿”å› åè½¬åçš„é“¾è¡¨ ã€‚ class Solution { public ListNode reverseBetween(ListNode head, int left, int right) { // å› ä¸ºå¤´èŠ‚ç‚¹æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œä½¿ç”¨è™šæ‹Ÿå¤´èŠ‚ç‚¹å¯ä»¥é¿å…å¤æ‚çš„åˆ†ç±»è®¨è®º ListNode dummyNode = new ListNode(-1, head); ListNode pre = dummyNode; // ç¬¬ 1 æ­¥ï¼šä»è™šæ‹Ÿå¤´èŠ‚ç‚¹èµ° left - 1 æ­¥ï¼Œæ¥åˆ° left èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ // å»ºè®®å†™åœ¨ for å¾ªç¯é‡Œï¼Œè¯­ä¹‰æ¸…æ™° for (int i = 0; i \u003c left - 1; i++) { pre = pre.next; } // ç¬¬ 2 æ­¥ï¼šä» pre å†èµ° right - left + 1 æ­¥ï¼Œæ¥åˆ° right èŠ‚ç‚¹ ListNode rightNode = pre; for (int i = 0; i \u003c right - left + 1; i++) { rightNode = rightNode.next; } // ç¬¬ 3 æ­¥ï¼šåˆ‡æ–­å‡ºä¸€ä¸ªå­é“¾è¡¨ï¼ˆæˆªå–é“¾è¡¨ï¼‰ ListNode leftNode = pre.next; ListNode curr = rightNode.next; // æ³¨æ„ï¼šåˆ‡æ–­é“¾æ¥ pre.next = null; rightNode.next = null; // ç¬¬ 4 æ­¥ï¼šåŒç¬¬ 206 é¢˜ï¼Œåè½¬é“¾è¡¨çš„å­åŒºé—´ reverseLinkedList(leftNode); // ç¬¬ 5 æ­¥ï¼šæ¥å›åˆ°åŸæ¥çš„é“¾è¡¨ä¸­ pre.next = rightNode; leftNode.next = curr; return dummyNode.next; } private void reverseLinkedList(ListNode head) { // ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’åè½¬ä¸€ä¸ªé“¾è¡¨ ListNode pre = null; ListNode cur = head; while (cur != null) { ListNode next = cur.next; cur.next = pre; pre = cur; cur = next; } } } ","date":"2023-08-08","objectID":"/leetcode/:2:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[142]ç¯å½¢é“¾è¡¨ II.java ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼Œpos ä»…ä»…æ˜¯ç”¨äºæ ‡è¯†ç¯çš„æƒ…å†µï¼Œå¹¶ä¸ä¼šä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚ è¯´æ˜ï¼šä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚ æ€è·¯ å¦‚å›¾æ‰€ç¤ºï¼Œå…ˆåˆ†æç¬¬ä¸€æ¬¡ç›¸é‡ï¼š slow èµ°è¿‡è·ç¦»ï¼ša+b fast èµ°è¿‡è·ç¦»ï¼ša+b+n(b+c) åˆå› ä¸º fast é€Ÿåº¦æ˜¯ slow çš„ 2 å€ï¼Œå¾—ï¼š2(a+b) = a+b+n(b+c) åŒ–ç®€å¾—ï¼ša=(n-1)(b+c)+c è¿™æ—¶ï¼Œè®© fast æŒ‡é’ˆå›åˆ°èµ·ç‚¹ï¼Œslow æŒ‡é’ˆç•™åœ¨åŸåœ°ï¼Œå®ƒä»¬åŒæ—¶ä»¥ç›¸åŒé€Ÿåº¦è¿åŠ¨ c çš„è·ç¦»ï¼Œæ…¢æŒ‡é’ˆåˆ°è¾¾äº¤ç‚¹å¤„ï¼Œå¿«æŒ‡é’ˆè·ç¦»äº¤ç‚¹è·ç¦»æ˜¯ç¯é•¿çš„æ•´æ•°å€ï¼Œç”±äºæˆ‘ä»¬ä¸çŸ¥é“ c çš„å¤§å°ï¼Œåªèƒ½è®©å¿«æ…¢æŒ‡é’ˆç»§ç»­ä¿æŒç›¸åŒé€Ÿåº¦å‘å‰èµ°ï¼Œç›´åˆ°ç¬¬äºŒæ¬¡ç›¸é‡ï¼Œç›¸é‡ç‚¹å¿…æ˜¯äº¤ç‚¹ã€‚ ä»£ç  public class Solution { public ListNode detectCycle(ListNode head) { ListNode slow = head, fast = head; while (fast != null \u0026\u0026 fast.next != null) { slow = slow.next; fast = fast.next.next; if (slow == fast) { break; } } //æ— ç¯ if (fast == null || fast.next == null) { return null; } fast = head; while (fast != slow) { slow = slow.next; fast = fast.next; } return fast; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:2:4","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[86]åˆ†éš”é“¾è¡¨.java //ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head å’Œä¸€ä¸ªç‰¹å®šå€¼ x ï¼Œè¯·ä½ å¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰ å°äº x çš„èŠ‚ç‚¹éƒ½å‡ºç°åœ¨ å¤§äºæˆ–ç­‰äº x çš„èŠ‚ç‚¹ä¹‹å‰ã€‚ //// ä½ åº”å½“ ä¿ç•™ ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚ //// //// ç¤ºä¾‹ 1ï¼š //// //è¾“å…¥ï¼šhead = [1,4,3,2,5,2], x = 3//è¾“å‡ºï¼š[1,2,2,4,3,5] class Solution { public ListNode partition(ListNode head, int x) { ListNode left = new ListNode(0); ListNode right = new ListNode(0); ListNode l = left; ListNode r = right; while (head != null) { if (head.val \u003c x) { l.next = head; l = l.next; } else { r.next = head; r = r.next; } head = head.next; } l.next = right.next; r.next = null; return left.next; } } ","date":"2023-08-08","objectID":"/leetcode/:2:5","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[148]æ’åºé“¾è¡¨.java ç»™ä½ é“¾è¡¨çš„å¤´ç»“ç‚¹ head ï¼Œè¯·å°†å…¶æŒ‰ å‡åº æ’åˆ—å¹¶è¿”å› æ’åºåçš„é“¾è¡¨ ã€‚ class Solution { public ListNode sortList(ListNode head) { if (head == null || head.next == null) return head; ListNode slow = head, fast = head.next; while (fast != null \u0026\u0026 fast.next != null) { slow = slow.next; fast = fast.next.next; } ListNode right = sortList(slow.next); slow.next = null; ListNode left = sortList(head); return merge(left, right); } private ListNode merge(ListNode l1, ListNode l2) { ListNode dummy = new ListNode(0); ListNode cur = dummy; while (l1 != null \u0026\u0026 l2 != null) { if (l1.val \u003c l2.val) { cur.next = l1; l1 = l1.next; } else { cur.next = l2; l2 = l2.next; } cur = cur.next; } cur.next = l1 == null ? l2 : l1; return dummy.next; } } ","date":"2023-08-08","objectID":"/leetcode/:2:6","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[2]ä¸¤æ•°ç›¸åŠ .java //ç»™ä½ ä¸¤ä¸ª éç©º çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚ //// è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚ //// ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚ //// //// ç¤ºä¾‹ 1ï¼š //// //è¾“å…¥ï¼šl1 = [2,4,3], l2 = [5,6,4]//è¾“å‡ºï¼š[7,0,8]//è§£é‡Šï¼š342 + 465 = 807. class Solution { public ListNode addTwoNumbers(ListNode l1, ListNode l2) { ListNode dummyHead = new ListNode(0); ListNode cur = dummyHead; int carry = 0; while (l1 != null || l2 != null) { int x = l1 == null ? 0 : l1.val; int y = l2 == null ? 0 : l2.val; int sum = x + y + carry; carry = sum / 10; cur.next = new ListNode(sum % 10); cur = cur.next; if (l1 != null) l1 = l1.next; if (l2 != null) l2 = l2.next; } if (carry \u003e 0) { cur.next = new ListNode(carry); } return dummyHead.next; } } ","date":"2023-08-08","objectID":"/leetcode/:2:7","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[143]é‡æ’é“¾è¡¨.java //ç»™å®šä¸€ä¸ªå•é“¾è¡¨ L çš„å¤´èŠ‚ç‚¹ head ï¼Œå•é“¾è¡¨ L è¡¨ç¤ºä¸ºï¼š //// //L0 â†’ L1 â†’ â€¦ â†’ Ln - 1 â†’ Ln// //// è¯·å°†å…¶é‡æ–°æ’åˆ—åå˜ä¸ºï¼š //// //L0 â†’ Ln â†’ L1 â†’ Ln - 1 â†’ L2 â†’ Ln - 2 â†’ â€¦ //// ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚ class Solution { public void reorderList(ListNode head) { if (head == null || head.next == null) { return; } ListNode l1 = head; ListNode slow = head, fast = head, prev = null; while (fast != null \u0026\u0026 fast.next != null) { prev = slow; slow = slow.next; fast = fast.next.next; } prev.next = null; ListNode l2 = slow; l2 = reverse(l2); l1 = merge(l1, l2); } private ListNode reverse(ListNode head) { ListNode prev = null; ListNode curNode = head; while (curNode != null) { ListNode nextNode = curNode.next; curNode.next = prev; prev = curNode; curNode = nextNode; } return prev; } private ListNode merge(ListNode l1, ListNode l2) { ListNode dummyHead = new ListNode(-1); ListNode curNode = dummyHead; while (l1 != null \u0026\u0026 l2 != null) { curNode.next = l1; curNode = curNode.next; l1 = l1.next; curNode.next = l2; curNode = curNode.next; l2 = l2.next; } curNode.next = l1 == null ? l2 : l1; return dummyHead.next; } } ","date":"2023-08-08","objectID":"/leetcode/:2:8","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"äºŒå‰æ ‘ å¿«é€Ÿæ’åºå°±æ˜¯ä¸ªäºŒå‰æ ‘çš„å‰åºéå†ï¼Œå½’å¹¶æ’åºå°±æ˜¯ä¸ªäºŒå‰æ ‘çš„ååºéå†ã€‚ ","date":"2023-08-08","objectID":"/leetcode/:3:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"é€’å½’æ¡†æ¶ /* äºŒå‰æ ‘éå†æ¡†æ¶ */ void traverse(TreeNode root) { // å‰åºéå† traverse(root.left) // ä¸­åºéå† traverse(root.right) // ååºéå† } ","date":"2023-08-08","objectID":"/leetcode/:3:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"å¿«é€Ÿæ’åº void sort(int[] nums, int lo, int hi) { /****** å‰åºéå†ä½ç½® ******/ // é€šè¿‡äº¤æ¢å…ƒç´ æ„å»ºåˆ†ç•Œç‚¹ p int p = partition(nums, lo, hi); /************************/ sort(nums, lo, p - 1); sort(nums, p + 1, hi); } ","date":"2023-08-08","objectID":"/leetcode/:3:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"å½’å¹¶æ’åº void sort(int[] nums, int lo, int hi) { int mid = (lo + hi) / 2; sort(nums, lo, mid); sort(nums, mid + 1, hi); /****** ååºéå†ä½ç½® ******/ // åˆå¹¶ä¸¤ä¸ªæ’å¥½åºçš„å­æ•°ç»„ merge(nums, lo, mid, hi); /************************/ } å¯ä»¥è¯´ï¼Œåªè¦æ¶‰åŠé€’å½’ï¼Œéƒ½å¯ä»¥æŠ½è±¡æˆäºŒå‰æ ‘çš„é—®é¢˜ã€‚ ","date":"2023-08-08","objectID":"/leetcode/:3:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"ä¸­åºéå†äºŒå‰æ ‘ class Solution { public List\u003cInteger\u003e inorderTraversal(TreeNode root) { List\u003cInteger\u003e res = new LinkedList\u003c\u003e(); Deque\u003cTreeNode\u003e stack = new LinkedList\u003c\u003e(); for (TreeNode cur = root; cur != null || !stack.isEmpty(); cur = cur.right) { // ä¸€ç›´ä¸‹åˆ°æœ€å·¦ while (cur != null) { stack.push(cur); cur = cur.left; } cur = stack.pop();// æ¯æ¬¡å‡ºæ ˆçš„å°±æ˜¯ä¸­åºéå†é¡ºåºçš„èŠ‚ç‚¹ï¼Œç„¶ååœ¨ä»¥ä¸‹è¿›è¡Œå¯¹åº”æ“ä½œ res.add(cur.val); // æœ€åå‘å³ä¸€æ­¥ } return res; } } ","date":"2023-08-08","objectID":"/leetcode/:3:4","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[105]ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘.java class Solution { public TreeNode buildTree(int[] preorder, int[] inorder) { HashMap\u003cInteger, Integer\u003e map = new HashMap\u003c\u003e(); for (int i = 0; i \u003c inorder.length; i++) { map.put(inorder[i], i); } return buildTreeHelper(preorder, 0, preorder.length, inorder, 0, inorder.length, map); } /** * æŒ‡é’ˆå·¦é—­å³å¼€ * * @param preorder * @param p_start * @param p_end * @param inorder * @param i_start * @param i_end * @param map * @return */ private TreeNode buildTreeHelper(int[] preorder, int p_start, int p_end, int[] inorder, int i_start, int i_end, HashMap\u003cInteger, Integer\u003e map) { if (p_start == p_end) { return null; } int root_val = preorder[p_start]; TreeNode root = new TreeNode(root_val); int i_root_index = map.get(root_val); int leftNum = i_root_index - i_start; // preorder åˆ†ä¸º [p_start + 1,p_start + leftNum + 1) å’Œ [p_start + leftNum + 1, p_end]ï¼Œå‰åºæ ¹ç»“ç‚¹åœ¨å·¦è¾¹ // inorder åˆ†ä¸º [i_start,i_root_index) å’Œ [i_root_index + 1,i_end)ï¼Œå°‘ä¸€ä¸ªæ ¹ç»“ç‚¹ root.left = buildTreeHelper(preorder, p_start + 1, p_start + leftNum + 1, inorder, i_start, i_root_index, map); root.right = buildTreeHelper(preorder, p_start + 1 + leftNum, p_end, inorder, i_root_index + 1, i_end, map); return root; } ","date":"2023-08-08","objectID":"/leetcode/:3:5","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[114]äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨.java ç»™ä½ äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ root ï¼Œè¯·ä½ å°†å®ƒå±•å¼€ä¸ºä¸€ä¸ªå•é“¾è¡¨ï¼š å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥åŒæ ·ä½¿ç”¨ TreeNode ï¼Œå…¶ä¸­ right å­æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œå·¦å­æŒ‡é’ˆå§‹ç»ˆä¸º null ã€‚ å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥ä¸äºŒå‰æ ‘ å…ˆåºéå† é¡ºåºç›¸åŒã€‚ æ€è·¯ æŠŠæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘æ’å…¥åˆ°è¯¥èŠ‚ç‚¹ä¸å³å­æ ‘ä¹‹é—´ï¼› åº”ç”¨ååºé€’å½’æ¡†æ¶ï¼ˆå·¦ã€å³ã€æ ¹ï¼‰ã€‚ ä»£ç  class Solution { public void flatten(TreeNode root) { // 1. å¶å­èŠ‚ç‚¹ if (root == null) return; // 2. é€’å½’ flatten TreeNode left = root.left; TreeNode right = root.right; flatten(left); flatten(right); // 3. æ‹¼å·¦ root.left = null; root.right = left; // 4. æ‹¼å³ TreeNode p = root; while (p.right != null) { p = p.right; } p.right = right; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:3:6","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[116]å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ.java ç»™å®šä¸€ä¸ª å®Œç¾äºŒå‰æ ‘ ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚ æ€è·¯ æŠŠæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘æŒ‡å‘å³å­æ ‘ï¼› å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå·¦å­æ ‘çš„å³å­æ ‘ä¹Ÿè¦æŒ‡å‘å³å­æ ‘çš„å·¦å­æ ‘ï¼› åº”ç”¨å‰åºé€’å½’æ¡†æ¶ï¼ˆæ ¹ã€å·¦ã€å³ï¼‰ã€‚ ä»£ç  class Solution { public Node connect(Node root) { if (root == null) { return null; } connect(root.left, root.right); return root; } private void connect(Node left, Node right) { if (left == null || right == null) { return; } left.next = right; // å››ä¸ªç‚¹ï¼Œä¸‰ä¸ªæŒ‡å‘ connect(left.left, left.right); connect(left.right, right.left); connect(right.left, right.right); } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:3:7","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[701]äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ.java ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œè¦æ’å…¥æ ‘ä¸­çš„å€¼ï¼Œå°†å€¼æ’å…¥äºŒå‰æœç´¢æ ‘ã€‚ è¿”å›æ’å…¥åäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ è¾“å…¥æ•°æ® ä¿è¯ ï¼Œæ–°å€¼å’ŒåŸå§‹äºŒå‰æœç´¢æ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹å€¼éƒ½ä¸åŒ æ€è·¯ è¿™é¢˜çš„å…³é”®åœ¨äºé‡ç½® æœç´¢è·¯å¾„ ä¸ŠèŠ‚ç‚¹çš„å·¦æˆ–å³å­æ ‘ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™é€’å½’ï¼›å¦‚æœä¸ºç©ºï¼Œç›´æ¥ new ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œå®ƒæ˜¯ä¼šè¢«ä¸Šä¸€æ¬¡é€’å½’æ‰€æŒ‡å‘çš„ã€‚ ä»£ç  class Solution { public TreeNode insertIntoBST(TreeNode root, int val) { if (root == null) { return new TreeNode(val); } if (val \u003e root.val) { root.right = insertIntoBST(root.right, val); } else { root.left = insertIntoBST(root.left, val); } return root; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡æƒ…å†µ O(logn)ï¼Œæœ€åæƒ…å†µ O(n) ç©ºé—´å¤æ‚åº¦ï¼šå¹³å‡æƒ…å†µ O(logn)ï¼Œæœ€åæƒ…å†µ O(n) ","date":"2023-08-08","objectID":"/leetcode/:3:8","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[450]åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹.java ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ æ€è·¯ é¦–å…ˆï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤è¿™ä¸¤æ­¥ä¸èƒ½åˆ†å¼€ï¼Œå› ä¸ºåˆ é™¤è¿˜éœ€è¦ç”¨åˆ°åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚ æ‰¾åˆ°å…ƒç´ åï¼Œå¦‚æœåˆ é™¤èŠ‚ç‚¹å·¦å³å­æ ‘æœ‰ç©ºç€çš„ï¼Œåªéœ€è¦æŠŠå¦ä¸€æ£µå­æ ‘ç§»åˆ°å½“å‰ä½ç½®å³å¯ï¼Œç›´æ¥è¿”å›ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œå®ƒæ˜¯ä¼šè¢«ä¸Šä¸€æ¬¡é€’å½’æ‰€æŒ‡å‘çš„ã€‚ æœ€å¤æ‚çš„æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹å·¦å³å­æ ‘éƒ½ä¸ä¸ºç©ºçš„æƒ…å†µï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼šæ‰¾åˆ°è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹ï¼Œå®ƒçš„ä½ç½®åœ¨å…¶å³å­æ ‘çš„æœ€å·¦å¶å­èŠ‚ç‚¹ï¼Œè®¾ä¸º p èŠ‚ç‚¹ï¼Œç”¨ p èŠ‚ç‚¹çš„å€¼è¦†ç›–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å€¼ï¼Œè¿™æ—¶ p èŠ‚ç‚¹çš„å€¼å‡ºç°äº† 2 æ¬¡ï¼Œç„¶åè½¬è€Œå»å³å­æ ‘åˆ é™¤ p èŠ‚ç‚¹çš„å€¼ã€‚ ä»£ç  class Solution { public TreeNode deleteNode(TreeNode root, int key) { if (root == null) { return null; } else if (root.val == key) { if (root.left == null || root.right == null) { return root.left == null ? root.right : root.left; } else { // æŠŠå³å­æ ‘æœ€å·¦ç»“ç‚¹ç§»åˆ°å½“å‰ä½ç½® TreeNode p = root.right; while (p.left != null) { p = p.left; } // æŠŠè¦åˆ é™¤çš„å€¼å…ˆè¦†ç›–ï¼Œæ­¤æ—¶è¿™ä¸ªå€¼å‡ºç° 2 æ¬¡ï¼Œ å»å³å­æ ‘åˆ é™¤å¤šä½™çš„èŠ‚ç‚¹ root.val = p.val; root.right = deleteNode(root.right, p.val); } } else if (root.val \u003c key) { root.right = deleteNode(root.right, key); } else if (root.val \u003e key) { root.left = deleteNode(root.left, key); } return root; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:3:9","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[102]äºŒå‰æ ‘çš„å±‚åºéå†.java ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›å…¶æŒ‰ å±‚åºéå† å¾—åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚ æ€è·¯ æ„å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆå§‹åŒ–æ—¶å°†æ ¹ç»“ç‚¹å…¥é˜Ÿï¼› æ¯ä¸ªèŠ‚ç‚¹å‡ºé˜Ÿæ—¶ï¼Œå°†å®ƒçš„å­èŠ‚ç‚¹æŒ‰å…ˆå·¦åå³çš„é¡ºåºå…¥é˜Ÿï¼› åªè¦é˜Ÿåˆ—éç©ºå°±é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚ ä»£ç  class Solution { public List\u003cList\u003cInteger\u003e\u003e levelOrder(TreeNode root) { List\u003cList\u003cInteger\u003e\u003e res = new LinkedList\u003c\u003e(); if (root == null) { return res; } Queue\u003cTreeNode\u003e q = new LinkedList\u003c\u003e(); // æ ¸å¿ƒæ•°æ®ç»“æ„ q.offer(root); // å°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ— while (!q.isEmpty()) { int size = q.size(); List\u003cInteger\u003e row = new LinkedList\u003c\u003e(); for (int i = 0; i \u003c size; i++) { TreeNode cur = q.poll(); row.add(cur.val); if (cur.left != null) { q.offer(cur.left); } if (cur.right != null) { q.offer(cur.right); } } res.add(row); } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:3:10","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[752]æ‰“å¼€è½¬ç›˜é”.java ä½ æœ‰ä¸€ä¸ªå¸¦æœ‰å››ä¸ªåœ†å½¢æ‹¨è½®çš„è½¬ç›˜é”ã€‚æ¯ä¸ªæ‹¨è½®éƒ½æœ‰10ä¸ªæ•°å­—ï¼š â€˜0â€™, â€˜1â€™, â€˜2â€™, â€˜3â€™, â€˜4â€™, â€˜5â€™, â€˜6â€™, â€˜7â€™, â€˜8â€™, â€˜9â€™ã€‚æ¯ä¸ªæ‹¨è½®å¯ä»¥è‡ªç”±æ—‹è½¬ï¼šä¾‹å¦‚æŠŠ â€˜9â€™ å˜ä¸º â€˜0â€™ï¼Œâ€˜0â€™ å˜ä¸º â€˜9â€™ ã€‚æ¯æ¬¡æ—‹è½¬éƒ½åªèƒ½æ—‹è½¬ä¸€ä¸ªæ‹¨è½®çš„ä¸€ä½æ•°å­—ã€‚ é”çš„åˆå§‹æ•°å­—ä¸º â€˜0000â€™ ï¼Œä¸€ä¸ªä»£è¡¨å››ä¸ªæ‹¨è½®çš„æ•°å­—çš„å­—ç¬¦ä¸²ã€‚ åˆ—è¡¨ deadends åŒ…å«äº†ä¸€ç»„æ­»äº¡æ•°å­—ï¼Œä¸€æ—¦æ‹¨è½®çš„æ•°å­—å’Œåˆ—è¡¨é‡Œçš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œè¿™ä¸ªé”å°†ä¼šè¢«æ°¸ä¹…é”å®šï¼Œæ— æ³•å†è¢«æ—‹è½¬ã€‚ å­—ç¬¦ä¸² target ä»£è¡¨å¯ä»¥è§£é”çš„æ•°å­—ï¼Œä½ éœ€è¦ç»™å‡ºè§£é”éœ€è¦çš„æœ€å°æ—‹è½¬æ¬¡æ•°ï¼Œå¦‚æœæ— è®ºå¦‚ä½•ä¸èƒ½è§£é”ï¼Œè¿”å› -1 ã€‚ æ€è·¯ è¿ç”¨ BFS æ¡†æ¶ï¼Œæ„å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯å½“ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºé˜Ÿï¼Œå°±å°†æ”¹å˜ 4 ä¸ªå¯†ç ä½çš„ 8 ç§æƒ…å†µå…¥é˜Ÿï¼Œæ¯åˆ¤æ–­ä¸€å±‚ï¼Œè®¡æ•°è‡ªå¢ï¼Œå½“å‡ºé˜Ÿå€¼ç­‰äºç›®æ ‡å€¼æ—¶è¿”å›è®¡æ•°ï¼Œå¦åˆ™æœ€ç»ˆè¿”å› -1ï¼› é’ˆå¯¹å­—ç¬¦ä¸²ä¸­çš„æŸä¸€ä½æ“ä½œï¼Œå¯ä»¥æŠ½ä¸€ä¸ªæ–¹æ³•å‡ºæ¥ï¼› é¢˜ç›®è¿˜ç»™äº†ä¸€ç»„æ­»äº¡æ•°å­—ï¼Œå½“å‡ºé˜Ÿå­—ç¬¦ä¸²åŒ…å«å…¶ä¸­æ—¶ï¼Œå°±è·³è¿‡ï¼Œè¯´æ˜èµ°åˆ°äº†æ­»èƒ¡åŒï¼› å½“å‡ºé˜Ÿçš„å­—ç¬¦ä¸²ä¸æ˜¯æœ€ç»ˆç›®æ ‡æ—¶ï¼Œå°±æŠŠå®ƒåŠ å…¥æ­»äº¡æ•°å­—ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢é‡å¤è®¿é—®ï¼Œèµ°å…¥æ­»å¾ªç¯ã€‚ ä»£ç  class Solution { public int openLock(String[] deadends, String target) { Queue\u003cString\u003e q = new LinkedList\u003c\u003e(); Set\u003cString\u003e set = new HashSet\u003c\u003e(); for (String deadend : deadends) { set.add(deadend); } q.offer(\"0000\"); int count = 0; while (!q.isEmpty()) { int size = q.size(); for (int i = 0; i \u003c size; i++) { String cur = q.poll(); if (cur.equals(target)) { return count; } if (set.contains(cur)) { continue; } set.add(cur); for (int j = 0; j \u003c 4; j++) { q.offer(operateOne(cur, j, 1)); q.offer(operateOne(cur, j, -1)); } } count++; } return -1; } /** * æ”¹å˜å­—ç¬¦ä¸²ä¸­çš„æŸä¸€ä½ * * @param s å­—ç¬¦ä¸² * @param index å“ªä¸€ä½ * @param change æ”¹å˜å¤šå°‘ ï¼ˆå¯¹äºè½¬ç›˜é”åªèƒ½ä¼ å…¥ +1 æˆ– -1ï¼‰ * @return */ private String operateOne(String s, int index, int change) { char[] ch = s.toCharArray(); if (ch[index] == '9' \u0026\u0026 change == 1) { ch[index] = '0'; } else if (ch[index] == '0' \u0026\u0026 change == -1) { ch[index] = '9'; } else { ch[index] += change; } return new String(ch); } } å¤æ‚åº¦ å› ä¸ºæ•°å­—çš„è¿›åˆ¶ã€è½¬ç›˜çš„ä½æ•°éƒ½æ˜¯å¸¸æ•°ï¼Œ æ—¶é—´å¤æ‚åº¦ï¼šO(deadends.length) ç©ºé—´å¤æ‚åº¦ï¼šO(deadends.length) ","date":"2023-08-08","objectID":"/leetcode/:3:11","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[662]äºŒå‰æ ‘æœ€å¤§å®½åº¦.java //ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è·å–è¿™ä¸ªæ ‘çš„æœ€å¤§å®½åº¦ã€‚æ ‘çš„å®½åº¦æ˜¯æ‰€æœ‰å±‚ä¸­çš„æœ€å¤§å®½åº¦ã€‚è¿™ä¸ªäºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘ï¼ˆfull binary treeï¼‰ç»“æ„ç›¸åŒï¼Œä½†ä¸€äº›èŠ‚ç‚¹ä¸ºç©ºã€‚ //// æ¯ä¸€å±‚çš„å®½åº¦è¢«å®šä¹‰ä¸ºä¸¤ä¸ªç«¯ç‚¹ï¼ˆè¯¥å±‚æœ€å·¦å’Œæœ€å³çš„éç©ºèŠ‚ç‚¹ï¼Œä¸¤ç«¯ç‚¹é—´çš„nullèŠ‚ç‚¹ä¹Ÿè®¡å…¥é•¿åº¦ï¼‰ä¹‹é—´çš„é•¿åº¦ã€‚ //// ç¤ºä¾‹ 1: //// //è¾“å…¥: //// 1// / // 3 2// / \\ // 5 3 9 ////è¾“å‡º: 4//è§£é‡Š: æœ€å¤§å€¼å‡ºç°åœ¨æ ‘çš„ç¬¬ 3 å±‚ï¼Œå®½åº¦ä¸º 4 (5,3,null,9)ã€‚ class Solution { int maxWidth; Map\u003cInteger, Integer\u003e leftmostPositions; public int widthOfBinaryTree(TreeNode root) { maxWidth = 0; leftmostPositions = new HashMap\u003c\u003e(); getWidth(root, 0, 0); return maxWidth; } private void getWidth(TreeNode node, int depth, int position) { if (node == null) return; // ä¸å­˜åœ¨è¯¥å±‚ï¼Œåˆ™åˆå§‹åŒ– leftmostPositions.computeIfAbsent(depth, key -\u003e position); maxWidth = Math.max(maxWidth, position - leftmostPositions.get(depth) + 1); // å½“å‰èŠ‚ç‚¹çš„å·¦å³è¾¹ç•Œ getWidth(node.left, depth + 1, position * 2); getWidth(node.right, depth + 1, position * 2 + 1); } } ","date":"2023-08-08","objectID":"/leetcode/:3:12","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[199]äºŒå‰æ ‘çš„å³è§†å›¾.java ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ class Solution { public List\u003cInteger\u003e rightSideView(TreeNode root) { List\u003cInteger\u003e result = new LinkedList\u003c\u003e(); if (root == null) return result; Queue\u003cTreeNode\u003e queue = new LinkedList\u003c\u003e(); queue.offer(root); while (!queue.isEmpty()) { int size = queue.size(); for (int i = 0; i \u003c size; i++) { TreeNode currentNode = queue.poll(); if (i == 0) result.add(currentNode.val); // å…¥é˜Ÿï¼šå…ˆå³åå·¦ï¼›å¦åˆ™å°±å– i == size -1 ä¹Ÿå¯ä»¥ if (currentNode.right != null) queue.offer(currentNode.right); if (currentNode.left != null) queue.offer(currentNode.left); } } return result; } } ","date":"2023-08-08","objectID":"/leetcode/:3:13","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[236]äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ.java class Solution { public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { if (root == null || root == p || root == q) { return root; } TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); if (left == null) { return right; } if (right == null) { return left; } return root; } } ","date":"2023-08-08","objectID":"/leetcode/:3:14","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æ»‘åŠ¨çª—å£ ","date":"2023-08-08","objectID":"/leetcode/:4:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æ¨¡ç‰ˆ /* æ»‘åŠ¨çª—å£ç®—æ³•æ¡†æ¶ */ void slidingWindow(String s, String t) { Map\u003cCharacter, Integer\u003e need = new HashMap\u003c\u003e(); Map\u003cCharacter, Integer\u003e window = new HashMap\u003c\u003e(); for (int i = 0; i \u003c t.length(); i++) { char c = t.charAt(i); need.put(c, need.getOrDefault(c, 0) + 1); } int left = 0, right = 0; int valid = 0; while (right \u003c s.length()) { // c æ˜¯å°†ç§»å…¥çª—å£çš„å­—ç¬¦ char c = s.charAt(right++); // todo è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° // todo åˆ¤æ–­å·¦ä¾§çª—å£æ˜¯å¦è¦æ”¶ç¼© while (window need shrink) { // d æ˜¯å°†ç§»å‡ºçª—å£çš„å­—ç¬¦ char d = s.charAt(left++); // todo è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° } } } rightï¼šå¯»æ‰¾å¯è¡Œè§£ leftï¼šè¯•æ¢æœ€ä¼˜è§£ ","date":"2023-08-08","objectID":"/leetcode/:4:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[3]æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸².java ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ æ€è·¯ rightï¼šå¯»æ‰¾å¯è¡Œè§£ï¼šåªè¦æ— é‡å¤å­—ç¬¦å°±å‰è¿›ï¼Œä¸€æ—¦å‡ºç°é‡å¤å­—ç¬¦å°±åœæ­¢ï¼Œè®°å½•åæ ‡ leftï¼šè¯•æ¢æœ€ä¼˜è§£ï¼šå‡ºç°é‡å¤å­—ç¬¦æ—¶å‰è¿›ï¼Œç›´åˆ°é‡å¤å­—ç¬¦æ¶ˆå¤± ä»£ç  class Solution { public int lengthOfLongestSubstring(String s) { if (s.length() == 0) { return 0; } Map\u003cCharacter, Integer\u003e map = new HashMap\u003c\u003e(); int left = 0, right = 0; int res = 1; while (right \u003c s.length()) { // c æ˜¯å°†ç§»å…¥çª—å£çš„å­—ç¬¦ï¼Œå³ç§»çª—å£ char c = s.charAt(right++); // è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° map.put(c, map.getOrDefault(c, 0) + 1); // åˆ¤æ–­å·¦ä¾§çª—å£æ˜¯å¦è¦æ”¶ç¼© while (map.get(c) \u003e 1) { // d æ˜¯å°†ç§»å‡ºçª—å£çš„å­—ç¬¦ï¼Œå·¦ç§»çª—å£ char d = s.charAt(left++); // è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° map.put(d, map.get(d) - 1); } res = Math.max(res, right - left); } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:4:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[438]æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯.java ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ pï¼Œæ‰¾åˆ° s ä¸­æ‰€æœ‰ p çš„ å¼‚ä½è¯ çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚ å¼‚ä½è¯ æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚ æ€è·¯ å½“çª—å£å¤§å°ç­‰äº p çš„é•¿åº¦æ—¶ï¼Œå·¦å³æŒ‡é’ˆåŒæ—¶å‰è¿›ï¼Œå¯»æ‰¾å¯è¡Œè§£ã€‚ ä»£ç  class Solution { public List\u003cInteger\u003e findAnagrams(String s, String p) { List\u003cInteger\u003e res = new ArrayList\u003c\u003e(); Map\u003cCharacter, Integer\u003e need = new HashMap\u003c\u003e(); Map\u003cCharacter, Integer\u003e window = new HashMap\u003c\u003e(); for (int i = 0; i \u003c p.length(); i++) { char c = p.charAt(i); need.put(c, need.getOrDefault(c, 0) + 1); } int left = 0, right = 0; int valid = 0; while (right \u003c s.length()) { // c æ˜¯å°†ç§»å…¥çª—å£çš„å­—ç¬¦ char c = s.charAt(right++); // è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° if (need.containsKey(c)) { window.put(c, window.getOrDefault(c, 0) + 1); if (window.get(c).equals(need.get(c))) { valid++; } } // åˆ¤æ–­å·¦ä¾§çª—å£æ˜¯å¦è¦æ”¶ç¼© if (right - left == p.length()) { if (valid == need.size()) { res.add(left); } // d æ˜¯å°†ç§»å‡ºçª—å£çš„å­—ç¬¦ char d = s.charAt(left++); // è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–° if (need.containsKey(d)) { if (window.get(d).equals(need.get(d))) { valid--; } window.put(d, window.get(d) - 1); } } } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:4:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"å›æº¯ ","date":"2023-08-08","objectID":"/leetcode/:5:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[46]å…¨æ’åˆ—.java ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚ æ€è·¯ å®šä¹‰ç»“æœé›†ä¸ºå…¨å±€å˜é‡ï¼› æ ¸å¿ƒæ˜¯å†™å‡ºå›æº¯å‡½æ•°ï¼Œæ˜ç¡®å¢æ·»ç»“æœã€é€€å‡ºé€’å½’çš„æ—¶æœºï¼Œå‘æ¯ä¸€ç§å¯èƒ½çš„æƒ…å†µè¿ˆå‡ºä¸€å°æ­¥ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å›æº¯ï¼Œåœ¨æœ€åè¿˜è¦å½’ä½ï¼› æ­£ç¡®çš„ç»“æœé›†ï¼šè·¯å¾„é•¿åº¦è¾¾åˆ°æ•°å­—é•¿åº¦ï¼› ç­›é€‰æ¡ä»¶ï¼šæ•°å­—åœ¨è·¯å¾„ä¸­æ²¡æœ‰å‡ºç°è¿‡ï¼› å¯¹ç®—æ³•è¿›è¡Œé€‚å½“çš„å‰ªæï¼Œæé«˜æ—¶é—´æ•ˆç‡ã€‚ ä»£ç  class Solution { // ç»“æœé›† private List\u003cList\u003cInteger\u003e\u003e res = new ArrayList\u003c\u003e(); public List\u003cList\u003cInteger\u003e\u003e permute(int[] nums) { // addã€remove ä¸ä¼šå½±å“new ArrayList çš„æµ…æ‹·è´ backTrack(nums, new LinkedList\u003c\u003e()); return res; } private void backTrack(int[] nums, LinkedList\u003cInteger\u003e path) { // å¢æ·»ç»“æœã€é€€å‡ºé€’å½’ if (path.size() == nums.length) { res.add(new ArrayList\u003c\u003e(path)); return; } for (int i = 0; i \u003c nums.length; i++) { // ç­›é€‰ if (path.contains(nums[i])) { continue; } // è¯•æ¢æ­¥ path.addLast(nums[i]); // å›æº¯ backTrack(nums, path); // å½’ä½ path.removeLast(); } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n*n!) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:5:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[51]N çš‡å.java n çš‡åé—®é¢˜ ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚ ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜ çš„è§£å†³æ–¹æ¡ˆã€‚ æ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªä¸åŒçš„ n çš‡åé—®é¢˜ çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ â€˜Qâ€™ å’Œ â€˜.â€™ åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚ æ€è·¯ å®šä¹‰ç»“æœé›†ä¸ºå…¨å±€å˜é‡ï¼› æ ¸å¿ƒæ˜¯å†™å‡ºå›æº¯å‡½æ•°ï¼Œæ˜ç¡®å¢æ·»ç»“æœã€é€€å‡ºé€’å½’çš„æ—¶æœºï¼Œå‘æ¯ä¸€ç§é€šè¿‡ç­›é€‰çš„æƒ…å†µè¿ˆå‡ºä¸€å°æ­¥ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å›æº¯ï¼Œåœ¨æœ€åè¿˜è¦å½’ä½ï¼› æ­£ç¡®çš„ç»“æœé›†ï¼šç¬¬ 8 è¡Œçš‡åç¬¦åˆè¦æ±‚ï¼› ç­›é€‰æ¡ä»¶ï¼šä»»æ„ä¸¤çš‡åä¸åœ¨åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ï¼› å¯¹ç®—æ³•è¿›è¡Œé€‚å½“çš„å‰ªæï¼Œæé«˜æ—¶é—´æ•ˆç‡ã€‚ ä»£ç  class Solution { // ç»“æœé›† private List\u003cList\u003cString\u003e\u003e res = new ArrayList\u003c\u003e(); public List\u003cList\u003cString\u003e\u003e solveNQueens(int n) { // åˆå§‹åŒ–æ£‹ç›˜ char[][] board = new char[n][n]; for (char[] line : board) { Arrays.fill(line, '.'); } backTrack(board, 0); return res; } private void backTrack(char[][] board, int row) { // å¢æ·»ç»“æœã€é€€å‡ºé€’å½’ if (row == board.length) { List\u003cString\u003e list = new ArrayList\u003c\u003e(); for (char[] c : board) { list.add(String.copyValueOf(c)); } res.add(list); return; } for (int col = 0; col \u003c board[row].length; col++) { // ç­›é€‰ if (!isValid(board, row, col)) { continue; } // è¯•æ¢æ­¥ board[row][col] = 'Q'; // å›æº¯ backTrack(board, row + 1); // å½’ä½ board[row][col] = '.'; } } private boolean isValid(char[][] board, int row, int col) { int n = board.length; // æ£€æŸ¥åˆ—æ˜¯å¦æœ‰çš‡åå†²çª for (int i = 0; i \u003c n; i++) { if (board[i][col] == 'Q') { return false; } } // æ£€æŸ¥å³ä¸Šæ–¹æ˜¯å¦æœ‰çš‡åå†²çª for (int i = row - 1, j = col + 1; i \u003e= 0 \u0026\u0026 j \u003c n; i--, j++) { if (board[i][j] == 'Q') { return false; } } // æ£€æŸ¥å·¦ä¸Šæ–¹æ˜¯å¦æœ‰çš‡åå†²çª for (int i = row - 1, j = col - 1; i \u003e= 0 \u0026\u0026 j \u003e= 0; i--, j--) { if (board[i][j] == 'Q') { return false; } } return true; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n!) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:5:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[22]æ‹¬å·ç”Ÿæˆ.java æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚ æœ‰æ•ˆæ‹¬å·ç»„åˆéœ€æ»¡è¶³ï¼šå·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚ æ€è·¯ ä»¥å·¦å³æ‹¬å·å‰©ä½™æ•°ä¸ºç­›é€‰ã€åˆ¤æ–­çš„æ ‡å‡†ï¼› æ­£ç¡®çš„ç»“æœé›†ï¼šå·¦å³æ‹¬å·å‰©ä½™æ•°éƒ½ä¸º 0ï¼› ç­›é€‰æ¡ä»¶ï¼šå·¦å³æ‹¬å·å‰©ä½™æ•°éƒ½ä¸ºéè´Ÿæ•°ï¼Œä¸”å³æ‹¬å·å‰©ä½™æ•°ä¸å°äºå·¦æ‹¬å·å‰©ä½™æ•°ï¼› ä»£ç  class Solution { // ç»“æœé›† List\u003cString\u003e res = new LinkedList\u003c\u003e(); public List\u003cString\u003e generateParenthesis(int n) { String curStr = \"\"; // ç»“æœæ¼”è¿›çš„èµ·ç‚¹æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œå·¦å³å„æœ‰nä¸ªæ‹¬å· backtrack(curStr, n, n); return res; } /** * å›æº¯æ³• * * @param str è·¯å¾„ * @param left å·¦æ‹¬å·å‰©ä½™æ•° * @param right å³æ‹¬å·å‰©ä½™æ•° */ private void backtrack(String str, int left, int right) { //è¾¹ç•Œæ¡ä»¶ base case if (left == 0 \u0026\u0026 right == 0) { res.add(str); return; } //å‡æï¼šå·¦æ‹¬å·æ•°å¿…é¡»å¤§äºç­‰äºå³æ‹¬å· if (left \u003c 0 || right \u003c 0 || left \u003e right) { return; } if (left \u003e 0) { backtrack(str + \"(\", left - 1, right); } if (right \u003e 0) { backtrack(str + \")\", left, right - 1); } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼š O(C_{2n}^n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:5:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"039 ç»„åˆæ€»å’Œ ç»™å®šä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚ candidates ä¸­çš„æ•°å­—å¯ä»¥æ— é™åˆ¶é‡å¤è¢«é€‰å–ã€‚ ä»£ç  class Solution { // ç»“æœé›† List\u003cList\u003cInteger\u003e\u003e res = new ArrayList\u003c\u003e(); public List\u003cList\u003cInteger\u003e\u003e combinationSum(int[] candidates, int target) { if (candidates == null || candidates.length == 0) { return res; } Arrays.sort(candidates); backTrack(new ArrayList\u003c\u003e(), 0, 0, candidates, target); return res; } private void backTrack(List\u003cInteger\u003e path, int sum, int idx, int[] candidates, int target) { // base case if (sum == target) { res.add(new ArrayList\u003c\u003e(path)); return; } for (int i = idx; i \u003c candidates.length; i++) { // å‡æ if (sum + candidates[i] \u003e target) { break; } path.add(candidates[i]); backTrack(path, sum + candidates[i], i, candidates, target); path.remove(path.size() - 1); } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n*2^n)å®é™…è¿è¡Œæƒ…å†µè¿œè¿œå°äºè¿™ä¸ªä¸Šç•Œå¯è¡¨ç¤ºä¸º O(S)ï¼Œå…¶ä¸­ S ä¸ºæ‰€æœ‰å¯è¡Œè§£çš„é•¿åº¦ä¹‹å’Œ ç©ºé—´å¤æ‚åº¦ï¼šO(target) ","date":"2023-08-08","objectID":"/leetcode/:5:4","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"040 ç»„åˆæ€»å’Œâ…¡ åœ¨ 039 ç»„åˆæ€»å’Œ çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ ä»£ç  class Solution { // ç»“æœé›† Set\u003cList\u003cInteger\u003e\u003e res = new HashSet\u003c\u003e(); public List\u003cList\u003cInteger\u003e\u003e combinationSum2(int[] candidates, int target) { if (candidates == null || candidates.length == 0) { return new ArrayList\u003c\u003e(res); } Arrays.sort(candidates); backTrack(new ArrayList\u003c\u003e(), 0, 0, candidates, target); // è¿”å›å€¼ç±»å‹éœ€è¦ Set è½¬ List return new ArrayList\u003c\u003e(res); } private void backTrack(List\u003cInteger\u003e path, int sum, int idx, int[] candidates, int target) { // base case if (sum == target) { res.add(new ArrayList\u003c\u003e(path)); return; } for (int i = idx; i \u003c candidates.length; i++) { // å‡æ if (sum + candidates[i] \u003e target) { break; } path.add(candidates[i]); //å›æº¯æ—¶ç”¨è¿‡çš„æ•°å­—ä¸èƒ½å†ç”¨ backTrack(path, sum + candidates[i], i + 1, candidates, target); path.remove(path.size() - 1); } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n*2^n)å®é™…è¿è¡Œæƒ…å†µè¿œè¿œå°äºè¿™ä¸ªä¸Šç•Œå¯è¡¨ç¤ºä¸º O(S)ï¼Œå…¶ä¸­ S ä¸ºæ‰€æœ‰å¯è¡Œè§£çš„é•¿åº¦ä¹‹å’Œ ç©ºé—´å¤æ‚åº¦ï¼šO(target) ","date":"2023-08-08","objectID":"/leetcode/:5:5","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"046 å…¨æ’åˆ— ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚ ä»£ç  class Solution { // ç»“æœé›† List\u003cList\u003cInteger\u003e\u003e res = new ArrayList\u003c\u003e(); public List\u003cList\u003cInteger\u003e\u003e permute(int[] nums) { backTrack(nums, new LinkedList\u003c\u003e()); return res; } private void backTrack(int[] nums, LinkedList\u003cInteger\u003e path) { // å‡æ if (path.size() == nums.length) { res.add(new ArrayList\u003c\u003e(path)); return; } for (int i = 0; i \u003c nums.length; i++) { // ç­›é€‰ if (path.contains(nums[i])) { continue; } path.addLast(nums[i]); backTrack(nums, path); path.removeLast(); } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n*n!) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:5:6","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"047 å…¨æ’åˆ—â…¡ åœ¨ 046 å…¨æ’åˆ— çš„åŸºç¡€ä¸Šï¼Œnumså¯åŒ…å«é‡å¤æ•°å­— ä»£ç  class Solution { // ç»“æœé›† Set\u003cList\u003cInteger\u003e\u003e res = new HashSet\u003c\u003e(); public List\u003cList\u003cInteger\u003e\u003e permuteUnique(int[] nums) { backTrack(nums, new LinkedList\u003c\u003e(), new boolean[nums.length]); return new ArrayList\u003c\u003e(res); } private void backTrack(int[] nums, LinkedList\u003cInteger\u003e path, boolean[] used) { // å‡æ if (path.size() == nums.length) { res.add(new ArrayList\u003c\u003e(path)); return; } for (int i = 0; i \u003c nums.length; i++) { // ç­›é€‰ if (used[i]) { continue; } path.addLast(nums[i]); used[i] = true; backTrack(nums, path, used); path.removeLast(); used[i] = false; } } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n*n!) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:5:7","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"åŠ¨æ€è§„åˆ’ ","date":"2023-08-08","objectID":"/leetcode/:6:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[322]é›¶é’±å…‘æ¢.java ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° amount ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚ è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1 ã€‚ ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚ æ€è·¯ è‡ªåº•å‘ä¸Šè€ƒè™‘ï¼Œè¦å‡‘åˆ° i å…ƒé’±æœ‰ dp[i] ç§æƒ…å†µï¼Œæ–°å»º dp æ•°ç»„ï¼› åˆå§‹å€¼ï¼šdp[0] = 0; çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šdp[i] = min(dp[i], 1 + dp[i - coin]); è¿”å›å€¼ï¼šdp[amount]; å‰ªæï¼šç¡¬å¸é‡‘é¢å¤§äºç›®æ ‡é‡‘é¢ã€‚ ä»£ç  class Solution { public int coinChange(int[] coins, int amount) { int[] dp = new int[amount + 1]; Arrays.fill(dp, amount + 1); dp[0] = 0; for (int i = 0; i \u003c= amount; i++) { // è¦å‡‘åˆ° i å…ƒé’±æœ‰ dp[i] ç§æƒ…å†µ for (int coin : coins) { if (coin \u003e i) { continue; } dp[i] = Math.min(dp[i], 1 + dp[i - coin]); } } return (dp[amount] == amount + 1) ? -1 : dp[amount]; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:6:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[53]æœ€å¤§å­åºå’Œ.java ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ æ€è·¯ å› ä¸ºï¼ŒæŸä¸€ä½çš„æœ€å¤§å­åºå’Œæ— éä¸¤ç§æƒ…å†µ ç»§ç»­ç´¯åŠ å‰ä¸€ä¸ªæ•°çš„æœ€å¤§å­åºå’Œ ä»å½“å‰æ•°å­—é‡æ–°ç´¯åŠ  æ‰€ä»¥ï¼Œå¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š f(i)=max({f(iâˆ’1)+nums[i],nums[i]}) ä»£ç  class Solution { public int maxSubArray(int[] nums) { int pre = 0, maxAns = nums[0]; for (int x : nums) { pre = Math.max(pre + x, x); maxAns = Math.max(maxAns, pre); } return maxAns; } } class Solution { public int maxSubArray(int[] nums) { int left = 0, right = 0, sum = 0, res = Integer.MIN_VALUE; while (right \u003c nums.length) { sum += nums[right++]; while (sum \u003c 0) { // d æ˜¯å°†ç§»å‡ºçª—å£çš„å­—ç¬¦ sum -= nums[left++]; } res = Math.max(sum, res); } int negative = Integer.MIN_VALUE; for (int num : nums) { negative = Math.max(num, negative); } return negative \u003c 0 ? negative : res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:6:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[300]æœ€é•¿é€’å¢å­åºåˆ—.java ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚ å­åºåˆ—æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7] æ˜¯æ•°ç»„ [0,3,1,6,2,2,7] çš„å­åºåˆ—ã€‚ æ€è·¯ å› ä¸ºï¼ŒæŸä¸€ä½çš„æœ€å¤§å­åºé•¿åº¦æ— éä¸¤ç§æƒ…å†µ å…ˆåœ¨å‰é¢æ‰¾å‡ºæ¯”å½“å‰æ•°å­—æ›´å°çš„æ•°å­—ï¼Œæ‰¾ä¸€ä¸ªé•¿åº¦æœ€é•¿çš„è‡ªå¢ 1 ä½œä¸ºå½“å‰çš„æœ€å¤§è‡ªåºé•¿åº¦ ä»å½“å‰æ•°å­—é‡æ–°ç´¯åŠ ï¼ˆå¯ä»¥è®©åˆå§‹åŒ–é•¿åº¦ä¸º1ï¼‰ ä»£ç  class Solution { public int lengthOfLIS(int[] nums) { final int n = nums.length; int[] dp = new int[n]; // base caseï¼šdp æ•°ç»„å…¨éƒ½åˆå§‹åŒ–ä¸º 1 Arrays.fill(dp, 1); int res = 0; for (int i = 0; i \u003c n; i++) { // åœ¨å‰é¢æ‰¾æ¯”å½“å‰æ•°å­—æ›´å°çš„æ•°å­—ï¼Œä»¥æ»¡è¶³é€’å¢å­åºåˆ—çš„è¦æ±‚ã€‚ int cur = nums[i]; for (int j = 0; j \u003c i; j++) { if (nums[j] \u003c cur) dp[i] = Math.max(dp[i], dp[j] + 1); } // æ›´æ–°æœ€å¤§å€¼ä½œä¸ºè¿”å›ç»“æœ res = Math.max(res, dp[i]); } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:6:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"æ ˆå’Œé˜Ÿåˆ— ","date":"2023-08-08","objectID":"/leetcode/:7:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[225]ç”¨é˜Ÿåˆ—å®ç°æ ˆ.java è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å®ç°ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œå¹¶æ”¯æŒæ™®é€šæ ˆçš„å…¨éƒ¨å››ç§æ“ä½œï¼ˆpushã€topã€pop å’Œ emptyï¼‰ã€‚ æ€è·¯ ç”¨ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•æ ˆé¡¶ã€‚ å…¥æ ˆã€åˆ¤ç©ºä¸åšå¤„ç† é¢å¤–å¤„ç†å‡ºæ ˆçš„ pop æ“ä½œï¼ŒæŠŠé˜Ÿåˆ—ä¸­å‰ n-1 ä¸ªå…ƒç´ å‡ºé˜Ÿå†å…¥é˜Ÿï¼Œè¿”å›æœ«å°¾å…ƒç´ ã€‚ ä»£ç  class MyStack { Queue\u003cInteger\u003e queue; int top; /** * Initialize your data structure here. */ public MyStack() { queue = new LinkedList\u003c\u003e(); top = 0; } /** * Push element x onto stack. */ public void push(int x) { queue.offer(x); top = x; } /** * Removes the element on top of the stack and returns that element. */ public int pop() { int size = queue.size(); for (int i = 0; i \u003c size - 1; i++) { top = queue.peek(); queue.offer(queue.poll()); } return queue.poll(); } /** * Get the top element. */ public int top() { return top; } /** * Returns whether the stack is empty. */ public boolean empty() { return queue.isEmpty(); } } ","date":"2023-08-08","objectID":"/leetcode/:7:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[232]ç”¨æ ˆå®ç°é˜Ÿåˆ—.java è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚é˜Ÿåˆ—åº”å½“æ”¯æŒä¸€èˆ¬é˜Ÿåˆ—æ”¯æŒçš„æ‰€æœ‰æ“ä½œï¼ˆpushã€popã€peekã€emptyï¼‰ æ€è·¯ å»ºç«‹ 2 ä¸ªæ ˆï¼Œå…ƒç´ å…ˆå…¥ s1ï¼Œå†å…¥ s2ï¼Œè¿™æ · s2 çš„æ ˆé¡¶å°±ç›¸å½“äºé˜Ÿå°¾äº†ã€‚ æŠŠå…³é”®æ“ä½œæ”¾åœ¨ peek å¤„ï¼Œåœ¨ pop ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ peek ï¼Œå°±èƒ½ç¡®ä¿ä¸ä¼šå‡ºé”™äº†ã€‚ ä»£ç  class MyQueue { private Stack\u003cInteger\u003e s1, s2; /** * Initialize your data structure here. */ public MyQueue() { s1 = new Stack\u003c\u003e(); s2 = new Stack\u003c\u003e(); } /** * Push element x to the back of queue. */ public void push(int x) { s1.push(x); } /** * Removes the element from in front of queue and returns that element. */ public int pop() { // å°† s1 å…ƒç´ è½¬ç§»è‡³ s2 peek(); return s2.pop(); } /** * Get the front element. */ public int peek() { if (s2.isEmpty()) { while (!s1.isEmpty()) { s2.push(s1.pop()); } } return s2.peek(); } /** * Returns whether the queue is empty. */ public boolean empty() { return s1.isEmpty() \u0026\u0026 s2.isEmpty(); } } ","date":"2023-08-08","objectID":"/leetcode/:7:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[496]ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I.java ç»™ä½ ä¸¤ä¸ª æ²¡æœ‰é‡å¤å…ƒç´  çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œå…¶ä¸­nums1 æ˜¯ nums2 çš„å­é›†ã€‚ è¯·ä½ æ‰¾å‡º nums1 ä¸­æ¯ä¸ªå…ƒç´ åœ¨ nums2 ä¸­çš„ä¸‹ä¸€ä¸ªæ¯”å…¶å¤§çš„å€¼ã€‚ nums1 ä¸­æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯æŒ‡ x åœ¨ nums2 ä¸­å¯¹åº”ä½ç½®çš„å³è¾¹çš„ç¬¬ä¸€ä¸ªæ¯” x å¤§çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¯¹åº”ä½ç½®è¾“å‡º -1 ã€‚ æ€è·¯ ä»åå¾€å‰éå† nums2ï¼Œç”¨æ ˆè®°å½•å³ä¾§å¤§äºå½“å‰æ•°å­—çš„å€¼ï¼› ä»¥å½“å‰æ•°å­—ä¸º keyï¼Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ä¸º valueï¼Œå»ºç«‹ä¸€ä¸ª HashMap å­˜å‚¨ï¼› éå† nums1 ,è·å–æ¯ä¸€ä¸ª key çš„ valueã€‚ ä»£ç  class Solution { public int[] nextGreaterElement(int[] nums1, int[] nums2) { Map\u003cInteger, Integer\u003e map = new HashMap\u003c\u003e(); Stack\u003cInteger\u003e stack = new Stack\u003c\u003e(); // ä»åå¾€å‰éå† for (int i = nums2.length - 1; i \u003e= 0; i--) { while (!stack.isEmpty() \u0026\u0026 nums2[i] \u003e= stack.peek()) { // æ ˆé¡¶å…ƒç´ å³å°†è¢« nums2[i] æŒ¡ä½ stack.pop(); } int nextGreaterNum = stack.isEmpty() ? -1 : stack.peek(); map.put(nums2[i], nextGreaterNum); stack.push(nums2[i]); } int[] res = new int[nums1.length]; for (int i = 0; i \u003c nums1.length; i++) { res[i] = map.get(nums1[i]); } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:7:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[503]ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II.java ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1ã€‚ æ€è·¯ ä»åå¾€å‰éå† numsï¼Œç”¨æ ˆè®°å½•å³ä¾§å¤§äºå½“å‰æ•°å­—çš„å€¼ å› ä¸ºæ•°ç»„æ˜¯å¾ªç¯æ•°ç»„ï¼Œæ‰€ä»¥åœ¨èµ‹å€¼ -1 æ—¶è¿˜è¦å»åæ ‡å·¦è¾¹æ‰¾æ‰¾ï¼Œå¦‚æœè¿˜æ‰¾ä¸åˆ°æ›´å¤§å…ƒç´ ï¼Œé‚£ä¹ˆå°±è¿”å› -1ï¼Œå¦åˆ™å°±è¿”å›ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚ ä»£ç  class Solution { public int[] nextGreaterElements(int[] nums) { int[] res = new int[nums.length]; Stack\u003cInteger\u003e stack = new Stack\u003c\u003e(); // ä»åå¾€å‰éå† for (int i = nums.length - 1; i \u003e= 0; i--) { while (!stack.isEmpty() \u0026\u0026 nums[i] \u003e= stack.peek()) { // æ ˆé¡¶å…ƒç´ å³å°†è¢« nums[i] æŒ¡ä½ stack.pop(); } if (stack.isEmpty()) { res[i] = -1; // åé¢æ‰¾ä¸åˆ°äº†ï¼Œå»å‰é¢æ‰¾æ‰¾çœ‹ for (int j = 0; j \u003c i; j++) { if (nums[j] \u003e nums[i]) { res[i] = nums[j]; break; } } } else { res[i] = stack.peek(); } stack.push(nums[i]); } return res; } } class Solution { public int[] nextGreaterElements(int[] nums) { int n = nums.length; int[] res = new int[n]; Arrays.fill(res, -1); // å•è°ƒæ ˆä¸­å­˜æ”¾ä¸‹æ ‡ Stack\u003cInteger\u003e stack = new Stack\u003c\u003e(); for (int i = 0; i \u003c n * 2; i++) { while (!stack.isEmpty() \u0026\u0026 nums[stack.peek()] \u003c nums[i % n]) { // å‡ºæ ˆçš„å€¼çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ å³ä¸º nums[i] res[stack.pop()] = nums[i % n]; } if (i \u003c n) { stack.push(i); } } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:7:4","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[1047]åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹.java //ç»™å‡ºç”±å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² Sï¼Œé‡å¤é¡¹åˆ é™¤æ“ä½œä¼šé€‰æ‹©ä¸¤ä¸ªç›¸é‚»ä¸”ç›¸åŒçš„å­—æ¯ï¼Œå¹¶åˆ é™¤å®ƒä»¬ã€‚ //// åœ¨ S ä¸Šåå¤æ‰§è¡Œé‡å¤é¡¹åˆ é™¤æ“ä½œï¼Œç›´åˆ°æ— æ³•ç»§ç»­åˆ é™¤ã€‚ //// åœ¨å®Œæˆæ‰€æœ‰é‡å¤é¡¹åˆ é™¤æ“ä½œåè¿”å›æœ€ç»ˆçš„å­—ç¬¦ä¸²ã€‚ç­”æ¡ˆä¿è¯å”¯ä¸€ã€‚ //// //// ç¤ºä¾‹ï¼š //// è¾“å…¥ï¼šâ€œabbacaâ€//è¾“å‡ºï¼šâ€œcaâ€//è§£é‡Šï¼š//ä¾‹å¦‚ï¼Œåœ¨ â€œabbacaâ€ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤ â€œbbâ€ ç”±äºä¸¤å­—æ¯ç›¸é‚»ä¸”ç›¸åŒï¼Œè¿™æ˜¯æ­¤æ—¶å”¯ä¸€å¯ä»¥æ‰§è¡Œåˆ é™¤æ“ä½œçš„é‡å¤é¡¹ã€‚ä¹‹åæˆ‘ä»¬å¾—åˆ°å­—ç¬¦ä¸² â€œaacaâ€ï¼Œå…¶ä¸­åˆ//åªæœ‰ â€œaaâ€ å¯ä»¥æ‰§è¡Œé‡å¤é¡¹åˆ é™¤æ“ä½œï¼Œæ‰€ä»¥æœ€åçš„å­—ç¬¦ä¸²ä¸º â€œcaâ€ã€‚ class Solution { public String removeDuplicates(String s) { char[] stack = new char[s.length()]; int index = 0; for (char currentChar : s.toCharArray()) { if (index \u003e 0 \u0026\u0026 stack[index - 1] == currentChar) { index--; } else { stack[index++] = currentChar; } } return new String(stack, 0, index); } } ","date":"2023-08-08","objectID":"/leetcode/:7:5","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"å…¶ä»– ","date":"2023-08-08","objectID":"/leetcode/:8:0","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰ç®—æ³•ï¼š[990]ç­‰å¼æ–¹ç¨‹çš„å¯æ»¡è¶³æ€§.java ç»™å®šä¸€ä¸ªç”±è¡¨ç¤ºå˜é‡ä¹‹é—´å…³ç³»çš„å­—ç¬¦ä¸²æ–¹ç¨‹ç»„æˆçš„æ•°ç»„ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²æ–¹ç¨‹ equations[i] çš„é•¿åº¦ä¸º 4ï¼Œå¹¶é‡‡ç”¨ä¸¤ç§ä¸åŒçš„å½¢å¼ä¹‹ä¸€ï¼šâ€œa==bâ€ æˆ– â€œa!=bâ€ã€‚åœ¨è¿™é‡Œï¼Œa å’Œ b æ˜¯å°å†™å­—æ¯ï¼ˆä¸ä¸€å®šä¸åŒï¼‰ï¼Œè¡¨ç¤ºå•å­—æ¯å˜é‡åã€‚ åªæœ‰å½“å¯ä»¥å°†æ•´æ•°åˆ†é…ç»™å˜é‡åï¼Œä»¥ä¾¿æ»¡è¶³æ‰€æœ‰ç»™å®šçš„æ–¹ç¨‹æ—¶æ‰è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ æ€è·¯ å°†æ–¹ç¨‹åˆ†æˆç­‰å¼å’Œä¸ç­‰å¼ä¸¤ç±»ï¼› åˆå§‹åŒ–ã€Œå›¾ã€ï¼› æ ¹æ®ç­‰å¼è¿æ¥ä¸¤ä¸¤èŠ‚ç‚¹ï¼› åˆ¤æ–­ä¸ç­‰å¼æ˜¯å¦æˆç«‹ã€‚ ä»£ç  class Solution { // èŠ‚ç‚¹ x çš„èŠ‚ç‚¹æ˜¯ parent[x] private int[] parent; // æ–°å¢ä¸€ä¸ªæ•°ç»„è®°å½•æ ‘çš„â€œé‡é‡â€ private int[] size; public boolean equationsPossible(String[] equations) { // 1. å°†æ–¹ç¨‹åˆ†æˆç­‰å¼å’Œä¸ç­‰å¼ä¸¤ç±» List\u003cString\u003e equals = new LinkedList\u003c\u003e(); List\u003cString\u003e unEquals = new LinkedList\u003c\u003e(); for (String equation : equations) { char c = equation.charAt(1); if (c == '=') { equals.add(equation); } else if (c == '!') { unEquals.add(equation); } } // 2. åˆå§‹åŒ–ã€Œå›¾ã€ parent = new int[26]; size = new int[26]; for (int i = 0; i \u003c 26; i++) { // çˆ¶èŠ‚ç‚¹æŒ‡é’ˆåˆå§‹æŒ‡å‘è‡ªå·± parent[i] = i; // é‡é‡åº”è¯¥åˆå§‹åŒ– 1 size[i] = 1; } // 3. æ ¹æ®ç­‰å¼è¿æ¥ä¸¤ä¸¤èŠ‚ç‚¹ for (String equal : equals) { int a = equal.charAt(0) - 'a'; int b = equal.charAt(3) - 'a'; union(a, b); } // 4. åˆ¤æ–­ä¸ç­‰å¼æ˜¯å¦æˆç«‹ for (String unEqual : unEquals) { int a = unEqual.charAt(0) - 'a'; int b = unEqual.charAt(3) - 'a'; int rootA = find(a); int rootB = find(b); if (rootA == rootB) { return false; } } return true; } /* å°† p å’Œ q è¿æ¥ */ private void union(int p, int q) { int rootP = find(p); int rootQ = find(q); if (rootP == rootQ) { // äºŒè€…å·²è¿æ¥ return; } // å°†ä¸¤æ£µæ ‘åˆå¹¶ä¸ºä¸€æ£µï¼Œå°æ ‘æ¥åˆ°å¤§æ ‘ä¸‹é¢ if (size[rootP] \u003e size[rootQ]) { parent[rootQ] = rootP; size[rootP] += size[rootQ]; } else { parent[rootP] = rootQ; size[rootQ] += size[rootP]; } } /* è¿”å›æŸä¸ªèŠ‚ç‚¹ x çš„æ ¹èŠ‚ç‚¹ */ private int find(int x) { // æ ¹èŠ‚ç‚¹çš„ parent[x] == x while (parent[x] != x) { parent[x] = parent[parent[x]]; x = parent[x]; } return x; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(n) ç©ºé—´å¤æ‚åº¦ï¼šO(n) ","date":"2023-08-08","objectID":"/leetcode/:8:1","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"[146]LRU ç¼“å­˜æœºåˆ¶.java è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ ã€‚ å®ç° LRUCache ç±»ï¼š LRUCache(int capacity) ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜ int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚ void put(int key, int value) å¦‚æœå…³é”®å­—å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ï¼›å¦‚æœå…³é”®å­—ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥è¯¥ç»„ã€Œå…³é”®å­—-å€¼ã€ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚ æ€è·¯ éœ€è¦ä¸€ä¸ªæœ‰æ—¶åºçš„ Map æ¥å®ç°ç®—æ³•ï¼Œåœ¨ Java è¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨ LinkedHashMapï¼› LRU çš„æ ¸å¿ƒæ˜¯ makeRecently æ–¹æ³•ï¼Œå®ƒæŠŠä¸€å¯¹ key-value æ”¾åˆ°æœ€æ–°çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨çš„é˜Ÿå°¾ã€‚ get æ–¹æ³•ç›´æ¥å» Map ä¸­æ‰¾ï¼Œå¹¶è°ƒç”¨ makeRecently æ–¹æ³•ï¼› put æ–¹æ³•éœ€è¦è€ƒè™‘ç¼“å­˜å¤§å°è¶…å‡ºç»™å®šå®¹é‡çš„æƒ…å†µï¼Œè‹¥ key æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆ™éœ€è¦åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„ key-value å¯¹ï¼Œå¹¶æ·»åŠ æ–°çš„ key-value å¯¹ï¼›è‹¥åŸæœ¬å°±å­˜åœ¨ keyï¼Œåˆ™æ›´æ–°å®ƒçš„ valueï¼Œå¹¶è°ƒç”¨ makeRecently æ–¹æ³•ã€‚ ä»£ç  class LRUCache { int capacity; LinkedHashMap\u003cInteger, Integer\u003e cache; public LRUCache(int capacity) { this.capacity = capacity; cache = new LinkedHashMap\u003c\u003e(); } public int get(int key) { if (!cache.containsKey(key)) { return -1; } return makeRecently(key); } public void put(int key, int value) { // å®¹é‡å·²æ»¡ï¼Œéœ€è¦ç§»é™¤ if (cache.size() == capacity \u0026\u0026 !cache.containsKey(key)) { int oldestKey = cache.keySet().iterator().next(); cache.remove(oldestKey); } cache.put(key, value); makeRecently(key); } private int makeRecently(int key) { int val = cache.get(key); // åˆ é™¤ keyï¼Œé‡æ–°æ’å…¥åˆ°é˜Ÿå°¾ cache.remove(key); cache.put(key, val); return val; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(1) ç©ºé—´å¤æ‚åº¦ï¼šO(capacity) ","date":"2023-08-08","objectID":"/leetcode/:8:2","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["practice"],"content":"050 Pow(x,n) intè½¬æ¢ä¸ºlong Java ä»£ç ä¸­ int32 å˜é‡ n \\in [-2147483648, 2147483647]ï¼Œå› æ­¤å½“ n = -2147483648 æ—¶æ‰§è¡Œ n = -nä¼šå› è¶Šç•Œè€Œèµ‹å€¼å‡ºé”™ã€‚è§£å†³æ–¹æ³•æ˜¯å…ˆå°† n å­˜å…¥ long å˜é‡ b ï¼Œåé¢ç”¨ b æ“ä½œå³å¯ã€‚ ä»£ç ï¼ˆè¿­ä»£ï¼‰ class Solution { public double myPow(double x, int n) { if (x == 0.0f) return 0.0d; //é˜²æ­¢n=-nèµ‹å€¼è¶Šç•Œ long b = n; // n=0æƒ…å†µè¿”å›1 double res = 1.0; if (b \u003c 0) { x = 1 / x; b = -b; } while (b \u003e 0) { if ((b \u0026 1) == 1) { //å¥‡æ•° res *= x; } x *= x; //æŒ‰ä½å³ç§»ï¼Œç›¸å½“äºé™¤ä»¥2 b \u003e\u003e= 1; } return res; } } å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(logn) ç©ºé—´å¤æ‚åº¦ï¼šO(1) ","date":"2023-08-08","objectID":"/leetcode/:8:3","tags":["LeetCode","DS"],"title":"LeetCode å¤§å…¨","uri":"/leetcode/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"å’±å°±æ˜¯è¯´æœ€åæ²¡æŠ¥å","date":"2023-08-08","objectID":"/kaggle/","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"å¯¼å­¦ ","date":"2023-08-08","objectID":"/kaggle/:1:0","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"èµ›é¢˜ ç»“æ„åŒ–(\u003e50%)ï¼š è§„æ•´ï¼Œçº¬åº¦å›ºå®š è‡ªç„¶è¯­è¨€ è¯­éŸ³è¯†åˆ« è®¡ç®—æœºè§†è§‰ ","date":"2023-08-08","objectID":"/kaggle/:1:1","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"æ—¶é—´è½´ entry deadlineï¼š æœ€æ™šå‚èµ›æ—¶é—´ team merger deadlineï¼š æœ€æ™šç»„é˜Ÿæ—¶é—´ final submission deadlineï¼š æœ€ç»ˆæäº¤æˆªæ­¢æ—¶é—´ ","date":"2023-08-08","objectID":"/kaggle/:1:2","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"ç»“æ„åŒ– ","date":"2023-08-08","objectID":"/kaggle/:2:0","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"æ ‘æ¨¡å‹ é€‚ç”¨åœºæ™¯ï¼š ç±»åˆ«å­—æ®µè¾ƒå¤šã€èšåˆç‰¹å¾è¾ƒå¤š XGBoost(2015) httpsï¼š//xgboost.readthedocs.io/en/latest ä¼˜ç‚¹ï¼šæå‡ºæ—¶é—´è¾ƒæ—©çš„é«˜é˜¶æ ‘æ¨¡å‹ï¼Œç²¾åº¦è¾ƒå¥½ ç¼ºç‚¹ï¼šè®­ç»ƒæ—¶é—´è¾ƒé•¿ï¼Œå¯¹ç±»åˆ«ç‰¹å¾æ”¯æŒä¸å‹å¥½ æ¥å£ï¼šsklearnæ¥å£å’ŒåŸç”Ÿæ¥å£ LighGBM(2018) httpsï¼š//lightgbm.readthedocs.io/en/latest ä¼˜ç‚¹ï¼šå¯¹èŠ‚ç‚¹åˆ†è£‚è¿›è¡Œæ”¹è¿›ï¼Œé€Ÿåº¦æœ‰ä¸€å®šæå‡ ç¼ºç‚¹ï¼šåŠ å…¥äº†éšæœºæ€§ï¼Œç²¾åº¦å’Œç¨³å®šæ€§æœ‰æ‰€ä¸‹é™ æ¥å£ï¼šsklearnæ¥å£å’ŒåŸç”Ÿæ¥å£ CatBoost(2019) httpsï¼š//catboost.ai/ ä¼˜ç‚¹ï¼šæ”¯æŒç±»åˆ«å’Œå­—ç¬¦ä¸²åˆ†è£‚ ç¼ºç‚¹ï¼šå®¹æ˜“è¿‡æ‹Ÿåˆ æ¥å£ï¼šsklearnæ¥å£å’ŒåŸç”Ÿæ¥å£ ","date":"2023-08-08","objectID":"/kaggle/:2:1","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"æ•°æ®é›†Dataset training set test setï¼šä¸€èˆ¬ä¸èƒ½ç”¨æ¥è®­ç»ƒï¼›å¯èƒ½åˆ†ä¸ºABæ¦œå• validation set åªè¦æœ‰åé¦ˆï¼Œå°±æœ‰è¿‡æ‹Ÿåˆ ","date":"2023-08-08","objectID":"/kaggle/:2:2","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"æ¨¡å‹é›†æˆ vote æŠ•ç¥¨ blend åŠ æƒ stacking äº¤å‰éªŒè¯ä¸­å¯¹æ¨¡å‹è¿›è¡Œå¤šæŠ˜è®­ç»ƒ æ·±åº¦å­¦ä¹ æ¨¡å‹é›†æˆ dropout éšæœºåˆ å‡ç½‘ç»œç»“æ„ snapshot é›†æˆå¤šä¸ªå±€éƒ¨æœ€ä¼˜ ","date":"2023-08-08","objectID":"/kaggle/:2:3","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["å­¦æœ¯ç ”ç©¶"],"content":"ç‰¹å¾å·¥ç¨‹ å†³å®šäº†æ¨¡å‹çš„ç²¾åº¦ä¸Šé™ ç±»åˆ«ç‰¹å¾ Onehotï¼šone-of-kï¼Œ100ã€010ã€001 å¢åŠ æ•°æ®ç»´åº¦ï¼Œä¸€èˆ¬é€‚ç”¨äºå–å€¼ä¸ªæ•°å°äº10 LabelEncoderï¼šæ ‡å·ï¼Œä¸å¢åŠ ç»´åº¦ï¼Œé»˜è®¤å­—å…¸é¡ºåº Ordinal Encodingï¼šå¯ä»¥æ‰‹åŠ¨ç»™å®šç¼–å· BinaryEncoderï¼šäºŒè¿›åˆ¶ç¼–ç ï¼ˆå‹ç¼©ç‰ˆ Onehotï¼‰ Frequency/Count Encodingï¼šè®¡æ•°ï¼ˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†å–å€¼éœ€è¦ä¸€è‡´ï¼‰ Mean/Target Encodingï¼šå¸®åŠ©æ¨¡å‹å¿«é€Ÿæ”¶æ•›ï¼Œä½†å¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆ æ•°å€¼ç‰¹å¾ å®¹æ˜“å‡ºç°å¼‚å¸¸å€¼å’Œç¦»ç¾¤ç‚¹ Roundï¼šå–æ•´ï¼ˆé˜²æ­¢æ¨¡å‹å»å­¦ä¹ ç»†ææœ«èŠ‚çš„è§„å¾‹ï¼‰ Box/Binsï¼šåˆ†ç±» æ—¥æœŸå­—æ®µ éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆç™»å½•æ—¥å¿—ã€æ¶ˆè´¹æ—¶é—´ï¼‰ ","date":"2023-08-08","objectID":"/kaggle/:2:4","tags":["å¤§æ•°æ®"],"title":"Kaggle","uri":"/kaggle/"},{"categories":["interview"],"content":"æŠ€æœ¯é€‰å‹ mongodbï¼šå¢åˆ æ”¹æŸ¥ esï¼šå¤§æ•°æ®æœç´¢ luceneï¼šåˆ†å¸ƒå¼æœç´¢ ","date":"2023-08-08","objectID":"/elasticsearch/:0:1","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"å€’æ’ç´¢å¼• æ ¹æ®åˆ†è¯æ‰¾åˆ°æ–‡æ¡£idï¼Œæ ¹æ®æ–‡æ¡£idæ‰¾åˆ°æ–‡æ¡£ã€‚ ç´¢å¼•ï¼šå¸®åŠ©å¿«é€Ÿæœç´¢ï¼Œä»¥æ•°æ®ç»“æ„ä¸ºè½½ä½“ï¼Œä»¥æ–‡ä»¶çš„å½¢å¼è½åœ°ã€‚ åˆ‡è¯ï¼šword segmentation è§„èŒƒåŒ–ï¼šnormalization å»é‡ï¼šdistinct å­—å…¸åºï¼šsorted ","date":"2023-08-08","objectID":"/elasticsearch/:0:2","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"æ—¥å¿—é‡‡é›† ELK LogStash ç­›é€‰ ElasticSearch å­˜å‚¨ Kibana å¯è§†åŒ– ","date":"2023-08-08","objectID":"/elasticsearch/:0:3","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"1. Elasticsearch å’Œä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¼ ç»Ÿæ•°æ®åº“é€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œè€Œ Elasticsearch æ˜¯ä¸€ä¸ªéå…³ç³»å‹æ•°æ®åº“ã€‚ä¼ ç»Ÿæ•°æ®åº“ä¸»è¦ç”¨äºå­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼Œè€Œ Elasticsearch ä¸»è¦ç”¨äºå­˜å‚¨éç»“æ„åŒ–æ•°æ®ã€‚ä¼ ç»Ÿæ•°æ®åº“çš„æŸ¥è¯¢é€šå¸¸æ˜¯åŸºäº SQL çš„ï¼Œè€Œ Elasticsearch çš„æŸ¥è¯¢æ˜¯åŸºäº JSON çš„ã€‚ ","date":"2023-08-08","objectID":"/elasticsearch/:0:4","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"2. Elasticsearch çš„æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ Elasticsearch çš„æ•°æ®ç»“æ„æ˜¯åŸºäºæ–‡æ¡£å’Œç´¢å¼•çš„ã€‚æ¯ä¸ªæ–‡æ¡£ä»£è¡¨ä¸€ä¸ªæ•°æ®å®ä½“ï¼Œæ¯ä¸ªç´¢å¼•ä»£è¡¨ä¸€ä¸ªæ•°æ®é›†åˆã€‚æ¯ä¸ªæ–‡æ¡£å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µå¯ä»¥æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸç­‰ç­‰ã€‚ ","date":"2023-08-08","objectID":"/elasticsearch/:0:5","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"3. Elasticsearch çš„æŸ¥è¯¢è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ Elasticsearch çš„æŸ¥è¯¢è¯­è¨€æ˜¯åŸºäº JSON çš„æŸ¥è¯¢è¯­è¨€ã€‚å®ƒå¯ä»¥ä½¿ç”¨å„ç§æŸ¥è¯¢ç±»å‹ï¼Œä¾‹å¦‚ matchã€termã€rangeã€bool ç­‰ç­‰ï¼Œæ¥å®ç°å„ç§å¤æ‚çš„æŸ¥è¯¢æ“ä½œã€‚ ","date":"2023-08-08","objectID":"/elasticsearch/:0:6","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"4. ç›¸å…³ä»£ç  // åˆ›å»ºä¸€ä¸ª Elasticsearch å®¢æˆ·ç«¯å¯¹è±¡ RestHighLevelClient client = new RestHighLevelClient( RestClient.builder(new HttpHost(\"localhost\", 9200, \"http\")) ); // æ‰§è¡Œä¸€ä¸ªèšåˆæ“ä½œ SearchRequest request = new SearchRequest(\"my_index\"); SearchSourceBuilder builder = new SearchSourceBuilder(); builder.aggregation(AggregationBuilders.terms(\"by_user\").field(\"user\")); request.source(builder); SearchResponse response = client.search(request, RequestOptions.DEFAULT); // è§£æèšåˆç»“æœ Terms byUser = response.getAggregations().get(\"by_user\"); for (Terms.Bucket bucket : byUser.getBuckets()) { String user = bucket.getKeyAsString(); long count = bucket.getDocCount(); System.out.println(user + \": \" + count); } // ------------------------------------------------------------------ // æ„å»ºä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ SearchRequest request = new SearchRequest(\"my_index\"); SearchSourceBuilder builder = new SearchSourceBuilder(); builder.query(QueryBuilders.matchQuery(\"message\", \"hello\")); request.source(builder); // æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // è§£ææŸ¥è¯¢ç»“æœ SearchHits hits = response.getHits(); for (SearchHit hit : hits) { String id = hit.getId(); String message = hit.getSourceAsMap().get(\"message\").toString(); System.out.println(id + \": \" + message); } // å…³é—­ Elasticsearch å®¢æˆ·ç«¯å¯¹è±¡ client.close(); åˆ›å»ºä¸€ä¸ª Elasticsearch å®¢æˆ·ç«¯å¯¹è±¡ RestHighLevelClient åˆ›å»ºç´¢å¼• CreateIndexRequest æ·»åŠ ä¸€ä¸ªæ–‡æ¡£ IndexRequest æ›´æ–°ä¸€ä¸ªæ–‡æ¡£ UpdateRequest åˆ é™¤ä¸€ä¸ªæ–‡æ¡£ DeleteRequest æœç´¢æ–‡æ¡£ SearchRequest æŸ¥è¯¢æ¡ä»¶ SearchSourceBuilder æŸ¥è¯¢ç»“æœ SearchHits ","date":"2023-08-08","objectID":"/elasticsearch/:0:7","tags":["ElasticSearch"],"title":"ğŸš©ElasticSearch","uri":"/elasticsearch/"},{"categories":["interview"],"content":"Tomcat å®šä¹‰ Tomcat = HTTP æœåŠ¡å™¨ + Servlet å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªWebå®¹å™¨ HTTPæœåŠ¡å™¨ï¼šå¤„ç†HTTPè¯·æ±‚å¹¶å“åº”ç»“æœ Servletå®¹å™¨ï¼šå°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„Servletï¼Œç”¨æ¥åŠ è½½å’Œç®¡ç†ä¸šåŠ¡ç±» ","date":"2023-08-08","objectID":"/tomcat/:0:1","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["interview"],"content":"è®¿é—®urlçš„è¿‡ç¨‹ ","date":"2023-08-08","objectID":"/tomcat/:0:2","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["interview"],"content":"Servlet ServletæŒ‡çš„æ˜¯ä»»ä½•å®ç°äº† Servlet æ¥å£çš„ç±»ï¼Œä¸»è¦ç”¨äºå¤„ç†å®¢æˆ·ç«¯ä¼ æ¥çš„ HTTP è¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªå“åº”ã€‚ // å‡ ä¹æ‰€æœ‰çš„Java Web æ¡†æ¶ï¼ˆå¦‚Springï¼‰ éƒ½æ˜¯åŸºäºServletçš„å°è£… public interface Servlet { void init(ServletConfig config) throws ServletException; ServletConfig getServletConfig(); // å®ç°ä¸šåŠ¡é€»è¾‘ void service(ServletRequest req,ServletRespons res) throws ServletException, IOException; String getServletInfo(); void destroy(); } ","date":"2023-08-08","objectID":"/tomcat/:0:3","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["interview"],"content":"Tomcat æ€»ä½“æ¶æ„ Tomcat è¦å®ç°2ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š å¤„ç† Socket è¿æ¥ï¼Œè½¬åŒ– å­—èŠ‚æµ-\u003eRequest-\u003eResponse-\u003eå­—èŠ‚æµ åŠ è½½å’Œç®¡ç†Servletï¼Œå¤„ç† Requestè¯·æ±‚ è¿æ¥å™¨çš„ä½œç”¨ï¼šå¯¹Servletå®¹å™¨é€šè¿‡ProtocalHandlerå±è”½äº†åè®®å’ŒIOæ¨¡å‹ï¼Œä½¿å¾—å®¹å™¨è·å–åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ServletRequestå¯¹è±¡ è¿æ¥å™¨çš„3ä¸ªé«˜å†…èšçš„åŠŸèƒ½ï¼šEndpoint``Processo``Adapter Endpoint ï¼šç½‘ç»œé€šä¿¡ socketï¼ˆTCP/IPï¼‰ â¬‡ï¸å­—èŠ‚æµâ¬‡ï¸ Processorï¼šåº”ç”¨å±‚åè®®è§£æï¼ˆHTTP) â¬‡ï¸Tomcat Requestâ¬‡ï¸ Adapterï¼šé€‚é…å™¨æ¨¡å¼è½¬åŒ– request å’Œ response â¬‡ï¸ServletRequestâ¬‡ï¸ å®¹å™¨ Tomcatä¸­æœ‰4ç§å®¹å™¨ï¼Œå®ƒä»¬æ˜¯çˆ¶å­å…³ç³»ï¼Œä»å¤§åˆ°å°å¦‚ä¸‹ï¼š Engineï¼šå¼•æ“ Hostï¼šè™šæ‹Ÿä¸»æœº/ç«™ç‚¹ã€åŸŸåã€‘ Contextï¼šWebåº”ç”¨ç¨‹åºã€Webåº”ç”¨è·¯å¾„ã€‘ Wrapperï¼š Servletã€Servletæ˜ å°„çš„è·¯å¾„ã€‘ï¼Œä¸ä¸€ä¸ªurlè¯·æ±‚ç›¸å¯¹åº” Mapperç»„ä»¶ï¼šå°†ç”¨æˆ·è¯·æ±‚çš„URLå®šä½åˆ°ä¸€ä¸ªServletï¼Œç»„ä»¶ä¸­ä¿å­˜äº†å®¹å™¨ç»„ä»¶ä¸è®¿é—®è·¯å¾„çš„æ˜ å°„å…³ç³» ","date":"2023-08-08","objectID":"/tomcat/:0:4","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["interview"],"content":"Java ç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ bootstrapï¼šåªæœ‰å®ƒæ˜¯C++ç¼–å†™ï¼ŒåªåŠ è½½åŒ…åä¸º javaã€javaxã€sunç­‰å¼€å¤´çš„æ ¸å¿ƒç±»åº“ JAVA_HOME/jre/lib æ‰©å±•ç±»åŠ è½½å™¨ ExtClassLoaderï¼šæ´¾ç”Ÿäº ClassLoader ç±» JAVA_HOME/jre/lib/ext åº”ç”¨ç±»åŠ è½½å™¨ AppClassLoader CLASSPATH æˆ– java.class.path å½“è§£æä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨çš„æ—¶å€™ï¼ŒJVM éœ€è¦ä¿è¯è¿™ä¸¤ä¸ªç±»å‹çš„ç±»åŠ è½½å™¨æ˜¯ç›¸åŒçš„ã€‚ ç±»åŠ è½½è¿‡ç¨‹ åŠ è½½ Loadingï¼š.class æ–‡ä»¶ -\u003e ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„æ•°æ®è®¿é—®å…¥å£ã€‚ é“¾æ¥ Linkingï¼š éªŒè¯ Verifyï¼šä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºæœ¬èº«ã€‚ï¼ˆä»¥ CAFEBABE å¼€å¤´ï¼‰ å‡†å¤‡ Prepareï¼šä¸ºå˜é‡åˆ†é…åˆå§‹å€¼ï¼ˆé›¶ï¼‰ï¼Œä¸åŒ…æ‹¬final static ä¿®é¥°çš„å¸¸é‡ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶å°±æ˜¾å¼åˆå§‹åŒ–äº†ï¼Œä¹Ÿä¸åŒ…æ‹¬å®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œå®ƒå’Œå¯¹è±¡ä¸€èµ·åˆ†é…åˆ°å †ä¸­ã€ç»™ç±»å˜é‡é»˜è®¤èµ‹å€¼ã€‘ è§£æ Resolveï¼šç¬¦å·å¼•ç”¨ -\u003e ç›´æ¥å¼•ç”¨ åˆå§‹åŒ– Initializationï¼šæ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•\u003cclinit\u003e() ï¼Œã€ç»™ç±»å˜é‡æ˜¾å¼èµ‹å€¼ï¼Œå³é™æ€ä»£ç å—èµ‹å€¼ã€‘ å£è¯€ï¼šçˆ¶é™å­é™ï¼ˆåˆå§‹åŒ–ï¼‰ï¼Œçˆ¶ä»£çˆ¶æ„ï¼Œå­ä»£å­æ„ ä½¿ç”¨ï¼šJVM ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œ å¸è½½ï¼šé”€æ¯ class å¯¹è±¡ ","date":"2023-08-08","objectID":"/tomcat/:0:5","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["interview"],"content":"ğŸŒŸ åŒäº²å§”æ´¾æœºåˆ¶ åŒäº²å§”æ´¾æœºåˆ¶ï¼šåŠ è½½æŸä¸ªç±»æ—¶ï¼Œä¼˜å…ˆäº¤ç»™ä¸Šçº§ç±»åŠ è½½å™¨åŠ è½½ã€‚çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½æ‰ä¼šè¿˜ç»™å­ç±»å»åŠ è½½ï¼Œä¾‹å¦‚è‡ªå®šä¹‰çš„Stringç±»æ°¸è¿œæ— æ³•æ‰§è¡Œï¼Œä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œè¿™å°±æ˜¯æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚ é¿å…ç±»çš„é‡å¤åŠ è½½ ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ Tomcat æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿ ç›®çš„ï¼šä¼˜å…ˆåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±»ã€‚ åŸå› ï¼šè‹¥ä½¿ç”¨JVMé»˜è®¤çš„AppClassLoaderåŠ è½½Webåº”ç”¨ï¼ŒAppClassLoaderåªèƒ½åŠ è½½ä¸€ä¸ªServletç±»ï¼Œåœ¨åŠ è½½ç¬¬äºŒä¸ªåŒåServletç±»æ—¶ï¼ŒAppClassLoaderä¼šè¿”å›ç¬¬ä¸€ä¸ªServletç±»çš„Classå®ä¾‹ã€‚ å› ä¸ºåœ¨AppClassLoaderçœ¼é‡Œï¼ŒåŒåServletç±»åªèƒ½è¢«åŠ è½½ä¸€æ¬¡ã€‚ æ–¹æ³•ï¼šç»§æ‰¿ClassLoaderæŠ½è±¡ç±»ï¼Œå¹¶é‡å†™å®ƒçš„loadClassæ–¹æ³•ã€‚ï¼ˆå› ä¸ºClassLoaderçš„é»˜è®¤å®ç°æ˜¯åŒäº²å§”æ´¾ï¼‰ Tomcat ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„ Webåº”ç”¨ä¹‹é—´çš„ç±»å¦‚ä½•éš”ç¦»ï¼Ÿ è‡ªå®šä¹‰ WebAppClassLoader ç±»åŠ è½½å™¨ï¼Œä¸ºæ¯ä¸ªWebåº”ç”¨åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ Webåº”ç”¨ä¹‹é—´çš„ç±»å¦‚ä½•å…±äº«åº“ç±»ï¼Ÿ è®¾è®¡ SharedClassLoader ç±»åŠ è½½å™¨ä½œä¸º WebAppClassLoader ç±»åŠ è½½å™¨çš„çˆ¶ç±»ï¼Œä¸“é—¨æ¥åŠ è½½ Web åº”ç”¨ä¹‹é—´å…±äº«çš„ç±»ï¼Œå­ç±»åŠ è½½ä¸åˆ°çš„ç±»ä¼šå§”æ‰˜çˆ¶åŠ è½½å™¨å»åŠ è½½ã€‚ Tomcatæœ¬èº«çš„ç±»ä¸Webåº”ç”¨çš„ç±»å¦‚ä½•éš”ç¦»ï¼Ÿ è®¾è®¡ CatalinaClassLoader ç±»åŠ è½½å™¨ï¼Œä¸“é—¨åŠ è½½ Tomcat è‡ªèº«çš„ç±»ã€‚ Tomcatæœ¬èº«çš„ç±»ä¸Webåº”ç”¨çš„ç±»å¦‚ä½•éš”å…±äº«æ•°æ®ï¼Ÿ åŒç†ï¼Œè®¾è®¡ CommonClassLoader ä½œä¸ºCatalinaClassLoader å’ŒSharedClassLoader çš„çˆ¶ç±»ã€‚ ","date":"2023-08-08","objectID":"/tomcat/:0:6","tags":["Java"],"title":"ğŸš©Tomcat","uri":"/tomcat/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/rpc_draft/","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"Socket åœ¨java.netåŒ…ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¸¸ç”¨ç±»ï¼š Socketï¼šç”¨äºå®¢æˆ·ç«¯ ServerSocketï¼šç”¨äºæœåŠ¡ç«¯ Socket ç½‘ç»œé€šä¿¡è¿‡ç¨‹åˆ†ä¸º4æ­¥ï¼š å»ºç«‹æœåŠ¡ç«¯ï¼Œç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå»ºç«‹è¿æ¥ ä¼ é€’æ•°æ® å…³é—­èµ„æº å…·ä½“åˆ°æœåŠ¡ç«¯ï¼š åˆ›å»º ServerSocket å¯¹è±¡å¹¶ä¸”ç»‘å®šip+port server.bind(new InetSocketAddress(ip,port)) ç›‘å¬è¯·æ±‚ accept() è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€åˆ°è¯·æ±‚ä¿¡æ¯ é€šè¿‡è¾“å‡ºæµå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ å…³é—­èµ„æº å…·ä½“åˆ°å®¢æˆ·ç«¯ï¼š åˆ›å»º Socket å¯¹è±¡å¹¶è¿æ¥æœåŠ¡å™¨ socket.connect(inetSocketAddress) è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å‡ºæµå‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ä¿¡æ¯ é€šè¿‡è¾“å…¥æµè·å–æœåŠ¡å™¨å“åº”ä¿¡æ¯ å…³é—­èµ„æº ","date":"2023-08-08","objectID":"/rpc_draft/:1:0","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"Serailizable ","date":"2023-08-08","objectID":"/rpc_draft/:2:0","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"1. Serializable æ¥å£ ","date":"2023-08-08","objectID":"/rpc_draft/:2:1","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"2. transient å…³é”®å­— ","date":"2023-08-08","objectID":"/rpc_draft/:2:2","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"3. å„ç§åºåˆ—åŒ– hessian2åºåˆ—åŒ–ï¼šdubbo rpcé»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼ï¼Œæºè‡ª hessian lite jsonåºåˆ—åŒ–ï¼šå¯è¯»æ€§å¼º javaåºåˆ—åŒ–ï¼šæ€§èƒ½ä¸å¥½ Kryoåºåˆ—åŒ–ï¼šä¸“é—¨é’ˆå¯¹Javaè¯­è¨€ï¼Œæ€§èƒ½éå¸¸å¥½ï¼Œæ¨èé¢å‘ç”Ÿäº§ç¯å¢ƒ ProtoBuf/ProtoStuffï¼šè·¨è¯­è¨€åºåˆ—åŒ– ","date":"2023-08-08","objectID":"/rpc_draft/:2:3","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"RPC ","date":"2023-08-08","objectID":"/rpc_draft/:3:0","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"1. åŸºç¡€ ","date":"2023-08-08","objectID":"/rpc_draft/:3:1","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"2. é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç† ","date":"2023-08-08","objectID":"/rpc_draft/:3:2","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"3. å¤šä¸ªPRCæœåŠ¡å¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ TCC+MQ ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ TCCï¼šTry-Confirm-Commit MQï¼šconsumerçš„é‡è¯•æœºåˆ¶ ","date":"2023-08-08","objectID":"/rpc_draft/:3:3","tags":["Network"],"title":"RPC æ‚è®°","uri":"/rpc_draft/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/java_draft/","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["draft"],"content":"11.1 Lambda ","date":"2023-08-08","objectID":"/java_draft/:0:1","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["draft"],"content":"11.2 Stream ","date":"2023-08-08","objectID":"/java_draft/:0:2","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["draft"],"content":"11.3 è®¾è®¡åŸåˆ™å’Œè®¾è®¡æ¨¡å¼ åæ¨¡å¼ï¼šæ­»ç”¨æ¨¡å¼ï¼Œéƒ½æ˜¯åæ¨¡å¼ ","date":"2023-08-08","objectID":"/java_draft/:0:3","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["draft"],"content":"11.4 å•å…ƒæµ‹è¯• ","date":"2023-08-08","objectID":"/java_draft/:0:4","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["draft"],"content":"11.5 Guava ","date":"2023-08-08","objectID":"/java_draft/:0:5","tags":["Java"],"title":"Java æ‚è®°","uri":"/java_draft/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"ä¸€ã€åŸºç¡€çŸ¥è¯† ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:0","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"1. å‡½æ•°å¼ç¼–ç¨‹ å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å‡½æ•°çš„ä¸»è¦æ„æ€æ˜¯â€œæŠŠå‡½æ•°ä½œä¸ºä¸€ç­‰å€¼â€ï¼Œä¸è¿‡å®ƒä¹Ÿå¸¸å¸¸éšå«ç€ç¬¬äºŒå±‚æ„æ€ï¼Œå³â€œæ‰§è¡Œæ—¶åœ¨å…ƒç´ ä¹‹é—´æ— äº’åŠ¨â€ã€‚ å¼•ç”¨é€æ˜æ€§â€”â€”â€œæ²¡æœ‰å¯æ„ŸçŸ¥çš„å‰¯ä½œç”¨â€ ä¸æ”¹å˜å¯¹è°ƒç”¨è€…å¯è§çš„å˜é‡ã€‚è¿”å›çš„ç»“æœåŸºäºå‚æ•°å´æ²¡æœ‰ä¿®æ”¹ä»»ä½•ä¸€ä¸ªä¼ å…¥çš„å‚æ•° ä¸è¿›è¡ŒI/O ä¸æŠ›å‡ºå¼‚å¸¸ é€‰æ‹©ä½¿ç”¨å¼•ç”¨é€æ˜çš„å‡½æ•° ä¹Ÿå…è®¸å‡½æ•°å†…éƒ¨æ‰§è¡Œä¸€äº›éå‡½æ•°å¼çš„æ“ä½œï¼Œåªè¦è¿™äº›æ“ä½œçš„ç»“æœä¸ä¼šæš´éœ²ç»™ç³»ç»Ÿä¸­çš„å…¶ä»–éƒ¨åˆ†ã€‚ä½œä¸ºå‡½æ•°å¼çš„ç¨‹åºï¼Œä½ çš„å‡½æ•°æˆ–æ–¹æ³•è°ƒç”¨çš„åº“å‡½æ•°å¦‚æœæœ‰å‰¯ä½œç”¨ï¼Œä½ å¿…é¡»è®¾æ³•éšè—å®ƒä»¬çš„éå‡½æ•°å¼è¡Œä¸ºï¼Œå¦åˆ™å°±ä¸èƒ½è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ è¢«ç§°ä¸ºâ€œå‡½æ•°å¼â€çš„å‡½æ•°æˆ–æ–¹æ³•éƒ½åªèƒ½ä¿®æ”¹æœ¬åœ°å˜é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒå¼•ç”¨çš„å¯¹è±¡éƒ½åº”è¯¥æ˜¯ä¸å¯ä¿®æ”¹çš„å¯¹è±¡ã€‚ è¦è¢«ç§°ä¸ºå‡½æ•°å¼ï¼Œå‡½æ•°æˆ–è€…æ–¹æ³•ä¸åº”è¯¥æŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚æ—¦æŠ›å‡ºå¼‚å¸¸ï¼Œå°±æ„å‘³ç€ç»“æœè¢«ç»ˆæ­¢äº†ï¼›ä¸å†åƒæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é»‘ç›’æ¨¡å¼é‚£æ ·ï¼Œç”±returnè¿”å›ä¸€ä¸ªæ°å½“çš„ç»“æœå€¼ã€‚ â€”â€” è¯·ä½¿ç”¨Optionalç±»å‹ Optionalç±»ï¼šå®ƒæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œå¯ä»¥åŒ…å«ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ä¸€ä¸ªå€¼ã€‚Optionalä¸­æœ‰æ–¹æ³•æ¥æ˜ç¡®å¤„ç†å€¼ä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¿™æ ·å°±å¯ä»¥é¿å…NullPointerå¼‚å¸¸äº†ã€‚ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:1","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"â˜…2. lambdaè¡¨è¾¾å¼ï¼šè¡Œä¸ºå‚æ•°åŒ–ï¼ˆçµæ´»ã€ç®€æ´ï¼‰ å‡½æ•°å¼æ¥å£ï¼ˆç”¨@FunctionalInterfaceæ ‡è®°ï¼‰ä¸åŒ¿åå†…éƒ¨ç±»ï¼š å‡½æ•°å¼æ¥å£ï¼ˆåŠ å‰ç¼€ï¼šIntã€Doubleã€Longï¼‰ Predicateï¼š T -\u003e boolean ï¼ˆè°“è¯ï¼‰ Consumerï¼š T -\u003e void Functionï¼š T,R -\u003e R Supplierï¼š() -\u003e R èŒƒå‹Tåªèƒ½ç»‘å®šåˆ°å¼•ç”¨ç±»å‹ é—­åŒ…ï¼šé—­åŒ…å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å®ä¾‹ï¼Œä¸”å®ƒå¯ä»¥æ— é™åˆ¶åœ°è®¿é—®é‚£ä¸ªå‡½æ•°çš„éæœ¬åœ°å˜é‡ã€‚ç°åœ¨ï¼ŒJava 8çš„Lambdaå’ŒåŒ¿åç±»å¯ä»¥åšç±»ä¼¼äºé—­åŒ…çš„äº‹æƒ…ï¼šå®ƒä»¬å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®å…¶ä½œç”¨åŸŸä¹‹å¤–çš„å˜é‡ã€‚ä½†æœ‰ä¸€ä¸ªé™åˆ¶ï¼šå®ƒä»¬ä¸èƒ½ä¿®æ”¹å®šä¹‰Lambdaçš„æ–¹æ³•çš„å±€éƒ¨å˜é‡çš„å†…å®¹ã€‚è¿™äº›å˜é‡å¿…é¡»æ˜¯éšå¼æœ€ç»ˆçš„ã€‚å¯ä»¥è®¤ä¸ºLambdaæ˜¯å¯¹å€¼å°é—­ï¼Œè€Œä¸æ˜¯å¯¹å˜é‡å°é—­ã€‚ æ–¹æ³•å¼•ç”¨ï¼šæ ¹æ®å·²æœ‰çš„æ–¹æ³•å®ç°æ¥åˆ›å»ºLambdaè¡¨è¾¾å¼ æŒ‡å‘é™æ€æ–¹æ³• æŒ‡å‘ä»»æ„ç±»å‹å®ä¾‹æ–¹æ³• æŒ‡å‘ç°æœ‰å¯¹è±¡çš„å®ä¾‹æ–¹æ³• æ„é€ å‡½æ•°å¼•ç”¨ï¼šClassName :: new æ¯”è¾ƒå™¨é“¾ï¼š ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:2","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"äºŒã€å‡½æ•°å¼æ•°æ®å¤„ç† ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:2:0","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"â˜…1. æµ ä¸­é—´æ“ä½œï¼šè¿”å›streamç±»å‹ filterï¼šæ’é™¤å…ƒç´ ï¼ŒPredicateï¼ŒT -\u003e boolean mapï¼šæå–ä¿¡æ¯ï¼ŒFunction\u003cT,R\u003e, T -\u003e R limitï¼šæˆªæ–­æµï¼ˆæœ‰çŠ¶æ€-æœ‰ç•Œï¼‰ skipï¼šä¸limitäº’è¡¥ï¼ˆæœ‰çŠ¶æ€-æœ‰ç•Œï¼‰ sortedï¼šæ’åºï¼ŒComparator, (T,T) -\u003e intï¼ˆæœ‰çŠ¶æ€-æ— ç•Œï¼‰ distinctï¼šå»é‡ï¼ˆæœ‰çŠ¶æ€-æ— ç•Œï¼‰ flatMapï¼šè®©ä½ æŠŠä¸€ä¸ªæµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰çš„æµè¿æ¥èµ·æ¥æˆä¸ºä¸€ä¸ªæµ ç»ˆç«¯æ“ä½œï¼šè¿”å›éstreamç±»å‹ collectï¼šè½¬æ¢æˆå…¶ä»–æ ¼å¼ï¼ˆè¿”å›é›†åˆï¼‰ countï¼šè®¡æ•°ï¼ˆè¿”å›longï¼‰ forEachï¼šéå†ï¼ˆè¿”å›voidï¼‰ ï¼ˆä»¥ä¸‹éƒ½æ˜¯çŸ­è·¯æ±‚å€¼ï¼‰ anyMatchï¼šè‡³å°‘åŒ¹é…ä¸€ä¸ªï¼ˆè¿”å›booleanï¼‰ allMatchï¼šéƒ½åŒ¹é…ï¼ˆè¿”å›booleanï¼‰ noneMatchï¼šéƒ½ä¸åŒ¹é…ï¼ˆè¿”å›booleanï¼‰ findAnyï¼šæ‰¾åˆ°ä»»æ„ï¼ˆè¿”å›Optionalç±»ï¼‰ findFirstï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªï¼Œåœ¨å¹¶è¡Œä¸Šé™åˆ¶æ›´å¤šï¼Œå¦‚æœä¸å…³å¿ƒè¿”å›çš„å…ƒç´ æ˜¯å“ªä¸ªï¼Œè¯·ä½¿ç”¨findAnyã€‚ï¼ˆè¿”å›Optionalç±»ï¼‰ reduceï¼š BinaryOperator ï¼Œ(T, T) -\u003e T ï¼ˆè¿”å›Optionalç±»ï¼‰ï¼ˆæœ‰çŠ¶æ€-æœ‰ç•Œï¼‰ æµåªèƒ½æ¶ˆè´¹ä¸€æ¬¡ã€‚ 1-1. åŸå§‹ç±»å‹æµç‰¹åŒ– Java 8å¼•å…¥äº†ä¸‰ä¸ªåŸå§‹ç±»å‹ç‰¹åŒ–æµæ¥å£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šIntStreamã€DoubleStreamå’ŒLongStreamï¼Œåˆ†åˆ«å°†æµä¸­çš„å…ƒç´ ç‰¹åŒ–ä¸ºintã€longå’Œdoubleï¼Œä»è€Œé¿å…äº†æš—å«çš„è£…ç®±æˆæœ¬ã€‚è¦è®°ä½çš„æ˜¯ï¼Œè¿™äº›ç‰¹åŒ–çš„åŸå› å¹¶ä¸åœ¨äºæµçš„å¤æ‚æ€§ï¼Œè€Œæ˜¯è£…ç®±é€ æˆçš„å¤æ‚æ€§â€”â€”å³ç±»ä¼¼intå’ŒIntegerä¹‹é—´çš„æ•ˆç‡å·®å¼‚ã€‚ 1-2. æ˜ å°„åˆ°æ•°æ®æµ è½¬æ¢å›å¯¹è±¡æµ //å°†Streamè½¬æ¢ä¸ºæ•°å€¼æµ IntStream intStream = menu.stream().mapToInt(Dish::getCalories); //å°†æ•°å€¼æµè½¬æ¢ä¸ºStream Stream\u003cInteger\u003e stream = intStream.boxed(); æ•°å€¼èŒƒå›´ rangeæ˜¯ä¸åŒ…å«ç»“æŸå€¼çš„ï¼Œè€ŒrangeClosedåˆ™åŒ…å«ç»“æŸå€¼ã€‚ ç”Ÿæˆå‹¾è‚¡æ•° Stream\u003cint[]\u003e pythagoreanTriples = IntStream.rangeClosed(1, 100).boxed() .flatMap(a -\u003e IntStream.rangeClosed(a, 100) .filter(b -\u003e Math.sqrt(a*a + b*b) % 1 == 0) .mapToObj(b -\u003e new int[]{a, b, (int)Math.sqrt(a * a + b * b)}) ); Stream\u003cdouble[]\u003e pythagoreanTriples2 = IntStream.rangeClosed(1, 100).boxed() .flatMap(a -\u003e IntStream.rangeClosed(a, 100) .mapToObj( b -\u003e new double[]{a, b, Math.sqrt(a*a + b*b)}) .filter(t -\u003e t[2] % 1 == 0)); 1-3. æ— é™æµ(æ–æ³¢é‚£å¥‘æ•°åˆ—) iterateï¼šä½¿ç”¨iterateçš„æ–¹æ³•åˆ™æ˜¯çº¯ç²¹ä¸å˜çš„ï¼šå®ƒæ²¡æœ‰ä¿®æ”¹ç°æœ‰çŠ¶æ€ï¼Œä½†åœ¨æ¯æ¬¡è¿­ä»£æ—¶ä¼šåˆ›å»ºæ–°çš„å…ƒç»„ Stream.iterate(new int[]{0, 1}, t -\u003e new int[]{t[1],t[0] + t[1]}) .limit(10) .map(t -\u003e t[0]) .forEach(System.out::println); //è¿™æ®µä»£ç å°†ç”Ÿæˆæ–æ³¢çº³å¥‘æ•°åˆ—ï¼š0, 1, 1, 2, 3, 5, 8, 13, 21, 34â€¦ generateï¼šgetAsInt()åœ¨è°ƒç”¨æ—¶ä¼šæ”¹å˜å¯¹è±¡çš„çŠ¶æ€ï¼Œç”±æ­¤åœ¨æ¯æ¬¡è°ƒç”¨æ—¶äº§ç”Ÿæ–°çš„å€¼ IntSupplier fib = new IntSupplier(){ private int previous = 0; private int current = 1; public int getAsInt(){ int oldPrevious = this.previous; int nextValue = this.previous + this.current; this.previous = this.current; this.current = nextValue; return oldPrevious; } }; IntStream.generate(fib).limit(10).forEach(System.out::println); 1-4. reduce 1-5. æ”¶é›†å™¨ Collectoræ¥å£ //Tæ˜¯æµä¸­è¦æ”¶é›†çš„é¡¹ç›®çš„æ³›å‹ã€‚ //Aæ˜¯ç´¯åŠ å™¨çš„ç±»å‹ï¼Œç´¯åŠ å™¨æ˜¯åœ¨æ”¶é›†è¿‡ç¨‹ä¸­ç”¨äºç´¯ç§¯éƒ¨åˆ†ç»“æœçš„å¯¹è±¡ã€‚ //Ræ˜¯æ”¶é›†æ“ä½œå¾—åˆ°çš„å¯¹è±¡ï¼ˆé€šå¸¸ä½†å¹¶ä¸ä¸€å®šæ˜¯é›†åˆï¼‰çš„ç±»å‹ã€‚ public interface Collector\u003cT, A, R\u003e { Supplier\u003cA\u003e supplier(); BiConsumer\u003cA, T\u003e accumulator(); Function\u003cA, R\u003e finisher(); BinaryOperator\u003cA\u003e combiner(); Set\u003cCharacteristics\u003e characteristics(); } è‡ªå·±å®ç°æ”¶é›†å™¨ List\u003cDish\u003e dishes = menuStream.collect(new ToListCollector\u003cDish\u003e()); ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:2:1","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"â˜…2. ç”¨ Optional å–ä»£ null nullçš„æ£€æŸ¥åªä¼šæ©ç›–é—®é¢˜ï¼Œå¹¶æœªçœŸæ­£åœ°ä¿®å¤é—®é¢˜ //1. å£°æ˜ä¸€ä¸ªç©ºçš„Optional Optional\u003cCar\u003e optCar = Optional.empty(); //2. ä¾æ®ä¸€ä¸ªéç©ºå€¼åˆ›å»ºOptional //å¦‚æœcaræ˜¯ä¸€ä¸ªnullï¼Œè¿™æ®µä»£ç ä¼šç«‹å³æŠ›å‡ºä¸€ä¸ªNullPointerException Optional\u003cCar\u003e optCar = Optional.of(car); //3. å¯æ¥å—nullçš„Optional //å¦‚æœcaræ˜¯nullï¼Œé‚£ä¹ˆå¾—åˆ°çš„Optionalå¯¹è±¡å°±æ˜¯ä¸ªç©ºå¯¹è±¡ Optional\u003cCar\u003e optCar = Optional.ofNullable(car); public String getCarInsuranceName(Optional\u003cPerson\u003e person) { return person.flatMap(Person::getCar) .flatMap(Car::getInsurance) .map(Insurance::getName) .orElse(\"Unknown\"); //å¦‚æœOptionalçš„ç»“æœå€¼ä¸ºç©ºï¼Œè®¾ç½®é»˜è®¤å€¼ } Optional é€šè¿‡ç±»å‹ç³»ç»Ÿè®©ä½ çš„åŸŸæ¨¡å‹ä¸­éšè—çš„çŸ¥è¯†æ˜¾å¼åœ°ä½“ç°åœ¨ä½ çš„ä»£ç ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œä½ æ°¸è¿œéƒ½ä¸åº”è¯¥å¿˜è®°è¯­è¨€çš„é¦–è¦åŠŸèƒ½å°±æ˜¯æ²Ÿé€šï¼Œå³ä½¿å¯¹ç¨‹åºè®¾è®¡è¯­è¨€è€Œè¨€ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚å£°æ˜æ–¹æ³•æ¥å—ä¸€ä¸ªOptionalå‚æ•°ï¼Œæˆ–è€…å°†ç»“æœä½œä¸ºOptionalç±»å‹è¿”å›ï¼Œè®©ä½ çš„åŒäº‹æˆ–è€…æœªæ¥ä½ æ–¹æ³•çš„ä½¿ç”¨è€…ï¼Œå¾ˆæ¸…æ¥šåœ°çŸ¥é“å®ƒå¯ä»¥æ¥å—ç©ºå€¼ï¼Œæˆ–è€…å®ƒå¯èƒ½è¿”å›ä¸€ä¸ªç©ºå€¼ã€‚ 2-1. Optional çš„æ–¹æ³• get()ï¼šå¦‚æœå˜é‡å­˜åœ¨ï¼Œå®ƒç›´æ¥è¿”å›å°è£…çš„å˜é‡å€¼ï¼Œå¦åˆ™å°±æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸ orElse(T other)ï¼šå…è®¸ä½ åœ¨Optionalå¯¹è±¡ä¸åŒ…å«å€¼æ—¶æä¾›ä¸€ä¸ªé»˜è®¤å€¼ orElseGet(Supplier\u003c? extends T\u003e other)ï¼šæ˜¯orElseæ–¹æ³•çš„å»¶è¿Ÿè°ƒç”¨ç‰ˆï¼ŒSupplier æ–¹æ³•åªæœ‰åœ¨Optionalå¯¹è±¡ä¸å«å€¼æ—¶æ‰æ‰§è¡Œè°ƒç”¨ã€‚å¦‚æœåˆ›å»ºé»˜è®¤å€¼æ˜¯ä»¶è€—æ—¶è´¹åŠ›çš„å·¥ä½œï¼Œä½ åº”è¯¥è€ƒè™‘é‡‡ç”¨è¿™ç§æ–¹å¼ï¼ˆå€Ÿæ­¤æå‡ç¨‹åºçš„æ€§èƒ½ï¼‰ï¼Œæˆ–è€…ä½ éœ€è¦éå¸¸ç¡®å®šæŸä¸ªæ–¹æ³•ä»…åœ¨Optionalä¸ºç©ºæ—¶æ‰è¿›è¡Œè°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘è¯¥æ–¹å¼ï¼ˆè¿™ç§æƒ…å†µæœ‰ä¸¥æ ¼çš„é™åˆ¶æ¡ä»¶ï¼‰ã€‚ orElseThrow(Supplier\u003c? extends X\u003e exceptionSupplier)ï¼šè‡ªå®šä¹‰æŠ›å‡ºå¼‚å¸¸ ifPresent(Consumer\u003c? super T\u003e)ï¼šèƒ½åœ¨å˜é‡å€¼å­˜åœ¨æ—¶æ‰§è¡Œä¸€ä¸ªä½œä¸ºå‚æ•°ä¼ å…¥çš„æ–¹æ³•ï¼Œå¦åˆ™å°±ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ ä¸æ¨èä½¿ç”¨åŸºç¡€ç±»å‹çš„Optionalï¼Œå› ä¸ºåŸºç¡€ç±»å‹çš„Optionalä¸æ”¯æŒmapã€flatMapä»¥åŠfilteræ–¹æ³•ï¼Œè€Œè¿™äº›å´æ˜¯Optionalç±»æœ€æœ‰ç”¨çš„æ–¹æ³•ã€‚ 2-2. å®æˆ˜æ¡ˆä¾‹ // ä½¿ç”¨ Optional å‰ public int readDuration(Properties props, String name) { String value = props.getProperty(name); if (value != null) { try { int i = Integer.parseInt(value); if (i \u003e 0) { return i; } } catch (NumberFormatException nfe) { } } return 0; } // ä½¿ç”¨ Optional å public int readDuration(Properties props, String name) { return Optional.ofNullable(props.getProperty(name)) .flatMap(OptionalUtility::stringToInt) .filter(i -\u003e i \u003e 0) .orElse(0); } ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:2:2","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"3. å†…éƒ¨è¿­ä»£ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:2:3","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"ä¸‰ã€é«˜æ•ˆ Java 8 ç¼–ç¨‹ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:0","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"1. å„ç‰ˆæœ¬å˜åŒ– Java 5ï¼šå¼•å…¥ for-each å¾ªç¯ï¼Œæ›¿ä»£è¿­ä»£å™¨ Java 7ï¼šå¼•å…¥è±å½¢æ“ä½œç¬¦\u003c\u003eï¼Œä½¿ç”¨èŒƒå‹ Java 8ï¼šlambdaè¡¨è¾¾å¼ï¼Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œè®©è®¾è®¡æ¨¡å¼æ›´çµæ´» ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:1","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"ğŸŒŸ2. è®¾è®¡æ¨¡å¼ 2-1. ç­–ç•¥æ¨¡å¼ åœºæ™¯ï¼šæ ¹æ®ä¸åŒæ¡ä»¶è¿›è¡Œç­›é€‰ã€‚ æŸç®—æ³•çš„æ¥å£ æ¥å£çš„å¤šç§å®ç° ç­–ç•¥å¯¹è±¡çš„å®¢æˆ· // 1. ä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼ public interface ValidationStrategy { boolean execute(String s); } public class IsAllLowerCase implements ValidationStrategy { public boolean execute(String s){ return s.matches(\"[a-z]+\"); } } public class IsNumeric implements ValidationStrategy { public boolean execute(String s){ return s.matches(\"\\\\d+\"); } } public class Validator{ private final ValidationStrategy strategy; public Validator(ValidationStrategy v){ this.strategy = v; } public boolean validate(String s){ return strategy.execute(s); } } Validator numericValidator = new Validator(new IsNumeric()); boolean b1 = numericValidator.validate(\"aaaa\"); //FALSE Validator lowerCaseValidator = new Validator(new IsAllLowerCase ()); boolean b2 = lowerCaseValidator.validate(\"bbbb\"); //TRUE // 2. ä½¿ç”¨ Lambda è¡¨è¾¾å¼ Validator numericValidator = new Validator((String s) -\u003e s.matches(\"[a-z]+\")); boolean b1 = numericValidator.validate(\"aaaa\"); Validator lowerCaseValidator = new Validator((String s) -\u003e s.matches(\"\\\\d+\")); boolean b2 = lowerCaseValidator.validate(\"bbbb\"); 2-2. æ¨¡æ¿æ–¹æ³• åœºæ™¯ï¼šéœ€è¦é‡‡ç”¨æŸä¸ªç®—æ³•çš„æ¡†æ¶ï¼ŒåŒæ—¶åˆå¸Œæœ›æœ‰ä¸€å®šçš„çµæ´»åº¦ï¼Œèƒ½å¯¹å®ƒçš„æŸäº›éƒ¨åˆ†è¿›è¡Œæ”¹è¿›ã€‚ // 1. ä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼ abstract class OnlineBanking { public void processCustomer(int id){ Customer c = Database.getCustomerWithId(id); makeCustomerHappy(c); } abstract void makeCustomerHappy(Customer c); } public void processCustomer(int id, Consumer\u003cCustomer\u003e makeCustomerHappy){ Customer c = Database.getCustomerWithId(id); makeCustomerHappy.accept(c); } // 2. ä½¿ç”¨ Lambda è¡¨è¾¾å¼ public void processCustomer(int id, Consumer\u003cCustomer\u003e makeCustomerHappy){ Customer c = Database.getCustomerWithId(id); makeCustomerHappy.accept(c); } new OnlineBankingLambda().processCustomer(1337, (Customer c) -\u003e System.out.println(\"Hello \" + c.getName()); 2-3. è§‚å¯Ÿè€…æ¨¡å¼ åœºæ™¯ï¼šæŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚çŠ¶æ€è½¬å˜ï¼‰ï¼Œsubjectéœ€è¦è‡ªåŠ¨åœ°é€šçŸ¥å…¶ä»–observerã€‚ subjectï¼šä¸»é¢˜ observerï¼šè§‚å¯Ÿè€… // 1. ä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼ interface Observer { void notify(String tweet); } class NYTimes implements Observer{ public void notify(String tweet) { if(tweet != null \u0026\u0026 tweet.contains(\"money\")){ System.out.println(\"Breaking news in NY! \" + tweet); } } } class Guardian implements Observer{ public void notify(String tweet) { if(tweet != null \u0026\u0026 tweet.contains(\"queen\")){ System.out.println(\"Yet another news in London... \" + tweet); } } } interface Subject{ void registerObserver(Observer o); void notifyObservers(String tweet); } class Feed implements Subject{ private final List\u003cObserver\u003e observers = new ArrayList\u003c\u003e(); public void registerObserver(Observer o) { this.observers.add(o); } public void notifyObservers(String tweet) { observers.forEach(o -\u003e o.notify(tweet)); } } Feed f = new Feed(); f.registerObserver(new NYTimes()); f.registerObserver(new Guardian()); //observe â†“â†“â†“ f.notifyObservers(\"The queen said her favourite book is Java 8 in Action!\"); //è¾“å‡ºï¼š //Yet another news in London... //The queen said her favourite book is Java 8 in Action! // 2. ä½¿ç”¨ Lambda è¡¨è¾¾å¼ // ç®€åŒ–äº†è§‚å¯Ÿè€…çš„ä»£ç  interface Subject{ void registerObserver(Observer o); void notifyObservers(String tweet); } class Feed implements Subject{ private final List\u003cObserver\u003e observers = new ArrayList\u003c\u003e(); public void registerObserver(Observer o) { this.observers.add(o); } public void notifyObservers(String tweet) { observers.forEach(o -\u003e o.notify(tweet)); } } Feed f = new Feed(); f.registerObserver((String tweet) -\u003e { if(tweet != null \u0026\u0026 tweet.contains(\"money\")){ System.out.println(\"Breaking news in NY! \" + tweet); } }); f.registerObserver((String tweet) -\u003e { if(tweet != null \u0026\u0026 tweet.contains(\"queen\")){ System.out.println(\"Yet another news in London... \" + tweet); } }); f.notifyObservers(\"The queen said her favourite book is Java 8 in Action!\"); //è¾“å‡ºï¼š //Yet another news in London... //The queen said her favourite book is Java 8 in Action! 2-4. è´£ä»»é“¾æ¨¡å¼ åœºæ™¯ï¼šåˆ›å»ºå¤„ç†å¯¹è±¡åºåˆ—ï¼ˆæ¯”å¦‚æ“ä½œåºåˆ—ï¼‰ å®šä¹‰ä¸€ä¸ªä»£è¡¨å¤„ç†å¯¹è±¡çš„æŠ½è±¡ç±» // 1. ä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼ public abstract class ProcessingObject\u003cT\u003e { protected ProcessingObject\u003cT\u003e successor; public void setSuccessor(ProcessingObject\u003cT\u003e successor){ this.successor = successor; } public T handle(T input){ T r = handleWork(input); if(successor != null){ return successor.handle(r); } return r; } abstract protected T handleWork(T input); } public class HeaderTextProcessing extends ProcessingObject\u003cString\u003e { public String handleWork(String text){ return \"From Raoul, Mario and Alan: \" + text; } } public class SpellCheckerProcessing extends ProcessingObject\u003cString\u003e { public String handleWork(String text){ return text.replaceAll(\"labda\", \"lambda\"); } } ProcessingObject\u003cString\u003e p1 = new HeaderTextProcessing(); ProcessingObject\u003cString\u003e p2 = new SpellCheckerProcessing(); p1.setSuccessor(p2); String result = p1.handle(\"Aren't labdas really sexy?!!\"); System.out.println(result); // 2. ä½¿ç”¨ Lambda è¡¨è¾¾å¼ UnaryOperator\u003cString\u003e headerProcessing = (String text) -\u003e \"From Raoul, Mario and Alan: \" + text; UnaryOperator\u003cString\u003e spellCheckerProcessing = (String text) -\u003e text.replaceAll(\"labda\", \"lambda\"); Function\u003cString, String\u003e pipeline = headerProcessing.andThen(spellCheckerProcessing); String result = pipeline.apply(\"Aren't labdas really sexy?!!\"); 2-5. å·¥å‚æ¨¡å¼ åœºæ™¯ï¼šæ— éœ€å‘å®¢æˆ·æš´éœ²å®ä¾‹åŒ–çš„é€»è¾‘å°±èƒ½å®Œæˆå¯¹è±¡çš„åˆ›å»º // 1. ä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼ public class ProductFactory { public static Product createProduct(String name){ switch(name){ case \"loan\": return new Loan(); case \"stock\": return new Stock(); case \"bond\": return new Bond(); default: throw new RuntimeException(\"No such product \" + name); } } } Product p = ProductFactory.createProduct(\"loan\"); // 2. ä½¿ç”¨ Lambda è¡¨è¾¾å¼ Supplier\u003cProduct\u003e loanSupplier = Loan::new; Loan loan = loanSupplier.get(); final static Map\u003cString, Supplier\u003cProduct\u003e\u003e map = new HashMap\u003c\u003e(); static { map.put(\"loan\", Loan::new); map.put(\"stock\", Stock::new); map.put(\"bond\", Bond::new); } public static Product createProduct(String name){ Supplier\u003cProduct\u003e p = map.get(name); if(p != null) return p.get(); throw new IllegalArgumentException(\"No such product \" + name); } ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:2","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"3. peekæŸ¥çœ‹ä¸­é—´å€¼ List\u003cInteger\u003e numbers = Arrays.asList(2, 3, 4, 5); List\u003cInteger\u003e result = numbers.stream() .peek(x -\u003e System.out.println(\"from stream: \" + x)) .map(x -\u003e x + 17) .peek(x -\u003e System.out.println(\"after map: \" + x)) .filter(x -\u003e x % 2 == 0) .peek(x -\u003e System.out.println(\"after filter: \" + x)) .limit(3) .peek(x -\u003e System.out.println(\"after limit: \" + x)) .collect(toList()); /* è¾“å‡ºï¼š from stream: 2 after map: 19 from stream: 3 after map: 20 after filter: 20 after limit: 20 from stream: 4 after map: 21 from stream: 5 after map: 22 after filter: 22 after limit: 22 */ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:3","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"â˜…4. æ¥å£çš„é»˜è®¤æ–¹æ³• public interface Sized { int size(); default boolean isEmpty() { return size() == 0; } } 4-1. ç»§æ‰¿å’Œå®ç°å†²çªçš„é—®é¢˜ 4-2. ä¸‰æ¡è§„åˆ™ é¦–å…ˆï¼Œç±»æˆ–çˆ¶ç±»ä¸­æ˜¾å¼å£°æ˜çš„æ–¹æ³•ï¼Œå…¶ä¼˜å…ˆçº§é«˜äºæ‰€æœ‰çš„é»˜è®¤æ–¹æ³•ã€‚ å¦‚æœç”¨ç¬¬ä¸€æ¡æ— æ³•åˆ¤æ–­ï¼Œæ–¹æ³•ç­¾ååˆæ²¡æœ‰åŒºåˆ«ï¼Œé‚£ä¹ˆé€‰æ‹©æä¾›æœ€å…·ä½“å®ç°çš„é»˜è®¤æ–¹æ³•çš„æ¥å£ã€‚å‡½æ•°ç­¾åç›¸åŒæ—¶ï¼Œä¼˜å…ˆé€‰æ‹©æ‹¥æœ‰æœ€å…·ä½“å®ç°çš„é»˜è®¤æ–¹æ³•çš„æ¥å£ï¼Œå³å¦‚æœBç»§æ‰¿äº†Aï¼Œé‚£ä¹ˆBå°±æ¯”Aæ›´åŠ å…·ä½“ã€‚ æœ€åï¼Œå¦‚æœå†²çªä¾æ—§æ— æ³•è§£å†³ï¼Œç»§æ‰¿äº†å¤šä¸ªæ¥å£çš„ç±»å¿…é¡»é€šè¿‡æ˜¾å¼è¦†ç›–å’Œè°ƒç”¨æœŸæœ›çš„æ–¹æ³•ï¼Œæ˜¾å¼åœ°é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªé»˜è®¤æ–¹æ³•çš„å®ç°ã€‚ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:4","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"5. ç»„åˆå¼å¼‚æ­¥ç¼–ç¨‹ 5-1. å¹¶å‘ä¸å¹¶è¡Œ â˜…5-2. Future -\u003e CompletableFuture Streamå’ŒCompletableFutureçš„è®¾è®¡éƒ½éµå¾ªäº†ç±»ä¼¼çš„æ¨¡å¼ï¼šå®ƒä»¬éƒ½ä½¿ç”¨äº†Lambdaè¡¨è¾¾å¼ä»¥åŠæµæ°´çº¿çš„æ€æƒ³ã€‚ä»è¿™ä¸ªè§’åº¦ï¼Œä½ å¯ä»¥è¯´ CompletableFutureå’ŒFutureçš„å…³ç³»å°±è·ŸStreamå’ŒCollectionçš„å…³ç³»ä¸€æ ·ã€‚ Collectionä¸»è¦æ˜¯ä¸ºäº†å­˜å‚¨å’Œè®¿é—®æ•°æ®ï¼Œè€ŒStreamåˆ™ä¸»è¦ç”¨äºæè¿°å¯¹æ•°æ®çš„è®¡ç®— é€šè¿‡Streamä½ å¯ä»¥å¯¹ä¸€ç³»åˆ—çš„æ“ä½œè¿›è¡Œæµæ°´çº¿ï¼Œé€šè¿‡mapã€filteræˆ–è€…å…¶ä»–ç±»ä¼¼çš„æ–¹æ³•æä¾›è¡Œä¸ºå‚æ•°åŒ–ï¼Œå®ƒå¯æœ‰æ•ˆé¿å…ä½¿ç”¨è¿­ä»£å™¨æ—¶æ€»æ˜¯å‡ºç°æ¨¡æ¿ä»£ç ã€‚ ç±»ä¼¼åœ°ï¼ŒCompletableFutureæä¾›äº†åƒthenComposeã€thenCombineã€allOfè¿™æ ·çš„æ“ä½œï¼Œå¯¹Futureæ¶‰åŠçš„é€šç”¨è®¾è®¡æ¨¡å¼æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„ç»†ç²’åº¦æ§åˆ¶ï¼Œæœ‰åŠ©äºé¿å…ä½¿ç”¨å‘½ä»¤å¼ç¼–ç¨‹çš„æ¨¡æ¿ä»£ç ã€‚ å®ä¾‹ List\u003cShop\u003e shops = Arrays.asList(new Shop(\"BestPrice\"), new Shop(\"LetsSaveBig\"), new Shop(\"MyFavoriteShop\"), new Shop(\"BuyItAll\")); // 1. é¡ºåºæŸ¥è¯¢ è€—æ—¶ 4032ms public List\u003cString\u003e findPrices(String product) { return shops.stream() .map(shop -\u003e String.format(\"%s price is %.2f\", shop.getName(), shop.getPrice(product))) .collect(toList()); } // 2. å¹¶è¡Œæµ è€—æ—¶ 1180ms public List\u003cString\u003e findPrices(String product) { return shops.parallelStream() .map(shop -\u003e String.format(\"%s price is %.2f\", shop.getName(), shop.getPrice(product))) .collect(toList()); } // 3. ä½¿ç”¨å·¥å‚æ–¹æ³•supplyAsyncåˆ›å»ºCompletableFutureå¯¹è±¡ è€—æ—¶ 2005ms List\u003cCompletableFuture\u003cString\u003e\u003e priceFutures = shops.stream() .map(shop -\u003e CompletableFuture.supplyAsync( () -\u003e String.format(\"%s price is %.2f\", shop.getName(), shop.getPrice(product)))) .collect(toList()); return priceFutures.stream() .map(CompletableFuture::join) .collect(toList()); //å¤„ç†5ä¸ªå•†åº—ï¼Œé¡ºåºæ‰§è¡Œç‰ˆæœ¬è€—æ—¶5025msï¼Œå¹¶è¡Œæµç‰ˆæœ¬è€—æ—¶2177msï¼Œè€ŒCompletableFutureç‰ˆæœ¬è€—æ—¶2006ms //å¤„ç†9ä¸ªå•†åº—ï¼Œå¹¶è¡Œæµç‰ˆæœ¬è€—æ—¶3143msï¼Œè€ŒCompletableFutureç‰ˆæœ¬è€—æ—¶3009ms è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„Streamæµæ°´çº¿ï¼Œè€Œä¸æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†æµçš„æµæ°´çº¿ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ”¾ç½®ä¸¤ä¸ªmapæ“ä½œâ€”â€”è¿™å…¶å®æ˜¯æœ‰ç¼˜ç”±çš„ã€‚è€ƒè™‘æµæ“ä½œä¹‹é—´çš„å»¶è¿Ÿç‰¹æ€§ï¼Œå¦‚æœä½ åœ¨å•ä¸€æµæ°´çº¿ä¸­å¤„ç†æµï¼Œå‘å‘ä¸åŒå•†å®¶çš„è¯·æ±‚åªèƒ½ä»¥åŒæ­¥ã€é¡ºåºæ‰§è¡Œçš„æ–¹å¼æ‰ä¼šæˆåŠŸã€‚å› æ­¤ï¼Œæ¯ä¸ªåˆ›å»ºCompletableFutureå¯¹è±¡åªèƒ½åœ¨å‰ä¸€ä¸ªæ“ä½œç»“æŸä¹‹åæ‰§è¡ŒæŸ¥è¯¢æŒ‡å®šå•†å®¶çš„åŠ¨ä½œã€é€šçŸ¥joinæ–¹æ³•è¿”å›è®¡ç®—ç»“æœã€‚ 5-3. ä½¿ç”¨å®šåˆ¶çš„æ‰§è¡Œå™¨ private final Executor executor = Executors.newFixedThreadPool(Math.min(shops.size(), 100), new ThreadFactory() { public Thread newThread(Runnable r) { Thread t = new Thread(r); //ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹â€”â€”è¿™ç§æ–¹å¼ä¸ä¼šé˜»æ­¢ç¨‹åºçš„å…³åœ t.setDaemon(true); return t; } }); //æ”¹è¿›ä¹‹åï¼Œä½¿ç”¨CompletableFutureæ–¹æ¡ˆçš„ç¨‹åºå¤„ç†5ä¸ªå•†åº—ä»…è€—æ—¶1021msï¼Œå¤„ç†9ä¸ªå•†åº—æ—¶è€—æ—¶1022msã€‚ CompletableFuture.supplyAsync(() -\u003e shop.getName() + \" price is \" + shop.getPrice(product), executor); å®ˆæŠ¤è¿›ç¨‹ Javaç¨‹åºæ— æ³•ç»ˆæ­¢æˆ–è€…é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ‰€ä»¥æœ€åå‰©ä¸‹çš„é‚£ä¸ªçº¿ç¨‹ä¼šç”±äºä¸€ç›´ç­‰å¾…æ— æ³•å‘ç”Ÿçš„äº‹ä»¶è€Œå¼•å‘é—®é¢˜ã€‚ä¸æ­¤ç›¸åï¼Œå¦‚æœå°†çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œæ„å‘³ç€ç¨‹åºé€€å‡ºæ—¶å®ƒä¹Ÿä¼šè¢«å›æ”¶ 5-4. CompletableFuture ä¸ parallelStream çš„é€‰æ‹© å¦‚æœä½ è¿›è¡Œçš„æ˜¯è®¡ç®—å¯†é›†å‹çš„æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰I/Oï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨Streamæ¥å£ï¼Œå› ä¸ºå®ç°ç®€å•ï¼ŒåŒæ—¶æ•ˆç‡ä¹Ÿå¯èƒ½æ˜¯æœ€é«˜çš„ï¼ˆå¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦åˆ›å»ºæ¯”å¤„ç†å™¨æ ¸æ•°æ›´å¤šçš„çº¿ç¨‹ï¼‰ã€‚ åä¹‹ï¼Œå¦‚æœä½ å¹¶è¡Œçš„å·¥ä½œå•å…ƒè¿˜æ¶‰åŠç­‰å¾…I/Oçš„æ“ä½œï¼ˆåŒ…æ‹¬ç½‘ç»œè¿æ¥ç­‰å¾…ï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨CompletableFutureçµæ´»æ€§æ›´å¥½ï¼Œä½ å¯ä»¥åƒå‰æ–‡è®¨è®ºçš„é‚£æ ·ï¼Œä¾æ®ç­‰å¾…/è®¡ç®—ï¼Œæˆ–è€…W/Cçš„æ¯”ç‡è®¾å®šéœ€è¦ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚è¿™ç§æƒ…å†µä¸ä½¿ç”¨å¹¶è¡Œæµçš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œå¤„ç†æµçš„æµæ°´çº¿ä¸­å¦‚æœå‘ç”ŸI/Oç­‰å¾…ï¼Œæµçš„å»¶è¿Ÿç‰¹æ€§ä¼šè®©æˆ‘ä»¬å¾ˆéš¾åˆ¤æ–­åˆ°åº•ä»€ä¹ˆæ—¶å€™è§¦å‘äº†ç­‰å¾…ã€‚ 5-5. join ä¸ get æ–¹æ³•ï¼Œæ„é€ åŒæ­¥å’Œå¼‚æ­¥æ“ä½œ CompletableFutureç±»ä¸­çš„joinæ–¹æ³•å’ŒFutureæ¥å£ä¸­çš„getæœ‰ç›¸åŒçš„å«ä¹‰ï¼Œå¹¶ä¸”ä¹Ÿå£°æ˜åœ¨Futureæ¥å£ä¸­ï¼Œå®ƒä»¬å”¯ä¸€çš„ä¸åŒæ˜¯joinä¸ä¼šæŠ›å‡ºä»»ä½•æ£€æµ‹åˆ°çš„å¼‚å¸¸ã€‚ future.thenCompose public List\u003cString\u003e findPrices(String product) { List\u003cCompletableFuture\u003cString\u003e\u003e priceFutures = shops.stream() //1. è·å–ä»·æ ¼ .map(shop -\u003e CompletableFuture.supplyAsync( () -\u003e shop.getPrice(product), executor)) //2. è§£ææŠ¥ä»· .map(future -\u003e future.thenApply(Quote::parse)) //3. ä¸ºè®¡ç®—æŠ˜æ‰£ä»·æ ¼æ„é€ Future //å¦‚æœä¸å¸Œæœ›ç­‰åˆ°ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œå…¨ç»“æŸæ‰å¼€å§‹ç¬¬äºŒé¡¹ä»»åŠ¡ï¼Œä½¿ç”¨thenCombineæ–¹æ³• .map(future -\u003e future.thenCompose(quote -\u003e CompletableFuture.supplyAsync( () -\u003e Discount.applyDiscount(quote), executor))) .collect(toList()); return priceFutures.stream() .map(CompletableFuture::join) .collect(toList()); } //thenComposeæ–¹æ³•åƒCompletableFutureç±»ä¸­çš„å…¶ä»–æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿæä¾›äº†ä¸€ä¸ªä»¥Asyncåç¼€ç»“å°¾çš„ç‰ˆæœ¬thenComposeAsyncã€‚ //é€šå¸¸è€Œè¨€ï¼Œåç§°ä¸­ä¸å¸¦Asyncçš„æ–¹æ³•å’Œå®ƒçš„å‰ä¸€ä¸ªä»»åŠ¡ä¸€æ ·ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼›è€Œåç§°ä»¥Asyncç»“å°¾çš„æ–¹æ³•ä¼šå°†åç»­çš„ä»»åŠ¡æäº¤åˆ°ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ‰€ä»¥æ¯ä¸ªä»»åŠ¡æ˜¯ç”±ä¸åŒçš„çº¿ç¨‹å¤„ç†çš„ã€‚ //å°±è¿™ä¸ªä¾‹å­è€Œè¨€ï¼Œç¬¬äºŒä¸ªCompletableFutureå¯¹è±¡çš„ç»“æœå–å†³äºç¬¬ä¸€ä¸ªCompletableFutureï¼Œæ‰€ä»¥æ— è®ºä½ ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„æ–¹æ³•æ¥å¤„ç†CompletableFutureå¯¹è±¡ï¼Œå¯¹äºæœ€ç»ˆçš„ç»“æœï¼Œæˆ–è€…å¤§è‡´çš„æ—¶é—´è€Œè¨€éƒ½æ²¡æœ‰å¤šå°‘å·®åˆ«ã€‚ //æˆ‘ä»¬é€‰æ‹©thenComposeæ–¹æ³•çš„åŸå› æ˜¯å› ä¸ºå®ƒæ›´é«˜æ•ˆä¸€äº›ï¼Œå› ä¸ºå°‘äº†å¾ˆå¤šçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚ future.thenCombine Future\u003cDouble\u003e futurePriceInUSD = CompletableFuture.supplyAsync(() -\u003e shop.getPrice(product)) .thenCombine( CompletableFuture.supplyAsync( () -\u003e exchangeService.getRate(Money.EUR, Money.USD)), (price, rate) -\u003e price * rate ); ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:5","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"6. æ–°çš„æ—¥æœŸå’Œæ—¶é—´API 6-1. LocalDate ã€ LocalTime å’Œ LocalDateTime LocalDate date = LocalDate.of(2014, 3, 18); LocalDate date1 = LocalDate.parse(\"2014-03-18\"); LocalTime time1 = LocalTime.parse(\"13:45:20\"); LocalDateTime dt = LocalDateTime.of(2014, Month.MARCH, 18, 13, 45, 20); LocalDate date2 = dt.toLocalDate(); LocalTime time2 = dt.toLocalTime(); Temporalæ¥å£å®šä¹‰äº†å¦‚ä½•è¯»å–å’Œæ“çºµä¸ºæ—¶é—´å»ºæ¨¡çš„å¯¹è±¡çš„å€¼ã€‚ 6-2. å®šä¹‰ Duration æˆ– Period å¾ˆè‡ªç„¶åœ°ä½ ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªTemporalå¯¹è±¡ä¹‹é—´çš„durationã€‚Durationç±»çš„é™æ€å·¥å‚æ–¹æ³•betweenå°±æ˜¯ä¸ºè¿™ä¸ªç›®çš„è€Œè®¾è®¡çš„ã€‚ // Duration å¯¹åº” time Duration d1 = Duration.between(time1, time2); Duration d2 = Duration.between(dateTime1, dateTime2); // Period å¯¹åº” date Period tenDays = Period.ofDays(10); Period threeWeeks = Period.ofWeeks(3); Period twoYearsSixMonthsOneDay = Period.of(2, 6, 1); æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬ä»‹ç»çš„è¿™äº›æ—¥æœŸï€­æ—¶é—´å¯¹è±¡éƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œè¿™æ˜¯ä¸ºäº†æ›´å¥½åœ°æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¿æŒé¢†åŸŸæ¨¡å¼ä¸€è‡´æ€§è€Œåšå‡ºçš„é‡å¤§è®¾è®¡å†³å®šã€‚ 6-3. æ“çºµæ—¥æœŸ // 1. ç»å¯¹ä¿®æ”¹ LocalDate date1 = LocalDate.of(2014, 3, 18); LocalDate date2 = date1.withYear(2011); //2011-03-18 LocalDate date3 = date2.withDayOfMonth(25); //2011-03-25 LocalDate date4 = date3.with(ChronoField.MONTH_OF_YEAR, 9);//2011-09-25 // 2. ç›¸å¯¹ä¿®æ”¹ LocalDate date1 = LocalDate.of(2014, 3, 18); LocalDate date2 = date1.plusWeeks(1); //2014-03-25 LocalDate date3 = date2.minusYears(3); //2011-03-25 LocalDate date4 = date3.plus(6, ChronoUnit.MONTHS); //2011-09-25 //ä¸Šé¢çš„plusæ–¹æ³•ä¹Ÿæ˜¯é€šç”¨æ–¹æ³•ï¼Œå®ƒå’Œminusæ–¹æ³•éƒ½å£°æ˜äºTemporalæ¥å£ä¸­ 6-4. è®¾è®¡ä¸€ä¸ªNextWorkingDayç±» TemporalAdjuster nextWorkingDay = TemporalAdjusters.ofDateAdjuster( temporal -\u003e { DayOfWeek dow = DayOfWeek.of(temporal.get(ChronoField.DAY_OF_WEEK)); int dayToAdd = 1; if (dow == DayOfWeek.FRIDAY) dayToAdd = 3; if (dow == DayOfWeek.SATURDAY) dayToAdd = 2; return temporal.plus(dayToAdd, ChronoUnit.DAYS); }); date = date.with(nextWorkingDay); 6-5. æ—¥æœŸå’Œ String è½¬æ¢ // ä½¿ç”¨ LocalDate çš„ format å’Œ parse æ–¹æ³• LocalDate date = LocalDate.of(2014, 3, 18); String s1 = date.format(DateTimeFormatter.BASIC_ISO_DATE); //20140318 String s2 = date.format(DateTimeFormatter.ISO_LOCAL_DATE); //2014-03-18 LocalDate date1 = LocalDate.parse(\"20140318\", DateTimeFormatter.BASIC_ISO_DATE); LocalDate date2 = LocalDate.parse(\"2014-03-18\", DateTimeFormatter.ISO_LOCAL_DATE); // è‡ªå®šä¹‰æ¨¡å¼ DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"dd/MM/yyyy\"); LocalDate date1 = LocalDate.of(2014, 3, 18); String formattedDate = date1.format(formatter); LocalDate date2 = LocalDate.parse(formattedDate, formatter); ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:6","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"å››ã€è¶…è¶Š Java 8 ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:0","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"1. åŸºäºâ€œå°¾-é€’â€çš„é˜¶ä¹˜ static long factorialTailRecursive(long n) { return factorialHelper(1, n); } static long factorialHelper(long acc, long n) { return n == 1 ? acc : factorialHelper(acc * n, n-1); } è¿™ç§å½¢å¼çš„é€’å½’æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸éœ€è¦åœ¨ä¸åŒçš„æ ˆå¸§ä¸Šä¿å­˜æ¯æ¬¡é€’å½’è®¡ç®—çš„ä¸­é—´å€¼ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿè‡ªè¡Œå†³å®šå¤ç”¨æŸä¸ªæ ˆå¸§è¿›è¡Œè®¡ç®—ã€‚å®é™…ä¸Šï¼Œåœ¨factorialHelperçš„å®šä¹‰ä¸­ï¼Œç«‹å³æ•°ï¼ˆé˜¶ä¹˜è®¡ç®—çš„ä¸­é—´ç»“æœï¼‰ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†è¯¥æ–¹æ³•ã€‚å†ä¹Ÿä¸ç”¨ä¸ºæ¯ä¸ªé€’å½’è°ƒç”¨åˆ†é…å•ç‹¬çš„æ ˆå¸§ç”¨äºè·Ÿè¸ªæ¯æ¬¡é€’å½’è°ƒç”¨çš„ä¸­é—´å€¼â€”â€”é€šè¿‡æ–¹æ³•çš„å‚æ•°èƒ½å¤Ÿç›´æ¥è®¿é—®è¿™äº›å€¼ã€‚ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:1","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"2. ç§‘é‡ŒåŒ–ï¼ˆcurryï¼‰ static DoubleUnaryOperator curriedConverter(double f, double b){ return (double x) -\u003e x * f + b; } DoubleUnaryOperator convertCtoF = curriedConverter(9.0/5, 32); DoubleUnaryOperator convertUSDtoGBP = curriedConverter(0.6, 0); DoubleUnaryOperator convertKmtoMi = curriedConverter(0.6214, 0); ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:2","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"3. Scala å£°æ˜å˜é‡ s : String åˆ›å»ºé›†åˆval authorsToAge = Map(\"Raoul\" -\u003e 23, \"Mario\" -\u003e 40, \"Alan\" -\u003e 53) val è¡¨ç¤ºä¸å¯å˜ï¼Œvarè¡¨ç¤ºå¯å˜ æ”¯æŒä»»æ„å¤§å°çš„å…ƒç»„ val book = (2014, \"Java 8 in Action\", \"Manning\") //å…ƒç»„ç±»å‹ä¸º(Int, String, String) val numbers = (42, 1337, 0, 3, 14) println(book._1) //2014 println(numbers._4) //3 Scalaä¸­çš„Streamå¯ä»¥è®°å½•å®ƒæ›¾ç»è®¡ç®—å‡ºçš„å€¼ï¼Œæ‰€ä»¥ä¹‹å‰çš„å…ƒç´ å¯ä»¥éšæ—¶è¿›è¡Œè®¿é—®ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒStreamè¿˜è¿›è¡Œäº†ç´¢å¼•ï¼Œæ‰€ä»¥Streamä¸­çš„å…ƒç´ å¯ä»¥åƒListé‚£æ ·é€šè¿‡ç´¢å¼•è®¿é—®ã€‚æ³¨æ„ï¼Œè¿™ç§æŠ‰æ‹©ä¹Ÿé™„å¸¦ç€å¼€é”€ï¼Œç”±äºéœ€è¦å­˜å‚¨è¿™äº›é¢å¤–çš„å±æ€§ï¼Œå’ŒJava 8ä¸­çš„Streamæ¯”èµ·æ¥ï¼ŒScalaç‰ˆæœ¬çš„Streamå†…å­˜çš„ä½¿ç”¨æ•ˆç‡å˜ä½äº†ï¼Œå› ä¸ºScalaä¸­çš„Streaméœ€è¦èƒ½å¤Ÿå›æº¯ä¹‹å‰çš„å…ƒç´ ï¼Œè¿™æ„å‘³ç€ä¹‹å‰è®¿é—®è¿‡çš„å…ƒç´ éƒ½éœ€è¦åœ¨å†…å­˜â€œè®°å½•ä¸‹æ¥â€ï¼ˆå³è¿›è¡Œç¼“å­˜ï¼‰ã€‚ Option: //Java public String getCarInsuranceName(Optional\u003cPerson\u003e person, int minAge) { return person.filter(p -\u003e p.getAge() \u003e= minAge) .flatMap(Person::getCar) .flatMap(Car::getInsurance) .map(Insurance::getName) .orElse(\"Unknown\"); } //Scala def getCarInsuranceName(person: Option[Person], minAge: Int) = person.filter(_.getAge() \u003e= minAge) .flatMap(_.getCar) .flatMap(_.getInsurance) .map(_.getName).getOrElse(\"Unknown\") //åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œä½ ä½¿ç”¨çš„æ˜¯_.getCarï¼ˆå¹¶æœªä½¿ç”¨åœ†æ‹¬å·ï¼‰ï¼Œè€Œä¸æ˜¯_.getCar() ï¼ˆå¸¦åœ†æ‹¬å·ï¼‰ã€‚Scalaè¯­è¨€ä¸­ï¼Œæ‰§è¡Œæ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¦‚æœä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œé‚£ä¹ˆå‡½æ•°çš„åœ†æ‹¬å·æ˜¯å¯ä»¥çœç•¥çš„ã€‚ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:3","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"4. é—­åŒ… é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å®ä¾‹ï¼Œå®ƒå¯ä»¥ä¸å—é™åˆ¶åœ°è®¿é—®è¯¥å‡½æ•°çš„éæœ¬åœ°å˜é‡ã€‚ ä¸è¿‡Java 8ä¸­çš„Lambdaè¡¨è¾¾å¼è‡ªèº«å¸¦æœ‰ä¸€å®šçš„é™åˆ¶ï¼šå®ƒä»¬ä¸èƒ½ä¿®æ”¹å®šä¹‰Lambdaè¡¨è¾¾å¼çš„å‡½æ•°ä¸­çš„æœ¬åœ°å˜é‡å€¼ã€‚è¿™äº›å˜é‡å¿…é¡»éšå¼åœ°å£°æ˜ä¸ºfinalã€‚ è¿™äº›èƒŒæ™¯çŸ¥è¯†æœ‰åŠ©äºæˆ‘ä»¬ç†è§£â€œLambdaé¿å…äº†å¯¹å˜é‡å€¼çš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¯¹å˜é‡çš„è®¿é—®â€ã€‚ ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:4","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"5. trait Scalaè¿˜æä¾›äº†å¦ä¸€ä¸ªéå¸¸æœ‰åŠ©äºæŠ½è±¡å¯¹è±¡çš„ç‰¹æ€§ï¼Œåç§°å«traitã€‚å®ƒæ˜¯Scalaä¸ºå®ç°Javaä¸­çš„æ¥å£è€Œè®¾è®¡çš„æ›¿ä»£å“ã€‚traitä¸­æ—¢å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å¸¦æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ã€‚traitåŒæ—¶è¿˜æ”¯æŒJavaä¸­æ¥å£é‚£æ ·çš„å¤šç»§æ‰¿ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†å®ƒä»¬çœ‹æˆä¸Java 8ä¸­æ¥å£ç±»ä¼¼çš„ç‰¹æ€§ï¼Œå®ƒä»¬éƒ½æ”¯æŒé»˜è®¤æ–¹æ³•ã€‚traitä¸­è¿˜å¯ä»¥åŒ…å«åƒæŠ½è±¡ç±»è¿™æ ·çš„å­—æ®µï¼Œè€ŒJava 8çš„æ¥å£ä¸æ”¯æŒè¿™æ ·çš„ç‰¹æ€§ã€‚é‚£ä¹ˆï¼Œtraitå°±ç±»ä¼¼äºæŠ½è±¡ç±»å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œå› ä¸ºtraitæ”¯æŒå¤šç»§æ‰¿ï¼Œè€ŒæŠ½è±¡ç±»ä¸æ”¯æŒå¤šç»§æ‰¿ã€‚Javaæ”¯æŒç±»å‹çš„å¤šç»§æ‰¿ï¼Œå› ä¸ºä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚ç°åœ¨ï¼ŒJava 8é€šè¿‡é»˜è®¤æ–¹æ³•åˆå¼•å…¥äº†å¯¹è¡Œä¸ºçš„å¤šç»§æ‰¿ï¼Œä¸è¿‡å®ƒä¾æ—§ä¸æ”¯æŒå¯¹çŠ¶æ€çš„å¤šç»§æ‰¿ï¼Œè€Œè¿™æ°æ°æ˜¯traitæ”¯æŒçš„ã€‚ trait Sized{ var size : Int = 0 def isEmpty() = size == 0 //å¸¦é»˜è®¤å®ç°çš„isEmptyæ–¹æ³• } class Empty extends Sized println(new Empty().isEmpty()) class Box val b1 = new Box() with Sized //åœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶æ„å»ºtrait println(b1.isEmpty()) val b2 = new Box() b2.isEmpty() //ç¼–è¯‘é”™è¯¯ï¼šå› ä¸ºBoxç±»çš„å£°æ˜å¹¶æœªç»§æ‰¿Sized ","date":"2023-08-08","objectID":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:5","tags":["Java"],"title":"ã€ŠJava8å®æˆ˜ã€‹ç¬”è®°","uri":"/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["interview"],"content":"å­¦ä¹  Java å¿…é¡»æŒæ¡çš„åŸºç¡€çŸ¥è¯†","date":"2023-08-08","objectID":"/java_base/","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"å…ƒæ³¨è§£ @Retentionç”¨äºæ ‡æ˜æ³¨è§£è¢«ä¿ç•™çš„é˜¶æ®µ RetentionPolicy SOURCE æºæ–‡ä»¶ä¿ç•™ CLASS ç¼–è¯‘æœŸä¿ç•™ï¼Œé»˜è®¤å€¼ï¼ˆ.classï¼šRuntimeInvisibleAnnotationsï¼‰ RUNTIME è¿è¡ŒæœŸä¿ç•™ï¼Œå¯é€šè¿‡åå°„å»è·å–æ³¨è§£ä¿¡æ¯ï¼ˆ.classï¼š RuntimeVisibleAnnotationsï¼‰ @Targetç”¨äºæ ‡æ˜æ³¨è§£ä½¿ç”¨çš„èŒƒå›´ ElementType @Inheritedç”¨äºæ ‡æ˜æ³¨è§£å¯ç»§æ‰¿ ","date":"2023-08-08","objectID":"/java_base/:0:1","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"åå°„ åå°„ç±»åŠåå°„æ–¹æ³•çš„è·å–ï¼Œéƒ½æ˜¯é€šè¿‡ä»åˆ—è¡¨ä¸­æœå¯»æŸ¥æ‰¾åŒ¹é…çš„æ–¹æ³•ï¼Œæ‰€ä»¥æŸ¥æ‰¾æ€§èƒ½ä¼šéšç±»çš„å¤§å°æ–¹æ³•å¤šå°‘è€Œå˜åŒ–ï¼› æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„Classå®ä¾‹ï¼Œä»è€Œæ¯ä¸ªç±»éƒ½å¯ä»¥è·å–methodåå°„æ–¹æ³•ï¼Œå¹¶ä½œç”¨åˆ°å…¶ä»–å®ä¾‹èº«ä¸Šï¼› åå°„ä¹Ÿæ˜¯è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¾å¿ƒä½¿ç”¨ï¼› åå°„ä½¿ç”¨è½¯å¼•ç”¨relectionDataç¼“å­˜classä¿¡æ¯ï¼Œé¿å…æ¯æ¬¡é‡æ–°ä»jvmè·å–å¸¦æ¥çš„å¼€é”€ï¼› åå°„è°ƒç”¨å¤šæ¬¡ç”Ÿæˆæ–°ä»£ç†Accessor, è€Œé€šè¿‡å­—èŠ‚ç ç”Ÿå­˜çš„åˆ™è€ƒè™‘äº†å¸è½½åŠŸèƒ½ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨ç‹¬ç«‹çš„ç±»åŠ è½½å™¨ï¼› invokeæ—¶ï¼Œæ˜¯é€šè¿‡ MethodAccessor è¿›è¡Œè°ƒç”¨çš„ï¼Œè€Œ MethodAccessor æ˜¯ä¸ªæ¥å£ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ—¶è°ƒç”¨ acquireMethodAccessor() è¿›è¡Œæ–°åˆ›å»ºã€‚ è¿›è¡Œ ma.invoke(obj, args); è°ƒç”¨æ—¶ï¼Œè°ƒç”¨ DelegatingMethodAccessorImpl.invoke();æœ€åè¢«å§”æ‰˜åˆ° NativeMethodAccessorImpl.invoke() åœ¨ClassDefiner.defineClassæ–¹æ³•å®ç°ä¸­ï¼Œæ¯è¢«è°ƒç”¨ä¸€æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªDelegatingClassLoaderç±»åŠ è½½å™¨å¯¹è±¡ ï¼Œè¿™é‡Œæ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„ç±»åŠ è½½å™¨ï¼Œæ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å¸è½½è¿™äº›ç”Ÿæˆçš„ç±»ï¼Œå› ä¸ºç±»çš„å¸è½½æ˜¯åªæœ‰åœ¨ç±»åŠ è½½å™¨å¯ä»¥è¢«å›æ”¶çš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶çš„ï¼Œå¦‚æœç”¨äº†åŸæ¥çš„ç±»åŠ è½½å™¨ï¼Œé‚£å¯èƒ½å¯¼è‡´è¿™äº›æ–°åˆ›å»ºçš„ç±»ä¸€ç›´æ— æ³•è¢«å¸è½½ã€‚è€Œåå°„ç”Ÿæˆçš„ç±»ï¼Œæœ‰æ—¶å€™å¯èƒ½ç”¨äº†å°±å¯ä»¥å¸è½½äº†ï¼Œæ‰€ä»¥ä½¿ç”¨å…¶ç‹¬ç«‹çš„ç±»åŠ è½½å™¨ï¼Œä»è€Œä½¿å¾—æ›´å®¹æ˜“æ§åˆ¶åå°„ç±»çš„ç”Ÿå‘½å‘¨æœŸã€‚ å½“æ‰¾åˆ°éœ€è¦çš„æ–¹æ³•ï¼Œéƒ½ä¼šcopyä¸€ä»½å‡ºæ¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸæ¥çš„å®ä¾‹ï¼Œä»è€Œä¿è¯æ•°æ®éš”ç¦»ï¼› è°ƒåº¦åå°„æ–¹æ³•ï¼Œæœ€ç»ˆæ˜¯ç”±jvmæ‰§è¡Œinvoke0()æ‰§è¡Œï¼› ","date":"2023-08-08","objectID":"/java_base/:0:2","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"API vs SPIï¼Ÿ SPI - â€œæ¥å£â€ä½äºâ€œè°ƒç”¨æ–¹â€æ‰€åœ¨çš„â€œåŒ…â€ä¸­ æ¦‚å¿µä¸Šæ›´ä¾èµ–è°ƒç”¨æ–¹ã€‚ ç»„ç»‡ä¸Šä½äºè°ƒç”¨æ–¹æ‰€åœ¨çš„åŒ…ä¸­ã€‚ å®ç°ä½äºç‹¬ç«‹çš„åŒ…ä¸­ã€‚ å¸¸è§çš„ä¾‹å­æ˜¯ï¼šæ’ä»¶æ¨¡å¼çš„æ’ä»¶ã€‚ ä½¿ç”¨SPIæœºåˆ¶çš„ç¼ºé™·ï¼š ä¸èƒ½æŒ‰éœ€åŠ è½½ï¼Œéœ€è¦éå†æ‰€æœ‰çš„å®ç°ï¼Œå¹¶å®ä¾‹åŒ–ï¼Œç„¶ååœ¨å¾ªç¯ä¸­æ‰èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å®ç°ã€‚å¦‚æœä¸æƒ³ç”¨æŸäº›å®ç°ç±»ï¼Œæˆ–è€…æŸäº›ç±»å®ä¾‹åŒ–å¾ˆè€—æ—¶ï¼Œå®ƒä¹Ÿè¢«è½½å…¥å¹¶å®ä¾‹åŒ–äº†ï¼Œè¿™å°±é€ æˆäº†æµªè´¹ã€‚ è·å–æŸä¸ªå®ç°ç±»çš„æ–¹å¼ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½é€šè¿‡ Iterator å½¢å¼è·å–ï¼Œä¸èƒ½æ ¹æ®æŸä¸ªå‚æ•°æ¥è·å–å¯¹åº”çš„å®ç°ç±»ã€‚ å¤šä¸ªå¹¶å‘å¤šçº¿ç¨‹ä½¿ç”¨ ServiceLoader ç±»çš„å®ä¾‹æ˜¯ä¸å®‰å…¨çš„ã€‚ API - â€œæ¥å£â€ä½äºâ€œå®ç°æ–¹â€æ‰€åœ¨çš„â€œåŒ…â€ä¸­ æ¦‚å¿µä¸Šæ›´æ¥è¿‘å®ç°æ–¹ã€‚ ç»„ç»‡ä¸Šä½äºå®ç°æ–¹æ‰€åœ¨çš„åŒ…ä¸­ã€‚ å®ç°å’Œæ¥å£åœ¨ä¸€ä¸ªåŒ…ä¸­ã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:3","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"happens-beforeè§„åˆ™ï¼Ÿ Java è™šæ‹Ÿæœºåœ¨è¿›è¡Œä»£ç ç¼–è¯‘ä¼˜åŒ–æ—¶ï¼Œä¼šå‡ºç°æŒ‡ä»¤é‡æ’åºé—®é¢˜ï¼Œä¸ºäº†é¿å…ç¼–è¯‘ä¼˜åŒ–å¯¹å¹¶å‘ç¼–ç¨‹å®‰å…¨æ€§çš„å½±å“ï¼ŒJava è™šæ‹Ÿæœºéœ€è¦ happens-before è§„åˆ™é™åˆ¶æˆ–ç¦æ­¢ç¼–è¯‘ä¼˜åŒ–çš„åœºæ™¯ï¼Œä¿è¯ç³»ç»Ÿå¹¶å‘çš„å®‰å…¨æ€§ã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:4","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"ä¸ºä»€ä¹ˆé‡‘é¢ä¸èƒ½ä½¿ç”¨doubleï¼Œè¦ä½¿ç”¨BigDecimalï¼Ÿ æµ®ç‚¹æ•°ä¸ç²¾ç¡®çš„æ ¹æœ¬åŸå› åœ¨äºå°¾æ•°éƒ¨åˆ†çš„ä½æ•°æ˜¯å›ºå®šçš„ï¼Œä¸€æ—¦éœ€è¦è¡¨ç¤ºçš„æ•°å­—çš„ç²¾åº¦é«˜äºæµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œé‚£ä¹ˆå¿…ç„¶äº§ç”Ÿè¯¯å·®ï¼è¿™åœ¨å¤„ç†é‡‘èæ•°æ®çš„æƒ…å†µä¸‹æ˜¯ç»å¯¹ä¸å…è®¸å­˜åœ¨çš„ã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:5","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€å¹»è±¡å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¼ºå¼•ç”¨ï¼Œå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œåªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜â€œæ´»ç€â€ï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šç¢°è¿™ç§å¯¹è±¡ã€‚å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸º nullï¼Œå°±æ˜¯å¯ä»¥è¢«åƒåœ¾æ”¶é›†çš„äº†ï¼Œå½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥ã€‚ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼Œæ˜¯ä¸€ç§ç›¸å¯¹å¼ºå¼•ç”¨å¼±åŒ–ä¸€äº›çš„å¼•ç”¨ï¼Œå¯ä»¥è®©å¯¹è±¡è±å…ä¸€äº›åƒåœ¾æ”¶é›†ï¼Œåªæœ‰å½“ JVM è®¤ä¸ºå†…å­˜ä¸è¶³æ—¶ï¼Œæ‰ä¼šå»è¯•å›¾å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚JVM ä¼šç¡®ä¿åœ¨æŠ›å‡º OutOfMemoryError ä¹‹å‰ï¼Œæ¸…ç†è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ï¼Œå¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚ åå°„ä½¿ç”¨è½¯å¼•ç”¨relectionDataç¼“å­˜classä¿¡æ¯ï¼Œé¿å…æ¯æ¬¡é‡æ–°ä»jvmè·å–å¸¦æ¥çš„å¼€é”€ï¼› å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰å¹¶ä¸èƒ½ä½¿å¯¹è±¡è±å…åƒåœ¾æ”¶é›†ï¼Œä»…ä»…æ˜¯æä¾›ä¸€ç§è®¿é—®åœ¨å¼±å¼•ç”¨çŠ¶æ€ä¸‹å¯¹è±¡çš„é€”å¾„ã€‚è¿™å°±å¯ä»¥ç”¨æ¥æ„å»ºä¸€ç§æ²¡æœ‰ç‰¹å®šçº¦æŸçš„å…³ç³»ï¼Œæ¯”å¦‚ï¼Œç»´æŠ¤ä¸€ç§éå¼ºåˆ¶æ€§çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœè¯•å›¾è·å–æ—¶å¯¹è±¡è¿˜åœ¨ï¼Œå°±ä½¿ç”¨å®ƒï¼Œå¦åˆ™é‡ç°å®ä¾‹åŒ–ã€‚å®ƒåŒæ ·æ˜¯å¾ˆå¤šç¼“å­˜å®ç°çš„é€‰æ‹©ã€‚ è™šå¼•ç”¨ï¼Œä½ ä¸èƒ½é€šè¿‡å®ƒè®¿é—®å¯¹è±¡ã€‚å¹»è±¡å¼•ç”¨ä»…ä»…æ˜¯æä¾›äº†ä¸€ç§ç¡®ä¿å¯¹è±¡è¢« finalize ä»¥åï¼ŒåšæŸäº›äº‹æƒ…çš„æœºåˆ¶ï¼Œæ¯”å¦‚ï¼Œé€šå¸¸ç”¨æ¥åšæ‰€è°“çš„ Post-Mortem æ¸…ç†æœºåˆ¶ï¼Œæˆ‘åœ¨ä¸“æ ä¸Šä¸€è®²ä¸­ä»‹ç»çš„ Java å¹³å°è‡ªèº« Cleaner æœºåˆ¶ç­‰ï¼Œä¹Ÿæœ‰äººåˆ©ç”¨å¹»è±¡å¼•ç”¨ç›‘æ§å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:6","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"NIO Bufferï¼šé«˜æ•ˆçš„æ•°æ®å®¹å™¨ï¼Œé™¤äº†å¸ƒå°”ç±»å‹ï¼Œæ‰€æœ‰åŸå§‹æ•°æ®ç±»å‹éƒ½æœ‰ç›¸åº”çš„ Buffer å®ç°ã€‚ Channelï¼šç±»ä¼¼åœ¨ Linux ä¹‹ç±»æ“ä½œç³»ç»Ÿä¸Šçœ‹åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ˜¯ NIO ä¸­è¢«ç”¨æ¥æ”¯æŒæ‰¹é‡å¼ IO æ“ä½œçš„ä¸€ç§æŠ½è±¡ã€‚File æˆ–è€… Socketï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ¯”è¾ƒé«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œè€Œ Channel åˆ™æ˜¯æ›´åŠ æ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸€ç§æŠ½è±¡ï¼Œè¿™ä¹Ÿä½¿å¾— NIO å¾—ä»¥å……åˆ†åˆ©ç”¨ç°ä»£æ“ä½œç³»ç»Ÿåº•å±‚æœºåˆ¶ï¼Œè·å¾—ç‰¹å®šåœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼ŒDMAï¼ˆDirect Memory Accessï¼‰ç­‰ã€‚ä¸åŒå±‚æ¬¡çš„æŠ½è±¡æ˜¯ç›¸äº’å…³è”çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Socket è·å– Channelï¼Œåä¹‹äº¦ç„¶ã€‚ Selectorï¼šæ˜¯ NIO å®ç°å¤šè·¯å¤ç”¨çš„åŸºç¡€ï¼Œå®ƒæä¾›äº†ä¸€ç§é«˜æ•ˆçš„æœºåˆ¶ï¼Œå¯ä»¥æ£€æµ‹åˆ°æ³¨å†Œåœ¨ Selector ä¸Šçš„å¤šä¸ª Channel ä¸­ï¼Œæ˜¯å¦æœ‰ Channel å¤„äºå°±ç»ªçŠ¶æ€ï¼Œè¿›è€Œå®ç°äº†å•çº¿ç¨‹å¯¹å¤š Channel çš„é«˜æ•ˆç®¡ç†ã€‚ Charsetï¼šæä¾› Unicode å­—ç¬¦ä¸²å®šä¹‰ï¼ŒNIO ä¹Ÿæä¾›äº†ç›¸åº”çš„ç¼–è§£ç å™¨ç­‰ NIO å¼•å…¥çš„å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œå¯ä½œä¸ºçº¿ç¨‹æ± æœºåˆ¶çš„å¹³æ›¿ï¼š public class NIOServer extends Thread { public void run() { try (Selector selector = Selector.open(); ServerSocketChannel serverSocket = ServerSocketChannel.open();) {// åˆ›å»ºSelectorå’ŒChannel serverSocket.bind(new InetSocketAddress(InetAddress.getLocalHost(), 8888)); // Qï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ˜ç¡®é…ç½®éé˜»å¡æ¨¡å¼å‘¢ï¼Ÿ serverSocket.configureBlocking(false); // æ³¨å†Œåˆ°Selectorï¼Œå¹¶è¯´æ˜å…³æ³¨ç‚¹ serverSocket.register(selector, SelectionKey.OP_ACCEPT); while (true) { selector.select();// é˜»å¡ç­‰å¾…å°±ç»ªçš„Channelï¼Œè¿™æ˜¯å…³é”®ç‚¹ä¹‹ä¸€ Set\u003cSelectionKey\u003e selectedKeys = selector.selectedKeys(); Iterator\u003cSelectionKey\u003e iter = selectedKeys.iterator(); while (iter.hasNext()) { SelectionKey key = iter.next(); // ç”Ÿäº§ç³»ç»Ÿä¸­ä¸€èˆ¬ä¼šé¢å¤–è¿›è¡Œå°±ç»ªçŠ¶æ€æ£€æŸ¥ sayHelloWorld((ServerSocketChannel) key.channel()); iter.remove(); } } } catch (IOException e) { e.printStackTrace(); } } private void sayHelloWorld(ServerSocketChannel server) throws IOException { try (SocketChannel client = server.accept();) { client.write(Charset.defaultCharset().encode(\"Hello world!\")); } } // çœç•¥äº†ä¸å‰é¢ç±»ä¼¼çš„main } Aï¼šè¿™æ˜¯å› ä¸ºé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ³¨å†Œæ“ä½œæ˜¯ä¸å…è®¸çš„ï¼Œä¼šæŠ›å‡º IllegalBlockingModeException å¼‚å¸¸ã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:7","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"todoï¼šä»€ä¹ˆæ˜¯é›¶æ‹·è´ï¼Ÿ å®šä¹‰ï¼šè®¡ç®—æœºæ‰§è¡ŒIOæ“ä½œæ—¶ï¼ŒCPUä¸éœ€è¦å°†æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨åŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼Œä»è€Œå¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å’ŒCPUçš„æ‹·è´æ—¶é—´ï¼Œæ˜¯ä¸€ç§IOæ“ä½œä¼˜åŒ–æŠ€æœ¯ã€‚ ä¼ ç»Ÿæ‹·è´ï¼š å†…æ ¸ç©ºé—´ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸è®¿é—®çš„åŒºåŸŸï¼Œæ˜¯å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¸»è¦æä¾›è¿›ç¨‹è°ƒåº¦ã€å†…å­˜åˆ†é…ã€è¿æ¥ç¡¬ä»¶èµ„æºç­‰åŠŸèƒ½ï¼› ç”¨æˆ·ç©ºé—´ï¼šç”¨æˆ·åº”ç”¨ç¨‹åºè®¿é—®çš„å†…å­˜åŒºåŸŸã€‚ï¼ˆfopenã€fwriteã€freadï¼‰ ç³»ç»Ÿè°ƒç”¨ï¼šä»ç”¨æˆ·æ€è¿›å…¥å†…æ ¸æ€ï¼Œå‘ç”ŸCPUä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼ˆopenã€writeã€readï¼‰ é›¶æ‹·è´çš„ä¸‰ç§å®ç°æ–¹å¼ï¼š mmap+write sendfile å¸¦æœ‰DMAæ”¶é›†æ‹·è´åŠŸèƒ½çš„sendfile Javaä¸­çš„é›¶æ‹·è´ï¼š ","date":"2023-08-08","objectID":"/java_base/:0:8","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"JIT å¼•å…¥JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘çš„ä¸»è¦ç›®çš„æ˜¯æé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚ä¼ ç»Ÿçš„ç¼–è¯‘æ–¹å¼æ˜¯æå‰å°†æºä»£ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œç„¶ååœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚è€ŒJITç¼–è¯‘æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å°†éƒ¨åˆ†ä»£ç è¿›è¡ŒåŠ¨æ€ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚ JITç¼–è¯‘å™¨ä¼šåœ¨è¿è¡Œæ—¶å¯¹çƒ­ç‚¹ä»£ç è¿›è¡Œç›‘æµ‹å’Œåˆ†æï¼Œçƒ­ç‚¹ä»£ç æŒ‡çš„æ˜¯é¢‘ç¹æ‰§è¡Œçš„ä»£ç å—æˆ–æ–¹æ³•ã€‚ä¸€æ—¦ç¡®å®šæŸæ®µä»£ç æ˜¯çƒ­ç‚¹ä»£ç ï¼ŒJITç¼–è¯‘å™¨ä¼šå°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¹¶ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ‰§è¡Œæ—¶ç›´æ¥ä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦è¿›è¡Œè§£é‡Šå’Œæ‰§è¡Œæºä»£ç çš„æ€§èƒ½æŸè€—ã€‚ é€ƒé€¸åˆ†æ æ˜¯ä¸€ç§é™æ€åˆ†ææŠ€æœ¯ï¼Œç”¨äºç¡®å®šç¨‹åºä¸­çš„å¯¹è±¡æ˜¯å¦é€ƒé€¸å‡ºæ–¹æ³•çš„ä½œç”¨åŸŸã€‚é€ƒé€¸æŒ‡çš„æ˜¯å¯¹è±¡åœ¨æ–¹æ³•å¤–è¢«å¼•ç”¨æˆ–ä¼ é€’ç»™å…¶ä»–æ–¹æ³•ä½¿ç”¨çš„æƒ…å†µ æ ˆä¸Šåˆ†é…å’Œæ ‡é‡æ›¿æ¢ã€‚æ ˆä¸Šåˆ†é…å°†å¯¹è±¡åˆ†é…åœ¨çº¿ç¨‹æ ˆä¸Šï¼Œå‡å°‘å †å†…å­˜çš„ä½¿ç”¨ã€‚ æ ‡é‡æ›¿æ¢å°†å¯¹è±¡æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å­—æ®µï¼Œå­˜å‚¨åœ¨å¯„å­˜å™¨æˆ–æ ˆä¸Šã€‚ ","date":"2023-08-08","objectID":"/java_base/:0:9","tags":["Java"],"title":"ğŸš©Java åŸºç¡€","uri":"/java_base/"},{"categories":["interview"],"content":"jstack çš„ä½¿ç”¨æ–¹å¼/å¦‚ä½•æ’æŸ¥ CPU é£™å‡é—®é¢˜ï¼Ÿ jps -lï¼šå…ˆæ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„ Java è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚ jstack -l 1234 \u003e thread_dump.txtï¼šç”Ÿæˆ Java è¿›ç¨‹çš„çº¿ç¨‹å¿«ç…§ï¼ŒåŒ…æ‹¬æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€çº¿ç¨‹çŠ¶æ€ã€é”ä¿¡æ¯ç­‰ï¼Œä½¿ç”¨ \u003e è¾“å‡ºåˆ°æ–‡ä»¶ ä½¿ç”¨ -lè¾“å‡ºé”çš„ä¿¡æ¯ ä½¿ç”¨ -gc è¾“å‡º gc ä¿¡æ¯ ä½¿ç”¨ VisualVM è¯»å–ä»¥ä¸Šæ–‡ä»¶ï¼Œè¿›è¡Œå¯è§†åŒ–åˆ†æã€‚ CPU å ç”¨ 100% å¯èƒ½æ˜¯ä»€ä¹ˆå¼•èµ·çš„ï¼Ÿ CPUå¯†é›†å‹æ“ä½œï¼š é¢‘ç¹çš„GC; å¦‚æœè®¿é—®é‡å¾ˆé«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„GCç”šè‡³FGCã€‚å½“è°ƒç”¨é‡å¾ˆå¤§æ—¶ï¼Œå†…å­˜åˆ†é…å°†å¦‚æ­¤ä¹‹å¿«ä»¥è‡³äºGCçº¿ç¨‹å°†è¿ç»­æ‰§è¡Œï¼Œè¿™å°†å¯¼è‡´CPUé£™å‡ã€‚ åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å½“ç¨‹åºæ‰§è¡Œxmlè§£ææ—¶ï¼Œè°ƒç”¨é‡ä¼šå¢åŠ ï¼Œä»è€Œå¯¼è‡´CPUå˜æ»¡ã€‚ æ­£åˆ™è¡¨è¾¾å¼ã€‚æˆ‘é‡åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼ä½¿CPUå……æ»¡çš„æƒ…å†µ; åŸå› å¯èƒ½æ˜¯Javaæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨çš„å¼•æ“å®ç°æ˜¯NFAè‡ªåŠ¨æœºï¼Œå®ƒå°†åœ¨å­—ç¬¦åŒ¹é…æœŸé—´æ‰§è¡Œå›æº¯ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢; æœ‰è®¸å¤šå·²å¯åŠ¨çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹çš„çŠ¶æ€åœ¨Blockedï¼ˆé”å®šç­‰å¾…ï¼ŒIOç­‰å¾…ç­‰ï¼‰å’ŒRunningä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚å½“é”äº‰ç”¨æ¿€çƒˆæ—¶ï¼Œè¿™ç§æƒ…å†µå¾ˆå®¹æ˜“å‘ç”Ÿã€‚ æœ‰äº›çº¿ç¨‹æ­£åœ¨æ‰§è¡Œéé˜»å¡æ“ä½œï¼Œä¾‹å¦‚ while(true)è¯­å¥ã€‚å¦‚æœåœ¨ç¨‹åºä¸­è®¡ç®—éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œåˆ™å¯ä»¥ä½¿çº¿ç¨‹ä¼‘çœ ã€‚ ","date":"2023-08-08","objectID":"/linux/:0:1","tags":["Linux"],"title":"ğŸš©Linux é¢è¯•é¢˜","uri":"/linux/"},{"categories":["interview"],"content":"å¦‚ä½•åˆ‡æ¢ jdk ç‰ˆæœ¬ï¼Ÿ sudo update-alternatives --config java ","date":"2023-08-08","objectID":"/linux/:0:2","tags":["Linux"],"title":"ğŸš©Linux é¢è¯•é¢˜","uri":"/linux/"},{"categories":["interview"],"content":"å¦‚ä½•æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Ÿ df -hï¼šå…¶ä¸­ -h é€‰é¡¹å¯ä»¥å°†ç£ç›˜å¤§å°ã€å·²ç”¨ç©ºé—´ã€å¯ç”¨ç©ºé—´ä»¥ GB æˆ– MB æ˜¾ç¤º du -hï¼šé€’å½’åœ°è®¡ç®—ç›®å½•å’Œæ–‡ä»¶çš„å¤§å°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾ç£ç›˜ç©ºé—´å ç”¨å¤§çš„æ–‡ä»¶å’Œç›®å½• du --max-depth=1 -h åªçœ‹ç›®å½•å ç”¨å¤§å° ","date":"2023-08-08","objectID":"/linux/:0:3","tags":["Linux"],"title":"ğŸš©Linux é¢è¯•é¢˜","uri":"/linux/"},{"categories":["interview"],"content":"æŸ¥çœ‹æ—¥å¿—çš„å‘½ä»¤ å®æ—¶ç›‘æ§æ—¥å¿—æœ€å 100 è¡Œ tail -n 100 -f xxx.log æŒ‰è¡Œå·æŸ¥è¯¢ æ”¶å°¾ 100 è¡Œï¼šhead/tail -n 100 ç¬¬ 100-300 è¡Œï¼šcat xx.log | tail -n +100 | head -n 200 æŒ‰æ—¥æœŸæŸ¥è¯¢ sed -nâ€™/2023-06-17 08:00:000/,/2023-06-23 17:00:000/pâ€™ xx.log ä»¥ä¸Šä¸¤ä¸ªæ—¶é—´å¿…é¡»åœ¨æ—¥å¿—ä¸­å‡ºç°è¿‡ æŸ¥è¯¢å¹¶è¾“å‡ºæ—¥å¿— cat -n xx.log | grep â€œerrorâ€ | error.txt çº¿ä¸Šè¯Šæ–­ï¼šArthasï¼ŒæŒ‡å®š ip+port å³å¯ ","date":"2023-08-08","objectID":"/linux/:0:4","tags":["Linux"],"title":"ğŸš©Linux é¢è¯•é¢˜","uri":"/linux/"},{"categories":["interview"],"content":"#{}å’Œ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ #{}æ˜¯é¢„ç¼–è¯‘å¤„ç†ï¼Œ${}æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ã€‚ Mybatis åœ¨å¤„ç†#{}æ—¶ï¼Œä¼šå°† sql ä¸­çš„#{}æ›¿æ¢ä¸º?å·ï¼Œè°ƒç”¨ PreparedStatement çš„set æ–¹æ³•æ¥èµ‹å€¼ï¼› Mybatis åœ¨å¤„ç†${}æ—¶ï¼Œå°±æ˜¯æŠŠ${}æ›¿æ¢æˆå˜é‡çš„å€¼ã€‚ä½¿ç”¨#{}å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢ SQL æ³¨å…¥ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§ã€‚ ä½¿ç”¨ ${} çš„æƒ…å†µ å½“sqlä¸­è¡¨åæ˜¯ä»å‚æ•°ä¸­å–çš„æƒ…å†µ order byæ’åºè¯­å¥ä¸­ï¼Œå› ä¸ºorder by åè¾¹å¿…é¡»è·Ÿå­—æ®µåï¼Œè¿™ä¸ªå­—æ®µåä¸èƒ½å¸¦å¼•å·ï¼Œå¦‚æœå¸¦å¼•å·ä¼šè¢«è¯†åˆ«ä¼šå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å­—æ®µã€‚ ","date":"2023-08-08","objectID":"/mybatis/:0:1","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"Mybatis æ˜¯å¦‚ä½•è¿›è¡Œåˆ†é¡µçš„ï¼Ÿåˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Mybatis ä½¿ç”¨ RowBounds å¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ ResultSet ç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µã€‚å¯ä»¥åœ¨ sql å†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚ åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ Mybatis æä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„ sqlï¼Œç„¶åé‡å†™ sqlï¼Œæ ¹æ® dialect æ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚ ","date":"2023-08-08","objectID":"/mybatis/:0:2","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"Mybatis çš„ä¸€çº§ã€äºŒçº§ç¼“å­˜ï¼Ÿ åŸºäº PerpetualCacheï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª HashMapã€‚ ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰: å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå½“ Session flush æˆ– close æ—¶æ¸…ç©º äºŒçº§ç¼“å­˜ï¼ˆé»˜è®¤å…³é—­ï¼‰ï¼šå­˜å‚¨ä½œç”¨åŸŸä¸º** Mapper(Namespace)** éœ€è¦å®ç° serializable æ¥å£ åªæœ‰ä¼šè¯æäº¤æˆ–å…³é—­åï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®æ‰ä¼šè½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­ C/U/D æ“ä½œåï¼Œè¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚ ","date":"2023-08-08","objectID":"/mybatis/:0:3","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"MyBatis æ‰§è¡Œæµç¨‹ï¼Ÿ è¯»å–é…ç½®æ–‡ä»¶ SqlSessionFactoryï¼šå”¯ä¸€çš„ä¼šè¯å·¥å‚ SqlSessionï¼šå¤šä¸ªä¼šè¯ Executorï¼šæ‰§è¡Œå™¨ï¼Œæ‰§è¡Œæ•°æ®åº“æ“ä½œå¹¶ç»´æŠ¤ç¼“å­˜ MappedStatementï¼šæ˜¯ Executor æ¥å£ä¸­çš„å‚æ•°ï¼Œå°è£…äº†æ˜ å°„ä¿¡æ¯ï¼Œæ¥æ”¶å…¥å‚ï¼Œè¿”å›å‡ºå‚ ","date":"2023-08-08","objectID":"/mybatis/:0:4","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"MyBatis å¼€å¯å»¶è¿ŸåŠ è½½ lazyLoadingEnabled = trueï¼ˆé»˜è®¤falseï¼‰ï¼ŒåŸç†ï¼š ä½¿ç”¨ CGLIB åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨ invoke æ–¹æ³•ï¼Œè‹¥ç›®æ ‡æ–¹æ³•ä¸º nullï¼Œæ‰§è¡Œ SQL é‡æ–°è°ƒç”¨ ","date":"2023-08-08","objectID":"/mybatis/:0:5","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"Java å¯¹è±¡ä¸ MySQL å¯¹è±¡å¦‚ä½•æ˜ å°„ï¼Ÿ MyBatis é»˜è®¤ä½¿ç”¨ JDBC çš„é¢„ç¼–è¯‘è¯­å¥æ¥æ‰§è¡Œ SQL è¯­å¥ã€‚åœ¨å°† String ç±»å‹çš„å‚æ•°ä¼ é€’ç»™ SQL è¯­å¥æ—¶ï¼ŒMyBatis ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º VARCHAR ç±»å‹ã€‚ è‡ªå®šä¹‰ç±»å‹è½¬æ¢ - å®ç° TypeHandler æ¥å£","date":"2023-08-08","objectID":"/mybatis/:0:6","tags":["MyBatis"],"title":"ğŸš©MyBatis é¢è¯•é¢˜","uri":"/mybatis/"},{"categories":["interview"],"content":"Principle åŸåˆ™ x 6 Open Close å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ˆé€šè¿‡æ¥å£å’ŒæŠ½è±¡ç±»ï¼‰ Liskov Substitution é‡Œæ°ä»£æ¢ï¼šå­ç±»å¯æ›¿æ¢çˆ¶ç±» Dependence Inversion ä¾èµ–å€’è½¬ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œéå…·ä½“ Interface Segregation æ¥å£éš”ç¦»ï¼š å¤šä¸ªéš”ç¦»çš„æ¥å£ä¼˜äºå•ä¸ªæ¥å£ï¼Œä»¥è§£è€¦åˆ Demeter è¿ªç±³ç‰¹ï¼šæœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå®ä½“é—´å‡å°‘ç›¸äº’ä½œç”¨ï¼Œæ¨¡å—ç‹¬ç«‹ Composite Reuse åˆæˆå¤ç”¨ï¼šç”¨èšåˆï¼Œè€Œéç»§æ‰¿ã€‚ ","date":"2023-08-08","objectID":"/design-pattern/:0:1","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"Create åˆ›å»ºå‹ x 5 Singleton 6ç§ Prototype å…‹éš†å¤§å¯¹è±¡ Builder å†…éƒ¨ç»“æ„å¤æ‚ï¼Œå…³æ³¨é¡ºåº Factory æ—¥å¿—ã€æ•°æ®åº“ Abstract Factory å¤šä¸ªäº§å“æ—ï¼ˆæ¢çš®è‚¤ï¼‰ ","date":"2023-08-08","objectID":"/design-pattern/:0:2","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"Structure ç»“æ„å‹ x 7 Adapter é€‚é…å™¨ è¡¥æ•‘æªæ–½ Bridge æ¡¥æ¥ æ‰©å±•ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ Composite ç»„åˆ éƒ¨åˆ†-æ•´ä½“ Decorator è£…é¥°å™¨ ä¸å¢åŠ å­ç±»æ¥æ‰©å±•ç±» Facade å¤–è§‚ éšè—ç³»ç»Ÿå¤æ‚æ€§ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ Flyweight äº«å…ƒ ä¸å¯åˆ†è¾¨çš„å¤§é‡å¯¹è±¡ Proxy ä»£ç† åˆ›å»ºå…·æœ‰åŸå¯¹è±¡çš„æ–°å¯¹è±¡ å’Œé€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šé€‚é…å™¨æ¨¡å¼ä¸»è¦æ”¹å˜æ‰€è€ƒè™‘å¯¹è±¡çš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ä¸èƒ½æ”¹å˜æ‰€ä»£ç†ç±»çš„æ¥å£ã€‚ 2ã€å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šè£…é¥°å™¨æ¨¡å¼ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†åŠ ä»¥æ§åˆ¶ã€‚ ","date":"2023-08-08","objectID":"/design-pattern/:0:3","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"Behavior è¡Œä¸ºå‹ x 11 Chain of Responsibility è´£ä»»é“¾ å¤šä¸ªå¯¹è±¡åŒæ—¶å¤„ç†ä¸€ä¸ªè¯·æ±‚ Command å‘½ä»¤ å¯æ”¯æŒæ’¤é”€ã€æ¢å¤æ“ä½œ Interpreter è§£é‡Šå™¨ é«˜é¢‘ã€ç‰¹å®šç±»å‹çš„é—®é¢˜ Iterator è¿­ä»£å™¨ é¡ºåºè®¿é—®èšåˆå¯¹è±¡ Mediator ä¸­ä»‹è€… 1å¯¹nçš„ç½‘çŠ¶ç»“æ„-\u003e1å¯¹1çš„æ˜Ÿå½¢ç»“æ„ Memento å¤‡å¿˜å½• ä¸ºæ»¡è¶³è¿ªç±³ç‰¹åŸåˆ™ï¼Œéœ€è¦ä¸€ä¸ªç®¡ç†å¤‡å¿˜å½•çš„ç±» åŸå‹æ¨¡å¼+å¤‡å¿˜å½•æ¨¡å¼ï¼Œå¯èŠ‚çº¦å†…å­˜ å¸¸ç”¨äºå®ç°æ’¤é”€å’Œé‡åšåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç”¨äºå®ç°æ•°æ®å¿«ç…§ã€äº‹åŠ¡ç®¡ç†ç­‰åº”ç”¨åœºæ™¯ | | Observer è§‚å¯Ÿè€… | æŸå¯¹è±¡é€šçŸ¥å…¶ä»–å¯¹è±¡ | | State çŠ¶æ€ | è¡Œä¸ºéšçŠ¶æ€è€Œæ”¹å˜ï¼Œæ›¿ä»£ ifâ€¦elseâ€¦ è¯­å¥ | | Strategy ç­–ç•¥ | åŠ¨æ€åœ¨å¤šç§è¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§ | | Template æ¨¡æ¿ | æŠ½ç¦»é€šç”¨æ–¹æ³•ï¼ŒåŠ finalä¿®é¥° | | Visitor è®¿é—®è€… | è¿åè¿ªç±³ç‰¹ã€ä¾èµ–å€’è½¬åŸåˆ™ SimpleFileVisitor | ","date":"2023-08-08","objectID":"/design-pattern/:0:4","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"å·¥å‚ï¼ˆåˆ›å»ºï¼‰+ç­–ç•¥ï¼ˆè¡Œä¸ºï¼‰æ¨¡å¼ ä½¿ç”¨åœºæ™¯ï¼šå¤šç§æ–¹å¼ç™»å½•ã€å¤šç§ä»˜æ¬¾æ–¹å¼ã€é˜¶æ¢¯è®¡ç®— types: # key:è¯·æ±‚å‚æ•° account: accountGranter # ç±»åé¦–å­—æ¯æ”¹å°å†™ sms: smsGranter we_chat: weChatGranter @Component public class WeChatGranter implements UserGranter{ @Override public LoginResp login(LoginReq loginReq){ // to do return new LoginResp(); } } @Component public class UserLoginFactory implements ApplicationContextAware{ private static Map\u003cString, UserGranter\u003e granterPool = new ConcurrentHashMap\u003c\u003e(); @Override public void setApplicationContext(ApplicationContext application){ // è·å–å®¹å™¨ä¸­çš„ bean å¯¹è±¡ loginTypeConfig.getTypes().forEach((k,v)-\u003e{ granterPool.put(k,(UserGranter) application.getBean(b)); }); } // å¯¹å¤–å¼€æ”¾ public UserGranter getGranter(String grantType){ return granterPool.get(grantType); } } ","date":"2023-08-08","objectID":"/design-pattern/:0:5","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"å•ç‚¹ç™»å½• SSO = Single Sign On ä¸€æ¬¡ç™»å½•ï¼Œè®¿é—®æ‰€æœ‰ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚ é›†æˆè®¤è¯ä¸­å¿ƒåˆ°åº”ç”¨ç³»ç»Ÿä¸­ï¼Œå¦‚ spring-security-oauth2 åœ¨è®¤è¯ä¸­å¿ƒä¸­é…ç½®åº”ç”¨ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº”ç”¨åç§°ã€åŸŸåã€å›è°ƒåœ°å€ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·åˆ†é…å”¯ä¸€ id é›†æˆè®¤è¯ä¸­å¿ƒæä¾›çš„ SDK æˆ–åº“ ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œé‡å®šå‘ï¼ˆredirectï¼‰åˆ°è®¤è¯ä¸­å¿ƒè¿›è¡Œç™»å½•ï¼ŒéªŒè¯å®Œèº«ä»½é‡å®šå‘å›åº”ç”¨ç³»ç»Ÿï¼Œåœ¨ URL å‚æ•°ä¸­æºå¸¦ç”¨æˆ·çš„èº«ä»½æ ‡è¯†ç¬¦ è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€äº Session ä¸­ ","date":"2023-08-08","objectID":"/design-pattern/:0:6","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["interview"],"content":"ç®¡é“+è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆChannel+Filterï¼‰ æ‰€æœ‰çš„å¤æ‚å¤„ç†ï¼Œéƒ½å¯ä»¥æŠ½è±¡ä¸ºç®¡é“+è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆChannel+Filterï¼‰ï¼Œç”¨äºæœåŠ¡çš„è¿‡æ»¤ å®ç°é¢å¤–çš„å¢å¼ºå¤„ç†ï¼Œå¦‚AOP ä¸­æ–­å½“å‰å¤„ç†æµç¨‹ï¼Œè¿”å›ç‰¹å®šæ•°æ® ","date":"2023-08-08","objectID":"/design-pattern/:0:7","tags":["Design Pattern"],"title":"ğŸš©Design Pattern - è®¾è®¡æ¨¡å¼","uri":"/design-pattern/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/jvm_draft_2/","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"1.1 å­—èŠ‚ç æŠ€æœ¯ ç¼–è¯‘ï¼šjavac demo/jvm/Xxx.java æŸ¥çœ‹å­—èŠ‚ç ï¼š javap -c demo.jvm.Xxx JVM æ˜¯ä¸€å°åŸºäºæ ˆçš„è®¡ç®—æœºå™¨ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬å±äºè‡ªå·±çš„çº¿ç¨‹æ ˆï¼ˆStackï¼‰ï¼Œç”¨äºå­˜å‚¨æ ˆå¸§ï¼ˆFrameï¼‰ï¼Œæ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨ï¼ŒJVMä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ ˆå¸§ã€‚ æ ˆå¸§ = æ“ä½œæ•°æ ˆ + å±€éƒ¨å˜é‡æ•°ç»„ + Classå¼•ç”¨ï¼ˆæŒ‡å‘å½“å‰æ–¹æ³•åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¯¹åº”çš„Classï¼‰ æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤ï¼š invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œæœ€å¿« invokespecialï¼šè°ƒç”¨æ„é€ å‡½æ•°ã€åŒä¸€ä¸ªç±»ä¸­çš„privateæ–¹æ³•ã€å¯è§çš„è¶…ç±»æ–¹æ³• invokevirtualï¼šè°ƒç”¨publicã€protectedã€packageçº§çš„ç§æœ‰æ–¹æ³• invokeinterfaceï¼šé€šè¿‡æ¥å£å¼•ç”¨æ¥è°ƒç”¨æ–¹æ³• invokedynamicï¼šæ”¯æŒlambdaè¡¨è¾¾å¼çš„å®ç°åŸºç¡€ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:1","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"1.2 ç±»åŠ è½½å™¨ 1.2.1 ç”Ÿå‘½å‘¨æœŸ åŠ è½½ï¼ˆLoadingï¼‰ï¼šæ‰¾ Class æ–‡ä»¶ éªŒè¯ï¼ˆVerificationï¼‰ï¼šéªŒè¯æ ¼å¼ã€ä¾èµ–ã€é“¾æ¥ï¼ˆLinkingï¼‰ã€‘ å‡†å¤‡ï¼ˆPreparationï¼‰ï¼šé™æ€å­—æ®µã€æ–¹æ³•è¡¨ã€é“¾æ¥ï¼ˆLinkingï¼‰ã€‘ è§£æï¼ˆResolutionï¼‰ï¼šç¬¦å·è§£æä¸ºå¼•ç”¨ã€é“¾æ¥ï¼ˆLinkingï¼‰ã€‘ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šæ„é€ å™¨ã€é™æ€å˜é‡èµ‹å€¼ã€é™æ€ä»£ç å— çˆ¶ç±»é™æ€å˜é‡ çˆ¶ç±»é™æ€ä»£ç å— å­ç±»é™æ€å˜é‡ å­ç±»é™æ€ä»£ç å— çˆ¶ç±»éé™æ€å˜é‡ çˆ¶ç±»éé™æ€ä»£ç å— çˆ¶ç±»æ„é€ å‡½æ•° å­ç±»éé™æ€å˜é‡ å­ç±»éé™æ€ä»£ç å— å­ç±»æ„é€ å‡½æ•° é¦–å…ˆï¼Œé™æ€ä¼˜å…ˆäºéé™æ€ï¼Œå…¶æ¬¡ï¼Œçˆ¶ç±»ä¼˜å…ˆäºå­ç±»ï¼Œæœ€åå˜é‡ä¼˜å…ˆäºä»£ç å—ï¼Œå¦å¤–ï¼Œæ„é€ å‡½æ•°å±äºéé™æ€ï¼Œåœ¨ä»£ç å—ä¹‹åæ‰§è¡Œã€‚ ä½¿ç”¨ï¼ˆUsingï¼‰ å¸è½½ï¼ˆUnloadingï¼‰ 1.2.2 ä¸ä¼šåˆå§‹åŒ–çš„æƒ…å†µï¼ˆå¯èƒ½ä¼šåŠ è½½ï¼‰ é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ï¼› å®šä¹‰å¯¹è±¡æ•°ç»„ï¼Œä¸ä¼šè§¦å‘è¯¥ç±»åˆå§‹åŒ–ï¼› å¸¸é‡åœ¨ç¼–è¯‘æœŸé—´ä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨å®šä¹‰å¸¸é‡çš„ç±»ï¼Œä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼› é€šè¿‡ç±»åè·å– Class å¯¹è±¡ï¼Œä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼› é€šè¿‡ Class.forName åŠ è½½æŒ‡å®šç±»æ—¶ï¼Œå¦‚æœæŒ‡å®šå‚æ•° initialize ä¸º false æ—¶ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼Œå¦åˆ™å°±ä¼šåˆå§‹åŒ–ï¼› é€šè¿‡ ClassLoader é»˜è®¤çš„ loadClass æ–¹æ³•ï¼ŒåªåŠ è½½ï¼Œä¸ä¼šåˆå§‹åŒ–ã€‚ 1.2.3 ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰ åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰ ç‰¹ç‚¹ï¼š åŒäº²å§”æ‰˜ è´Ÿè´£ä¾èµ– ç¼“å­˜åŠ è½½ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:2","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"1.3 å†…å­˜æ¨¡å‹ Javaè¿›ç¨‹ç»„æˆï¼š æ ˆ Stack å † Heap å¹´è½»ä»£ Young generation æ–°ç”Ÿä»£ Eden space å­˜æ´»åŒº Survivor spaceï¼šæ€»æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ S0 S1 è€å¹´ä»£ Old generation ï¼ˆè¿›å…¥è€å¹´ä»£é˜ˆå€¼-XX:+MaxTenuringThreshold=15ï¼‰ éå † Non-Heapï¼šæœ¬è´¨ä¸Šè¿˜æ˜¯ Heapï¼Œåªæ˜¯ä¸å½’ GC ç®¡ç† å…ƒæ•°æ®åŒº Metaspace -XX:MaxMetaspaceSize=256m å¸¸é‡æ±  æ–¹æ³•åŒº CCS = Compressed Class Spaceï¼šå­˜æ”¾ class ä¿¡æ¯ï¼Œå’Œ Metaspace æœ‰äº¤å‰ Code Cacheï¼šå­˜æ”¾ JITï¼ˆjust-in-time compilation åŠæ—¶ç¼–è¯‘ï¼‰ ç¼–è¯‘å™¨ç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ä»£ç  JVMè‡ªèº« ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:3","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"1.4 å¯åŠ¨å‚æ•° -Dï¼šè®¾ç½®ç³»ç»Ÿå±æ€§ -Xï¼šéæ ‡å‡†å‚æ•°ï¼ŒåŸºæœ¬éƒ½æ˜¯ä¼ ç»™ JVM çš„ï¼Œé»˜è®¤ JVM å®ç°è¿™äº›å‚æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯æ‰€æœ‰ JVM éƒ½æ»¡è¶³ï¼Œä¹Ÿä¸ä¿è¯å‘åå…¼å®¹ã€‚ -XXï¼šéç¨³å®šå‚æ•°ï¼Œéšæ—¶å¯èƒ½åœ¨ä¸‹ä¸€ç‰ˆæœ¬å–æ¶ˆ -XX:+Use**GCï¼šä½¿ç”¨ G1/ConcMarkSweepã€Serialã€Parallel GC -XX: +UnlockExperimentalVMOptions -XX:+UseZGCï¼šJava 11+ æœ‰ ZGC -XX: +UnlockExperimentalVMOptions -XX:+UseShenandoahGCï¼šJava 12+ æœ‰ Shenandoah GC åˆ†æè¯Šæ–­ # å½“ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ äº§ç”Ÿï¼Œè‡ªåŠ¨ Dump å †å†…å­˜ java -XX:+HeapDumpOnOutOfMemoryError -Xmx256m ConsumeHeap # æŒ‡å®šå†…å­˜æº¢å‡ºæ—¶ Dump æ–‡ä»¶çš„ç›®å½• java -XX:HeapDumpPath=/usr/local/ ConsumeHeap # è‡´å‘½é”™è¯¯çš„æ—¥å¿—æ–‡ä»¶å java -XX:ErrorFile=filename # è¿œç¨‹è°ƒè¯• java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1506 JavaAgent Agentæ—¶JVMä¸­çš„ä¸€é¡¹é»‘ç§‘æŠ€ï¼Œå¯ä»¥é€šè¿‡æ— ä¾µå…¥æ–¹å¼æ³¨å…¥AOPä»£ç æˆ–æ‰§è¡Œç»Ÿè®¡ï¼Œæƒé™éå¸¸å¤§ã€‚ # å¯ç”¨nativeæ–¹å¼çš„agentï¼Œå‚è€ƒ LD_LIBRARY_PATH è·¯å¾„ -agentlib:libname[=options] # å¯ç”¨nativeæ–¹å¼çš„agent -agentpath:pathname[=options] # å¯ç”¨å¤–éƒ¨çš„agentåº“ï¼Œå¦‚pinpoint.jarç­‰ç­‰ -javaagent:jarpath[=options] # ç¦ç”¨æ‰€æœ‰agent -Xnoagent ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:4","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.1 å†…ç½®å‘½ä»¤è¡Œå·¥å…· javapï¼šåç¼–è¯‘classæ–‡ä»¶ jarï¼šæ‰“åŒ…æ–‡ä»¶æˆ–ç›®å½•æˆ.jaræ–‡ä»¶ jpsï¼šæŸ¥çœ‹Javaè¿›ç¨‹ jstatï¼šæŸ¥çœ‹JVMå†…éƒ¨gcç›¸å…³ä¿¡æ¯ -class ç±»åŠ è½½ï¼ˆClassLoaderï¼‰ä¿¡æ¯ç»Ÿè®¡ -compiler JITå³æ—¶ç¼–è¯‘å™¨ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ -gc GCç›¸å…³å †å†…å­˜ä¿¡æ¯ï¼ˆå•ä½ï¼škbï¼‰ -gccapacity å„ä¸ªå†…å­˜æ± åˆ†ä»£ç©ºé—´çš„å®¹é‡ -gccauce çœ‹ä¸Šæ¬¡ã€æœ¬æ¬¡GCçš„åŸå›  -gcnew å¹´è½»ä»£çš„ç»Ÿè®¡ä¿¡æ¯ -gcnewcapacity -gcold è€å¹´ä»£å’Œå…ƒæ•°æ®åŒºçš„è¡Œä¸ºç»Ÿè®¡ -gcoldcapacity -gcmetacapacity -gcutil GCç›¸å…³åŒºåŸŸçš„ä½¿ç”¨ç‡ç»Ÿè®¡ï¼ˆå•ä½ï¼š%ï¼‰ -printcompilation æ‰“å°JVMç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ jmapï¼šæŸ¥çœ‹heapæˆ–ç±»å ç”¨ç©ºé—´ç»Ÿè®¡ -heap [pid]æ‰“å°å †å†…å­˜çš„é…ç½®å’Œä½¿ç”¨ä¿¡æ¯ -histo [pid]çœ‹å“ªä¸ªç±»å ç”¨çš„ç©ºé—´æœ€å¤šï¼Œç›´æ–¹å›¾ -dump:format=b,file=xxxx.hprof [pid] å¤‡ä»½å †å†…å­˜ jstackï¼šæŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ -Fï¼šå¼ºåˆ¶æ‰§è¡Œ thread dumpï¼Œå¯åœ¨Javaè¿›ç¨‹å¡æ­»æ—¶ä½¿ç”¨ -mï¼šæ··åˆæ¨¡å¼ï¼Œå°† Java å¸§å’Œ native å¸§ä¸€èµ·è¾“å‡º -lï¼šé•¿åˆ—è¡¨æ¨¡å¼ï¼Œå°†çº¿ç¨‹ç›¸å…³çš„locksä¿¡æ¯ä¸€èµ·è¾“å‡ºï¼Œæ¯”å¦‚æŒæœ‰çš„é”ï¼Œç­‰å¾…çš„é” jcmd pid helpï¼šç»¼åˆäº†å‰é¢å‡ ä¸ªå‘½ä»¤ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:5","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.2 å†…ç½®å›¾å½¢åŒ–å·¥å…· jconsole jvisualvm visualgc jmc ç”¨äºå¯¹ Java åº”ç”¨ç¨‹åºè¿›è¡Œç®¡ç†ã€ç›‘è§†ã€æ¦‚è¦åˆ†æå’Œæ•…éšœæ’é™¤çš„å·¥å…·å¥—ä»¶ã€‚ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:6","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.3 GC åŸç† ä¸ºä»€ä¹ˆè¦åˆ†ä»£ï¼Ÿ å¤§éƒ¨åˆ†æ–°ç”Ÿå¯¹è±¡å¾ˆå¿«æ— ç”¨ å­˜æ´»è¾ƒé•¿æ—¶é—´çš„å¯¹è±¡ï¼Œå¯èƒ½å­˜æ´»æ›´é•¿æ—¶é—´ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:7","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.4 ä¸²è¡Œ/å¹¶è¡Œ GC ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:8","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.5 CMS/G1 GC ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:9","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.6 ZGC/Shenandoah GC ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:10","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"2.7 GC æ€»ç»“ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:11","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"3.1 GC æ—¥å¿—è§£è¯»ä¸åˆ†æ -XX:+UseSerialGC -XX:+UseParallelGC -XX:+UseConcMarkSweepGC -XX:+UseG1GC ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:12","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"3.2 JVM çº¿ç¨‹å †æ ˆæ•°æ®åˆ†æ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:13","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"3.3 å†…å­˜åˆ†æä¸ç›¸å…³å·¥å…· å †å†…å­˜æº¢å‡º å…ƒç©ºé—´æº¢å‡º æœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:14","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"3.4 JVM é—®é¢˜åˆ†æè°ƒä¼˜ç»éªŒ ","date":"2023-08-08","objectID":"/jvm_draft_2/:0:15","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆäºŒï¼‰","uri":"/jvm_draft_2/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/jvm_draft_1/","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆä¸€ï¼‰","uri":"/jvm_draft_1/"},{"categories":["draft"],"content":"JVM æ¶æ„æ¨¡å‹ Java ç¼–è¯‘å™¨è¾“å…¥çš„æŒ‡ä»¤æµåŸºæœ¬ä¸Šæ—¶ä¸€ç§åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„ï¼Œé€‚ç”¨äºèµ„æºå—é™çš„ç³»ç»Ÿï¼Œå¤§éƒ¨åˆ†æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼ŒæŒ‡ä»¤é›†æ›´å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ï¼Œä¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå¯ç§»æ¤æ€§å¥½ï¼Œæ›´å¥½å®ç°è·¨å¹³å°ã€‚ JVM ç”Ÿå‘½å‘¨æœŸ å¯åŠ¨ï¼šé€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨(bootstrap class loader)åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»ï¼ˆinitial classï¼‰ æ‰§è¡Œï¼šJVM è¿›ç¨‹ é€€å‡ºï¼šæŸçº¿ç¨‹è°ƒç”¨Runtimeç±»çš„exitæˆ–haltæ–¹æ³•æ˜¯å…¶ä¸­ä¸€ç§ ","date":"2023-08-08","objectID":"/jvm_draft_1/:0:1","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆä¸€ï¼‰","uri":"/jvm_draft_1/"},{"categories":["draft"],"content":"è¿è¡Œæ—¶æ•°æ®åŒº æ ˆã€å †ã€å…ƒç©ºé—´çš„äº¤äº’å…³ç³»ï¼š å…ƒç©ºé—´ Metaspaceï¼ˆè¿›ç¨‹æ‹¥æœ‰ï¼Œçº¿ç¨‹é—´å…±äº«ï¼‰ åˆåéå †ï¼Œå¸¸çœ‹ä½œæ˜¯ä¸€å—ç‹¬ç«‹äº Java å †çš„å†…å­˜ç©ºé—´ï¼Œä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚ ç±»å‹ä¿¡æ¯ï¼ˆclassã€interfaceã€enumã€annotationï¼‰ã€ åŸŸï¼ˆFieldï¼‰ä¿¡æ¯ åŸŸåç§° åŸŸç±»å‹ åŸŸä¿®é¥°ç¬¦ï¼ˆpublicã€privateã€p rotectedã€staticã€finalã€volatileã€transientï¼‰ æ–¹æ³•ä¿¡æ¯ æ–¹æ³•å æ–¹æ³•è¿”å›ç±»å‹ï¼ˆåŒ…æ‹¬voidï¼‰ æ–¹æ³•å‚æ•°ï¼ˆæŒ‰é¡ºåºï¼‰ æ–¹æ³•ä¿®é¥°ç¬¦ æ–¹æ³•å­—èŠ‚ç ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨åŠå¤§å°ï¼ˆabstactå’Œnativeæ–¹æ³•é™¤å¤–ï¼‰ å¼‚å¸¸è¡¨ åŒ…åã€ç±»å çˆ¶ç±»å ä¿®é¥°ç¬¦ï¼ˆpublicã€abstractã€finalï¼‰ è¿™ä¸ªç±»å‹ç›´æ¥æ¥å£çš„æœ‰åºåˆ—è¡¨ è¿è¡Œæ—¶å¸¸é‡æ± ï¼šåœ¨ç±»åŠ è½½åï¼Œå­˜æ”¾ç¼–è¯‘ç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ é™æ€å˜é‡ å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ ä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿æ¢ï¼Ÿ ä¸ºæ°¸ä¹…ä»£è®¾ç½®ç©ºé—´å¤§å°æ˜¯å¾ˆéš¾ç¡®å®šçš„ã€‚ å¯¹æ°¸ä¹…ä»£è¿›è¡Œè°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ã€‚ ğŸŒŸå †ï¼ˆè¿›ç¨‹æ‹¥æœ‰ï¼Œçº¿ç¨‹é—´å…±äº«ï¼‰â€”â€”æ•°æ®å­˜å‚¨ å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ä»ç„¶åœ¨å †ã€‚ è®¾ç½®å‚æ•° -Xï¼šjvmçš„è¿è¡Œå‚æ•° msï¼šmemory startï¼Œåˆå§‹å†…å­˜å¤§å°ï¼Œé»˜è®¤ç”µè„‘å†…å­˜/64 mxï¼šmemory maxï¼Œæœ€å¤§å†…å­˜å¤§å°ï¼Œé»˜è®¤ç”µè„‘å†…å­˜/4 mnï¼šæ–°ç”Ÿä»£å¤§å° -XX: NewRatioï¼ˆè€å¹´ä»£/æ–°ç”Ÿä»£ï¼‰=2ï¼ˆé»˜è®¤ï¼‰ï¼šè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1/3 SurvivorRatioï¼ˆedenåŒº/survivoråŒºï¼‰=8ï¼ˆé»˜è®¤ï¼‰ï¼šè¡¨ç¤ºedenåŒºå 8ï¼ŒsurvivoråŒºå„å 1ï¼Œæœ‰æ—¶éœ€è¦æ˜¾å¼æŒ‡å®šæ‰ç”Ÿæ•ˆ ã€+ç”¨-ä¸ç”¨ã€‘UseAdaptiveSizePolicyï¼šä½¿ç”¨è‡ªé€‚åº”çš„å†…å­˜åˆ†é…ç­–ç•¥ Max TenuringThreshold=15ï¼ˆé»˜è®¤ï¼‰ï¼šè¡¨ç¤ºage==16æ—¶æ™‹å‡è‡³è€å¹´ä»£ å¯¹è±¡å¤§å°å¤§äºTo Spaceå¯ç”¨å†…å­˜æ—¶ç›´æ¥æ™‹å‡ å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå æ¯”è¶…è¿‡ä¸€åŠï¼Œåˆ™å¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ç›´æ¥æ™‹å‡ HandlePromotionFailure=trueï¼ˆé»˜è®¤ï¼‰ï¼šç©ºé—´åˆ†é…æ‹…ä¿ï¼Œåœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ï¼Œå¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡Minor GC æ˜¯å®‰å…¨çš„ï¼Œå¦åˆ™æŸ¥çœ‹HandlePromotionFailureå€¼ï¼Œå¦‚æœä¸ºfalseæ”¹ä¸ºæ‰§è¡Œ Full GCï¼Œå¦‚æœä¸ºtrueï¼Œç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å° å¦‚æœå¤§äºï¼Œæ‰§è¡ŒMinor GCï¼ˆä»æœ‰é£é™©ï¼‰ å¦‚æœå°äºï¼Œæ‰§è¡ŒFull GC JDK7ä»¥åæ”¹ä¸ºä¸¤æ¬¡æ£€éªŒç»“æœå¤§äºæœ‰ä¸€ä¸ªæˆç«‹å°± Minor GCï¼Œå¦åˆ™Full GCã€‚ ã€+ç”¨-ä¸ç”¨ã€‘PrintGCDetailsï¼šæ˜¾ç¤º GC ç»†èŠ‚ä¿¡æ¯(ç®€ç•¥ç‰ˆå»æ‰Details) ã€+ç”¨-ä¸ç”¨ã€‘PrintFlagsInitialï¼šæŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ ã€+ç”¨-ä¸ç”¨ã€‘PrintFlagsFinalï¼šæŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ ã€+ç”¨-ä¸ç”¨ã€‘UseTLABï¼šä½¿ç”¨ TLAB TLABWasteTargetPercentï¼šè®¾ç½® TLAB å ç”¨ Eden ç©ºé—´çš„ç™¾åˆ†æ¯”ï¼Œé»˜è®¤1% ã€+ç”¨-ä¸ç”¨ã€‘DoEscapeAnalysisï¼šæ‰“å¼€é€ƒé€¸åˆ†æï¼ˆjdk7+é»˜è®¤æ‰“å¼€ï¼‰ ã€+ç”¨-ä¸ç”¨ã€‘PrintEscapeAnalysisï¼šæŸ¥çœ‹é€ƒé€¸åˆ†æçš„ç­›é€‰ç»“æœ ã€Error: VM option â€˜PrintEscapeAnalysisâ€™ is notproduct and is available only in debug version of VM.ã€‘ ã€+ç”¨-ä¸ç”¨ã€‘EliminateAllocationsï¼šæ‰“å¼€æ ‡é‡æ›¿æ¢ MetaspaceSize=20.75Mï¼ˆé»˜è®¤ï¼‰ï¼šè®¾ç½®å…ƒç©ºé—´åˆå§‹åˆ†é…ç©ºé—´ï¼Œå»ºè®®è®¾ç½®ä¸€ä¸ªè¾ƒé«˜çš„å€¼ï¼Œé¿å…é¢‘ç¹Full GC MaxMetaspaceSizeï¼šè®¾ç½®å…ƒç©ºé—´æœ€å¤§ç©ºé—´ï¼ˆé»˜è®¤æ— é™åˆ¶ï¼‰ jpsï¼šæŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹idï¼šæŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„æŸä¸ªå‚æ•°æƒ…å†µ å¹´è½»ä»£ä¸è€å¹´ä»£ YoungGen Edenï¼šå‡ ä¹æ‰€æœ‰Javaå¯¹è±¡éƒ½æ˜¯åœ¨è¿™é‡Œè¢« new å‡ºæ¥çš„ï¼Œç»å¤§éƒ¨åˆ†ï¼ˆ80%ï¼‰å¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº† survivor 0 survivor 1 OldGenï¼šå¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆæ‰€ä»¥è¦å°‘åˆ›å»ºå¤§å¯¹è±¡ï¼‰ GC = Garbage Collection é¢‘ç¹æ”¶é›†å¹´è½»ä»£ï¼Œè¾ƒå°‘æ”¶é›†è€å¹´ä»£ï¼Œå‡ ä¹ä¸åŠ¨å…ƒç©ºé—´ã€‚ Young GC/Minor GCï¼šå¯¹æ–°ç”Ÿä»£GCã€‚ åœ¨EdenåŒºæ»¡æ—¶è§¦å‘ï¼ŒSurvivoråŒºæ»¡æ—¶ä¸è§¦å‘ã€‚ ä¼šå¼•å‘STWï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç›´åˆ°GCç»“æŸæ‰æ¢å¤ã€‚ Old GC/Major GCï¼šå¯¹è€å¹´ä»£GCã€‚ è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘Minor GCï¼Œå¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘ Major GCï¼Œå¦‚æœè¿˜ä¸è¶³å°±æŠ¥é”™ï¼šOOM Mixed GCï¼šå¯¹æ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£GCã€‚åªæœ‰ G1 GC ä¼šæœ‰è¿™ç§è¡Œä¸ºï¼ŒæŒ‰ç…§ region å°åŒºåŸŸåˆ’åˆ†ã€‚ Full GCï¼šå¯¹ Java æ•´ä¸ªå †å’Œå…ƒç©ºé—´GCï¼Œåœ¨å¼€å‘ä¸­åº”å°½é‡é¿å…ã€‚ è°ƒç”¨System.gc()æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡ŒFull GCï¼Œä½†ä¸æ˜¯å¿…ç„¶æ‰§è¡Œ è€å¹´ä»£æˆ–å…ƒç©ºé—´å†…å­˜ä¸è¶³ æ™‹å‡å¯¹è±¡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜ ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLABï¼ˆçº¿ç¨‹ç§æœ‰ ï¼‰ å°½ç®¡ä¸æ˜¯æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½èƒ½åœ¨ TLAB ä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼Œä½† JVM ç¡®å®å°† TLAB ä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰ã€‚ å¯¹è±¡åˆ†é…ä¼˜å…ˆçº§ï¼šTLAB\u003eEdenåŒºå…¶ä»–ç©ºé—´\u003eè€å¹´ä»£ å †ä¸æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹© é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ï¼šå¯ä»¥æœ‰æ•ˆå‡å°‘ Java ç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰ï¼Œ åœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™æ²¡æœ‰é€ƒé€¸ã€‚â€”â€”å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚ è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™å‘ç”Ÿé€ƒé€¸ï¼ˆnew çš„å¯¹è±¡å®ä½“åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼‰ æ ‡é‡æ›¿æ¢ï¼šç”¨å¯¹å¤šä¸ªæ ‡é‡çš„æ“ä½œä»£æ›¿å¯¹èšåˆé‡çš„æ“ä½œã€‚ ç¨‹åºè®¡æ•°å™¨ï¼ˆæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼‰ å…¨ç§°ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œä¹Ÿç§°ä¸ºç¨‹åºé’©å­ã€‚ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚å®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨JVM è§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OOMå¼‚å¸¸çš„åŒºåŸŸã€‚å®ƒå¹¶éå¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œè€Œæ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿã€‚ ğŸŒŸè™šæ‹Ÿæœºæ ˆï¼ˆæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼‰â€”â€”ç¨‹åºè¿è¡Œ æ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œä¸€ä¸€å¯¹åº”æ‰§è¡Œçš„æ–¹æ³•ã€‚ ğŸŒŸå±€éƒ¨å˜é‡è¡¨ Local Variables ğŸŒŸæ“ä½œæ•°æ ˆ Operand Stackï¼Œè¡¨è¾¾å¼æ ˆï¼š32bitå ä¸€ä¸ªæ·±åº¦ï¼ˆintï¼‰ï¼Œ64bitå ä¸¤ä¸ªæ·±åº¦ï¼ˆdoubleï¼‰ åŠ¨æ€é“¾æ¥ Dynamic Linkingï¼ŒæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼šåœ¨ Java æºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ä¿å­˜åœ¨ class æ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚ æ–¹æ³•è¿”å›åœ°å€ Return Addressï¼šæ–¹æ³•æ­£å¸¸é€€å‡ºï¼ˆPCè®¡æ•°å™¨çš„å€¼ï¼Œå³è¯¥æ–¹æ³•æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼‰æˆ–å¼‚å¸¸é€€å‡ºï¼ˆæŸ¥è¯¢å¼‚å¸¸è¡¨ï¼‰çš„å®šä¹‰ é™„åŠ ä¿¡æ¯ é™æ€é“¾æ¥ï¼šç¼–è¯‘æœŸå¯çŸ¥ã€æ—©æœŸç»‘å®šã€‘ éè™šæ–¹æ³•ï¼šåœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶ä¸å¯å˜ invokestaticï¼šstatic invokespecialï¼šprivateã€finalã€å®ä¾‹æ„é€ å™¨(\u003cinit\u003e æ–¹æ³•)ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ï¼šç¼–è¯‘æœŸæœªçŸ¥ï¼Œè¿è¡ŒæœŸå¯çŸ¥ã€æ™šæœŸç»‘å®šã€‘ invokevitualï¼šè°ƒç”¨è™šæ–¹æ³• invokeinterfaceï¼šè°ƒç”¨æ¥å£ invokedynamicï¼šåŠ¨æ€è§£ææ–¹æ³•ï¼Œç„¶åæ‰§è¡Œï¼ˆLambdaè¡¨è¾¾å¼çš„å‡ºç°ä½¿å¾—è¯¥æŒ‡ä»¤å¯ä»¥ç›´æ¥ç”Ÿæˆï¼‰ Java æ˜¯é™æ€è¯­è¨€ï¼Œä½† Lambda è¡¨è¾¾å¼ä½¿å®ƒå…·å¤‡åŠ¨æ€è¯­è¨€çš„ç‰¹ç‚¹ã€‚ï¼ˆinvokedynamicï¼‰ åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæ„é€ å™¨å’Œæ–¹æ³•ç­‰ä»·ã€‚Java ä¸­ä»»ä½•ä¸€ä¸ªputsçš„æ–¹æ³•å…¶å®éƒ½å…·å¤‡c++ä¸­è™šå‡½æ•°çš„ç‰¹å¾ï¼ˆå¤šæ€ï¼šå…è®¸çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å®ä¾‹ï¼‰ï¼Œé™¤éç”¨ final ä¿®é¥°ã€‚ å˜é‡ç±»å‹ï¼š æˆå‘˜å˜é‡ ç±»å˜é‡ï¼Œprepareé˜¶æ®µé»˜è®¤èµ‹å€¼ï¼Œinitialé˜¶æ®µæ˜¾å¼èµ‹å€¼ å®ä¾‹å˜é‡ï¼Œéšç€å¯¹è±¡çš„åˆ›å»ºï¼Œåœ¨å †ç©ºé—´ä¸­åˆ†é…ç©ºé—´ï¼Œè¿›è¡Œèµ‹å€¼ å±€éƒ¨å˜é‡ï¼šå¿…é¡»æ˜¾å¼èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ ğŸŒŸæœ¬åœ°æ–¹æ³•æ ˆï¼ˆæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼‰ ä¸ Java å¤–é¢çš„ç¯å¢ƒäº¤äº’ã€‚ æœ¬åœ°æ–¹æ³•ï¼šä¸€ä¸ª Java ç¨‹åºè°ƒç”¨é Java ä»£ç ï¼ˆæ¯”å¦‚Cï¼‰çš„æ¥å£ã€‚ ","date":"2023-08-08","objectID":"/jvm_draft_1/:0:2","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆä¸€ï¼‰","uri":"/jvm_draft_1/"},{"categories":["draft"],"content":"Java å®ˆæŠ¤çº¿ç¨‹ è™šæ‹Ÿæœºçº¿ç¨‹ï¼šJVM è¾¾åˆ°å®‰å…¨ç‚¹æ—¶å‡ºç°ã€‚ å‘¨æœŸä»»åŠ¡çº¿ç¨‹ GC çº¿ç¨‹ ç¼–è¯‘çº¿ç¨‹ï¼šå°†å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç  ä¿¡å·è°ƒåº¦çº¿ç¨‹ï¼šæ¥æ”¶ä¿¡å· ","date":"2023-08-08","objectID":"/jvm_draft_1/:0:3","tags":["JVM"],"title":"JVM æ‚è®°ï¼ˆä¸€ï¼‰","uri":"/jvm_draft_1/"},{"categories":["interview"],"content":"Java è¿›é˜¶å¿…ç»ä¹‹è·¯","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"JVM å†…å­˜æ¨¡å‹ å †ï¼ˆHeapï¼‰ï¼šçº¿ç¨‹å…±äº«ã€‚æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚ GC ä¸»è¦ç®¡ç†çš„å¯¹è±¡ã€‚ æ–°ç”Ÿä»£ï¼ˆ1/3ï¼‰ edenï¼ˆ8/10ï¼‰ï¼Œå¯ä»¥é€šè¿‡ -XXSurvivorRatio è°ƒæ•´ï¼Œé»˜è®¤ 8 fromã€to åŒºåŸŸï¼ˆå„ 1/10ï¼‰ TLABï¼šThread Local Allocation Bufferï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…çš„ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸï¼Œå¦åˆ™ï¼Œå¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä¸ºé¿å…æ“ä½œåŒä¸€åœ°å€ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨åŠ é”ç­‰æœºåˆ¶ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦ï¼ˆstartã€topã€endï¼‰ è€å¹´ä»£ ï¼ˆ2/3ï¼‰ å¤§å¯¹è±¡ é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼Œ-XX:MaxTenuringThresholdè°ƒæ•´ï¼Œé»˜è®¤ 15ï¼Œå–å€¼ 0ï½15 from+to ç©ºé—´ä¸è¶³ OutOfMemoryErrorï¼šå †ç©ºé—´ä¸è¶³ï¼Œè°ƒæ•´ Xmx -Xms åˆå§‹å †ç©ºé—´ï¼Œ-Xmx å †ç©ºé—´ä¸Šé™ï¼Œå»ºè®®è®¾ç½®ç›¸ç­‰ï¼ˆç‰©ç†å†…å­˜çš„ 1/4ï¼‰ï¼Œåœ¨è€ƒè™‘å…¶ä»–é¡¹ç›®çš„å†…å­˜ä½¿ç”¨æƒ…å†µæ—¶ï¼Œå°½é‡å¤§ã€‚ æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ï¼šçº¿ç¨‹å…±äº«ã€‚å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼ŒJVM å¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­æ—¶é‡Šæ”¾ jdk 7 ä½äºæ°¸ä¹…ä»£ï¼Œjdk8 ç§»åŠ¨åˆ°äº† metaspace å…ƒç©ºé—´ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚ OutOfMemoryErrorï¼šMetaspace è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå¸¸é‡æ± ä¸­çš„ç¬¦å·åœ°å€ï¼ˆ#1ã€#2..ï¼‰å˜ä¸ºçœŸå®åœ°å€ è™šæ‹Ÿæœºæ ˆï¼ˆJVM Stackï¼‰ï¼šçº¿ç¨‹ç§æœ‰ï¼Œç”±å¤šä¸ªæ ˆå¸§ç»„æˆã€‚å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ–¹æ³•ã€å¯¹è±¡æŒ‡é’ˆã€‚ å¦‚æœå±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ã€‚ StackOverFlowErrorï¼šé€’å½’è°ƒç”¨å¯¼è‡´æ ˆå¸§è¿‡å¤š or æ ˆå¸§è¿‡å¤§ã€‚ -Xss 128kï¼ˆé»˜è®¤ 1Mï¼Œå¤ªå¤§äº†ï¼‰ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ï¼šçº¿ç¨‹ç§æœ‰ã€‚ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Native æ–¹æ³•æœåŠ¡ã€‚å¦‚Javaä½¿ç”¨cæˆ–è€…c++ç¼–å†™çš„æ¥å£æœåŠ¡æ—¶ï¼Œä»£ç åœ¨æ­¤åŒºè¿è¡Œã€‚ ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šçº¿ç¨‹ç§æœ‰ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„ï¼ˆå­—èŠ‚ç ï¼‰æŒ‡ä»¤ã€‚ ã€ä¸ç”± JVM ç®¡ç†ã€‘ç›´æ¥å†…å­˜ï¼šæ˜¯ JVM çš„ç³»ç»Ÿå†…å­˜ï¼Œåœ¨ NIO æ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒºï¼Œå®ƒåˆ†é…å›æ”¶æˆæœ¬é«˜ï¼Œè¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡ç¼“å†²åŒºå¤åˆ¶ï¼‰ã€‚ ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:1","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"STWä¸ºä»€ä¹ˆéœ€è¦åœé¡¿æ‰€æœ‰çš„Javaæ‰§è¡Œçº¿ç¨‹å‘¢ï¼Ÿ ç¡®ä¿ä¸€è‡´æ€§å¿«ç…§ï¼Œè®©æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒå†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šäº†ï¼Œå¦‚æœå‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†äº«ç»“æœçš„å‡†ç¡®æ€§æ˜¯æ— æ³•ä¿è¯çš„ã€‚ STWäº‹ä»¶å’Œé‡‡ç”¨å“ªæ¬¾GCæ— å…³ï¼Œæ‰€æœ‰çš„GCéƒ½æ˜¯æœ‰è¿™ä¸ªäº‹ä»¶ è¶Šä¼˜ç§€ï¼Œå›æ”¶æ•ˆç‡è¶Šé«˜çš„åƒåœ¾å›æ”¶å™¨ï¼Œå°½å¯èƒ½åœ°ç¼©çŸ­æš‚åœæ—¶é—´ã€‚ STWæ˜¯JVMåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„ã€‚æ˜¯åœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹ï¼ŒæŠŠç”¨æˆ·æ­£å¸¸çš„çº¿ç¨‹å…¨éƒ¨åœæ‰ï¼Œå†å»æŠŠä¸ç”¨çš„å¯¹è±¡éƒ½å¹²æ‰ã€‚ ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:2","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"G1 GCçš„å¥½å¤„ï¼Ÿ -xx:+UseG1GC ä¼˜åŠ¿ï¼š å¹¶è¡Œä¸å¹¶å‘ - å¤šä¸ªåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶å·¥ä½œï¼ˆå¹¶è¡Œï¼‰ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼ˆå¹¶å‘ï¼‰ï¼Œåˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š å¹´è½»ä»£åƒåœ¾å›æ”¶ å¹¶å‘æ ‡è®° æ··åˆæ”¶é›†ï¼ˆEden + from -\u003e toï¼Œold -\u003e oldâ€™ï¼‰ åˆ†ä»£æ”¶é›† - **G1**å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºåŸŸ(**Region**)ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“ edenã€s0ã€s1 å’Œ humongousï¼ˆå¤§å¯¹è±¡ï¼‰ï¼Œå®ƒä¸è¦æ±‚å¹´è½»ä»£ï¼Œè€å¹´ä»£æ˜¯è¿ç»­çš„ã€‚ mixed gcï¼šéƒ¨åˆ†åŒºåŸŸï¼ŒG1 ç‰¹æœ‰ minor gcï¼šæ–°ç”Ÿä»£ï¼Œæ—¶é—´çŸ­ï¼ˆSTWï¼‰ full gcï¼šæ–°ç”Ÿä»£+è€å¹´ä»£ï¼Œæ—¶é—´é•¿ï¼ˆSTWï¼‰ å¤åˆ¶ç®—æ³•ï¼šG1å†…å­˜å›æ”¶ä½¿ç”¨Regionä½œä¸ºåŸºæœ¬å•ä½ï¼Œå¯¹å†…å­˜ç©ºé—´è¿›è¡Œæ•´ç†ã€‚ å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ - å¯ä»¥è®©ç”¨æˆ·æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚ ç¼ºç‚¹ï¼šç›¸æ¯”äºCMSï¼ŒG1è¿˜ä¸å…·å¤‡å…¨æ–¹ä½ã€å‹å€’æ€§ä¼˜åŠ¿ã€‚æ¯”å¦‚ï¼ŒG1ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„**å†…å­˜å ç”¨**ä»¥åŠç¨‹åºè¿è¡Œæ—¶çš„**é¢å¤–æ‰§è¡Œè´Ÿè½½**éƒ½æ¯”CMSè¦é«˜ã€‚ ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:3","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"ğŸŒŸJavaå¸¸è§çš„åƒåœ¾æ”¶é›†å™¨å’Œå¯¹åº”çš„GC ç®—æ³•ï¼Ÿ å¯è¾¾æ€§åˆ†æï¼šä»¥ GC Root ä¸ºèµ·ç‚¹ï¼Œæ ‡è®°å‡ºæ‰€æœ‰è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ¸…é™¤ã€‚ GC æ–°ç”Ÿä»£ è€å¹´ä»£ ç‰¹ç‚¹ SerialGCï¼ˆJDK1.2 é»˜è®¤ï¼‰ å¤åˆ¶ç®—æ³• ä¼˜ç‚¹ï¼šé«˜æ•ˆã€æ— ç¢ç‰‡ï¼Œ ç¼ºç‚¹ï¼šå†…å­˜åˆ©ç”¨ç‡ä½ æ ‡è®°-æ•´ç†ï¼Œæ— å†…å­˜ç¢ç‰‡ é€‚ç”¨äºå•æ ¸ CPU ParallelGCï¼ˆJDK1.3é»˜è®¤ï¼‰ é«˜ååé‡ï¼Œæ–°è€å¹´ä»£GC å¹¶è¡Œæ‰§è¡Œ CMS GCï¼ˆJDK5 å¼•å…¥ï¼‰ æ ‡è®°-æ¸…é™¤ï¼Œé«˜æ•ˆï¼Œ ä½†å‡ºç°å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ ä½å»¶è¿Ÿï¼Œå› ä¸ºä½¿ç”¨äº†å¢é‡æ ‡è®°å’Œå¹¶å‘æ ‡è®°æ¥å‡å°‘ STW æ—¶é—´ G1ï¼ˆGarbage 1stï¼ŒJDK9 é»˜è®¤ï¼‰ region ä¹‹é—´å¤åˆ¶ï¼Œä¸è¦æ±‚å¹´è½»ä»£ã€è€å¹´ä»£æ˜¯è¿ç»­çš„ å…¼é¡¾ååé‡å’Œå»¶è¿Ÿ ZGCï¼ˆJDK11 å¼•å…¥ï¼‰ å¤åˆ¶ æ ‡è®°-æ•´ç†ï¼Œç€è‰²æŒ‡é’ˆ+è¯»å±éšœæŠ€æœ¯ é€šè¿‡ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœæŠ€æœ¯ï¼Œè§£å†³äº†è½¬ç§»è¿‡ç¨‹ä¸­å‡†ç¡®è®¿é—®å¯¹è±¡çš„é—®é¢˜ï¼Œä½¿å¾— GC æœ€å¤§åœé¡¿æ—¶é—´ä¸è¶…è¿‡ 10msï¼Œä½†ä»…æ”¯æŒ Linux 64 ä½å¹³å° ZGC çš„**ç€è‰²æŒ‡é’ˆ**ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ ‡è®°ä½æ¥æ ‡è®°å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå°†å…¶å­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­çš„ unused_bits å­—æ®µä¸­ï¼Œå¯ä»¥å¿«é€Ÿæ ‡è®°å¯¹è±¡å­˜æ´»ä¿¡æ¯ï¼Œå®ç°å†…å­˜å‹ç¼©å’Œå¿«é€Ÿçš„åƒåœ¾å›æ”¶ï¼›**è¯»å±éšœæŠ€æœ¯**åœ¨å¯¹è±¡å¼•ç”¨è¯»å–æ—¶è¿›è¡Œå†…å­˜å±éšœï¼Œå¯ä»¥å‡å°‘STW æ—¶é—´ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚ Minor/Young + Major = Full GC GCè¿‡ç¨‹ Java åº”ç”¨ä¸æ–­åˆ›å»ºå¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯åˆ†é…åœ¨ Eden åŒºåŸŸï¼Œå½“å…¶ç©ºé—´å ç”¨è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè§¦å‘ minor GCã€‚ä»ç„¶è¢«å¼•ç”¨çš„å¯¹è±¡å­˜æ´»ä¸‹æ¥ï¼Œè¢«å¤åˆ¶åˆ° JVM é€‰æ‹©çš„ Survivor åŒºåŸŸï¼Œè€Œæ²¡æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡åˆ™è¢«å›æ”¶ã€‚ ç»è¿‡ä¸€æ¬¡ Minor GCï¼ŒEden å°±ä¼šç©ºé—²ä¸‹æ¥ï¼Œç›´åˆ°å†æ¬¡è¾¾åˆ° Minor GC è§¦å‘æ¡ä»¶ï¼Œè¿™æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ª Survivor åŒºåŸŸåˆ™ä¼šæˆä¸º to åŒºåŸŸï¼ŒEden åŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’Œ From åŒºåŸŸå¯¹è±¡ï¼Œéƒ½ä¼šè¢«å¤åˆ¶åˆ° to åŒºåŸŸï¼Œå¹¶ä¸”å­˜æ´»çš„å¹´é¾„è®¡æ•°ä¼šè¢«åŠ  1ã€‚ ç±»ä¼¼ç¬¬äºŒæ­¥çš„è¿‡ç¨‹ä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¹´é¾„è®¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿæ‰€è°“çš„æ™‹å‡ï¼ˆPromotionï¼‰è¿‡ç¨‹ï¼Œè¶…è¿‡é˜ˆå€¼çš„å¯¹è±¡ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚ ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:4","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"ä»€ä¹ˆæ˜¯å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼ï¼Ÿ å†…å­˜æº¢å‡º Out Of Memoryï¼Œæ˜¯æŒ‡ç¨‹åºåœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¾›å…¶ä½¿ç”¨ï¼Œå‡ºç°out of memoryï¼›æ¯”å¦‚ç”³è¯·äº†ä¸€ä¸ªinteger,ä½†ç»™å®ƒå­˜äº†longæ‰èƒ½å­˜ä¸‹çš„æ•°ï¼Œé‚£å°±æ˜¯å†…å­˜æº¢å‡ºã€‚å¯èƒ½åŸå› ï¼š è™šæ‹Ÿæœºæ ˆï¼šStackOverFlowErrorï¼Œé€’å½’æ–¹æ³•æ­»å¾ª å…ƒç©ºé—´æ–¹æ³•åŒºï¼šOutOfMemoryErrorï¼šMetaspaceï¼Œå¯åŠ¨å‚æ•°å†…å­˜å€¼è®¾å®šå¾—è¿‡å° å †ï¼šOutOfMemoryErrorï¼Œç”¨ jmap + VisualVM æ’æŸ¥ï¼Œæˆ–è®¾ç½®å¯åŠ¨å‚æ•°è¾“å‡ºæ—¥å¿—ã€‚ å†…å­˜ä¸­åŠ è½½çš„æ•°æ®é‡è¿‡äºåºå¤§ï¼Œå¦‚ä¸€æ¬¡ä»æ•°æ®åº“å–å‡ºè¿‡å¤šæ•°æ® é›†åˆç±»ä¸­æœ‰å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨å®Œåæœªæ¸…ç©ºï¼Œä½¿å¾—JVMä¸èƒ½å›æ”¶ å†…å­˜æ³„éœ² memory leakï¼Œæ˜¯æŒ‡ç¨‹åºåœ¨ç”³è¯·å†…å­˜åï¼Œæ— æ³•é‡Šæ”¾å·²ç”³è¯·çš„å†…å­˜ç©ºé—´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶å°†å…¶å¼•ç”¨ç½®ä¸º null æˆ–è€…æ‰‹åŠ¨é‡Šæ”¾ï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€æ€§èƒ½ä¸‹é™ã€æ•°æ®ä¸¢å¤±ç­‰ä¸¥é‡åæœã€‚ e.g. ThreadLocal æ²¡æœ‰åŠæ—¶è°ƒç”¨ removeï¼ˆï¼‰ ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:5","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":"ğŸŒŸJVM è°ƒä¼˜å·¥å…· çœ‹å †ä¿¡æ¯ jmap -heap \u003cpid\u003e ç”Ÿæˆå¿«ç…§ dump æ–‡ä»¶ï¼ˆä¿å­˜çº¿ç¨‹ã€å †æ ˆè°ƒç”¨ã€å¼‚å¸¸ä¿¡æ¯ï¼‰ï¼Œå¯ä»¥ç”¨ VisualVM å»åŠ è½½ xxx.hprof æ–‡ä»¶ jmap -dump:format=b,file=heap.hprof \u003cpid\u003e åƒåœ¾å›æ”¶ç»Ÿè®¡ jstat -gc \u003cpid\u003e ","date":"2023-08-08","objectID":"/jvm%E4%B8%8Egc/:0:6","tags":["Java"],"title":"ğŸš©JVMä¸GC","uri":"/jvm%E4%B8%8Egc/"},{"categories":["interview"],"content":" JUC = java.util.concurrent ","date":"2023-08-08","objectID":"/juc/:0:0","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"è¿›ç¨‹ vs çº¿ç¨‹ï¼Ÿ è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œç¨‹åºçš„å®ä¾‹ï¼ˆå¤šå¼€è½¯ä»¶ = å¤šå®ä¾‹è¿›ç¨‹ï¼‰ï¼ŒåŒ…å«äº†çº¿ç¨‹ è¿›ç¨‹æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼ŒåŒä¸€è¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ åˆ‡æ¢çº¿ç¨‹æˆæœ¬ \u003c åˆ‡æ¢è¿›ç¨‹ å®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹ã€‚ ","date":"2023-08-08","objectID":"/juc/:0:1","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"å¹¶è¡Œ vs å¹¶å‘ï¼Ÿ å¹¶å‘ï¼šåŒä¸€æ—¶é—´ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµä½¿ç”¨ CPUï¼ŒJava å¹¶å‘æœ‰ä¸‰å¤§ç‰¹æ€§ åŸå­æ€§ï¼šé” å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼ˆvolatileï¼‰ æœ‰åºæ€§ï¼šé˜²æ­¢å…ˆè¯»å’Œåå†™ï¼ˆvolatileï¼‰ å¹¶è¡Œï¼š4 æ ¸ CPU åŒæ—¶æ‰§è¡Œ 4 ä¸ªçº¿ç¨‹ ","date":"2023-08-08","objectID":"/juc/:0:2","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"ğŸŒŸåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼Ÿ extends Thread @override run() implements Runnable @override run() æ— è¿”å›å€¼ï¼Œä¸å¯æŠ›å¼‚å¸¸ implements Callable @ovverride call() æœ‰è¿”å›å€¼ï¼Œå¯æŠ›å¼‚å¸¸ FutureTask\u003c\u003e ft; ft.get() å¼‚æ­¥è·å¾—ç»“æœ çº¿ç¨‹æ±  Executors å’Œ ThreadPoolExecutors çš„åŒºåˆ«å’Œè”ç³»ï¼Ÿ ThreadPoolExecutor æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ï¼Œæœ‰ 7 å¤§å‚æ•°ï¼š public ThreadPoolExecutor( int corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¯¹äº N æ ¸ï¼ˆé€»è¾‘å¤„ç†å™¨ï¼‰ CPU IO å¯†é›†å‹ï¼š2N+1ï¼Œè¯»å†™è¯·æ±‚ä»»åŠ¡æ—¶é—´é•¿ CPU å¯†é›†å‹ï¼šN+1ï¼Œè®¡ç®—ã€Bitmap è½¬æ¢ï¼Œé«˜å¹¶å‘ï¼Œå‡å°‘åˆ‡æ¢ä¸Šä¸‹æ–‡ int maximumPoolSize æœ€å¤§ï¼ˆæ ¸å¿ƒ+æ•‘æ€¥ï¼‰çº¿ç¨‹æ•° long keepAliveTime æ•‘æ€¥çº¿ç¨‹ç”Ÿå­˜æ—¶é—´å€¼ TimeUnit unit æ•‘æ€¥çº¿ç¨‹ç”Ÿå­˜æ—¶é—´å•ä½ BlockingQueue queue é˜»å¡é˜Ÿåˆ—ï¼Œæ»¡äº†åˆ›å»ºæ•‘æ€¥çº¿ç¨‹ ArrayBlockingQueue æ•°ç»„ FIFOï¼ˆé¥¿åŠ è½½ï¼‰ï¼Œå…¥é˜Ÿå‡ºé˜Ÿé”ä½æ•´ä¸ªé˜Ÿåˆ— LinkedBlockingQueue é“¾è¡¨ FIFOï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œæ”¶å°¾æœ‰ä¸¤æŠŠé”ï¼Œå…¥é˜Ÿå‡ºé˜Ÿäº’ä¸å½±å“ï¼Œæ•ˆç‡é«˜ DelayedWorkQueue å‡ºé˜Ÿæ‰§è¡Œæ—¶é—´é å‰çš„ SynchronousQueueï¼šæ¯æ¬¡æ’å…¥éƒ½ç­‰å¾…ç§»å‡ºï¼Œä¸å­˜å‚¨å…ƒç´  ThreadFactory threadFactory å®šä¹‰çº¿ç¨‹åã€æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ RejectedExecutionHandler handler å½“çº¿ç¨‹å’Œé˜»å¡é˜Ÿåˆ—éƒ½å¿™æ—¶ï¼Œè§¦å‘çš„æ‹’ç»ç­–ç•¥ AbortPolicy æŠ›å¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰ CallerRunsPolicy è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œ DiscardOldestPolicy ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—æœ€ä¹…ä»»åŠ¡ DiscardPolicy ä¸¢å¼ƒå½“å‰ä»»åŠ¡ Executors æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›äº†ä¸€äº›å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ± çš„é™æ€æ–¹æ³•ï¼Œä½†ä¸æ¨èä½¿ç”¨ï¼ŒåŸå› ï¼š çº¿ç¨‹æ± æˆ–è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ = Integer.MAX_VALUE æ²¡åšé™åˆ¶ï¼Œä¼šå¯¼è‡´ OOMã€‚ newCachedThreadPool()ï¼šå®ƒä¼šè¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå½“æ— ç¼“å­˜çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼›ç”¨æ¥å¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡ã€‚å…¶å†…éƒ¨ä½¿ç”¨ SynchronousQueue ä½œä¸ºå·¥ä½œé˜Ÿåˆ—ã€‚ newFixedThreadPool(int nThreads)ï¼šå›ºå®šçº¿ç¨‹æ•°ï¼Œç”¨äºä»»åŠ¡é‡å·²çŸ¥ä¸”ç›¸å¯¹è€—æ—¶çš„åœºæ™¯ã€‚ newSingleThreadExecutor()ï¼šå•çº¿ç¨‹ï¼Œé¡ºåºæ‰§è¡Œä»»åŠ¡ newSingleThreadScheduledExecutor() å’Œ newScheduledThreadPool(int corePoolSize)ï¼Œåˆ›å»ºçš„æ˜¯ä¸ª ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼ŒåŒºåˆ«åœ¨äºå•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹ã€‚ newWorkStealingPool(int parallelism)ï¼Œè¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«äººå¿½ç•¥çš„çº¿ç¨‹æ± ï¼ŒJava 8 æ‰åŠ å…¥è¿™ä¸ªåˆ›å»ºæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šæ„å»ºForkJoinPoolï¼Œåˆ©ç”¨Work-Stealingç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºã€‚ çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯ æ•°æ®è¿ç§»ï¼šMySQL -\u003e es ç”¨åˆ°äº† CountDownLatch + çº¿ç¨‹æ± ï¼Œåˆå§‹å€¼è®¾ä¸ºæŸ¥è¯¢æ€»é¡µæ•°ï¼Œæ¯é¡µ ctl.countDown()ï¼Œæœ€ç»ˆ countDownLatch.await() ç­‰å¾…è®¡æ•°å½’é›¶ æ•°æ®æ±‡æ€»ï¼šå¹¶è¡Œæ‰§è¡Œæ²¡æœ‰ä¾èµ–å…³ç³»çš„æ¥å£ï¼ŒCallable + Future å¼‚æ­¥è°ƒç”¨ï¼šä¸Šçº§æ–¹æ³•ä¸éœ€ä¾èµ–ä¸‹çº§æ–¹æ³•çš„è¿”å›å€¼ e.g. ä¿å­˜æœç´¢å†å² @EnableAsync class SpringBootApplication @Async(â€œtaskExecutorâ€) ","date":"2023-08-08","objectID":"/juc/:0:3","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"Java çº¿ç¨‹çš„çŠ¶æ€ yield()ï¼šä½¿çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œä½†ä¸é‡Šæ”¾é”èµ„æºï¼Œä¸ä¼šå¯¼è‡´é˜»å¡ t.join()ï¼šå½“å‰çº¿ç¨‹è°ƒç”¨çº¿ç¨‹tï¼Œå½“å‰çº¿ç¨‹ä¸é‡Šæ”¾é”ï¼Œtä¼šé‡Šæ”¾åŒæ­¥é” **notify()**ï¼šéšæœºå”¤é†’åœ¨æ­¤ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹ ğŸŒŸObject.wait() vs Thread.sleep(long) ï¼Ÿ wait() æ–¹æ³•æ˜¯ Object ç±»çš„æˆå‘˜æ–¹æ³•ï¼Œè€Œ sleep() æ–¹æ³•æ˜¯ Thread ç±»çš„é™æ€æ–¹æ³•ã€‚åœ¨ä½¿ç”¨ wait() æ–¹æ³•æ—¶éœ€è¦è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼Œè€Œ sleep() æ–¹æ³•ä¸éœ€è¦ã€‚ wait() æ–¹æ³•ä¼šé‡Šæ”¾å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–è¯¥å¯¹è±¡çš„ç›‘è§†å™¨é”å¹¶æ‰§è¡ŒåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ã€‚è€Œ sleep() æ–¹æ³•ä¸ä¼šé‡Šæ”¾ä»»ä½•é”ï¼Œçº¿ç¨‹ä»ç„¶æŒæœ‰ä¹‹å‰è·å–çš„æ‰€æœ‰é”ã€‚ wait() æ–¹æ³•å¿…é¡»åœ¨ synchronized å—æˆ–æ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼Œå³åœ¨ synchronized å—æˆ–æ–¹æ³•å†…éƒ¨è°ƒç”¨ wait() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚è€Œ sleep() æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œä¸éœ€è¦æŒæœ‰ä»»ä½•é”ã€‚ wait() æ–¹æ³•ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¢« notify() æˆ– notifyAll() å”¤é†’ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ã€‚è€Œ sleep() æ–¹æ³•ä¼šæš‚åœçº¿ç¨‹çš„æ‰§è¡Œï¼Œç­‰å¾…æŒ‡å®šçš„æ—¶é—´åè‡ªåŠ¨å”¤é†’çº¿ç¨‹ã€‚ å¦‚ä½•åœæ­¢çº¿ç¨‹ï¼Ÿ æ­£å¸¸æ‰§è¡Œå®Œ run() stop() ä¸æ¨è interrupt æ‰“æ–­ï¼ˆé˜»å¡ä¼šæŠ›å¼‚å¸¸ InterruptedExceptionï¼‰ï¼ŒæˆåŠŸåå¯ç”¨ isInterrupt() åˆ¤æ–­ ","date":"2023-08-08","objectID":"/juc/:0:4","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"ğŸŒŸsynchronized synchronized ä¸­çš„é” åå‘é”ã€æ— ç«äº‰ã€‘ï¼šåªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œç¬¬ä¸€æ¬¡ CASï¼ˆä¹è§‚é”ï¼‰ï¼Œä¹‹ååˆ¤æ–­çº¿ç¨‹ id ğŸŒŸCAS = Compare and Swapï¼ˆæ¯”è¾ƒå¹¶æ›¿æ¢ï¼‰ï¼šå½“ä¸”ä»…å½“å†…å­˜åœ°å€Vçš„å€¼ä¸é¢„æœŸå€¼Aç›¸ç­‰æ—¶ï¼Œå°†å†…å­˜åœ°å€Vçš„å€¼ä¿®æ”¹ä¸ºç›®æ ‡å€¼Bï¼Œå¦åˆ™å°±ä»€ä¹ˆéƒ½ä¸åšã€‚åœ¨æ— é”æƒ…å†µä¸‹ï¼Œä¿è¯çº¿ç¨‹æ“ä½œå…±äº«æ•°æ®çš„åŸå­æ€§ï¼Œé€šè¿‡è‡ªæ—‹é”ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚ CAS æ¥å®ç°ï¼ˆUnsafe ç±»ï¼‰ï¼Œç”¨äº AQSã€AtomicXxxã€‚ç¼ºç‚¹ï¼šå¾ªç¯æ—¶é—´é•¿å¼€é”€å¾ˆå¤§ã€åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€ABAé—®é¢˜ã€‚ è½»é‡çº§é”ã€æœ‰ç«äº‰ã€‘ï¼šå¤šçº¿ç¨‹äº¤æ›¿ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯ CAS æ“ä½œï¼Œä¿è¯åŸå­æ€§ é‡é‡çº§é” Monitorã€å¤šçº¿ç¨‹ç«äº‰ã€‘ï¼šæ‚²è§‚é”ï¼Œç”± JVM æä¾›ï¼ŒC++å®ç°ã€‚ä¸€æ—¦å‘ç”Ÿé”ç«äº‰ï¼Œéƒ½ä¼šç¼–ç¨‹é‡é‡çº§é” waitSetï¼šwaiting çŠ¶æ€çš„çº¿ç¨‹é›†åˆ entrySetï¼šBLOCKED çŠ¶æ€çš„çº¿ç¨‹é›†åˆ ownerï¼šå½“å‰è·å¾—é”çš„çº¿ç¨‹ï¼Œåªæœ‰ä¸€ä¸ª Hotspot JVM ä¸­å¯¹è±¡å­˜å‚¨é”çš„æ–¹å¼ å¯¹è±¡å¤´ MarkWordï¼ˆ001 æ— é”ï¼Œ101 åå‘é”ï¼Œ00 è½»é‡çº§é”ï¼Œ10 é‡é‡çº§é”ï¼Œ11 GCï¼‰ KlassWord å®ä¾‹æ•°æ® Object body å¯¹é½å¡«å…… Lock å’Œ synchronized çš„åŒºåˆ«ï¼Ÿ synchronized æ˜¯Java çš„ä¸€ä¸ªå†…ç½®å…³é”®å­—ï¼Œåªèƒ½å®ç°éå…¬å¹³é”ã€‚ Lock æ˜¯ä¸€ä¸ªç±»ï¼Œæœ‰ ReentrantLockã€ReentrantReadWriteLock çš„å®ç°ï¼Œå¯ä»¥å®ç°ï¼š å…¬å¹³é” ä¸­æ–­è¯•å›¾è·å–é”çš„ä¸€ä¸ªçº¿ç¨‹ è®¾ç½®è¶…æ—¶ å¿…é¡»æ‰‹åŠ¨ unlock()é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é” æœ‰ç«äº‰æ—¶ï¼ŒLock æ€§èƒ½æ›´å¥½ã€‚ ","date":"2023-08-08","objectID":"/juc/:0:5","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"æ­»é”è¯Šæ–­ jpsï¼šJVM ä¸­è¿›ç¨‹çŠ¶æ€ jstackï¼šJava è¿›ç¨‹å†…çº¿ç¨‹çš„å †æ ˆ jstack -l \u003cè¿›ç¨‹ id\u003e jconsoleï¼šå¯¹ JVM çš„å†…å­˜ã€çº¿ç¨‹ã€ç±»çš„ç›‘æ§ ","date":"2023-08-08","objectID":"/juc/:0:6","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"ğŸŒŸvolatile åŠŸèƒ½ï¼š ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§ ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼ˆJIT å³æ—¶ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–ï¼Œå¯é€šè¿‡ -Xint å…³é—­ï¼Œä½†ä¸æ¨èï¼‰ ç”¨æ³•å’ŒåŸç†ï¼š volatile ä¿®é¥°çš„å†™å˜é‡æ”¾åœ¨æœ€åï¼Œé˜»æ­¢ä¸Šæ–¹å†™æ“ä½œè¶Šè¿‡å±éšœ volatile ä¿®é¥°çš„è¯»å˜é‡æ”¾åœ¨æœ€å…ˆï¼Œé˜»æ­¢ä¸‹æ–¹è¯»æ“ä½œçº¦è¿‡å±éšœ ä½¿ç”¨åœºæ™¯ï¼š DCL å•ä¾‹ AQS.state ","date":"2023-08-08","objectID":"/juc/:0:7","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"ğŸŒŸAQS = AbstractQueuedSynchronizer æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ Qï¼šå’Œ synchronized çš„åŒºåˆ«ï¼Ÿ Aï¼š ä»–ä»¬éƒ½æ˜¯æ‚²è§‚é”ã€‚AQS ç”± Java å®ç°ï¼Œæ‰‹åŠ¨å¼€å¯å’Œå…³é—­ï¼Œå¤„ç†ç«äº‰æœ‰å¤šç§æ–¹æ¡ˆï¼Œsynchronized ç”± C++ å®ç°ï¼Œè‡ªåŠ¨é‡Šæ”¾é”ï¼Œé‡åˆ°ç«äº‰å°±å˜æˆé‡é‡çº§é”ï¼Œæ€§èƒ½å·®ã€‚ AQS æœ‰ä¸€ä¸ª FIFO é˜Ÿåˆ—ï¼Œhead æŒ‡å‘æœ€ä¹…å…ƒç´ ï¼Œtail æŒ‡å‘æœ€æ–°å…ƒç´ ï¼Œå¯ä»¥å®ç°å…¬å¹³é”å’Œéå…¬å¹³é”ï¼š å…¬å¹³é”ï¼šFIFO éå…¬å¹³é”ï¼šæ–°å…ƒç´ ä¸é˜Ÿåˆ—ä¸­å…ƒç´ ç«äº‰ ä½¿ç”¨åœºæ™¯ï¼š ReentrantLock å¯é‡å…¥é” = CAS + AQSï¼ˆextendsï¼‰ exclusiveOwnerThread å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ï¼Œå½“å…¶ä¸º null æ—¶ï¼Œå”¤é†’åŒå‘é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ Semaphoreï¼šæ§åˆ¶æŸæ–¹æ³•å¹¶å‘è®¿é—®çº¿ç¨‹æ•° acquire() è¯·æ±‚ -1 release() é‡Šæ”¾ +1 å†…éƒ¨çŠ¶æ€ï¼š volatile state = 0 æ— é”/1 æœ‰é” ï¼Œä¿®æ”¹é€šè¿‡ CASï¼Œä¿è¯åŸå­æ€§ã€‚ ","date":"2023-08-08","objectID":"/juc/:0:8","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview"],"content":"ThreadLocal ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹å‰¯æœ¬ï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å†²çªé—®é¢˜ï¼ŒåŒ…å« setã€getã€remove æ–¹æ³•ï¼Œkey æ˜¯ ThreadLocal è‡ªå·±ï¼Œæ”¾å…¥ ThreadLocalMap ä¸­ã€‚ ä½¿ç”¨åœºæ™¯ åœ¨å¤æ‚çš„é“¾å¼è°ƒç”¨ä¸­ä¼ é€’å‚æ•°ï¼šå·¥ä½œä¸­å¯èƒ½ä¼šé‡åˆ°å¾ˆé•¿çš„è°ƒç”¨é“¾ï¼Œä¾‹å¦‚ï¼šåœ¨A-\u003eB-\u003eC-\u003eDçš„è°ƒç”¨é“¾ä¸­ï¼ŒDéœ€è¦ä½¿ç”¨Açš„å‚æ•°ï¼Œè€Œä¸ºäº†é¿å…ä¸€å±‚å±‚ä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ThreadLocalå°†å‚æ•°å­˜å‚¨åœ¨Aä¸­ï¼Œç„¶ååœ¨Dä¸­å–å‡ºä½¿ç”¨ã€‚ ä¸ºæ¯ä¸ªçº¿ç¨‹ç”Ÿæˆç‹¬ç«‹çš„éšæœºæ•°æˆ–è€…å…¶ä»–ç±»ä¼¼çš„èµ„æºï¼šåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªçº¿ç¨‹ç”Ÿæˆç‹¬äº«çš„å¯¹è±¡ï¼Œé¿å…å¤šçº¿ç¨‹ä¸‹çš„ç«äº‰æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œç»™æ¯ä¸ªçº¿ç¨‹æºå¸¦dateFormatã€‚ static ThreadLocal\u003cSimpleDateFormat\u003e dateFormatThreadLocal = ThreadLocal.withInitial(() -\u003e new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\")); // ...ç•¥ public static String date(int seconds) { //å‚æ•°çš„å•ä½æ˜¯æ¯«ç§’ï¼Œä»1970.1.1 00:00:00 GMTè®¡æ—¶ Date date = new Date(1000 * seconds); SimpleDateFormat dateFormat = dateFormatThreadLocal.get(); return dateFormat.format(date); } ThreadLocalæ˜¯ä¸€ç§é¿å…å…±äº«çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§æ— åŒæ­¥æ–¹æ¡ˆã€‚å…¶å®æŠŠdateFormatå†™åœ¨date()é‡Œé¢ä¹Ÿæ˜¯æ— åŒæ­¥æ–¹æ¡ˆï¼Œåªä¸è¿‡ï¼Œå®ƒå«å¦ä¸€ç§åå­—â€”â€”æ ˆå°é—­ å¼ºã€è½¯ã€å¼±ã€è™šå¼•ç”¨ å¼ºå¼•ç”¨ï¼šnewï¼ŒGC Root ï¼ˆå¯è¾¾æ€§åˆ†æï¼‰æ‰¾ä¸åˆ°æ—¶å›æ”¶ è½¯å¼•ç”¨ï¼šSoftReferenceï¼Œå†…å­˜ä¸è¶³æ—¶å›æ”¶ å¼±å¼•ç”¨ï¼šWeakReferenceï¼Œå§‹ç»ˆå›æ”¶ è™šå¼•ç”¨ï¼šReferenceQueueï¼Œç”± ReferenceHandler çº¿ç¨‹é‡Šæ”¾ å†…å­˜æ³„æ¼é—®é¢˜ static class Entry extends WeakReference\u003cThreadLocal\u003c?\u003e\u003e{ Object value; Entry(ThreadLocal\u003c?\u003e k,Object v){ super(k); // å¼±å¼•ç”¨ï¼ŒGC ä¼šé‡Šæ”¾ value = v; // å¼ºå¼•ç”¨ï¼Œå†…å­˜æ³„æ¼ } } è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨è°ƒç”¨ remove() æ–¹æ³• ","date":"2023-08-08","objectID":"/juc/:0:9","tags":["Java"],"title":"ğŸš©JUC","uri":"/juc/"},{"categories":["interview","practice","ChatGPT"],"content":"å­¦ä¹  JUC ä¸å¾—ä¸æŒæ¡çš„ä»£ç ...","date":"2023-08-08","objectID":"/juc-%E7%BB%8F%E5%85%B8%E4%BB%A3%E7%A0%81/","tags":["Java"],"title":"ğŸš©JUC ç»å…¸ä»£ç ","uri":"/juc-%E7%BB%8F%E5%85%B8%E4%BB%A3%E7%A0%81/"},{"categories":["interview","practice","ChatGPT"],"content":" package juc; import java.util.concurrent.*; /** * ä¸€ä¸ªçº¿ç¨‹1,3,5,7ï¼›ä¸€ä¸ªçº¿ç¨‹ 2,4,6,8ï¼›åˆä½œè¾“å‡º 1,2,3,4,5,6,7,8 * æ ¸å¿ƒæ€æƒ³ï¼š * 1. ä½¿ç”¨synchronizedå…³é”®å­—å¯¹lockå¯¹è±¡è¿›è¡ŒåŒæ­¥ * 2. ä½¿ç”¨waitå’Œnotifyæ–¹æ³•å®ç°çº¿ç¨‹ä¹‹é—´çš„äº¤æ›¿è¾“å‡º * 3. è¾“å‡ºçš„æ•°å­—ç”¨ volatile ä¿®é¥°ï¼Œä¿è¯å¯è§æ€§ */ public class AlternatePrinting { private static final Object lock = new Object(); private static volatile int count = 1; public static void main(String[] args) { // ç­‰ä»·äºnewFixedThreadPoolï¼ˆ2ï¼‰ï¼Œä½†æ˜¯é˜»å¡é˜Ÿåˆ—ä¸Šé™ä¸æ˜¯ Integer.MAX_VALUE ExecutorService executorService = new ThreadPoolExecutor(2, 2, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u003c\u003e(1), new CustomThreadFactory()); executorService.submit(new OddPrinter()); executorService.submit(new EvenPrinter()); executorService.shutdown(); } static class CustomThreadFactory implements ThreadFactory { private static final String THREAD_NAME_PREFIX = \"MyThread-\"; private int threadCount = 1; @Override public Thread newThread(Runnable r) { Thread thread = new Thread(r); thread.setName(THREAD_NAME_PREFIX + threadCount++); return thread; } } static class OddPrinter implements Runnable { @Override public void run() { while (count \u003c= 8) { synchronized (lock) { if (count % 2 != 0) { System.out.println(count++ + \" by \" + Thread.currentThread().getName()); lock.notify(); } else { try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } } } } } static class EvenPrinter implements Runnable { @Override public void run() { while (count \u003c= 8) { synchronized (lock) { if (count % 2 == 0) { System.out.println(count++ + \" by \" + Thread.currentThread().getName()); lock.notify(); } else { try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } } } } } } ä»¥ä¸Šä»£ç ç”± ChatGPT ç”Ÿæˆï¼Œç»éªŒè¯å¯ä»¥å®ç°åŠŸèƒ½ã€‚ ","date":"2023-08-08","objectID":"/juc-%E7%BB%8F%E5%85%B8%E4%BB%A3%E7%A0%81/:0:0","tags":["Java"],"title":"ğŸš©JUC ç»å…¸ä»£ç ","uri":"/juc-%E7%BB%8F%E5%85%B8%E4%BB%A3%E7%A0%81/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/mq_draft/","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"MQ å››å¤§ä½œç”¨ å¼‚æ­¥é€šä¿¡ï¼šå‡å°‘çº¿ç¨‹ç­‰å¾… ç³»ç»Ÿè§£è€¦ å‰Šå³°å¡«è°·ï¼šå‹åŠ›å¤§çš„æ—¶å€™ï¼Œç¼“å†²éƒ¨åˆ†è¯·æ±‚ å¯é é€šä¿¡ï¼šæä¾›å¤šç§æ¶ˆæ¯æ¨¡å¼ã€æœåŠ¡è´¨é‡ã€é¡ºåºä¿éšœç­‰ ","date":"2023-08-08","objectID":"/mq_draft/:0:1","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"æ¶ˆæ¯å¤„ç†æ¨¡å¼ ç‚¹å¯¹ç‚¹ï¼šQueue å‘å¸ƒè®¢é˜…ï¼šå¯¹åº” Topicï¼ˆKafka) ","date":"2023-08-08","objectID":"/mq_draft/:0:2","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"Kafka Brokerï¼šé›†ç¾¤ä¸­çš„æœåŠ¡å™¨ Topicï¼šæ¶ˆæ¯ç±»åˆ«ï¼Œç‰©ç†ä¸Šä¸åŒ Topic çš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ã€é€šè¿‡é¡ºåºå†™å…¥è¾¾åˆ°é«˜ååã€‘ Partitionï¼šæ¯ä¸ª Topic åŒ…å« 1ï½n ä¸ª Partitionã€å¯æ‰©å±•æ€§ã€‘ Producerï¼šç”Ÿäº§è€…ï¼Œè´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ° Brokerï¼Œæœ‰ä¸‰ç§ç¡®è®¤æ¨¡å¼ ack = 0 åªå‘é€ï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸå†™å…¥ broker ack = 1 å†™å…¥åˆ° leader å°±è®¤ä¸ºæˆåŠŸ ack = -1/all å†™å…¥åˆ°æœ€å°å‰¯æœ¬åˆ™è®¤ä¸ºæˆåŠŸ Consumerï¼š æ¶ˆè´¹è€…ï¼Œä» Broker è¯»å–æ¶ˆæ¯ Consumer Groupï¼šæ¯ä¸ª Consumer å±äºä¸€ä¸ªç‰¹å®šçš„ Consumer Group ","date":"2023-08-08","objectID":"/mq_draft/:0:3","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"RabbitMQ ","date":"2023-08-08","objectID":"/mq_draft/:0:4","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"26.2 RocketMQ ","date":"2023-08-08","objectID":"/mq_draft/:0:5","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["draft"],"content":"26.3 Pulsar ","date":"2023-08-08","objectID":"/mq_draft/:0:6","tags":["MQ"],"title":"MQ æ‚è®°","uri":"/mq_draft/"},{"categories":["interview"],"content":"ğŸŒŸRabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ producer ç”Ÿäº§è€…ç¡®è®¤ æŒä¹…åŒ–ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—ã€æ¶ˆæ¯ consumer æ¶ˆè´¹è€…ç¡®è®¤ï¼šç”± spring ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸå ack consumer æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œè¾¾åˆ°ä¸€å®šæ¬¡æ•°åè½¬äººå·¥å¤„ç† ç›‘æ§å’Œå‘Šè­¦ é«˜å¯ç”¨é›†ç¾¤ ","date":"2023-08-08","objectID":"/mq/:0:1","tags":["MQ"],"title":"ğŸš©MQ - æ¶ˆæ¯é˜Ÿåˆ—","uri":"/mq/"},{"categories":["interview"],"content":"ğŸŒŸé‡å¤æ¶ˆè´¹æ€ä¹ˆè§£å†³ï¼Ÿ æ¯æ¡æ¶ˆæ¯è®¾ç½®å”¯ä¸€ id å¹‚ç­‰æ€§æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”ã€æ•°æ®åº“é”ï¼ˆä¹è§‚é”ã€æ‚²è§‚é”ã€å”¯ä¸€ç´¢å¼•ï¼‰ ","date":"2023-08-08","objectID":"/mq/:0:2","tags":["MQ"],"title":"ğŸš©MQ - æ¶ˆæ¯é˜Ÿåˆ—","uri":"/mq/"},{"categories":["interview"],"content":"å»¶è¿Ÿé˜Ÿåˆ— å»¶è¿Ÿæ¶ˆè´¹çš„æ¶ˆæ¯ï¼šè¶…æ—¶è®¢å•ã€é™æ—¶ä¼˜æƒ ã€å®šæ—¶å‘å¸ƒï¼ˆe.g. é›¶é›¶æ’­é¡¹ç›®ä¸­çš„ä»»åŠ¡ï¼‰ å»¶è¿Ÿé˜Ÿåˆ— = æ­»ä¿¡äº¤æ¢æœº + TTL æ­»ä¿¡äº¤æ¢æœº DLXï¼ˆDead Letter Exchangeï¼‰ï¼šå£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œdelayed = true æ­»ä¿¡ dead letter å®šä¹‰ï¼š æ¶ˆè´¹è€…ä½¿ç”¨basic.rejectå£°æ˜æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸” requeue = false æ¶ˆæ¯è¿‡æœŸï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹ï¼ˆå‘é€æ¶ˆæ¯æ—¶æ·»åŠ å‚æ•° x-delay = è¶…æ—¶æ—¶é—´ï¼‰ é˜Ÿåˆ—å·²æ»¡ï¼Œæœ€æ—©çš„æ¶ˆæ¯å¯èƒ½æˆä¸ºæ­»ä¿¡ ","date":"2023-08-08","objectID":"/mq/:0:3","tags":["MQ"],"title":"ğŸš©MQ - æ¶ˆæ¯é˜Ÿåˆ—","uri":"/mq/"},{"categories":["interview"],"content":"ğŸŒŸå¤§æ•°æ®å †ç§¯åœ¨ MQ æ€ä¹ˆåŠï¼Ÿ å•ä¸ªæ¶ˆè´¹è€…-å¤šçº¿ç¨‹æ¶ˆè´¹ å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ ä½¿ç”¨ RabbitMQ æƒ°æ€§é˜Ÿåˆ—ï¼Œæ”¯æŒç™¾ä¸‡æ¡æ¶ˆæ¯å­˜å‚¨ å°†æ¶ˆæ¯ç›´æ¥å­˜å…¥ç£ç›˜ æ¶ˆè´¹è€…ä»ç£ç›˜è¯»æ¶ˆæ¯ ","date":"2023-08-08","objectID":"/mq/:0:4","tags":["MQ"],"title":"ğŸš©MQ - æ¶ˆæ¯é˜Ÿåˆ—","uri":"/mq/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"æ¶ˆæ¯å¼•æ“ç³»ç»Ÿ ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"å®šä¹‰ æŒä¹…åŒ–èƒ½åŠ›ï¼šTBçº§åˆ«æ•°æ®ä¿æŒO(1)çš„æ—¶é—´å¤æ‚åº¦ é«˜ååç‡ï¼š100kps åˆ†å¸ƒå¼æ¶ˆè´¹ï¼šæ¯ä¸ªpartitionå†…æ¶ˆæ¯é¡ºåºä¼ è¾“ æ”¯æŒç¦»çº¿å’Œå®æ—¶å¤„ç† æ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±• ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:1","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"åŸºæœ¬æ¦‚å¿µ brokerï¼škafkaçš„æœåŠ¡å™¨ topicï¼šå‘å¸ƒåˆ°kafkaé›†ç¾¤çš„æ¶ˆæ¯çš„ç±»åˆ« partitionï¼šç‰©ç†åˆ†åŒºï¼Œæ¯ä¸ªtopicåŒ…å«1ï½nä¸ªpartition producerï¼šè´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°kafka broker consumerï¼šå‘kafka broker è¯»å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ consumer groupï¼šæ¯ä¸ªconsumerå¯ä»¥å±äºä¸€ä¸ªç‰¹å®šçš„group ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:2","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"ç‰¹æ€§ brokerå¼ºä¾èµ–zookeeper å¤špartitionæ”¯æŒæ°´å¹³æ‰©å±•å’Œå¹¶è¡Œå¤„ç†ï¼Œé¡ºåºå†™å…¥æå‡ååæ€§èƒ½ å®¹é”™æ€§ï¼šæ¯ä¸ªpartitionå¯ä»¥é€šè¿‡å‰¯æœ¬å› å­æ·»åŠ å¤šä¸ªå‰¯æœ¬ï¼ˆ3å‰¯æœ¬2ç¡®è®¤ï¼Œ5å‰¯æœ¬3ç¡®è®¤ï¼‰ Kafka ç®€ä»‹ æœåŠ¡å™¨ç«¯ï¼šBrokeré›†ç¾¤ï¼Œåˆ†æ•£è¿è¡Œåœ¨ä¸åŒæœºå™¨ä»¥å®ç°é«˜å¯ç”¨ å®¢æˆ·ç«¯ï¼š ç”Ÿäº§è€…ï¼ˆProducerï¼‰ï¼šå‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯ æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼šå‘ä¸»é¢˜è®¢é˜…æ–°æ¶ˆæ¯ ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼ˆPeer to Peerï¼ŒP2Pï¼‰ æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹åŒæ—¶æ¶ˆè´¹ï¼ŒåŠ é€Ÿæ•´ä¸ªæ¶ˆè´¹ç«¯çš„ååé‡ï¼ˆTPSï¼‰ é‡å¹³è¡¡ï¼ˆRebalanceï¼‰ï¼šæ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºçš„è¿‡ç¨‹ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å‹ å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰ï¼ˆv0.8ï¼‰ é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰ï¼šå”¯ä¸€å¯¹å¤–æä¾›æœåŠ¡ è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰ï¼šè¿½éšé¢†å¯¼è€… åˆ†åŒºï¼ˆPartitioningï¼‰ ä¸»é¢˜ï¼ˆTopicï¼‰ï¼šä¸»é¢˜æ˜¯æ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œæ˜¯å‘å¸ƒè®¢é˜…çš„å¯¹è±¡ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­å¤šç”¨æ¥åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡ åˆ†åŒºï¼ˆPartitionï¼‰ï¼šä¸€ä¸ªæœ‰åºä¸å˜çš„æ¶ˆæ¯åºåˆ—ï¼Œå°†æ¯ä¸ªä¸»é¢˜åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºï¼ˆPartitionï¼‰ï¼Œ ç”Ÿäº§è€…ç”Ÿäº§çš„æ¯æ¡æ¶ˆæ¯åªä¼šè¢«å‘é€åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ã€‚ Kafka çš„ä¸‰å±‚æ¶ˆæ¯æ¶æ„ ä¸»é¢˜å±‚ï¼šæ¯ä¸ªä¸»é¢˜å¯ä»¥é…ç½® M ä¸ªåˆ†åŒºï¼Œè€Œæ¯ä¸ªåˆ†åŒºåˆå¯ä»¥é…ç½® N ä¸ªå‰¯æœ¬ åˆ†åŒºå±‚ï¼šæ¯ä¸ªåˆ†åŒºçš„ N ä¸ªå‰¯æœ¬ä¸­åªèƒ½æœ‰ä¸€ä¸ªå……å½“é¢†å¯¼è€…è§’è‰²ï¼Œå¯¹å¤–æä¾›æœåŠ¡ï¼›å…¶ä»– N-1 ä¸ªå‰¯æœ¬æ˜¯è¿½éšè€…å‰¯æœ¬ï¼Œåªæ˜¯æä¾›æ•°æ®å†—ä½™ä¹‹ç”¨ã€‚ æ¶ˆæ¯å±‚ï¼šåˆ†åŒºä¸­åŒ…å«è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯çš„ä½ç§»ä» 0 å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ã€‚ æœ€åï¼Œå®¢æˆ·ç«¯ç¨‹åºåªèƒ½ä¸åˆ†åŒºçš„é¢†å¯¼è€…å‰¯æœ¬è¿›è¡Œäº¤äº’ã€‚ ä½ç§» æ¶ˆè´¹è€…ä½ç§»ï¼ˆConsumer Offsetï¼‰ï¼šæ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦çš„æŒ‡ç¤ºå™¨ï¼Œå¯èƒ½æ˜¯éšæ—¶å˜åŒ–çš„ï¼› åˆ†åŒºä½ç§»ï¼šæ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç§»ï¼Œè¡¨å¾çš„æ˜¯åˆ†åŒºå†…çš„æ¶ˆæ¯ä½ç½®ï¼Œå®ƒæ˜¯å•è°ƒé€’å¢ä¸”ä¸å˜çš„ã€‚ Kafka Streamsï¼ˆv0.10ï¼‰ ğŸŒŸApache Kafka æ˜¯æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼ˆDistributed Streaming Platformï¼‰ Kafka ä¸å…¶ä»–ä¸»æµå¤§æ•°æ®æµå¼è®¡ç®—æ¡†æ¶ç›¸æ¯”çš„ä¼˜åŠ¿ï¼Ÿ æ›´å®¹æ˜“å®ç°ç«¯åˆ°ç«¯çš„æ­£ç¡®æ€§ï¼ˆCorrectnessï¼‰ çµæ´»æ€§ï¼šKafka Streams æ˜¯ä¸€ä¸ªç”¨äºæ­å»ºå®æ—¶æµå¤„ç†çš„å®¢æˆ·ç«¯åº“è€Œéæ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ç³»ç»Ÿ ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:1:3","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"Kafka åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ Kafka ç‰ˆæœ¬å¯¹æ¯” Apache Kafkaï¼šå¼€å‘äººæ•°æœ€å¤šã€ç‰ˆæœ¬è¿­ä»£é€Ÿåº¦æœ€å¿«ï¼Œç”¨æˆ·ä»…ä»…éœ€è¦ä¸€ä¸ªæ¶ˆæ¯å¼•æ“ç³»ç»Ÿäº¦æˆ–æ˜¯ç®€å•çš„æµå¤„ç†åº”ç”¨åœºæ™¯ï¼ŒåŒæ—¶éœ€è¦å¯¹ç³»ç»Ÿæœ‰è¾ƒå¤§æŠŠæ§åº¦ï¼›ã€æ›´æ–°å¿«ï¼ŒæŠŠæ§åº¦é«˜ã€‘ Confluent Kafkaï¼šç”¨æˆ·éœ€è¦ç”¨åˆ° Kafka çš„ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œä¸­æ–‡æ–‡æ¡£å°‘ï¼›ã€é«˜çº§ç‰¹æ€§ã€‘ CDH/HDP Kafkaï¼šæ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥åœ¨å‰ç«¯ UI ç•Œé¢ä¸Šå®Œæˆï¼Œç”¨æˆ·éœ€è¦å¿«é€Ÿåœ°æ­å»ºæ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œæˆ–è€…éœ€è¦æ­å»ºçš„æ˜¯å¤šæ¡†æ¶æ„æˆçš„æ•°æ®å¹³å°ä¸” Kafka åªæ˜¯å…¶ä¸­ä¸€ä¸ªç»„ä»¶ã€‚ã€èŠ‚çœè¿ç»´æˆæœ¬ã€‘ ç£ç›˜é€‰æ‹© æœºæ¢°ç£ç›˜æˆæœ¬ä½ä¸”å®¹é‡å¤§ï¼Œä½†æ˜“æŸåï¼›å›ºæ€ç¡¬ç›˜æ€§èƒ½ä¼˜åŠ¿å¤§ï¼Œä¸è¿‡å•ä»·é«˜ã€‚è€Œ Kafka å¤šæ˜¯é¡ºåºè¯»å†™æ“ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šè§„é¿äº†æœºæ¢°ç£ç›˜éšæœºè¯»å†™æ“ä½œæ…¢çš„åŠ£åŠ¿ï¼Œæ‰€ä»¥é€‰æ‹©æœºæ¢°ç£ç›˜å³å¯ã€‚ å°± Kafka è€Œè¨€ï¼Œä¸€æ–¹é¢ Kafka è‡ªå·±å®ç°äº†å†—ä½™æœºåˆ¶æ¥æä¾›é«˜å¯é æ€§ï¼›å¦ä¸€æ–¹é¢é€šè¿‡åˆ†åŒºçš„æ¦‚å¿µï¼ŒKafka ä¹Ÿèƒ½åœ¨è½¯ä»¶å±‚é¢è‡ªè¡Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥å¯ä»¥ä¸æ­å»ºç£ç›˜é˜µåˆ—ï¼ˆRAIDï¼‰ I/Oæ¨¡å‹ Kafka å®¢æˆ·ç«¯åº•å±‚ä½¿ç”¨äº† Java çš„ selectorï¼Œåœ¨ä¸åŒå¹³å°ä¸Šçš„ I/O æ¨¡å‹ä¸åŒï¼š Linuxï¼šepollï¼Œä»‹äºI/O å¤šè·¯å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/Oä¹‹é—´ï¼› Windowsï¼šselectï¼Œå±äºI/O å¤šè·¯å¤ç”¨æ¨¡å‹ã€‚ é›¶æ‹·è´ï¼ˆZero Copyï¼‰ï¼šå½“æ•°æ®åœ¨ç£ç›˜å’Œç½‘ç»œè¿›è¡Œä¼ è¾“æ—¶ï¼Œé¿å…æ˜‚è´µçš„å†…æ ¸æ€æ•°æ®æ‹·è´ï¼Œä»è€Œå®ç°å¿«é€Ÿåœ°æ•°æ®ä¼ è¾“ã€‚ Kafka é›†ç¾¤é…ç½®å‚æ•° ä»¥ä¸‹ä¸»è¦ä¸ºéœ€è¦ä¿®æ”¹é»˜è®¤å€¼çš„å‚æ•°ã€‚ Broker ç«¯å‚æ•° log.dirsï¼šç”¨é€—å·åˆ†å‰²æ–‡ä»¶ç›®å½•è·¯å¾„ï¼Œæœ€å¥½ä¿è¯è¿™äº›ç›®å½•æŒ‚è½½åˆ°ä¸åŒçš„ç‰©ç†ç£ç›˜ä¸Šï¼Œä»¥æé«˜æ€§èƒ½ã€æ•…éšœè½¬ç§»ï¼ˆFailoverï¼‰ã€‚å¦‚ï¼š`/home/kafka1,/home/kafka2,/home/kafka3`` zookeeper.connectï¼šchroot æ˜¯ ZooKeeper çš„æ¦‚å¿µï¼Œç±»ä¼¼äºåˆ«åï¼Œåªéœ€è¦å†™ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯åŠ åˆ°æœ€åçš„ã€‚å¦‚ï¼šzk1:2181,zk2:2181,zk3:2181/kafka1å’Œzk1:2181,zk2:2181,zk3:2181/kafka2 listenersï¼šç›‘å¬å™¨ï¼Œå‘Šè¯‰å¤–éƒ¨è¿æ¥è€…è¦é€šè¿‡ä»€ä¹ˆåè®®è®¿é—®æŒ‡å®šä¸»æœºåå’Œç«¯å£å¼€æ”¾çš„ Kafka æœåŠ¡ï¼Œæ ¼å¼ä¸Šæ˜¯è‹¥å¹²ä¸ªé€—å·åˆ†éš”çš„ä¸‰å…ƒç»„ï¼Œæ¯ä¸ªä¸‰å…ƒç»„çš„æ ¼å¼ä¸º\u003cåè®®åç§°ï¼Œä¸»æœºåï¼Œç«¯å£å·\u003eï¼Œå…¶ä¸­ä¸»æœºåå»ºè®®ä½¿ç”¨åŸŸåï¼Œè€Œä¸æ˜¯IPåœ°å€ã€‚å¦‚æœè‡ªå®šä¹‰åè®®åå­—ï¼Œå¦‚ï¼šCONTROLLER://localhost:9092ï¼Œå°±éœ€è¦æŒ‡å®šåè®®åº•å±‚ä½¿ç”¨äº†å“ªç§å®‰å…¨åè®®ï¼Œå¦‚ï¼šlistener.security.protocol.map=CONTROLLER:PLAINTEXT advertised.listenersï¼šæ ¼å¼åŒä¸Šã€‚ä¸»è¦æ˜¯ä¸ºå¤–ç½‘è®¿é—®ç”¨çš„ï¼Œå¦‚æœclientsåœ¨å†…ç½‘ç¯å¢ƒè®¿é—®ä¸éœ€è¦é…ç½®è¿™ä¸ªå‚æ•°ã€‚ auto.create.topics.enableï¼šæ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topicã€‚å»ºè®® falseï¼Œæ–¹ä¾¿ç®¡ç†ã€‚ ğŸŒŸunclean.leader.election.enableï¼šæ˜¯å¦å…è®¸ Unclean Leader é€‰ä¸¾ã€‚å»ºè®® falseï¼Œé˜²æ­¢è½åè¿›åº¦å¤ªå¤šçš„å‰¯æœ¬ç«é€‰ Leaderã€‚ auto.leader.rebalance.enableï¼šæ˜¯å¦å…è®¸å®šæœŸè¿›è¡Œ Leader é€‰ä¸¾ã€‚å»ºè®® falseï¼Œé˜²æ­¢æ— æ„ä¹‰åœ°æ¢ Leader å¯¼è‡´æ€§èƒ½é™ä½ã€‚ log.retention.{hour|minutes|ms}ï¼šæ§åˆ¶ä¸€æ¡æ¶ˆæ¯æ•°æ®è¢«ä¿å­˜å¤šé•¿æ—¶é—´ã€‚ä»ä¼˜å…ˆçº§ä¸Šæ¥è¯´ ms è®¾ç½®æœ€é«˜ã€minutes æ¬¡ä¹‹ã€hour æœ€ä½ã€‚æ¯”å¦‚log.retention.hour=168è¡¨ç¤ºé»˜è®¤ä¿å­˜ 7 å¤©çš„æ•°æ® log.retention.bytesï¼šæŒ‡å®š Broker ä¸ºæ¶ˆæ¯ä¿å­˜çš„æ€»ç£ç›˜å®¹é‡å¤§å°ã€‚é»˜è®¤å€¼ä¸º -1ï¼Œä¸ä½œé™åˆ¶ï¼Œä½¿ç”¨äº‘ä¸Š Kafka æœåŠ¡æ—¶ï¼Œéœ€è¦åšä¸€å®šé™åˆ¶ã€‚ message.max.bytesï¼šæ§åˆ¶ Broker èƒ½å¤Ÿæ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯å¤§å°ã€‚é»˜è®¤å€¼ä¸º 1000012ï¼Œä¸åˆ°1MBï¼Œå»ºè®®è®¾ç½®ä¸€ä¸ªè¾ƒå¤§å€¼ã€‚ Topic çº§åˆ«å‚æ•° Topic çº§åˆ«å‚æ•°ä¼šè¦†ç›–å…¨å±€ Broker å‚æ•°çš„å€¼ã€‚ retention.msï¼šè§„å®šäº†è¯¥ Topic æ¶ˆæ¯è¢«ä¿å­˜çš„æ—¶é•¿ï¼Œé»˜è®¤æ˜¯ 7 å¤©ã€‚ retention.bytesï¼šè§„å®šäº†è¦ä¸ºè¯¥ Topic é¢„ç•™å¤šå¤§çš„ç£ç›˜ç©ºé—´ã€‚å’Œå…¨å±€å‚æ•°ä½œç”¨ç›¸ä¼¼ï¼Œè¿™ä¸ªå€¼é€šå¸¸åœ¨å¤šç§Ÿæˆ·çš„ Kafka é›†ç¾¤ä¸­ä¼šæœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å½“å‰é»˜è®¤å€¼æ˜¯ -1ï¼Œè¡¨ç¤ºå¯ä»¥æ— é™ä½¿ç”¨ç£ç›˜ç©ºé—´ã€‚ max.message.bytesï¼šå†³å®šäº† Kafka Broker èƒ½å¤Ÿæ­£å¸¸æ¥æ”¶è¯¥ Topic çš„æœ€å¤§æ¶ˆæ¯å¤§å° è®¾ç½®æ—¶æœºï¼š åˆ›å»º Topic æ—¶ï¼šbin/kafka-topics.sh --bootstrap -server localhost:9092 --create --topictransaction --partitions1 --replication -factor1 --configretention.ms=15552000000 --configmax.message.bytes=5242880 ä¿®æ”¹ Topic æ—¶ï¼ˆå»ºè®®ï¼‰ï¼šbin/kafka-configs.sh --zookeeperlocalhost:2181 --entity -typetopics --entity -nametransaction --alter --add -configmax.message.bytes=10485760 JVM å‚æ•° å †å†…å­˜ï¼šå»ºè®® 6G export KAFKA_HEAP_OPTS=--Xms6g --Xmx6g GCï¼šä¼˜å…ˆä½¿ç”¨ G1 G1ï¼šJDK 8 ç›´æ¥ä½¿ç”¨ï¼Œå…·æœ‰æ›´å°‘çš„ Full GCï¼Œéœ€è¦è°ƒæ•´çš„å‚æ•°æ›´å°‘ -XX:+UseCurrentMarkSweepGCï¼šJDK 8 ä»¥ä¸‹åœ¨ Broker æ‰€åœ¨æœºå™¨çš„ CPU èµ„æºéå¸¸å……è£•æ—¶ä½¿ç”¨ -XX:+UseParallelGC export KAFKA_JVM_PERFORMANCE_OPTS= -server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -Djava.awt.headless=true æ“ä½œç³»ç»Ÿå‚æ•° æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼šè®¾ç½®ä¸€ä¸ªè¶…å¤§ä¸Šé™ï¼Œå¦‚ï¼šulimit -n 1000000 æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šXFS \u003e ext4 swappniess è°ƒä¼˜ï¼šå»ºè®®é…ç½®æˆä¸€ä¸ªæ¥è¿‘ 0 ä½†ä¸ä¸º 0 çš„å€¼ï¼Œæ¯”å¦‚ 1ï¼Œè¿™æ ·èƒ½å¤Ÿè§‚æµ‹åˆ° Broker æ€§èƒ½å¼€å§‹å‡ºç°æ€¥å‰§ä¸‹é™ï¼Œä»è€Œç»™ä½ è¿›ä¸€æ­¥è°ƒä¼˜å’Œè¯Šæ–­é—®é¢˜çš„æ—¶é—´ã€‚ æäº¤æ—¶é—´ï¼šå‘ Kafka å‘é€æ•°æ®å¹¶ä¸æ˜¯çœŸè¦ç­‰æ•°æ®è¢«å†™å…¥ç£ç›˜æ‰ä¼šè®¤ä¸ºæˆåŠŸï¼Œè€Œæ˜¯åªè¦æ•°æ®è¢«å†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰ä¸Šå°±å¯ä»¥äº†ï¼Œéšåæ“ä½œç³»ç»Ÿæ ¹æ® LRU ç®—æ³•ä¼šå®šæœŸï¼ˆç”±æäº¤æ—¶é—´å†³å®šï¼‰å°†é¡µç¼“å­˜ä¸Šçš„â€œè„â€æ•°æ®è½ç›˜åˆ°ç‰©ç†ç£ç›˜ä¸Šã€‚é»˜è®¤å€¼ä¸º 5 ç§’ï¼Œå»ºè®®è°ƒå¤§æäº¤é—´éš”å»æ¢å–æ€§èƒ½ã€‚ ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:2:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"Kafka å®¢æˆ·ç«¯ åˆ†åŒºç­–ç•¥ å¦‚æœæŒ‡å®šäº† Keyï¼Œé‚£ä¹ˆé»˜è®¤å®ç°æŒ‰æ¶ˆæ¯é”®ä¿åºç­–ç•¥ï¼› å¦‚æœæ²¡æœ‰æŒ‡å®š Keyï¼Œåˆ™ä½¿ç”¨è½®è¯¢ç­–ç•¥ï¼› é’ˆå¯¹é‚£äº›å¤§è§„æ¨¡çš„ Kafka é›†ç¾¤ï¼Œå¯ä½¿ç”¨åŸºäºåœ°ç†ä½ç½®çš„åˆ†åŒºç­–ç•¥ æ•°æ®å‹ç¼©ç®—æ³• Producer ç«¯å‹ç¼©ã€Broker ç«¯ä¿æŒã€Consumer ç«¯è§£å‹ç¼©ã€‚ ç„¶è€Œï¼ŒBroker ç«¯ä»ç„¶ä¼šå‘ç”Ÿæ¶ˆæ¯æ ¼å¼è½¬æ¢æ—¶å‘ç”Ÿçš„è§£å‹ç¼©ï¼Œè¿™ç§æ¶ˆæ¯æ ¡éªŒæ˜¯å¿…è¦çš„ã€‚ åº”å½“å°½é‡è§„é¿æ‰ä¸ºäº†å…¼å®¹è€ç‰ˆæœ¬è€Œå¼•å…¥çš„è§£å‹ç¼©ã€‚ GZIP Snappy LZ4ï¼šååé‡æœ€é«˜ Zstandard ï¼ˆç®€å†™ä¸º zstdï¼‰ï¼šä» Kafka 2.1.0 å¼€å§‹æ”¯æŒã€‚å®ƒæ˜¯ Facebook å¼€æºçš„ä¸€ä¸ªå‹ç¼©ç®—æ³•ï¼Œèƒ½å¤Ÿæä¾›è¶…é«˜çš„å‹ç¼©æ¯”ï¼ˆcompression ratioï¼‰ benchmarkï¼ˆåŸºå‡†æµ‹è¯•ï¼‰ç»“æœï¼š åœ¨ååé‡æ–¹é¢ï¼šLZ4 \u003e Snappy \u003e zstd å’Œ GZIPï¼› è€Œåœ¨å‹ç¼©æ¯”æ–¹é¢ï¼Œzstd \u003e LZ4 \u003e GZIP \u003e Snappy æ¶ˆæ¯æ— ä¸¢å¤± ğŸŒŸKafka åªå¯¹â€œå·²æäº¤â€çš„æ¶ˆæ¯ï¼ˆcommitted messageï¼‰åšæœ‰é™åº¦çš„æŒä¹…åŒ–ä¿è¯ã€‚ è®¾ç½® acks = allã€‚acks æ˜¯ Producer çš„ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨äº†ä½ å¯¹â€œå·²æäº¤â€æ¶ˆæ¯çš„å®šä¹‰ã€‚å¦‚æœè®¾ç½®æˆ allï¼Œåˆ™è¡¨æ˜æ‰€æœ‰å‰¯æœ¬ Broker éƒ½è¦æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯æ‰ç®—æ˜¯â€œå·²æäº¤â€ã€‚è¿™æ˜¯æœ€é«˜ç­‰çº§çš„â€œå·²æäº¤â€å®šä¹‰ã€‚ è®¾ç½® retries ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ã€‚è¿™é‡Œçš„ retries åŒæ ·æ˜¯ Producer çš„å‚æ•°ï¼Œå¯¹åº”å‰é¢æåˆ°çš„ Producer è‡ªåŠ¨é‡è¯•ã€‚å½“å‡ºç°ç½‘ç»œçš„ç¬æ—¶æŠ–åŠ¨æ—¶ï¼Œæ¶ˆæ¯å‘é€å¯èƒ½ä¼šå¤±è´¥ï¼Œæ­¤æ—¶é…ç½®äº† retries \u003e 0 çš„ Producer èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚ å¯¹äº Broker ç«¯çš„å‚æ•°ï¼Œè®¾ç½®æ¶ˆæ¯ä¿å­˜ä»½æ•° replication.factor \u003e= 3ï¼Œè®¾ç½®æ¶ˆæ¯å†™å…¥å‰¯æœ¬æ•° min.insync.replicas \u003e 1ï¼Œå¯ä»¥æå‡æ¶ˆæ¯æŒä¹…æ€§ï¼Œæ¨èè®¾ç½®æˆ replication.factor = min.insync.replicas + 1 Producer ç«¯ä¸¢å¤±æ•°æ® æ°¸è¿œè¦ä½¿ç”¨å¸¦æœ‰å›è°ƒé€šçŸ¥çš„å‘é€ API ä¸è¦ä½¿ç”¨ producer.send(msg)ï¼Œè¿™æ˜¯â€œfire and forgetâ€ï¼Œå³â€œå‘å°„åä¸ç®¡â€ï¼› è€Œè¦ä½¿ç”¨ producer.send(msg, callback) Consumer ç«¯ä¸¢å¤±æ•°æ® ä¿è¯å…ˆæ¶ˆè´¹æ¶ˆæ¯ï¼Œåæ›´æ–°ä½ç§» å¦‚æœæ˜¯å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†æ¶ˆè´¹æ¶ˆæ¯ï¼ŒConsumer ç¨‹åºä¸è¦å¼€å¯è‡ªåŠ¨æäº¤ä½ç§»ï¼Œè€Œæ˜¯è¦åº”ç”¨ç¨‹åºæ‰‹åŠ¨æäº¤ä½ç§»ï¼Œå³enable.auto.commit = false Kafka æ‹¦æˆªå™¨ Producer ç«¯ æ‹¦æˆªå™¨å®ç°ç±»éƒ½è¦ç»§æ‰¿æ¥å£ï¼š org.apache.kafka.clients.producer.ProducerInterceptor onSendï¼šè¯¥æ–¹æ³•ä¼šåœ¨æ¶ˆæ¯å‘é€ä¹‹å‰è¢«è°ƒç”¨ã€‚ onAcknowledgementï¼šè¯¥æ–¹æ³•ä¼šåœ¨æ¶ˆæ¯æˆåŠŸæäº¤æˆ–å‘é€å¤±è´¥ä¹‹åè¢«è°ƒç”¨ï¼Œæ—©äº callback çš„è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•å¤„åœ¨ Producer å‘é€çš„ä¸»è·¯å¾„ä¸­ï¼Œæ‰€ä»¥æœ€å¥½åˆ«æ”¾ä¸€äº›å¤ªé‡çš„é€»è¾‘è¿›å»ï¼Œå¦åˆ™ä½ ä¼šå‘ç°ä½ çš„ Producer TPS ç›´çº¿ä¸‹é™ã€‚ Consumer ç«¯ æ‹¦æˆªå™¨å®ç°ç±»éƒ½è¦ç»§æ‰¿å€Ÿå£ï¼š org.apache.kafka.clients.consumer.ConsumerInterceptor onConsumeï¼šè¯¥æ–¹æ³•åœ¨æ¶ˆæ¯è¿”å›ç»™ Consumer ç¨‹åºä¹‹å‰ï¼ˆæ­£å¼å¤„ç†æ¶ˆæ¯ä¹‹å‰ï¼‰è°ƒç”¨ã€‚ onCommitï¼šConsumer åœ¨æäº¤ä½ç§»ä¹‹åè°ƒç”¨è¯¥æ–¹æ³•ã€‚é€šå¸¸ä½ å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­åšä¸€äº›è®°è´¦ç±»çš„åŠ¨ä½œï¼Œæ¯”å¦‚æ‰“æ—¥å¿—ç­‰ã€‚ ä½¿ç”¨åœºæ™¯ ç«¯åˆ°ç«¯ç³»ç»Ÿæ€§èƒ½æ£€æµ‹ã€æ¶ˆæ¯å®¡è®¡ Kafka é‡‡ç”¨ TCP åè®® Producer å¯åŠ¨æ—¶ä¼šé¦–å…ˆåˆ›å»ºä¸bootstrap.servers ä¸­æ‰€æœ‰ Broker çš„ TCP è¿æ¥ï¼Œæ‰€ä»¥åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸å»ºè®®æŠŠé›†ç¾¤ä¸­æ‰€æœ‰çš„ Broker ä¿¡æ¯éƒ½é…ç½®åˆ° bootstrap.servers ä¸­ï¼Œé€šå¸¸ä½ æŒ‡å®š 3ï½4 å°å°±è¶³ä»¥äº†ã€‚å› ä¸º Producer ä¸€æ—¦è¿æ¥åˆ°é›†ç¾¤ä¸­çš„ä»»ä¸€å° Brokerï¼Œå°±èƒ½æ‹¿åˆ°æ•´ä¸ªé›†ç¾¤çš„ Broker ä¿¡æ¯ï¼Œæ•…æ²¡å¿…è¦ä¸º bootstrap.servers æŒ‡å®šæ‰€æœ‰çš„ Brokerã€‚ TCP è¿æ¥åˆ›å»ºæ—¶æœº åœ¨åˆ›å»º KafkaProducer å®ä¾‹æ—¶ åœ¨æ›´æ–°å…ƒæ•°æ®å å½“ Producer å°è¯•ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„ä¸»é¢˜å‘é€æ¶ˆæ¯æ—¶ï¼ŒBroker ä¼šå‘Šè¯‰ Producer è¯´è¿™ä¸ªä¸»é¢˜ä¸å­˜åœ¨ã€‚æ­¤æ—¶ Producer ä¼šå‘é€ METADATA è¯·æ±‚ç»™ Kafka é›†ç¾¤ï¼Œå»å°è¯•è·å–æœ€æ–°çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ Producer é€šè¿‡metadata.max.age.ms å‚æ•°å®šæœŸåœ°å»æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 300000ï¼Œå³ 5 åˆ†é’Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡é›†ç¾¤é‚£è¾¹æ˜¯å¦æœ‰å˜åŒ–ï¼ŒProducer æ¯ 5 åˆ†é’Ÿéƒ½ä¼šå¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡å…ƒæ•°æ®ä»¥ä¿è¯å®ƒæ˜¯æœ€åŠæ—¶çš„æ•°æ®ã€‚ åœ¨æ¶ˆæ¯å‘é€æ—¶ TCP è¿æ¥å…³é—­æ—¶æœº ç”¨æˆ·ä¸»åŠ¨å…³é—­ producer.close() æˆ– KafkaConsumer.close() ï¼ˆæ¨èï¼‰ kill -9 è¿›ç¨‹ Kafka è‡ªåŠ¨å…³é—­ Producer ç«¯å‚æ•° connections.max.idle.msçš„å€¼ï¼Œé»˜è®¤9åˆ†é’Ÿï¼Œå³å¦‚æœåœ¨ 9 åˆ†é’Ÿå†…æ²¡æœ‰ä»»ä½•è¯·æ±‚â€œæµè¿‡â€æŸä¸ª TCP è¿æ¥ï¼Œé‚£ä¹ˆ Kafka ä¼šä¸»åŠ¨å¸®ä½ æŠŠè¯¥ TCP è¿æ¥å…³é—­ã€‚è‹¥æ”¹ä¸º -1ï¼ŒTCP è¿æ¥å°†æˆä¸ºæ°¸ä¹…é•¿è¿æ¥ã€‚ TCP è¿æ¥æ˜¯åœ¨ Broker ç«¯è¢«å…³é—­çš„ï¼Œä½†å…¶å®è¿™ä¸ª TCP è¿æ¥çš„å‘èµ·æ–¹æ˜¯å®¢æˆ·ç«¯ï¼Œå› æ­¤åœ¨ TCP çœ‹æ¥ï¼Œè¿™å±äºè¢«åŠ¨å…³é—­çš„åœºæ™¯ï¼Œå³ passive closeã€‚è¢«åŠ¨å…³é—­çš„åæœå°±æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„ CLOSE_WAIT è¿æ¥ï¼Œå› æ­¤ Producer ç«¯æˆ– Client ç«¯æ²¡æœ‰æœºä¼šæ˜¾å¼åœ°è§‚æµ‹åˆ°æ­¤è¿æ¥å·²è¢«ä¸­æ–­ã€‚ Consumer ç«¯ç®¡ç† TCP å’Œç”Ÿäº§è€…ä¸åŒçš„æ˜¯ï¼Œæ„å»º KafkaConsumer å®ä¾‹æ—¶æ˜¯ä¸ä¼šåˆ›å»ºä»»ä½• TCP è¿æ¥çš„ã€‚ TCP è¿æ¥æ˜¯åœ¨è°ƒç”¨ KafkaConsumer.poll æ–¹æ³•æ—¶è¢«åˆ›å»ºçš„ï¼š å‘èµ· FindCoordinator è¯·æ±‚æ—¶ï¼šå¸Œæœ› Kafka é›†ç¾¤å‘Šè¯‰å®ƒå“ªä¸ª Broker æ˜¯ç®¡ç†å®ƒçš„åè°ƒè€…ï¼Œå•å‘é€‰æ‹©å¾…å‘é€è¯·æ±‚æœ€å°‘çš„ Brokerï¼› è¿æ¥åè°ƒè€…æ—¶ï¼šæ¶ˆè´¹è€…çŸ¥æ™“äº†çœŸæ­£çš„åè°ƒè€…åï¼Œä¼šåˆ›å»ºè¿å‘è¯¥ Broker çš„ Socket è¿æ¥ æ¶ˆè´¹æ•°æ®æ—¶ æ¶ˆæ¯äº¤ä»˜å¯é æ€§ä¿éšœ æœ€å¤šä¸€æ¬¡ï¼ˆat most onceï¼‰ï¼šæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ç»ä¸ä¼šè¢«é‡å¤å‘é€ã€‚ è‡³å°‘ä¸€æ¬¡ï¼ˆat least onceï¼‰ï¼šæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä½†æœ‰å¯èƒ½è¢«é‡å¤å‘é€ã€‚ ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly onceï¼‰ï¼šæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šè¢«é‡å¤å‘é€ã€‚ å¹‚ç­‰æ€§ Producer props.put(â€œenable.idempotenceâ€, true)ï¼šProducer è‡ªåŠ¨å‡çº§æˆå¹‚ç­‰æ€§ Producerï¼Œåªèƒ½å¤Ÿä¿è¯æŸä¸ªä¸»é¢˜çš„ä¸€ä¸ªåˆ†åŒºä¸Šä¸å‡ºç°é‡å¤æ¶ˆæ¯ï¼Œä½†æ— æ³•å®ç°å¤šä¸ªåˆ†åŒºçš„å¹‚ç­‰æ€§ï¼›å…¶æ¬¡ï¼Œå®ƒåªèƒ½å®ç°å•ä¼šè¯ä¸Šçš„å¹‚ç­‰æ€§ï¼Œä¸èƒ½å®ç°è·¨ä¼šè¯çš„å¹‚ç­‰æ€§ã€‚è¿™é‡Œçš„ä¼šè¯ï¼Œä½ å¯ä»¥ç†è§£ä¸º Producer è¿›ç¨‹çš„ä¸€æ¬¡è¿è¡Œã€‚å½“ä½ é‡å¯äº† Producer è¿›ç¨‹ä¹‹åï¼Œè¿™ç§å¹‚ç­‰æ€§ä¿è¯å°±ä¸§å¤±äº†ã€‚ äº‹åŠ¡å‹ Producer äº‹åŠ¡æä¾›çš„å®‰å…¨æ€§ä¿éšœæ˜¯ç»å…¸çš„ ACID åŸå­æ€§ï¼ˆAtomicityï¼‰ ä¸€è‡´æ€§ (Consistency) éš”ç¦»æ€§ (Isolation) ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡å½¼æ­¤ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ isolation.level å‚æ•°ï¼š read_uncommittedï¼šè¿™æ˜¯é»˜è®¤å€¼ï¼Œè¡¨æ˜ Consumer èƒ½å¤Ÿè¯»å–åˆ° Kafka å†™å…¥çš„ä»»ä½•æ¶ˆæ¯ï¼Œä¸è®ºäº‹åŠ¡å‹ Producer æäº¤äº‹åŠ¡è¿˜æ˜¯ç»ˆæ­¢äº‹åŠ¡ï¼Œå…¶å†™å…¥çš„æ¶ˆæ¯éƒ½å¯ä»¥è¯»å–ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœä½ ç”¨äº†äº‹åŠ¡å‹ Producerï¼Œé‚£ä¹ˆå¯¹åº”çš„ Consumer å°±ä¸è¦ä½¿ç”¨è¿™ä¸ªå€¼ã€‚ read_committedï¼šè¡¨æ˜ Consumer åªä¼šè¯»å–äº‹åŠ¡å‹ Producer æˆåŠŸæäº¤äº‹åŠ¡å†™å…¥çš„æ¶ˆæ¯ã€‚å½“ç„¶äº†ï¼Œå®ƒä¹Ÿèƒ½çœ‹åˆ°éäº‹åŠ¡å‹ Producer å†™å…¥çš„æ‰€æœ‰æ¶ˆæ¯ã€‚Kafka ä¸»è¦æ˜¯åœ¨å·²æäº¤è¯»ï¼ˆread committedï¼‰è¿™ä¸€éš”ç¦»çº§åˆ«ä¸Šåšäº‹æƒ…ã€‚ æŒä¹…æ€§ (Durability) è®¾ç½®äº‹åŠ¡å‹ Producer çš„æ–¹æ³• å’Œå¹‚ç­‰æ€§ Producer ä¸€æ ·ï¼Œå¼€å¯ enable.idempotence = true è®¾ç½® Producer ç«¯å‚æ•° transctional. id producer.initTransactions(); try { producer.beginTransaction(); producer.send(record1); producer.send(record2); producer.commitTransaction(); } catch (KafkaException e) { producer.abortTransaction(); } æ¶ˆè´¹è€…ç»„ Consumer Group ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼šä¸‹æ¸¸å¤šä¸ª Consumer éƒ½è¦æŠ¢å¤ºå…±äº«æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¼¸ç¼©æ€§ï¼ˆscalabilityï¼‰å·® å‘å¸ƒ/è®¢é˜…æ¨¡å‹ï¼šæ¯ä¸ªè®¢é˜…è€…éƒ½å¿…é¡»è¦è®¢é˜…ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒº æ¶ˆè´¹è€…ç»„ï¼šç»„å†…çš„æ¯ä¸ªå®ä¾‹ä¸è¦æ±‚ä¸€å®šè¦è®¢é˜…ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒConsumer å®ä¾‹çš„æ•°é‡åº”è¯¥ç­‰äºè¯¥ Group è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ€»æ•°ã€‚ ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼šæ‰€æœ‰æ¶ˆæ¯éƒ½å±äºåŒä¸€ä¸ª Group å‘å¸ƒ/è®¢é˜…æ¨¡å‹ï¼šæ‰€æœ‰å®ä¾‹éƒ½å±äºä¸åŒçš„ Group ä½ç§»ä¿å­˜åœ¨ Broker ç«¯çš„å†…éƒ¨ä¸»é¢˜__consumer_offsetsä¸­ è¿›åº¦ç›‘æ§ æ»åç¨‹åº¦ï¼šConsumer Lag ï¼ŒæŒ‡æ¶ˆè´¹è€…è½åäºç”Ÿäº§è€…çš„ç¨‹åº¦ã€‚ ä½¿ç”¨ Kafka è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…· kafka-consumer-groups è„šæœ¬ã€‚ï¼ˆæœ€ç®€å•ï¼‰ bin/kafka-consumer-groups.sh(bat) ä½¿ç”¨ Kafka Java Consumer API ç¼–ç¨‹ã€‚ public static Map\u003cTopicPartition, Long\u003e lagOf(String groupID, String bootstrapServers) throws TimeoutException { Properties props = new Properties(); props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers); try (AdminClient client = AdminClient.create(props)) { ListConsumerGroupOffsetsResult result = client.listConsumerGroupOffsets(groupID);// ğŸŒŸè·å–ç»™å®šæ¶ˆè´¹è€…ç»„çš„æœ€æ–°æ¶ˆè´¹æ¶ˆæ¯çš„ä½ç§» try { Map\u003cTopicPartition, OffsetAndMetadata\u003e consumedOffsets = result.partitionsToOffsetAndMetadata().get(10, TimeUnit.SECONDS); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false); // ç¦æ­¢è‡ªåŠ¨æäº¤ä½ç§» props.put(ConsumerConfig.GROUP_ID_CONFIG, groupID); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); try (final KafkaConsumer\u003cString, String\u003e consumer = new KafkaConsumer\u003c\u003e(props)) { Map\u003cTopicPartition, Long\u003e endOffsets = consumer.endOffsets(consumedOffsets.keySet());// ğŸŒŸè·å–è®¢é˜…åˆ†åŒºçš„æœ€æ–°æ¶ˆæ¯ä½ç§» return endOffsets.entrySet().stream().collect(Collectors.toMap(entry -\u003e entry.getKey(), entry -\u003e entry.getValue() - consumedOffsets.get(entry.getKey()).offset()));// ğŸŒŸæ‰§è¡Œç›¸åº”çš„å‡æ³•æ“ä½œï¼Œè·å– Lag å€¼å¹¶å°è£…è¿›ä¸€ä¸ª Map å¯¹è±¡ } } catch (InterruptedException e) { Thread.currentThread().interrupt(); // å¤„ç†ä¸­æ–­å¼‚å¸¸ // ... return Collections.emptyMap(); } catch (ExecutionException e) { // å¤„ç† ExecutionException // ... return Collections.emptyMap(); } catch (TimeoutException e) { throw new TimeoutException(\"Timed out when getting lag for consumer group \" + groupID); } } } ä½¿ç”¨ Kafka è‡ªå¸¦çš„ JMX ç›‘æ§æŒ‡æ ‡ã€‚ï¼ˆé›†æˆæ€§æœ€å¥½ï¼‰ Kafka æ¶ˆè´¹è€…æä¾›äº†ä¸€ä¸ªåä¸º kafka.consumer:type=consumer-fetch-manager-metrics,client-id=â€œ{client-id}â€çš„ JMX æŒ‡æ ‡ï¼Œrecords-lag-max å’Œ records-lead-min åˆ†åˆ«è¡¨ç¤ºæ­¤æ¶ˆè´¹è€…åœ¨æµ‹è¯•çª—å£æ—¶é—´å†…æ›¾ç»è¾¾åˆ°çš„æœ€å¤§çš„ Lag å€¼å’Œæœ€å°çš„ Lead å€¼ï¼ˆ Lead å€¼æ˜¯æŒ‡æ¶ˆè´¹è€…æœ€æ–°æ¶ˆè´¹æ¶ˆæ¯çš„ä½ç§»ä¸åˆ†åŒºå½“å‰ç¬¬ä¸€æ¡æ¶ˆæ¯ä½ç§»çš„å·®å€¼ï¼ŒLag ä¸ Lead çš„å€¼å‘ˆè´Ÿç›¸å…³ï¼‰ï¼ŒLag è¶Šå¤§ï¼ŒLead è¶Šå°ï¼Œå°±æ„å‘³ç€æ¶ˆè´¹è€…ç«¯è¦ä¸¢æ¶ˆæ¯äº†ã€‚ ä½ç§»ä¸»é¢˜ __consumer_offsets æ ¸å¿ƒæ•°æ®ç»“æ„ é”®å€¼å¯¹ï¼Œç±»ä¼¼äºMap\u003cTopicPartition, Long\u003e keyï¼š\u003cGroup IDï¼Œä¸»é¢˜åï¼Œåˆ†åŒºå· \u003e valueï¼š\u003cä½ç§»ï¼Œæ—¶é—´æˆ³ï¼Œç”¨æˆ·è‡ªå®šä¹‰æ•°æ®\u003eï¼Œä¿å­˜è¿™äº›å…ƒæ•°æ®æ˜¯ä¸ºäº†å¸®åŠ© Kafka æ‰§è¡Œå„ç§å„æ ·åç»­çš„æ“ä½œï¼Œæ¯”å¦‚åˆ é™¤è¿‡æœŸä½ç§»æ¶ˆæ¯ç­‰ã€‚ è¯¥å†…éƒ¨ä¸»é¢˜ä¸‹è¿˜æœ‰ä¸¤ç§æ¶ˆæ¯æ ¼å¼ï¼š ç”¨æ¥æ³¨å†Œ Consumer Group çš„æ¶ˆæ¯ï¼› tombstone ï¼ˆå¢“ç¢‘ï¼‰æ¶ˆæ¯ï¼šæ¶ˆæ¯ä½“æ˜¯ nullï¼Œç”¨äºåˆ é™¤ Group è¿‡æœŸä½ç§»ç”šè‡³æ˜¯åˆ é™¤ Group çš„æ¶ˆæ¯ã€‚ åˆ†åŒº åˆ†åŒºæ•°é…ç½®ï¼šBroker ç«¯å‚æ•° offsets.topic.num.partitionsï¼Œé»˜è®¤å€¼ 50ï¼› å‰¯æœ¬æ•°ï¼šBroker ç«¯å‚æ•° offsets.topic.replication.factor ï¼Œé»˜è®¤å€¼ 3ã€‚ Compaction æ•´ç†ä½ç§» è¿‡æœŸæ¶ˆæ¯ï¼šå¯¹äºåŒä¸€ä¸ª Key çš„ä¸¤æ¡æ¶ˆæ¯ M1 å’Œ M2ï¼Œå¦‚æœ M1 çš„å‘é€æ—¶é—´æ—©äº M2ï¼Œé‚£ä¹ˆ M1 å°±æ˜¯è¿‡æœŸæ¶ˆæ¯ã€‚ Log Cleaner çº¿ç¨‹å®šæœŸåœ°å·¡æ£€å¾… Compact çš„ä¸»é¢˜ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å¯åˆ é™¤æ•°æ®ã€‚ Rebalance æ‰€æœ‰ Broker éƒ½æœ‰å„è‡ªçš„ Coordinator ç»„ä»¶ï¼Œå…·ä½“æ¥è®²ï¼ŒConsumer ç«¯åº”ç”¨ç¨‹åºåœ¨æäº¤ä½ç§»æ—¶ï¼Œå…¶å®æ˜¯å‘ Coordinator æ‰€åœ¨çš„ Broker æäº¤ä½ç§»ã€‚åŒæ ·åœ°ï¼Œå½“ Consumer åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¹Ÿæ˜¯å‘ Coordinator æ‰€åœ¨çš„ Broker å‘é€å„ç§è¯·æ±‚ï¼Œç„¶åç”± Coordinator è´Ÿè´£æ‰§è¡Œæ¶ˆè´¹è€…ç»„çš„æ³¨å†Œã€æˆå‘˜ç®¡ç†è®°å½•ç­‰å…ƒæ•°æ®ç®¡ç†æ“ä½œã€‚ Kafka ä¸ºæŸä¸ª Consumer Group ç¡®å®š Coordinator æ‰€åœ¨çš„ Broker çš„ç®—æ³•æœ‰ 2 ä¸ªæ­¥éª¤ï¼š ç¡®å®šç”±ä½ç§»ä¸»é¢˜çš„å“ªä¸ªåˆ†åŒºæ¥ä¿å­˜è¯¥ Group æ•°æ®ï¼špartitionId=Math.abs(groupId.hashCode() % offsetsTopicPartitionCount) æ‰¾å‡ºè¯¥åˆ†åŒº Leader å‰¯æœ¬æ‰€åœ¨çš„ Brokerï¼Œè¯¥ Broker å³ä¸ºå¯¹åº”çš„ Coordinator é¿å… Rebalance æ–¹æ³•ï¼ˆConsumer ç«¯ï¼‰ï¼š æ£€æµ‹å¿ƒè·³é—´éš”ï¼š session.timeout.msï¼Œé»˜è®¤å€¼ä¸º 10 ç§’ï¼Œæ¨èè®¾ä¸º 6 ç§’ å‘é€å¿ƒè·³é—´éš”ï¼šheartbeat.interval.ms è¶Šå°ï¼Œé¢‘ç‡è¶Šé«˜ï¼Œä¼šé¢å¤–æ¶ˆè€—å¸¦å®½èµ„æºï¼Œä½†å¥½å¤„æ˜¯èƒ½å¤Ÿæ›´åŠ å¿«é€Ÿåœ°çŸ¥æ™“å½“å‰æ˜¯å¦å¼€å¯ Rebalanceï¼Œæ¨èè®¾ä¸º 2 ç§’ å®é™…æ¶ˆè´¹èƒ½åŠ›ï¼šmax.poll.interval.msï¼Œé™å®šäº†åº”ç”¨ç¨‹åºä¸¤æ¬¡è°ƒç”¨ poll æ–¹æ³•çš„æœ€å¤§æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼ä¸º 5 åˆ†é’Ÿã€‚æœ€å¥½å°†è¯¥å‚æ•°å€¼è®¾ç½®å¾—å¤§ä¸€ç‚¹ï¼Œæ¯”ä¸‹æ¸¸æœ€å¤§å¤„ç†æ—¶é—´ç¨é•¿ä¸€ç‚¹ã€‚å°±æ‹¿ MongoDB è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœå†™ MongoDB çš„æœ€é•¿æ—¶é—´æ˜¯ 7 åˆ†é’Ÿï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸º 8 åˆ†é’Ÿå·¦å³ã€‚ GC å‚æ•°ï¼šæŸ¥çœ‹æ˜¯å¦å‡ºç°äº†é¢‘ç¹çš„ Full GC æ¶ˆè´¹è€…ä½ç§» å®ƒè®°å½•äº† Consumer è¦æ¶ˆè´¹çš„ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»ï¼Œå¦‚æœä½ æäº¤äº†ä½ç§» Xï¼Œé‚£ä¹ˆ Kafka ä¼šè®¤ä¸ºæ‰€æœ‰ä½ç§»å€¼å°äº X çš„æ¶ˆæ¯ä½ éƒ½å·²ç»æˆåŠŸæ¶ˆè´¹äº†ã€‚ ğŸŒŸè‡ªåŠ¨æäº¤ï¼šenable.auto.commit = trueï¼Œæäº¤é—´éš”ä¸ºauto.commit.interval.ms Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"group.id\", \"test\"); props.put(\"enable.auto.commit\", \"true\"); props.put(\"auto.commit.interval.ms\", \"2000\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); KafkaConsumer\u003cString, String\u003e consumer = new KafkaConsumer\u003c\u003e(props); consumer.subscribe(Arrays.asList(\"foo\", \"bar\")); while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(100); for (ConsumerRecord\u003cString, String\u003e record : records) System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value()); } æ‰‹åŠ¨æäº¤ï¼šenable.auto.commit = falseï¼Œä½¿ç”¨ consumer.commitSyncï¼ˆé˜»å¡ï¼‰æˆ– consumer.commitAsyncï¼ˆå¼‚æ­¥ï¼‰ // åŒæ­¥ï¼šåˆ©ç”¨ commitSync çš„è‡ªåŠ¨é‡è¯•æ¥è§„é¿é‚£äº›ç¬æ—¶é”™è¯¯ï¼Œæ¯”å¦‚ç½‘ç»œçš„ç¬æ—¶æŠ–åŠ¨ï¼ŒBroker ç«¯ GC ç­‰ while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); // å¤„ç†æ¶ˆæ¯ try { consumer.commitSync(); } catch (CommitFailedException e) { handle(e); // å¤„ç†æäº¤å¤±è´¥å¼‚å¸¸ } } // å¼‚æ­¥ï¼šå¸¸è§„æ€§ã€é˜¶æ®µæ€§çš„æ‰‹åŠ¨æäº¤ while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); // å¤„ç†æ¶ˆæ¯ consumer.commitAsync((offsets, exception) -\u003e { if (exception != null) handle(exception); }); } // äºŒè€…ç»“åˆï¼šæ—¢å®ç°äº†å¼‚æ­¥æ— é˜»å¡å¼çš„ä½ç§»ç®¡ç†ï¼Œä¹Ÿç¡®ä¿äº† Consumer ä½ç§»çš„æ­£ç¡®æ€§ try { while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); // å¤„ç†æ¶ˆæ¯ commitAysnc(); // ä½¿ç”¨å¼‚æ­¥æäº¤è§„é¿é˜»å¡ } } catch (Exception e) { handle(e); // å¤„ç†å¼‚å¸¸ } finally { try { consumer.commitSync(); // æœ€åä¸€æ¬¡æäº¤ä½¿ç”¨åŒæ­¥é˜»å¡å¼æäº¤ } finally { consumer.close(); } } // æ›´åŠ ç»†ç²’åº¦çš„æ“ä½œ // Kafka Consumer API ä¸ºæ‰‹åŠ¨æäº¤æä¾›äº†è¿™æ ·çš„æ–¹æ³•ï¼š // commitSync(Map\u003cTopicPartition, OffsetAndMetadata\u003e) å’Œ // commitAsync(Map\u003cTopicPartition, OffsetAndMetadata\u003e)ã€‚ // å®ƒä»¬çš„å‚æ•°æ˜¯ä¸€ä¸ª Map å¯¹è±¡ï¼Œé”®å°±æ˜¯ TopicPartitionï¼Œå³æ¶ˆè´¹çš„åˆ†åŒºï¼Œè€Œå€¼æ˜¯ä¸€ä¸ª OffsetAndMetadata å¯¹è±¡ï¼Œä¿å­˜çš„ä¸»è¦æ˜¯ä½ç§»æ•°æ®ã€‚ private Map\u003cTopicPartition, OffsetAndMetadata\u003e offsets = new HashMap\u003c\u003e(); int count = 0; â€¦â€¦ while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); for (ConsumerRecord\u003cString, String\u003e record: records) { process(record); // å¤„ç†æ¶ˆæ¯ offsets.put(new TopicPartition(record.topic(), record.partition()), new OffsetAndMetadata(record.offset() + 1)ï¼› ifï¼ˆcount % 100 == 0ï¼‰// æ¯ç´¯è®¡ 100 æ¡æ¶ˆæ¯å°±ç»Ÿä¸€æäº¤ä¸€æ¬¡ä½ç§» consumer.commitAsync(offsets, null); // å›è°ƒå¤„ç†é€»è¾‘æ˜¯null count++; } } CommitFailedException å¼‚å¸¸ è§£å†³åŠæ³•ï¼š ç¼©çŸ­å•æ¡æ¶ˆæ¯å¤„ç†çš„æ—¶é—´ï¼Œç®€åŒ–æ¶ˆè´¹é€»è¾‘ï¼›ï¼ˆä¼˜å…ˆï¼‰ å¢åŠ æœŸæœ›çš„æ—¶é—´é—´éš” max.poll.interval.ms å‚æ•°å€¼ï¼› å‡å°‘ä¸‹æ¸¸ç³»ç»Ÿä¸€æ¬¡æ€§æ¶ˆè´¹çš„æ¶ˆæ¯æ€»æ•°ï¼Œå‡å°‘ poll æ–¹æ³•ä¸€æ¬¡æ€§è¿”å›çš„æ¶ˆæ¯æ•°é‡ï¼Œå³å‡å°‘max.poll.records å‚æ•°å€¼ï¼› ä¸‹æ¸¸ç³»ç»Ÿä½¿ç”¨å¤šçº¿ç¨‹æ¥åŠ é€Ÿæ¶ˆè´¹ è®©ç‹¬ç«‹æ¶ˆè´¹è€…ä¸æ¶ˆè´¹è€…ç»„çš„ group.id ä¿æŒä¸åŒ Kafka Java Consumer ç”¨æˆ·ä¸»çº¿ç¨‹ + å¿ƒè·³çº¿ç¨‹ï¼Œéé˜»å¡å¼çš„æ¶ˆæ¯è·å– åœ¨æ¶ˆè´¹æ¶ˆæ¯è¿™ä¸€å±‚é¢ï¼Œä»ç„¶æ˜¯å•çº¿ç¨‹è®¾è®¡ã€‚ KafkaConsumer ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«åŒä¸€ä¸ª KafkaConsumer å®ä¾‹ï¼Œå¦åˆ™ç¨‹åºä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼Œé™¤äº† KafkaConsumer.wakeup() æ–¹æ³•ã€‚ ä¸¤ç§å¤šçº¿ç¨‹æ–¹æ¡ˆï¼š æ¶ˆè´¹è€…ç¨‹åºå¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸“å±çš„ KafkaConsumer å®ä¾‹ï¼Œè´Ÿè´£å®Œæ•´çš„æ¶ˆæ¯è·å–ã€æ¶ˆæ¯å¤„ç†æµç¨‹ã€‚ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œèƒ½ä¿è¯åˆ†åŒºå†…çš„æ¶ˆè´¹é¡ºåº ç¼ºç‚¹ï¼šå ç”¨æ›´å¤šèµ„æºï¼Œå¯èƒ½ä¼šå‡ºç°ä¸å¿…è¦çš„ Rebalance // æ¯ä¸ª KafkaConsumerRunner ç±»éƒ½ä¼šåˆ›å»ºä¸€ä¸ªä¸“å±çš„ KafkaConsumer å®ä¾‹ public class KafkaConsumerRunner implements Runnable { private final AtomicBoolean closed = new AtomicBoolean(false); private final KafkaConsumer consumer; public void run() { try { consumer.subscribe(Arrays.asList(\"topic\")); while (!closed.get()) { ConsumerRecords records = consumer.poll(Duration.ofMillis(10000)); // æ‰§è¡Œæ¶ˆæ¯å¤„ç†é€»è¾‘ } } catch (WakeupException e) { // Ignore exception if closing if (!closed.get()) throw e; } finally { consumer.close(); } } // Shutdown hook which can be called from a separate thread public void shutdown() { closed.set(true); consumer.wakeup(); } å•çº¿ç¨‹è·å–æ¶ˆæ¯ï¼Œå¤šçº¿ç¨‹æ¶ˆè´¹ ä¼˜ç‚¹ï¼šä¼¸ç¼©æ€§å¼ºï¼Œæ¶ˆæ¯çš„è·å–ä¸å¤„ç†è§£è€¦ ç¼ºç‚¹ï¼šå®ç°éš¾åº¦å¤§ï¼Œæ— æ³•ä¿è¯åˆ†åŒºå†…çš„æ¶ˆè´¹é¡ºåºï¼Œå¯èƒ½å‡ºç°é‡å¤æ¶ˆè´¹ï¼ˆä½ç§»æäº¤å›°éš¾ï¼‰ // å½“ Consumer çš„ poll æ–¹æ³•è¿”å›æ¶ˆæ¯åï¼Œç”±ä¸“é—¨çš„çº¿ç¨‹æ± æ¥è´Ÿè´£å¤„ç†å…·ä½“çš„æ¶ˆæ¯ // è°ƒç”¨ poll æ–¹æ³•çš„ä¸»çº¿ç¨‹ä¸è´Ÿè´£æ¶ˆæ¯å¤„ç†é€»è¾‘ private final KafkaConsumer\u003cString, String\u003e consumer; private ExecutorService executors; ... private int workerNum = ...; executors = new ThreadPoolExecutor( workerNum, workerNum, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue\u003c\u003e(1000), new ThreadPoolExecutor.CallerRunsPolicy()); ... while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); for (final ConsumerRecord record : records) { executors.submit(new Worker(record)); } } .. ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:3:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"Kafka æ ¸å¿ƒè®¾è®¡åŸç† å‰¯æœ¬æœºåˆ¶ å‰¯æœ¬çš„åŠŸèƒ½ï¼š æä¾›æ•°æ®å†—ä½™ï¼ˆKafkaï¼Œä»¥ä¸‹ä¸¤é¡¹æœªæä¾›ï¼‰ æä¾›é«˜ä¼¸ç¼©æ€§ æ”¹å–„æ•°æ®å±€éƒ¨æ€§ å‰¯æœ¬ï¼ˆReplicaï¼‰ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåªèƒ½è¿½åŠ å†™æ¶ˆæ¯çš„æäº¤æ—¥å¿—ã€‚ è¿½éšè€…å‰¯æœ¬ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼ˆå› æ­¤ä¸èƒ½æä¾›è¯»æ“ä½œæ¨ªå‘æ‰©å±•ä»¥åŠæ”¹å–„å±€éƒ¨æ€§ï¼‰ï¼Œåªå‘é¢†å¯¼è€…å‰¯æœ¬å¼‚æ­¥æ‹‰å–æ¶ˆæ¯ï¼Œå¹¶å†™å…¥åˆ°è‡ªå·±çš„æäº¤æ—¥å¿—ä¸­ã€‚ Kafka å‰¯æœ¬æœºåˆ¶çš„å¥½å¤„ï¼š Read-your-writesï¼šç«‹å³èƒ½è¯»å–è‡ªå·±å†™å…¥çš„æ¶ˆæ¯ å•è°ƒè¯»ï¼ˆMonitonic Readsï¼‰ï¼šå¯¹äºä¸€ä¸ªæ¶ˆè´¹è€…ç”¨æˆ·è€Œè¨€ï¼Œåœ¨å¤šæ¬¡æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå®ƒä¸ä¼šçœ‹åˆ°æŸæ¡æ¶ˆæ¯ä¸€ä¼šå„¿å­˜åœ¨ä¸€ä¼šå„¿ä¸å­˜åœ¨ã€‚ ISRï¼ˆIn-sync Replicasï¼‰ æŒ‡çš„æ˜¯ä¸ Leader å‰¯æœ¬åŒæ­¥çš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬ Leader æœ¬èº«ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€é›†åˆã€‚ åŒæ­¥ä¸å¦ï¼Œå–å†³äº Broker ç«¯å‚æ•° replica.lag.time.max.ms å‚æ•°å€¼ï¼Œè¡¨ç¤º Follower å‰¯æœ¬èƒ½å¤Ÿè½å Leader å‰¯æœ¬çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œå½“å‰é»˜è®¤å€¼æ˜¯ 10 ç§’ã€‚ Unclean é¢†å¯¼è€…é€‰ä¸¾ Broker ç«¯å‚æ•° unclean.leader.election.enable æ§åˆ¶æ˜¯å¦å…è®¸ Unclean é¢†å¯¼è€…é€‰ä¸¾ï¼Œå¼€å¯å¯èƒ½ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œå…³é—­å¯èƒ½ä¼šä½¿å¾— ISR é›†åˆä¸ºç©ºã€‚ CAP ç†è®ºï¼šä»¥ä¸‹ä¸‰è€…åªèƒ½æ»¡è¶³å…¶äºŒï¼š ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šå…³é—­ Unclean é¢†å¯¼è€…é€‰ä¸¾ï¼Œå¯é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼ˆå»ºè®®ï¼‰ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šå¼€å¯ Unclean é¢†å¯¼è€…é€‰ä¸¾ï¼Œå¯ä¿è¯å¯¹å¤–æä¾›æœåŠ¡ï¼ˆè¿˜å¯ä»¥é€šè¿‡å¢åŠ å‰¯æœ¬æ•°æ¥æé«˜å¯ç”¨æ€§ï¼Œæ‰€ä»¥å»ºè®®åœ¨ Unclean ä¸Šé€‰æ‹©ä¸€è‡´æ€§ï¼‰ åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ Kafka è¯·æ±‚å¤„ç† Reactor æ¨¡å¼ epoll æ˜¯ä¸€ç§ IO æ¨¡å‹ï¼Œè€Œ Reactor æ˜¯ä¸€ç§ IO å¤„ç†æ¨¡å¼ã€‚ ä½œè€… Doug Lea æ›¾å¼€å‘æ•´ä¸ª java.util.concurrent åŒ…ã€‚ Acceptor çº¿ç¨‹ï¼šåªæ˜¯ç”¨äºè¯·æ±‚åˆ†å‘ï¼Œä¸æ¶‰åŠå…·ä½“çš„é€»è¾‘å¤„ç†ï¼Œéå¸¸å¾—è½»é‡çº§ï¼Œå› æ­¤æœ‰å¾ˆé«˜çš„ååé‡è¡¨ç°ã€‚ Broker ç«¯å‚æ•° num.network.threadsï¼šç”¨äºè°ƒæ•´è¯¥ç½‘ç»œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°ã€‚å…¶é»˜è®¤å€¼æ˜¯ 3ï¼Œè¡¨ç¤ºæ¯å° Broker å¯åŠ¨æ—¶ä¼šåˆ›å»º 3 ä¸ªç½‘ç»œçº¿ç¨‹ï¼Œä¸“é—¨å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ã€‚ å¼‚æ­¥çº¿ç¨‹æ±  å½“ç½‘ç»œçº¿ç¨‹æ‹¿åˆ°è¯·æ±‚åï¼Œå®ƒä¸æ˜¯è‡ªå·±å¤„ç†ï¼Œè€Œæ˜¯å°†è¯·æ±‚æ”¾å…¥åˆ°ä¸€ä¸ªå…±äº«è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚ IO çº¿ç¨‹æ± ï¼šçº¿ç¨‹æ•°ç”± Broker ç«¯å‚æ•°num.io.threadsæ§åˆ¶ PRODUCE ç”Ÿäº§è¯·æ±‚ï¼šå°†æ¶ˆæ¯å†™å…¥åˆ°åº•å±‚çš„ç£ç›˜æ—¥å¿—ä¸­ FETCH è¯·æ±‚ï¼šä»ç£ç›˜æˆ–é¡µç¼“å­˜ä¸­è¯»å–æ¶ˆæ¯ è¯·æ±‚é˜Ÿåˆ—æ˜¯æ‰€æœ‰ç½‘ç»œçº¿ç¨‹å…±äº«çš„ï¼Œè€Œå“åº”é˜Ÿåˆ—åˆ™æ˜¯æ¯ä¸ªç½‘ç»œçº¿ç¨‹ä¸“å±çš„ï¼Œå› ä¸ºDispatcher åªæ˜¯ç”¨äºè¯·æ±‚åˆ†å‘è€Œä¸è´Ÿè´£å“åº”å›ä¼ ï¼Œæ‰€ä»¥åªèƒ½è®©æ¯ä¸ªç½‘ç»œçº¿ç¨‹è‡ªå·±å‘é€ Response ç»™å®¢æˆ·ç«¯ã€‚ Kafka Broker å¯åŠ¨åï¼Œä¼šåœ¨åå°åˆ†åˆ«åˆ›å»ºä¸¤å¥—ç½‘ç»œçº¿ç¨‹æ± å’Œ IO çº¿ç¨‹æ± çš„ç»„åˆï¼Œå®ƒä»¬åˆ†åˆ«å¤„ç†æ•°æ®ç±»è¯·æ±‚å’Œæ§åˆ¶ç±»è¯·æ±‚ï¼Œå› æ­¤ listeners é…ç½®å¯ä»¥é…ç½®ä¸¤ä¸ªç«¯å£å·ã€‚ Purgatory ç»„ä»¶ â€œç‚¼ç‹±â€ç»„ä»¶ï¼Œç”¨æ¥ç¼“å­˜å»¶è¿Ÿè¯·æ±‚ï¼Œæ¯”å¦‚è®¾ç½®äº† acks=allï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚å°±å¿…é¡»ç­‰å¾… ISR ä¸­æ‰€æœ‰å‰¯æœ¬éƒ½æ¥æ”¶äº†æ¶ˆæ¯åæ‰èƒ½è¿”å›ï¼Œæ­¤æ—¶å¤„ç†è¯¥è¯·æ±‚çš„ IO çº¿ç¨‹å°±å¿…é¡»ç­‰å¾…å…¶ä»– Broker çš„å†™å…¥ç»“æœã€‚å½“è¯·æ±‚ä¸èƒ½ç«‹åˆ»å¤„ç†æ—¶ï¼Œå®ƒå°±ä¼šæš‚å­˜åœ¨ Purgatory ä¸­ã€‚ ğŸŒŸ Rebalance é‡å¹³è¡¡ Rebalance æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ª Consumer Group ä¸‹çš„æ‰€æœ‰ Consumer å¦‚ä½•è¾¾æˆä¸€è‡´ï¼Œæ¥åˆ†é…è®¢é˜… Topic çš„æ¯ä¸ªåˆ†åŒºã€‚è§¦å‘æ¡ä»¶ï¼š ç»„æˆå‘˜æ•°å‘ç”Ÿå˜æ›´ï¼› è®¢é˜…ä¸»é¢˜æ•°å‘ç”Ÿå˜æ›´ï¼› è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜æ›´ã€‚ å¼Šç«¯ï¼š å½±å“ Consumer ç«¯ TPSï¼Œç±»ä¼¼ JVM çš„ STWï¼Œæ‰€æœ‰ Consumer å®ä¾‹éƒ½ä¼šåœæ­¢æ¶ˆè´¹ï¼› éœ€è¦é‡æ–°åˆ›å»ºè¿æ¥å…¶ä»– Broker çš„ Socket èµ„æºï¼ŒGroup ä¸‹çš„æ‰€æœ‰æˆå‘˜éƒ½è¦å‚ä¸è¿›æ¥ï¼Œè€Œä¸”é€šå¸¸ä¸ä¼šè€ƒè™‘å±€éƒ¨æ€§åŸç†ï¼Œä½†å±€éƒ¨æ€§åŸç†å¯¹æå‡ç³»ç»Ÿæ€§èƒ½æ˜¯ç‰¹åˆ«é‡è¦çš„ï¼› é€Ÿåº¦å¾ˆæ…¢ï¼Œå‡ ç™¾ä¸ª Consumer å®ä¾‹çš„ Rebalance éœ€è¦å‡ ä¸ªå°æ—¶ã€‚ æ¶ˆè´¹è€…ç«¯æœ‰æ¶ˆæ¯å¤„ç†çº¿ç¨‹å’Œå¿ƒè·³çº¿ç¨‹ï¼Œé‡å¹³è¡¡çš„é€šçŸ¥æœºåˆ¶æ˜¯é€šè¿‡å¿ƒè·³çº¿ç¨‹æ¥å®Œæˆçš„ã€‚heartbeat.interval.msæ—¢æ˜¯å¿ƒè·³çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿæ˜¯æ§åˆ¶é‡å¹³è¡¡é€šçŸ¥çš„é¢‘ç‡ã€‚ æ¶ˆè´¹è€…ç»„çš„ 5 ç§çŠ¶æ€ Emptyï¼šä¼šè¿›è¡Œè¿‡æœŸä½ç§»åˆ é™¤ï¼šRemoved âœ˜âœ˜âœ˜ expired offsets in âœ˜âœ˜âœ˜ milliseconds. Dead PreparingRebalanceï¼šç­‰å¾…æˆå‘˜åŠ å…¥ CompletingRebalanceï¼šè€ç‰ˆæœ¬ä¸­å« AwatingSyncï¼Œç­‰å¾…åˆ†é…æ–¹æ¡ˆ Stableï¼šé‡å¹³è¡¡å·²å®Œæˆ æ¶ˆè´¹è€…ç«¯ 2 ç±»è¯·æ±‚ JoinGroup è¯·æ±‚ï¼šç¬¬ä¸€ä¸ªå‘é€ JoinGroup è¯·æ±‚çš„æˆå‘˜è‡ªåŠ¨æˆä¸ºé¢†å¯¼è€… æ­¤å¤„çš„é¢†å¯¼è€…ä¸åŒäºé¢†å¯¼è€…å‰¯æœ¬ï¼Œå®ƒä»¬ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚è¿™é‡Œçš„é¢†å¯¼è€…æ˜¯å…·ä½“çš„æ¶ˆè´¹è€…å®ä¾‹ï¼Œå®ƒæ—¢ä¸æ˜¯å‰¯æœ¬ï¼Œä¹Ÿä¸æ˜¯åè°ƒè€…ã€‚é¢†å¯¼è€…æ¶ˆè´¹è€…çš„ä»»åŠ¡æ˜¯æ”¶é›†æ‰€æœ‰æˆå‘˜çš„è®¢é˜…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œåˆ¶å®šå…·ä½“çš„åˆ†åŒºæ¶ˆè´¹åˆ†é…æ–¹æ¡ˆã€‚ SyncGroup è¯·æ±‚ Broker ç«¯ LeaveGroup è¯·æ±‚ï¼šä¸»åŠ¨ç¦»ç»„ session.timeout.msï¼šå´©æºƒç¦»ç»„ Kafka æ§åˆ¶å™¨ zookeeper znode æ˜¯æ ‘å½¢ç»“æ„ä¸Šçš„èŠ‚ç‚¹ï¼Œåˆ†ä¸ºæŒä¹…æ€§å’Œä¸´æ—¶æ€§ã€‚ èŠ‚ç‚¹å˜æ›´ç›‘å¬å™¨ (ChangeHandler) ï¼šç›‘æ§ï¼ˆWatchï¼‰ znode å˜æ›´è¡Œä¸ºï¼Œå®ç°é›†ç¾¤æˆå‘˜ç®¡ç†ã€åˆ†å¸ƒå¼é”ã€é¢†å¯¼è€…é€‰ä¸¾ç­‰åŠŸèƒ½ã€‚ Broker åœ¨å¯åŠ¨æ—¶ï¼Œä¼šå°è¯•å» ZooKeeper ä¸­åˆ›å»º /controller èŠ‚ç‚¹ã€‚Kafka å½“å‰é€‰ä¸¾æ§åˆ¶å™¨çš„è§„åˆ™æ˜¯ï¼šç¬¬ä¸€ä¸ªæˆåŠŸåˆ›å»º /controller èŠ‚ç‚¹çš„ Broker ä¼šè¢«æŒ‡å®šä¸ºæ§åˆ¶å™¨ã€‚ æ§åˆ¶å™¨èŒè´£ï¼š ä¸»é¢˜ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ é™¤ã€å¢åŠ åˆ†åŒºï¼‰ï¼šæ‰§è¡Œ kafka-topic è„šæœ¬ åˆ†åŒºé‡åˆ†é…ï¼šæ‰§è¡Œ kafka-reassign-partitions è„šæœ¬ Preferred é¢†å¯¼è€…é€‰ä¸¾ é›†ç¾¤æˆå‘˜ç®¡ç†ï¼ˆæ–°å¢ Brokerã€Broker ä¸»åŠ¨å…³é—­ã€Broker å®•æœºï¼‰ æ•°æ®æœåŠ¡ï¼šåœ¨ ZooKeeper ä¸­ä¹Ÿä¿å­˜äº†ä¸€ä»½ æ§åˆ¶å™¨å†…éƒ¨è®¾è®¡åŸç†ï¼š å•çº¿ç¨‹+äº‹ä»¶é˜Ÿåˆ—æ–¹æ¡ˆï¼› å¼‚æ­¥æ“ä½œ Zookeeperï¼› èµ‹äºˆ StopReplica è¯·æ±‚æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä½¿å®ƒèƒ½å¤Ÿå¾—åˆ°æŠ¢å å¼çš„å¤„ç†ã€‚ æ§åˆ¶å™¨ç»„ä»¶å‡ºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š åœ¨ Zookeeper ä¸­æ‰‹åŠ¨åˆ é™¤ /controller èŠ‚ç‚¹ï¼šrmr /controllerï¼Œè¿™æ ·æ—¢å¯ä»¥å¼•å‘æ§åˆ¶å™¨çš„é‡é€‰ä¸¾ï¼Œåˆå¯ä»¥é¿å…é‡å¯ Broker å¯¼è‡´çš„æ¶ˆæ¯å¤„ç†ä¸­æ–­ã€‚ é«˜æ°´ä½ ç¤ºæ„å›¾ï¼š ï½œâ€”â€” LEO â€”â€” ï½œæœªæäº¤æ¶ˆæ¯ï¼Œä¸å¯è¢«æ¶ˆè´¹ ï½œâ€”â€” é«˜æ°´ä½ â€”â€” ï½œå·²æäº¤æ¶ˆæ¯ é«˜æ°´ä½çš„ä½œç”¨ï¼š å®šä¹‰æ¶ˆæ¯å¯è§æ€§ å®Œæˆå‰¯æœ¬åŒæ­¥ æ—¥å¿—ä½ç§»ï¼š LSOï¼šLog Stable Offsetï¼Œ Kafka äº‹åŠ¡é€šè¿‡ LSOæ¥åˆ¤æ–­æ¶ˆæ¯å¯è§æ€§ LEOï¼šLog End Offsetï¼Œæ—¥å¿—æœ«ç«¯ä½ç§»ï¼Œè¡¨ç¤ºå‰¯æœ¬å†™å…¥ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»å€¼ã€‚ Kafka ä½¿ç”¨ Leader å‰¯æœ¬çš„é«˜æ°´ä½æ¥å®šä¹‰æ‰€åœ¨åˆ†åŒºçš„é«˜æ°´ä½ã€‚ Leader Epoch æ•°æ®ç»“æ„ï¼š Epochï¼šç‰ˆæœ¬å·ï¼Œå°ç‰ˆæœ¬å·è¢«è®¤ä¸ºè¿‡æœŸ Start Offsetï¼šèµ·å§‹ä½ç§» ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:4:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"Kafka è¿ç»´ä¸ç›‘æ§ ä¸»é¢˜ç®¡ç† # åˆ›å»ºä¸»é¢˜ bin/kafka-topics.sh --bootstrap-server broker_host:port --create --topic my_topic_name --partitions 1 --replication-factor 1 # æŸ¥è¯¢ä¸»é¢˜ bin/kafka-topics.sh --bootstrap-server broker_host:port --list bin/kafka-topics.sh --bootstrap-server broker_host:port --describe --topic \u003ctopic_name\u003e # ä¿®æ”¹ä¸»é¢˜åˆ†åŒº bin/kafka-topics.sh --bootstrap-server broker_host:port --alter --topic \u003ctopic_name\u003e --partitions \u003c æ–°åˆ†åŒºæ•° \u003e # ä¿®æ”¹ä¸»é¢˜çº§åˆ« # è®¾ç½®åŠ¨æ€å‚æ•°ï¼Œä½¿ç”¨ --bootstrap-server # è®¾ç½®å¸¸è§„çš„ä¸»é¢˜çº§åˆ«å‚æ•°ï¼Œè¿˜æ˜¯ä½¿ç”¨ --zookeeperã€‚ bin/kafka-configs.sh --zookeeper zookeeper_host:port --entity-type topics --entity-name \u003ctopic_name\u003e --alter --add-config max.message.bytes=10485760 # ä¿®æ”¹ä¸»é¢˜é™åˆ¶ bin/kafka-configs.sh --zookeeper zookeeper_host:port --alter --add-config 'leader.replication.throttled.rate=104857600,follower.replication.throttled.rate=104857600' --entity-type brokers --entity-name 0 # Broker ID bin/kafka-configs.sh --zookeeper zookeeper_host:port --alter --add-config 'leader.replication.throttled.replicas=*,follower.replication.throttled.replicas=*' --entity-type topics --entity-name test # ä¸»é¢˜åˆ†åŒºè¿ç§» bin/kafka-topics.sh --bootstrap-server broker_host:port --delete --topic \u003ctopic_name\u003e å†…éƒ¨ä¸»é¢˜ï¼š __consumer_offsets __transaction_stateï¼šä¸ºæ”¯æŒäº‹åŠ¡å¼•å…¥ åŠ¨æ€ Broker å‚æ•°é…ç½® åˆå§‹åŒ–é…ç½®åœ¨config/server.propertiesä¸­ï¼Œ Dynamic Update Mode åˆ—ï¼ˆå±æ€§çš„ä¸‰ç§çº§åˆ«ï¼‰ï¼š read-onlyï¼šåªæœ‰é‡å¯ Brokerï¼Œæ‰èƒ½ä»¤ä¿®æ”¹ç”Ÿæ•ˆã€‚ per-brokerï¼šåªä¼šåœ¨å¯¹åº”çš„ Broker ä¸Šç”Ÿæ•ˆã€‚ å¦‚ listeners cluster-wideï¼šä¼šåœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ç”Ÿæ•ˆï¼Œå¯å¯¹æ‰€æœ‰ Broker éƒ½ç”Ÿæ•ˆã€‚ å¦‚ log.retention.ms # é…ç½® bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-default --alter --add-config unclean.leader.election.enable=true # æŸ¥çœ‹ bin/kafka-configs.sh --bootstrap-server kafka-host:port --entity-type brokers --entity-default --describe å¯èƒ½è¢«åŠ¨æ€è°ƒæ•´çš„å‚æ•°ï¼š log.retention.msï¼šä¿®æ”¹æ—¥å¿—ç•™å­˜æ—¶é—´ num.io.threads å’Œ num.network.threadsï¼šä¸¤ç»„çº¿ç¨‹æ±  ssl.keystore.typeã€ssl.keystore.locationã€ssl.keystore.password å’Œ ssl.key.passwordï¼šåˆ›å»ºé‚£äº›è¿‡æœŸæ—¶é—´å¾ˆçŸ­çš„ SSL è¯ä¹¦ï¼Œå¢åŠ å®‰å…¨æ€§ num.replica.fetchersï¼šå¢åŠ è¯¥å‚æ•°å€¼ï¼Œå¯ç¡®ä¿æœ‰å……è¶³çš„çº¿ç¨‹å¯ä»¥æ‰§è¡Œ Follower å‰¯æœ¬å‘ Leader å‰¯æœ¬çš„æ‹‰å– é‡è®¾æ¶ˆè´¹è€…ä½ç§» Kafka ä¼˜ç‚¹ï¼šæä¾›è¾ƒé«˜ååé‡ï¼Œæ¶ˆæ¯çŸ­ï¼Œèƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºã€‚ é‡è®¾ç­–ç•¥ï¼š ä½ç§»ç»´åº¦ Earliestï¼šæœ€æ—©ä½ç§»å¤„ Latestï¼šæœ€æ–°ä½ç§»å¤„ Currentï¼šæœ€æ–°æäº¤ä½ç§»å¤„ Specified-Offsetï¼šç‰¹å®šä½ç§»å¤„ï¼ˆç»å¯¹æ•°å€¼ï¼‰ Shift-By-Nï¼šè°ƒæ•´åˆ°å½“å‰ä½ç§»+Nå¤„ï¼ˆç›¸å¯¹æ•°å€¼ï¼‰ æ—¶é—´ç»´åº¦ DateTimeï¼šæ—¶åˆ»å¤„ Durationï¼šè·ç¦»å½“å‰æ—¶é—´é—´éš”å¤„ï¼Œæ ¼å¼ä¸º PnDTnHnMnSï¼Œå¦‚ 15 åˆ†é’Ÿå‰å¯è¡¨ç¤ºä¸º PT0H15M0Sã€‚ åœ¨ Java ä¸­ï¼Œé€šè¿‡consumer.seek(key,value) æ–¹æ³•é‡è®¾ç­–ç•¥ã€‚ è¿ç»´åˆ©å™¨ AdminClient \u003cdependency\u003e \u003cgroupId\u003eorg.apache.kafka\u003c/groupId\u003e \u003cartifactId\u003ekafka-clients\u003c/artifactId\u003e \u003cversion\u003e2.3.0\u003c/version\u003e \u003c/dependency\u003e åœ¨ Java ä¸­çš„å¯¹è±¡ä¸ºorg.apache.kafka.clients.admin.AdminClient // åˆ›å»ºä¸»é¢˜ String newTopicName = \"test-topic\"; try (AdminClient client = AdminClient.create(props)) { NewTopic newTopic = new NewTopic(newTopicName, 10, (short) 3); CreateTopicsResult result = client.createTopics(Arrays.asList(newTopic)); result.all().get(10, TimeUnit.SECONDS); } // æŸ¥è¯¢æ¶ˆè´¹è€…ä½ç§» String groupID = \"test-group\"; try (AdminClient client = AdminClient.create(props)) { ListConsumerGroupOffsetsResult result = client.listConsumerGroupOffsets(groupID); Map\u003cTopicPartition, OffsetAndMetadata\u003e offsets = result.partitionsToOffsetAndMetadata().get(10, TimeUnit.SECONDS); System.out.println(offsets); } // è·å– Broker ç£ç›˜å ç”¨ try (AdminClient client = AdminClient.create(props)) { DescribeLogDirsResult ret = client.describeLogDirs(Collections.singletonList(targetBrokerId)); // æŒ‡å®š Broker id long size = 0L; for (Map\u003cString, DescribeLogDirsResponse.LogDirInfo\u003e logDirInfoMap : ret.all().get().values()) { size += logDirInfoMap.values().stream().map(logDirInfo -\u003e logDirInfo.replicaInfos).flatMap( topicPartitionReplicaInfoMap -\u003e topicPartitionReplicaInfoMap.values().stream().map(replicaInfo -\u003e replicaInfo.size)) .mapToLong(Long::longValue).sum(); } System.out.println(size); } Kafka è®¤è¯æœºåˆ¶ authentication SASL æœºåˆ¶ï¼šæä¾›è®¤è¯å’Œæ•°æ®å®‰å…¨æœåŠ¡çš„æ¡†æ¶ FSSAPIï¼šKerberos ä½¿ç”¨çš„å®‰å…¨æ¥å£ PLAINï¼šç”¨æˆ·å+å¯†ç  SCRAM ï¼šæ”¹è¿› PLAINï¼Œå°†è®¤è¯ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨ ZooKeeperï¼Œé¿å…äº†åŠ¨æ€ä¿®æ”¹éœ€è¦é‡å¯ Broker çš„å¼Šç«¯ OAUTHBEARERï¼šåŸºäº OAuth 2 è®¤è¯æ¡†æ¶ Delegation Tokenï¼šè½»é‡çº§ æˆæƒæœºåˆ¶ Authorization æƒé™æ¨¡å‹ï¼š ACLï¼šAccess-Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚ï¼ˆç”¨æˆ·ç›´æ¥æ˜ å°„æƒé™ï¼‰ å¼€å¯æ–¹æ³•ï¼šauthorizer.class.name=kafka.security.auth.SimpleAclAuthorizer RBACï¼šRole-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚ ABACï¼šAttribute-Based Access Controlï¼ŒåŸºäºå±æ€§çš„æƒé™æ§åˆ¶ã€‚ PBACï¼šPolicy-Based Access Controlï¼ŒåŸºäºç­–ç•¥çš„æƒé™æ§åˆ¶ã€‚ ç›‘æ§ Kafka JVM è°ƒä¼˜ Full GC å‘ç”Ÿé¢‘ç‡å’Œæ—¶é•¿ å¼€å¯ G1 çš„ -XX:+PrintAdaptiveSizePolicy å¼€å…³ï¼Œè®© JVM å‘Šè¯‰ä½ åˆ°åº•æ˜¯è°å¼•å‘äº† Full GCã€‚ æ´»è·ƒå¯¹è±¡å¤§å° åº”ç”¨çº¿ç¨‹æ€»æ•° Broker é›†ç¾¤ç›‘æ§ 5 ä¸ªæ–¹æ³•ï¼š æŸ¥çœ‹ Broker è¿›ç¨‹æ˜¯å¦å¯åŠ¨ï¼Œç«¯å£æ˜¯å¦å»ºç«‹ æŸ¥çœ‹ Broker ç«¯å…³é”®æ—¥å¿— æŸ¥çœ‹ Broker ç«¯ 2 ç±»å…³é”®çº¿ç¨‹çš„çŠ¶æ€ Log Compaction çº¿ç¨‹ï¼Œè¿™ç±»çº¿ç¨‹æ˜¯ä»¥ kafka-log-cleaner-thread å¼€å¤´çš„ å‰¯æœ¬æ‹‰å–æ¶ˆæ¯çš„çº¿ç¨‹ï¼Œé€šå¸¸ä»¥ ReplicaFetcherThread å¼€å¤´ æŸ¥çœ‹ Broker ç«¯ç«¯å…³é”® JMX æŒ‡æ ‡ ç›‘æ§ Kafka å®¢æˆ·ç«¯ï¼šé¦–è¦å…³å¿ƒç½‘ç»œå¾€è¿”æ—¶å»¶ï¼ˆRound-Trip Timeï¼ŒRTTï¼‰ ä¸»æµç›‘æ§æ¡†æ¶ Kafka Manager æ¡†æ¶é€‚ç”¨äºåŸºæœ¬çš„ Kafka ç›‘æ§ Grafana+InfluxDB+JMXTrans çš„ç»„åˆé€‚ç”¨äºå·²ç»å…·æœ‰è¾ƒæˆç†Ÿæ¡†æ¶çš„ä¼ä¸šï¼Œå¯ä»¥åœ¨ä¸€å¥—æ¡†æ¶ä¸­åŒæ—¶ç›‘æ§ä¼ä¸šçš„dogeå…³é”®æŠ€æœ¯ç»„ä»¶ è°ƒä¼˜ Kafka ç›®æ ‡ï¼šé«˜ååé‡ã€ä½å»¶è¿Ÿ ä¼˜åŒ–æ¼æ–— å±‚çº§è¶Šé ä¸Šï¼Œè°ƒä¼˜æ•ˆæœè¶Šæ˜æ˜¾ï¼š åº”ç”¨ç¨‹åºå±‚ ä¸è¦é¢‘ç¹åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œå¤šå¤ç”¨ ç”¨å®ŒåŠæ—¶å…³é—­ åˆç†åˆ©ç”¨å¤šçº¿ç¨‹ï¼ŒKafka çš„ Java Producer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒJava Consumer è™½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿæœ‰åº”å¯¹æ–¹æ¡ˆï¼ˆè§å‰æ–‡ï¼‰ã€‚ æ¡†æ¶å±‚ï¼šå°½åŠ›ä¿æŒå®¢æˆ·ç«¯ç‰ˆæœ¬å’Œ Broker ç«¯ç‰ˆæœ¬ä¸€è‡´ JVM å±‚ å †è®¾ç½®ï¼š6ï½8 GBï¼Œæˆ– Full GC ä¹‹åå †ä¸Šå­˜æ´»å¯¹è±¡çš„æ€»å¤§å°çš„ 1.5ï½2 å€ GC æ”¶é›†å™¨ï¼šé€‰æ‹© G1 æ”¶é›†å™¨ é…ç½®-XX:+PrintAdaptiveSizePolicyï¼Œæ¥æ¢æŸ¥ä¸€ä¸‹åˆ°åº•æ˜¯è°å¯¼è‡´çš„ Full GCã€‚ é…ç½®-XX:+G1HeapRegionSize=Nï¼ŒNè¶Šå¤§ï¼Œå¤§å¯¹è±¡æ•°è¶Šå°‘ã€‚ æ“ä½œç³»ç»Ÿå±‚ æŒ‚åœ¨æ–‡ä»¶ç³»ç»Ÿæ—¶ç¦æ‰ atime æ›´æ–°ï¼Œé¿å… inode è®¿é—®æ—¶é—´çš„å†™å…¥æ“ä½œï¼Œå‡å°‘æ–‡ä»¶ç³»ç»Ÿçš„å†™æ“ä½œæ•°ã€‚å‘½ä»¤ï¼šmount -o noatime é€‰æ‹© ext4 æˆ– XFS æ–‡ä»¶ç³»ç»Ÿ swap ç©ºé—´è®¾ç½®æˆä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œæ¯”å¦‚ 1ï½10 ä¹‹é—´ï¼Œä»¥é˜²æ­¢ Linux çš„ OOM Killer å¼€å¯éšæ„æ€æ‰è¿›ç¨‹ é¡µç¼“å­˜å¤§å°é¢„ç•™å‡ºä¸€ä¸ªæ—¥å¿—æ®µå¤§å°ï¼Œè‡³å°‘èƒ½ä¿è¯ Kafka å¯ä»¥å°†æ•´ä¸ªæ—¥å¿—æ®µå…¨éƒ¨æ”¾å…¥é¡µç¼“å­˜ ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:5:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["è¯»ä¹¦ç¬”è®°"],"content":"Kafka Streams æµå¤„ç†ï¼šå¤„ç†æ— é™æ•°æ®é›† Kafka Streams çš„ç‰¹ç‚¹ å®ƒæ˜¯ä¸€ä¸ªJava å®¢æˆ·ç«¯åº“ï¼ˆClient Libraryï¼‰ï¼Œæ›´è½»é‡çº§ åº”ç”¨éƒ¨ç½²æ–¹é¢ï¼šKafka Streams æ›´å€¾å‘äºå°†éƒ¨ç½²äº¤ç»™å¼€å‘äººå‘˜æ¥åšï¼Œè€Œä¸æ˜¯ä¾èµ–äºæ¡†æ¶è‡ªå·±å®ç°ã€‚ ä¸Šä¸‹æ¸¸æ•°æ®æºï¼šKafka Streams åªæ”¯æŒä¸ Kafka é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œå®ƒæ²¡æœ‰æä¾›å¼€ç®±å³ç”¨çš„å¤–éƒ¨æ•°æ®æºè¿æ¥å™¨ã€‚ åè°ƒæ–¹å¼ï¼šé€šè¿‡æ¶ˆè´¹è€…ç»„å®ç°é«˜ä¼¸ç¼©æ€§å’Œé«˜å®¹é”™æ€§ Kafka Streams ä¸ Kafka çš„é€‚é…æ€§æœ€å¥½ DSL ï¼šDomain Specific Languageï¼Œé¢†åŸŸç‰¹å®šè¯­è¨€ æµè¡¨äºŒå…ƒæ€§ï¼šæµåœ¨æ—¶é—´ç»´åº¦ä¸Šèšåˆä¹‹åå½¢æˆè¡¨ï¼Œè¡¨åœ¨æ—¶é—´ç»´åº¦ä¸Šä¸æ–­æ›´æ–°å½¢æˆæµï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æµè¡¨äºŒå…ƒæ€§ï¼ˆDuality of Streams and Tablesï¼‰ å¸¸è§æ“ä½œç®—å­ æ— çŠ¶æ€ç®—å­ filterï¼šè¿‡æ»¤ï¼Œå¦‚.filter(((key, value) -\u003e value.startsWith(\"s\"))) mapï¼škvå¯¹ï¼Œå¦‚ KStream\u003cString, Integer\u003e transformed = stream.map( (key, value) -\u003e KeyValue.pair(value.toLowerCase(), value.length())); print æ˜¯ç»ˆæ­¢æ“ä½œï¼Œpeek è¿˜èƒ½ç»§ç»­å¤„ç† æœ‰çŠ¶æ€ç®—å­ï¼šæ¶‰åŠèšåˆæ–¹é¢æ“ä½œ é‡‘èé¢†åŸŸåº”ç”¨ Avroï¼š æ˜¯ Java æˆ–å¤§æ•°æ®ç”Ÿæ€åœˆå¸¸ç”¨çš„åºåˆ—åŒ–ç¼–ç æœºåˆ¶ï¼Œèƒ½æå¤§åœ°èŠ‚çœç£ç›˜å ç”¨ç©ºé—´æˆ–ç½‘ç»œ I/O ä¼ è¾“é‡ è¯†åˆ«ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼š èº«ä»½è¯å· æ‰‹æœºå· è®¾å¤‡ ID åº”ç”¨æ³¨å†Œè´¦å· Cookie ","date":"2023-08-08","objectID":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/:6:0","tags":["MQ"],"title":"ã€ŠKafkaæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ç¬”è®°","uri":"/kafka%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"},{"categories":["draft"],"content":"1. 3PC ç›¸æ¯” 2PC æ”¹è¿›åœ¨å“ªï¼Ÿ 3PCåœ¨äº‹åŠ¡ç®¡ç†è€…å’Œäº‹åŠ¡å‚ä¸è€…ä¸­å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œè¶…è¿‡å“åº”æ—¶é—´é»˜è®¤å¤±è´¥ï¼Œä»¥é¿å…äº‹åŠ¡å‚ä¸è€…ä¸€ç›´é˜»å¡å ç”¨èµ„æºã€‚ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰åœ¨2PCä¸­ç›´é‚®äº‹åŠ¡ç®¡ç†è€…æ‰æ‹¥æœ‰è¶…æ—¶æœºåˆ¶ã€‚ å®é™…åº”ç”¨å¹¿æ³›çš„ï¼š2PC+å¤åˆ¶çŠ¶æ€æœº ","date":"2023-08-08","objectID":"/distributed-transaction/:0:1","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"2. TCC ä¸ 2PC/3PC çš„åŒºåˆ«ï¼Ÿ TCC ï¼šTry - Confirm - Cancelï¼Œä¸€ç§æŸ”æ€§äº‹åŠ¡è§£å†³æ–¹æ¡ˆ 2PC/3PC ä¾é æ•°æ®åº“æˆ–è€…å­˜å‚¨èµ„æºå±‚é¢çš„äº‹åŠ¡ï¼ŒTCC ä¸»è¦é€šè¿‡ä¿®æ”¹ä¸šåŠ¡ä»£ç æ¥å®ç°ã€‚ 2PC/3PC å±äºä¸šåŠ¡ä»£ç æ— ä¾µå…¥çš„ï¼ŒTCC å¯¹ä¸šåŠ¡ä»£ç æœ‰ä¾µå…¥ã€‚ 2PC/3PC è¿½æ±‚çš„æ˜¯å¼ºä¸€è‡´æ€§ï¼Œåœ¨ä¸¤é˜¶æ®µæäº¤çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€ç›´ä¼šæŒæœ‰æ•°æ®åº“çš„é”ã€‚TCC è¿½æ±‚çš„ æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸ä¼šä¸€ç›´æŒæœ‰å„ä¸ªä¸šåŠ¡èµ„æºçš„é”ã€‚ ","date":"2023-08-08","objectID":"/distributed-transaction/:0:2","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"3. åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ç±»ï¼šæŸ”æ€§äº‹åŠ¡å’Œåˆšæ€§äº‹åŠ¡ æŸ”æ€§äº‹åŠ¡ï¼šTCC/FMTã€Sagaï¼ˆçŠ¶æ€æœºæ¨¡å¼ã€Aopæ¨¡å¼ï¼‰ã€æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯ã€æ¶ˆæ¯äº‹åŠ¡ï¼ˆåŠæ¶ˆæ¯ï¼‰ æ»¡è¶³ BASE ç†è®º æœ‰ä¸šåŠ¡æ”¹é€ ï¼Œæœ€ç»ˆâ¼€è‡´æ€§ï¼Œå®ç°è¡¥å¿æ¥â¼ï¼Œå®ç°èµ„æºé”å®šæ¥â¼ï¼Œâ¾¼å¹¶å‘ï¼Œé€‚åˆâ»“äº‹åŠ¡ ç»†åˆ†ä¸ºä¸¤ç§ï¼š è¡¥å¿å‹äº‹åŠ¡ï¼ˆåŒæ­¥ï¼‰ï¼šTCCã€Saga TCC æŠŠäº‹åŠ¡è¿â¾è¿‡ç¨‹åˆ†æˆ Tryã€Confirm / Cancel ä¸¤ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µçš„é€»è¾‘ç”±ä¸šåŠ¡ä»£ç æ§åˆ¶ï¼Œé¿å…äº†â»“äº‹åŠ¡ï¼Œå¯ä»¥è·å–æ›´â¾¼çš„æ€§èƒ½ã€‚ é€šçŸ¥å‹äº‹åŠ¡ï¼ˆå¼‚æ­¥ï¼‰ï¼šMQäº‹åŠ¡æ¶ˆæ¯ã€æœ€â¼¤åŠªâ¼’é€šçŸ¥å‹ã€‚ å¤–éƒ¨ç³»ç»Ÿï¼šæœ€å¤§åŠªåŠ›é€šçŸ¥å‹å› ä¸ºå¤–éƒ¨çš„â½¹ç»œç¯å¢ƒæ›´åŠ å¤æ‚å’Œä¸å¯ä¿¡ï¼Œæ‰€ä»¥åªèƒ½å°½æœ€â¼¤åŠªâ¼’å»é€šçŸ¥å®ç°æ•°æ®æœ€ç»ˆâ¼€è‡´æ€§ï¼Œâ½å¦‚å……å€¼å¹³å°ä¸è¿è¥å•†ã€â½€ä»˜å¯¹æ¥ç­‰ç­‰è·¨â½¹ç»œç³»ç»Ÿçº§åˆ«å¯¹æ¥ï¼› å†…éƒ¨ç³»ç»Ÿï¼šå¼‚æ­¥ç¡®ä¿å‹ï¼Œå› ä¸ºå†…éƒ¨ç›¸å¯¹â½è¾ƒå¯æ§ï¼Œå¦‚è®¢å•å’Œè´­ç‰©â»‹ã€æ”¶è´§ä¸æ¸…ç®—ã€â½€ä»˜ä¸ç»“ç®—ç­‰ç­‰åœºæ™¯ï¼› åˆšæ€§äº‹åŠ¡ï¼šXA åè®®ï¼ˆ2PCã€JTAã€JTSï¼‰ã€3PC æ»¡è¶³ CP ç†è®º é€šå¸¸â½†ä¸šåŠ¡æ”¹é€ ï¼Œå¼ºâ¼€è‡´æ€§ï¼ŒåŸâ½£â½€æŒå›æ»š/éš”ç¦»æ€§ï¼Œä½å¹¶å‘ï¼Œé€‚åˆçŸ­äº‹åŠ¡ ä½†ç”±äºåŒæ­¥é˜»å¡ï¼Œå¤„ç†æ•ˆç‡ä½ï¼Œä¸é€‚åˆâ¼¤å‹â½¹ç«™åˆ†å¸ƒå¼åœºæ™¯ æœ€â¼¤åŠªâ¼’é€šçŸ¥äº‹åŠ¡ VS å¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡ æœ€â¼¤åŠªâ¼’é€šçŸ¥äº‹åŠ¡åœ¨æˆ‘è®¤çŸ¥ä¸­ï¼Œå…¶å®æ˜¯åŸºäºå¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡å‘å±•â½½æ¥é€‚â½¤äºå¤–éƒ¨å¯¹æ¥çš„â¼€ç§ä¸šåŠ¡å®ç°ã€‚ä»–ä»¬ä¸»è¦æœ‰çš„æ˜¯ä¸šåŠ¡å·®åˆ«ï¼Œå¦‚ä¸‹ï¼š ä»å‚ä¸è€…æ¥è¯´ï¼šæœ€â¼¤åŠªâ¼’é€šçŸ¥äº‹åŠ¡é€‚â½¤äºè·¨å¹³å°ã€è·¨ä¼ä¸šçš„ç³»ç»Ÿé—´ä¸šåŠ¡äº¤äº’ï¼›å¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡æ›´é€‚â½¤äºåŒâ½¹ç»œä½“ç³»çš„å†…éƒ¨æœåŠ¡äº¤ä»˜ã€‚ ä»æ¶ˆæ¯å±‚â¾¯è¯´ï¼šæœ€â¼¤åŠªâ¼’é€šçŸ¥äº‹åŠ¡éœ€è¦ä¸»åŠ¨æ¨é€å¹¶æä¾›å¤šæ¡£æ¬¡æ—¶é—´çš„é‡è¯•æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„é€šçŸ¥ï¼›â½½å¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡åªéœ€è¦æ¶ˆæ¯æ¶ˆè´¹è€…ä¸»åŠ¨å»æ¶ˆè´¹ã€‚ ä»æ•°æ®å±‚â¾¯è¯´ï¼šæœ€â¼¤åŠªâ¼’é€šçŸ¥äº‹åŠ¡è¿˜éœ€é¢å¤–çš„å®šæœŸæ ¡éªŒæœºåˆ¶å¯¹æ•°æ®è¿›â¾å…œåº•ï¼Œä¿è¯æ•°æ®çš„æœ€ç»ˆâ¼€è‡´æ€§ï¼›â½½å¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡åªéœ€ä¿è¯æ¶ˆæ¯çš„å¯é æŠ•é€’å³å¯ï¼Œâ¾ƒèº«â½†éœ€å¯¹æ•°æ®è¿›â¾å…œåº•å¤„ç†ã€‚ ","date":"2023-08-08","objectID":"/distributed-transaction/:0:3","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"4. åˆšæ€§äº‹åŠ¡ - XA æ¨¡å‹ è¿™ä¸ªæ¨¡å‹ä¸»è¦ä½¿â½¤äº† 2PC æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„å®Œæ•´æ€§ã€‚ åœ¨X/Open **DTP(Distributed Transaction Process)**æ¨¡å‹â¾¥â¾¯ï¼Œæœ‰ä¸‰ä¸ªâ»†â¾Šï¼š AP: Applicationï¼Œåº”â½¤ç¨‹åºã€‚ä¹Ÿå°±æ˜¯ä¸šåŠ¡å±‚ã€‚å“ªäº›æ“ä½œå±äºâ¼€ä¸ªäº‹åŠ¡ï¼Œå°±æ˜¯APå®šä¹‰çš„ã€‚ TM: Transaction Managerï¼Œäº‹åŠ¡ç®¡ç†å™¨ã€‚æ¥æ”¶APçš„äº‹åŠ¡è¯·æ±‚ï¼Œå¯¹å…¨å±€äº‹åŠ¡è¿›â¾ç®¡ç†ï¼Œç®¡ç†äº‹åŠ¡åˆ†â½€çŠ¶æ€ï¼Œåè°ƒRMçš„å¤„ç†ï¼Œé€šçŸ¥RMå“ªäº›æ“ä½œå±äºå“ªäº›å…¨å±€äº‹åŠ¡ä»¥åŠäº‹åŠ¡åˆ†â½€ç­‰ç­‰ã€‚è¿™ä¸ªä¹Ÿæ˜¯æ•´ä¸ªäº‹åŠ¡è°ƒåº¦æ¨¡å‹çš„æ ¸â¼¼éƒ¨åˆ†ã€‚ RMï¼šResource Managerï¼Œèµ„æºç®¡ç†å™¨ã€‚â¼€èˆ¬æ˜¯æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„èµ„æºç®¡ç†å™¨ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—(å¦‚JMSæ•°æ®æº)ï¼Œâ½‚ä»¶ç³»ç»Ÿç­‰ã€‚ XAè§„èŒƒä¸»è¦å®šä¹‰äº†(å…¨å±€)äº‹åŠ¡ç®¡ç†å™¨(Transaction Manager)å’Œ(å±€éƒ¨)èµ„æºç®¡ç†å™¨(Resource Manager)ä¹‹é—´çš„æ¥â¼ã€‚XAæ¥â¼æ˜¯åŒå‘çš„ç³»ç»Ÿæ¥â¼ï¼Œåœ¨äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransaction Managerï¼‰ä»¥åŠâ¼€ä¸ªæˆ–å¤šä¸ªèµ„æºç®¡ç†å™¨ï¼ˆResource Managerï¼‰ä¹‹é—´å½¢æˆé€šä¿¡æ¡¥æ¢ï¼Œä»â½½åœ¨å¤šä¸ªæ•°æ®åº“èµ„æºä¸‹ä¿è¯ACIDå››ä¸ªç‰¹æ€§ã€‚â½¬å‰çŸ¥åçš„æ•°æ®åº“ï¼Œå¦‚Oracle, DB2,mysqlç­‰ï¼Œéƒ½æ˜¯å®ç°äº†XAæ¥â¼çš„ï¼Œéƒ½å¯ä»¥ä½œä¸ºRMã€‚ XAä¹‹æ‰€ä»¥éœ€è¦å¼•â¼Šäº‹åŠ¡ç®¡ç†å™¨æ˜¯å› ä¸ºï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä»ç†è®ºä¸Šè®²ï¼ˆå‚è€ƒFischerç­‰çš„è®ºâ½‚ï¼‰ï¼Œä¸¤å°æœºå™¨ç†è®ºä¸Šâ½†æ³•è¾¾åˆ°â¼€è‡´çš„çŠ¶æ€ï¼Œéœ€è¦å¼•â¼Šâ¼€ä¸ªå•ç‚¹è¿›â¾åè°ƒã€‚äº‹åŠ¡ç®¡ç†å™¨æ§åˆ¶ç€å…¨å±€äº‹åŠ¡ï¼Œç®¡ç†äº‹åŠ¡â½£å‘½å‘¨æœŸï¼Œå¹¶åè°ƒèµ„æºã€‚èµ„æºç®¡ç†å™¨è´Ÿè´£æ§åˆ¶å’Œç®¡ç†å®é™…èµ„æºï¼ˆå¦‚æ•°æ®åº“æˆ–JMSé˜Ÿåˆ—) ","date":"2023-08-08","objectID":"/distributed-transaction/:0:4","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"5. XAè§„èŒƒ ä»¥ä¸‹çš„å‡½æ•°ä½¿äº‹åŠ¡ç®¡ç†å™¨å¯ä»¥å¯¹èµ„æºç®¡ç†å™¨è¿›â¾çš„æ“ä½œï¼š xa_open,xa_closeï¼šå»ºâ½´å’Œå…³é—­ä¸èµ„æºç®¡ç†å™¨çš„è¿æ¥ã€‚ xa_start,xa_endï¼šå¼€å§‹å’Œç»“æŸâ¼€ä¸ªæœ¬åœ°äº‹åŠ¡ã€‚ xa_prepare,xa_commit,xa_rollbackï¼šé¢„æäº¤ã€æäº¤å’Œå›æ»šâ¼€ä¸ªæœ¬åœ°äº‹åŠ¡ã€‚ xa_recoverï¼šå›æ»šâ¼€ä¸ªå·²è¿›â¾é¢„æäº¤çš„äº‹åŠ¡ã€‚ ax_å¼€å¤´çš„å‡½æ•°ä½¿èµ„æºç®¡ç†å™¨å¯ä»¥åŠ¨æ€åœ°åœ¨äº‹åŠ¡ç®¡ç†å™¨ä¸­è¿›â¾æ³¨å†Œï¼Œå¹¶ å¯ä»¥å¯¹XID(TRANSACTION IDS)è¿›â¾æ“ä½œã€‚ ax_reg,ax_unregï¼›å…è®¸â¼€ä¸ªèµ„æºç®¡ç†å™¨åœ¨â¼€ä¸ªTMS(TRANSACTION MANAGER SERVER)ä¸­åŠ¨æ€æ³¨å†Œæˆ–æ’¤æ¶ˆæ³¨å†Œã€‚ XAå„ä¸ªé˜¶æ®µçš„å¤„ç†æµç¨‹ ","date":"2023-08-08","objectID":"/distributed-transaction/:0:5","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"6. JTAè§„èŒƒ ä½œä¸ºjavaå¹³å°ä¸Šäº‹åŠ¡è§„èŒƒ JTAï¼ˆJava Transaction APIï¼‰ä¹Ÿå®šä¹‰äº†å¯¹XAäº‹åŠ¡çš„â½€æŒï¼Œå®é™…ä¸Šï¼ŒJTAæ˜¯åŸºäºXAæ¶æ„ä¸Šå»ºæ¨¡çš„ï¼Œåœ¨JTA ä¸­ï¼Œäº‹åŠ¡ç®¡ç†å™¨æŠ½è±¡ä¸ºjavax.transaction.TransactionManageræ¥â¼ï¼Œå¹¶é€šè¿‡åº•å±‚äº‹åŠ¡æœåŠ¡ ï¼ˆå³JTSï¼‰å®ç°ã€‚åƒå¾ˆå¤šå…¶ä»–çš„javaè§„èŒƒâ¼€æ ·ï¼ŒJTAä»…ä»…å®šä¹‰äº†æ¥â¼ï¼Œå…·ä½“çš„å®ç°åˆ™æ˜¯ç”±ä¾›åº”å•†(å¦‚J2EEâ¼šå•†)è´Ÿè´£æä¾›ã€‚ ","date":"2023-08-08","objectID":"/distributed-transaction/:0:6","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"7. TCC TCC(Try-Confirm-Cancel)åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ç›¸å¯¹äº XA ç­‰ä¼ ç»Ÿæ¨¡å‹ï¼Œå…¶ç‰¹å¾åœ¨äºå®ƒä¸ä¾èµ–èµ„æºç®¡ç†å™¨(RM)å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„â½€æŒï¼Œâ½½æ˜¯é€šè¿‡å¯¹ä¸šåŠ¡é€»è¾‘çš„åˆ†è§£æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ TCC æ¨¡å‹è®¤ä¸ºå¯¹äºä¸šåŠ¡ç³»ç»Ÿä¸­â¼€ä¸ªç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶å¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼Œå¿…é¡»æ¥å—â¼€äº›ä¸ç¡®å®šæ€§ï¼Œå³å¯¹ä¸šåŠ¡é€»è¾‘åˆæ­¥æ“ä½œçš„è°ƒâ½¤ä»…æ˜¯â¼€ä¸ªä¸´æ—¶æ€§æ“ä½œï¼Œè°ƒâ½¤å®ƒçš„ä¸»ä¸šåŠ¡æœåŠ¡ä¿ç•™äº†åç»­çš„å–æ¶ˆæƒã€‚å¦‚æœä¸»ä¸šåŠ¡æœåŠ¡è®¤ä¸ºå…¨å±€äº‹åŠ¡åº”è¯¥å›æ»šï¼Œå®ƒä¼šè¦æ±‚å–æ¶ˆä¹‹å‰çš„ä¸´æ—¶æ€§æ“ä½œï¼Œè¿™å°±å¯¹åº”ä»ä¸šåŠ¡æœåŠ¡çš„å–æ¶ˆæ“ä½œã€‚â½½å½“ä¸»ä¸šåŠ¡æœåŠ¡è®¤ä¸ºå…¨å±€äº‹åŠ¡åº”è¯¥æäº¤æ—¶ï¼Œå®ƒä¼šæ”¾å¼ƒä¹‹å‰ä¸´æ—¶æ€§æ“ä½œçš„å–æ¶ˆæƒï¼Œè¿™å¯¹åº”ä»ä¸šåŠ¡æœåŠ¡çš„ç¡®è®¤æ“ä½œã€‚æ¯â¼€ä¸ªåˆæ­¥æ“ä½œï¼Œæœ€ç»ˆéƒ½ä¼šè¢«ç¡®è®¤æˆ–å–æ¶ˆã€‚ TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š Try é˜¶æ®µï¼š è°ƒâ½¤ Try æ¥â¼ï¼Œå°è¯•æ‰§â¾ä¸šåŠ¡ï¼Œå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼Œé¢„ç•™ä¸šåŠ¡èµ„æºã€‚ Confirm æˆ– Cancel é˜¶æ®µï¼š ä¸¤è€…æ˜¯äº’æ–¥çš„ï¼Œåªèƒ½è¿›â¼Šå…¶ä¸­â¼€ä¸ªï¼Œå¹¶ä¸”éƒ½æ»¡â¾œå¹‚ç­‰æ€§ï¼Œå…è®¸å¤±è´¥é‡è¯•ã€‚ Confirm æ“ä½œï¼š å¯¹ä¸šåŠ¡ç³»ç»Ÿåšç¡®è®¤æäº¤ï¼Œç¡®è®¤æ‰§â¾ä¸šåŠ¡æ“ä½œï¼Œä¸åšå…¶ä»–ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿â½¤ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚ Cancel æ“ä½œï¼š åœ¨ä¸šåŠ¡æ‰§â¾é”™è¯¯ï¼Œéœ€è¦å›æ»šçš„çŠ¶æ€ä¸‹æ‰§â¾ä¸šåŠ¡å–æ¶ˆï¼Œé‡Šæ”¾é¢„ç•™èµ„æºã€‚ Try é˜¶æ®µå¤±è´¥å¯ä»¥ Cancelï¼Œå¦‚æœ Confirm å’Œ Cancel é˜¶æ®µå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ TCC ä¸­ä¼šæ·»åŠ äº‹åŠ¡â½‡å¿—ï¼Œå¦‚æœ Confirm æˆ–è€… Cancel é˜¶æ®µå‡ºé”™ï¼Œåˆ™ä¼šè¿›â¾é‡è¯•ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªé˜¶æ®µéœ€è¦â½€æŒå¹‚ç­‰ï¼›å¦‚æœé‡è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦â¼ˆâ¼¯ä»‹â¼Šè¿›â¾æ¢å¤å’Œå¤„ç†ç­‰ã€‚ TCCäº‹åŠ¡æ¨¡å‹çš„è¦æ±‚ å¯æŸ¥è¯¢æ“ä½œï¼šæœåŠ¡æ“ä½œå…·æœ‰å…¨å±€å”¯â¼€çš„æ ‡è¯†ï¼Œæ“ä½œå”¯â¼€çš„ç¡®å®šçš„æ—¶é—´ã€‚ å¹‚ç­‰æ“ä½œï¼šé‡å¤è°ƒâ½¤å¤šæ¬¡äº§â½£çš„ä¸šåŠ¡ç»“æœä¸è°ƒâ½¤â¼€æ¬¡äº§â½£çš„ç»“æœç›¸åŒã€‚ é€šè¿‡ä¸šåŠ¡æ“ä½œå®ç°å¹‚ç­‰æ€§ ç³»ç»Ÿç¼“å­˜æ‰€æœ‰è¯·æ±‚ä¸å¤„ç†çš„ç»“æœï¼Œæœ€åæ˜¯æ£€æµ‹åˆ°é‡å¤è¯·æ±‚ä¹‹åï¼Œâ¾ƒåŠ¨è¿”å›ä¹‹å‰çš„å¤„ç†ç»“æœã€‚ TCCäº‹åŠ¡æ¨¡å‹ VS DTPäº‹åŠ¡æ¨¡å‹ â½è¾ƒâ¼€ä¸‹TCCäº‹åŠ¡æ¨¡å‹å’ŒDTPäº‹åŠ¡æ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š è¿™ä¸¤å¼ å›¾çœ‹èµ·æ¥å·®åˆ«è¾ƒâ¼¤ï¼Œå®é™…ä¸Šå¾ˆå¤šåœ°â½…æ˜¯ç±»ä¼¼çš„! TCCæ¨¡å‹ä¸­çš„ ä¸»ä¸šåŠ¡æœåŠ¡ ç›¸å½“äº DTPæ¨¡å‹ä¸­çš„APï¼ŒTCCæ¨¡å‹ä¸­çš„ä»ä¸šåŠ¡æœåŠ¡ ç›¸å½“äº DTPæ¨¡å‹ä¸­çš„RM åœ¨DTPæ¨¡å‹ä¸­ï¼Œåº”â½¤APæ“ä½œå¤šä¸ªèµ„æºç®¡ç†å™¨RMä¸Šçš„èµ„æºï¼›â½½åœ¨TCCæ¨¡å‹ä¸­ï¼Œæ˜¯ä¸»ä¸šåŠ¡æœåŠ¡æ“ä½œå¤šä¸ªä»ä¸šåŠ¡æœåŠ¡ä¸Šçš„èµ„æºã€‚ä¾‹å¦‚èˆªç­é¢„å®šæ¡ˆä¾‹ä¸­ï¼Œç¾å›¢Appå°±æ˜¯ä¸»ä¸šåŠ¡æœåŠ¡ï¼Œâ½½å·èˆªå’Œä¸œèˆªå°±æ˜¯ä»ä¸šåŠ¡æœåŠ¡ï¼Œä¸»ä¸šåŠ¡æœåŠ¡éœ€è¦ä½¿â½¤ä»ä¸šåŠ¡æœåŠ¡ä¸Šçš„æœºç¥¨èµ„æºã€‚ä¸åŒçš„æ˜¯DTPæ¨¡å‹ä¸­çš„èµ„æºæä¾›è€…æ˜¯ç±»ä¼¼äºMysqlè¿™ç§å…³ç³»å‹æ•°æ®åº“ï¼Œâ½½TCCæ¨¡å‹ä¸­èµ„æºçš„æä¾›è€…æ˜¯å…¶ä»–ä¸šåŠ¡æœåŠ¡ã€‚ TCCæ¨¡å‹ä¸­ï¼Œä»ä¸šåŠ¡æœåŠ¡æä¾›çš„tryã€confirmã€cancelæ¥â¼ ç›¸å½“äº DTPæ¨¡å‹ä¸­RMæä¾›çš„prepareã€commitã€rollbackæ¥â¼ã€‚XAåè®®ä¸­è§„å®šäº†DTPæ¨¡å‹ä¸­å®šRMéœ€è¦æä¾›prepareã€commitã€rollback æ¥â¼ç»™TMè°ƒâ½¤ï¼Œä»¥å®ç°ä¸¤é˜¶æ®µæäº¤ã€‚â½½åœ¨TCCæ¨¡å‹ä¸­ï¼Œä»ä¸šåŠ¡æœåŠ¡ç›¸å½“äºRMï¼Œæä¾›äº†ç±»ä¼¼çš„tryã€confirmã€ cancelæ¥â¼ã€‚ äº‹åŠ¡ç®¡ç†å™¨ï¼šDTPæ¨¡å‹å’ŒTCCæ¨¡å‹ä¸­éƒ½æœ‰â¼€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ã€‚ä¸åŒçš„æ˜¯ï¼šåœ¨DTPæ¨¡å‹ä¸­ï¼Œé˜¶æ®µ1çš„(prepare)å’Œé˜¶æ®µ2çš„(commitã€rollback)ï¼Œéƒ½æ˜¯ç”±TMè¿›â¾è°ƒâ½¤çš„ã€‚åœ¨TCCæ¨¡å‹ä¸­ï¼Œé˜¶æ®µ1çš„tryæ¥â¼æ˜¯ä¸»ä¸šåŠ¡æœåŠ¡è°ƒâ½¤(ç»¿â¾Šç®­å¤´)ï¼Œé˜¶æ®µ2çš„(confirmã€cancelæ¥â¼)æ˜¯äº‹åŠ¡ç®¡ç†å™¨TMè°ƒâ½¤(çº¢â¾Šç®­å¤´)ã€‚è¿™å°±æ˜¯ TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹çš„â¼†é˜¶æ®µå¼‚æ­¥åŒ–åŠŸèƒ½ï¼Œä»ä¸šåŠ¡æœåŠ¡çš„ç¬¬â¼€é˜¶æ®µæ‰§â¾æˆåŠŸï¼Œä¸»ä¸šåŠ¡æœåŠ¡å°±å¯ä»¥æäº¤å®Œæˆï¼Œç„¶åå†ç”±äº‹åŠ¡ç®¡ç†å™¨æ¡†æ¶å¼‚æ­¥çš„æ‰§â¾å„ä»ä¸šåŠ¡æœåŠ¡çš„ç¬¬â¼†é˜¶æ®µã€‚è¿™â¾¥ç‰ºç‰²äº†â¼€å®šçš„éš”ç¦»æ€§å’Œâ¼€è‡´æ€§çš„ï¼Œä½†æ˜¯æâ¾¼äº†â»“äº‹åŠ¡çš„å¯â½¤æ€§ã€‚ TCCä¸2PCå¯¹â½ XAæ˜¯èµ„æºå±‚â¾¯çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¼ºâ¼€è‡´æ€§ï¼Œåœ¨ä¸¤é˜¶æ®µæäº¤çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œâ¼€ç›´ä¼šæŒæœ‰èµ„æºçš„é”ã€‚åŸºäºæ•°æ®åº“é”å®ç°ï¼Œéœ€è¦æ•°æ®åº“â½€æŒXAåè®®ï¼Œç”±äºåœ¨æ‰§â¾äº‹åŠ¡çš„å…¨ç¨‹éƒ½éœ€è¦å¯¹ç›¸å…³æ•°æ®åŠ é”ï¼Œâ¼€èˆ¬â¾¼å¹¶å‘æ€§èƒ½ä¼šâ½è¾ƒå·® TCCæ˜¯ä¸šåŠ¡å±‚â¾¯çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæœ€ç»ˆâ¼€è‡´æ€§ï¼Œä¸ä¼šâ¼€ç›´æŒæœ‰èµ„æºçš„é”ï¼Œæ€§èƒ½è¾ƒå¥½ã€‚ä½†æ˜¯å¯¹å¾®æœåŠ¡çš„ä¾µâ¼Šæ€§å¼ºï¼Œå¾®æœåŠ¡çš„æ¯ä¸ªäº‹åŠ¡éƒ½å¿…é¡»å®ç°tryã€confirmã€cancelç­‰3ä¸ªâ½…æ³•ï¼Œå¼€å‘æˆæœ¬â¾¼ï¼Œä»Šåç»´æŠ¤æ”¹é€ çš„æˆæœ¬ä¹Ÿâ¾¼ä¸ºäº†è¾¾åˆ°äº‹åŠ¡çš„â¼€è‡´æ€§è¦æ±‚ï¼Œtryã€confirmã€cancelæ¥â¼å¿…é¡»å®ç°å¹‚ç­‰æ€§æ“ä½œç”±äºäº‹åŠ¡ç®¡ç†å™¨è¦è®°å½•äº‹åŠ¡â½‡å¿—ï¼Œå¿…å®šä¼šæŸè€—â¼€å®šçš„æ€§èƒ½ï¼Œå¹¶ä½¿å¾—æ•´ä¸ªTCCäº‹åŠ¡æ—¶é—´æ‹‰â»“ã€‚TCCå®ƒä¼šå¼±åŒ–æ¯ä¸ªæ­¥éª¤ä¸­å¯¹äºèµ„æºçš„é”å®šï¼Œä»¥è¾¾åˆ°â¼€ä¸ªèƒ½æ‰¿å—â¾¼å¹¶å‘çš„â½¬çš„ï¼ˆåŸºäºæœ€ç»ˆâ¼€è‡´æ€§ï¼‰ã€‚ TCC çš„ä½¿â½¤åœºæ™¯ TCCæ˜¯å¯ä»¥è§£å†³éƒ¨åˆ†åœºæ™¯ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Œä½†æ˜¯ï¼Œå®ƒçš„â¼€ä¸ªé—®é¢˜åœ¨äºï¼Œéœ€è¦æ¯ä¸ªå‚ä¸è€…éƒ½åˆ†åˆ«å®ç°Tryï¼ŒConfirmå’ŒCancelæ¥â¼åŠé€»è¾‘ï¼Œè¿™å¯¹äºä¸šåŠ¡çš„ä¾µâ¼Šæ€§æ˜¯å·¨â¼¤çš„ã€‚ TCC â½…æ¡ˆä¸¥é‡ä¾èµ–å›æ»šå’Œè¡¥å¿ä»£ç ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ï¼šå›æ»šä»£ç é€»è¾‘å¤æ‚ï¼Œä¸šåŠ¡ä»£ç å¾ˆéš¾ç»´æŠ¤ã€‚æ‰€ä»¥ï¼ŒTCC â½…æ¡ˆçš„ä½¿â½¤åœºæ™¯è¾ƒå°‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä½¿â½¤çš„åœºæ™¯ã€‚ â½å¦‚è¯´è·Ÿé’±æ‰“äº¤é“çš„ï¼Œâ½€ä»˜ã€äº¤æ˜“ç›¸å…³çš„åœºæ™¯ï¼Œâ¼¤å®¶ä¼šâ½¤ TCCâ½…æ¡ˆï¼Œä¸¥æ ¼ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨â¾ƒåŠ¨å›æ»šï¼Œä¸¥æ ¼ä¿è¯èµ„â¾¦çš„æ­£ç¡®æ€§ï¼Œä¿è¯åœ¨èµ„â¾¦ä¸Šä¸ä¼šå‡ºç°é—®é¢˜ã€‚ ","date":"2023-08-08","objectID":"/distributed-transaction/:0:7","tags":["Distributed"],"title":"Distributed Transaction - åˆ†å¸ƒå¼äº‹åŠ¡","uri":"/distributed-transaction/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/zookeeper_draft/","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zookeeper æ˜¯ chubby çš„å¼€æºå®ç°ï¼Œä½¿ç”¨ zab åè®®ï¼Œpaxos ç®—æ³•çš„å˜ç§ã€‚ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:0","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zookeeperæä¾›äº†ä»€ä¹ˆï¼Ÿ æ–‡ä»¶ç³»ç»Ÿï¼šæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜æ”¾æ•°æ®ä¸Šé™ä¸º 1M é€šçŸ¥æœºåˆ¶ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:1","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"å››ç§æ•°æ®èŠ‚ç‚¹ persistent æŒä¹…èŠ‚ç‚¹ ephemeral ä¸´æ—¶èŠ‚ç‚¹ persistent sequential æŒä¹…é¡ºåºèŠ‚ç‚¹ ephemeral sequential ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:2","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"Watcher æœºåˆ¶ ä¸€æ¬¡æ€§ï¼šæ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä¸€æ—¦ä¸€ä¸ª Watcher è¢« è§¦ å‘ ï¼ŒZookeeper éƒ½ä¼šå°† å…¶ä»ç›¸åº”çš„å­˜å‚¨ä¸­ç§»é™¤ã€‚ ä¸²è¡Œï¼šå®¢æˆ·ç«¯ Watcher å›è°ƒçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸²è¡ŒåŒæ­¥çš„è¿‡ç¨‹ã€‚ è½»é‡ï¼šWatcher é€šçŸ¥éå¸¸ç®€å•ï¼Œåªä¼šå‘Šè¯‰å®¢æˆ·ç«¯å‘ç”Ÿäº†äº‹ä»¶ï¼Œè€Œä¸ä¼šè¯´æ˜äº‹ä»¶çš„ å…·ä½“å†…å®¹ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†Œ Watcher çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šæŠŠå®¢æˆ·ç«¯çœŸå®çš„ Watcher å¯¹è±¡å®ä½“ä¼ é€’åˆ°æœåŠ¡ç«¯ï¼Œä»…ä»…æ˜¯åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸­ä½¿ç”¨ boolean ç±»å‹å±æ€§è¿›è¡Œäº† æ ‡è®°ã€‚ æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼‚æ­¥å‘é€é€šçŸ¥ï¼Œæ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ã€‚æ•°æ®åŒæ­¥æ–¹å¼ï¼š diffï¼šå·®å¼‚åŒ–åŒæ­¥ trunc+diffï¼šå…ˆå›æ»šï¼Œå†å·®å¼‚åŒ–åŒæ­¥ truncï¼šå›æ»šåŒæ­¥ snapï¼šå…¨é‡åŒæ­¥ï¼ˆå¿«ç…§ï¼‰ å®¢æˆ·ç«¯æ³¨å†Œ watcher è°ƒç”¨ getData()/getChildren()/exist()ä¸‰ä¸ª APIï¼Œä¼ å…¥ Watcher å¯¹è±¡ æ ‡è®°è¯·æ±‚ requestï¼Œå°è£… Watcher åˆ° WatchRegistration å°è£…æˆ Packet å¯¹è±¡ï¼Œå‘æœåŠ¡ç«¯å‘é€ request æ”¶åˆ°æœåŠ¡ç«¯å“åº”åï¼Œå°† Watcher æ³¨å†Œåˆ° ZKWatcherManager ä¸­è¿›è¡Œç®¡ç† è¯·æ±‚è¿”å›ï¼Œå®Œæˆæ³¨å†Œã€‚ æœåŠ¡ç«¯å¤„ç† watcher å°è£… WatchedEventï¼šå°†é€šçŸ¥çŠ¶æ€ï¼ˆSyncConnectedï¼‰ã€äº‹ä»¶ç±»å‹ï¼ˆNodeDataChangedï¼‰ä»¥åŠèŠ‚ç‚¹è·¯å¾„å°è£…æˆä¸€ä¸ª WatchedEvent å¯¹è±¡ æŸ¥è¯¢ Watcherï¼šä» WatchTable ä¸­æ ¹æ®èŠ‚ç‚¹è·¯å¾„æŸ¥æ‰¾ Watcher æ‰¾åˆ°ï¼šæå–å¹¶ä» WatchTable å’Œ Watch2Paths ä¸­åˆ é™¤å¯¹åº” Watcherï¼ˆä»è¿™é‡Œå¯ä»¥çœ‹å‡º Watcher åœ¨æœåŠ¡ç«¯æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè§¦å‘ä¸€æ¬¡å°±å¤±æ•ˆäº†ï¼‰ è°ƒç”¨ process æ–¹æ³•æ¥è§¦å‘ Watcherï¼šè¿™é‡Œ process ä¸»è¦å°±æ˜¯é€šè¿‡ ServerCnxn å¯¹åº”çš„ TCP è¿æ¥å‘é€ Watcher äº‹ä»¶ é€šçŸ¥ã€‚ å®¢æˆ·ç«¯å›è°ƒ watcher å®¢æˆ·ç«¯ SendThread çº¿ç¨‹æ¥æ”¶äº‹ä»¶é€šçŸ¥ï¼Œäº¤ç”± EventThread çº¿ç¨‹å›è°ƒ Watcherã€‚ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:3","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"Server å·¥ä½œçŠ¶æ€ lookingï¼šå¯»æ‰¾ leader followingï¼šå½“å‰æœåŠ¡å™¨è§’è‰²æ—¶ follower å¤„ç†å®¢æˆ·ç«¯çš„éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡ç»™ leader æœåŠ¡å™¨ å‚ä¸äº‹åŠ¡è¯·æ±‚ proposal çš„æŠ•ç¥¨ å‚ä¸ leader é€‰ä¸¾æŠ•ç¥¨ leadingï¼šå½“å‰æœåŠ¡å™¨è§’è‰²æ—¶ leader äº‹åŠ¡è¯·æ±‚çš„å”¯ä¸€è°ƒåº¦å’Œå¤„ç†è€…ï¼Œä¿è¯äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ é›†ç¾¤å†…éƒ¨å„æœåŠ¡çš„è°ƒåº¦è€… observingï¼šå½“å‰æœåŠ¡å™¨è§’è‰²æ—¶ observer å¤„ç†å®¢æˆ·ç«¯çš„éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡ç»™ leader æœåŠ¡å™¨ ä¸å‚ä¸ä»»ä½•å½¢å¼çš„æŠ•ç¥¨ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:4","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zookeeper å¦‚ä½•ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§ï¼Ÿ å…¨å±€é€’å¢çš„äº‹åŠ¡IDï¼Œæ‰€æœ‰ proposalï¼ˆæè®®ï¼‰éƒ½åœ¨è¢«æå‡ºæ—¶åŠ ä¸Šäº† zxidï¼Œä¸º 64 ä½æ•°å­—ï¼š é«˜ 32 ä½ï¼š epochï¼Œç”¨æ¥æ ‡è¯† leader å‘¨æœŸ ä½ 32 ä½ï¼šç”¨æ¥è®¡æ•°ï¼Œæ–°äº§ç”Ÿproposal çš„æ—¶å€™ï¼Œä¼šä¾æ®æ•°æ®åº“çš„ä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œé¦–å…ˆä¼šå‘å…¶ä»–çš„ server å‘å‡ºäº‹åŠ¡æ‰§è¡Œè¯·æ±‚ï¼Œå¦‚æœè¶…è¿‡åŠæ•°çš„æœºå™¨éƒ½èƒ½æ‰§è¡Œå¹¶ä¸”èƒ½å¤ŸæˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹æ‰§è¡Œ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:5","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zk èŠ‚ç‚¹å®•æœºå¦‚ä½•å¤„ç†ï¼Ÿ é›†ç¾¤è§„åˆ™ä¸º 2N+1 å°ï¼ŒN\u003e0ï¼Œè‡³å°‘ 3 å°ã€‚åªè¦è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ­£å¸¸ï¼Œé›†ç¾¤å°±èƒ½æ­£å¸¸æä¾›æœåŠ¡ã€‚ follower å®•æœºï¼šæ•°æ®ä¸ä¼šä¸¢å¤± leader å®•æœºï¼šé€‰ä¸¾å‡ºæ–°çš„ leader ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:6","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zk è´Ÿè½½å‡è¡¡å’Œ nginx è´Ÿè½½å‡è¡¡çš„åŒºåˆ« zkï¼šå¯ä»¥è°ƒæ§ï¼Œååé‡å° nginxï¼šåªèƒ½è°ƒæƒé‡ï¼Œå…¶ä»–çš„éœ€è¦è‡ªå·±å†™æ’ä»¶ï¼Œååé‡å¤§ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:7","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["draft"],"content":"zk çš„åº”ç”¨åœºæ™¯ åˆ†å¸ƒå¼æ•°æ®çš„å‘å¸ƒå’Œè®¢é˜…ï¼š æ•°æ®å‘å¸ƒ/è®¢é˜…ï¼šé…ç½®ä¸­å¿ƒï¼ŒåŠ¨æ€è·å–æ•°æ®ï¼Œæ•°æ®é‡é€šå¸¸è¾ƒå°ï¼ˆå¦‚æ•°æ®åº“é…ç½®ä¿¡æ¯ï¼‰ æ•°æ®å­˜å‚¨ï¼šå­˜å‚¨åœ¨ zk ä¸Šçš„ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ æ•°æ®è·å–ï¼šè¯»å–æ•°æ®èŠ‚ç‚¹ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªæ•°æ®å˜æ›´ watcher æ•°æ®å˜æ›´ï¼šå½“å˜æ›´æ•°æ®æ—¶ï¼Œzk ä¼šå°†æ•°æ®å˜æ›´é€šçŸ¥å‘åˆ°å„å®¢æˆ·ç«¯ è´Ÿè½½å‡è¡¡ å‘½åæœåŠ¡ï¼šæŒ‡é€šè¿‡æŒ‡å®šçš„åå­—æ¥è·å–èµ„æºæˆ–è€…æœåŠ¡çš„åœ°å€ï¼Œåˆ©ç”¨ zk åˆ›å»ºä¸€ä¸ª å…¨å±€çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªåå­—ï¼ŒæŒ‡å‘é›†ç¾¤ä¸­çš„é›†ç¾¤ï¼Œæä¾›çš„æœåŠ¡ çš„åœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹çš„å¯¹è±¡ç­‰ç­‰ã€‚ åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ é›†ç¾¤ç®¡ç†ï¼šæ‰€æœ‰æœºå™¨çº¦å®šåœ¨çˆ¶ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼Œç„¶åç›‘å¬çˆ¶ç›®å½•èŠ‚ç‚¹çš„å­—èŠ‚ç‚¹å˜åŒ–ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æœºå™¨é€€å‡ºå’ŒåŠ å…¥ã€é€‰ä¸¾ master åˆ†å¸ƒå¼é”ï¼š ç‹¬å é”ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½å»åˆ›å»º/distribute_lock èŠ‚ç‚¹ æ§åˆ¶æ—¶åºï¼š/distribute_lock å·²ç»é¢„å…ˆå­˜åœ¨ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯åœ¨å®ƒä¸‹é¢åˆ›å»ºä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼Œå’Œé€‰ master ä¸€æ ·ï¼Œç¼–å·æœ€å°çš„è·å¾—é”ï¼Œç”¨å®Œåˆ é™¤ã€‚ åˆ†å¸ƒå¼é˜Ÿåˆ— åŒæ­¥é˜Ÿåˆ—ï¼šå½“ä¸€ä¸ªé˜Ÿåˆ—æˆå‘˜éƒ½èšé½æ—¶ï¼Œé˜Ÿåˆ—æ‰å¯ç”¨ã€‚åœ¨çº¦å®šç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶ç›®å½•èŠ‚ç‚¹ å¼‚æ­¥é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºï¼šå…¥åˆ—æœ‰ç¼–å·ï¼Œå‡ºåˆ—æŒ‰ç¼–å·ã€‚ç±»ä¼¼åˆ†å¸ƒå¼é”ä¸­æ§åˆ¶æ—¶åºçš„å®ç°ã€‚ ","date":"2023-08-08","objectID":"/zookeeper_draft/:0:8","tags":["Zookeeper"],"title":"Zookeeper æ‚è®°","uri":"/zookeeper_draft/"},{"categories":["interview"],"content":"Raft åè®®çš„åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Raft åè®®çš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡é€‰ä¸¾ä¸€ä¸ª leader èŠ‚ç‚¹æ¥ç®¡ç†æ•´ä¸ªé›†ç¾¤ï¼Œå¹¶é€šè¿‡ leader èŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹å‘é€å¿ƒè·³ä¿¡å·å’Œæ—¥å¿—å¤åˆ¶ç­‰ä¿¡æ¯æ¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚å½“ leader èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„ leader èŠ‚ç‚¹ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:1","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Raft åè®®ä¸­æœ‰å“ªäº›è§’è‰²ï¼Ÿ Raft åè®®ä¸­æœ‰ä¸‰ç§è§’è‰²ï¼šleaderã€follower å’Œ candidateã€‚å…¶ä¸­ï¼Œleader è´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ï¼Œfollower å’Œ candidate åˆ™è´Ÿè´£æ¥æ”¶ leader çš„æŒ‡ä»¤å’Œæäº¤æ—¥å¿—ç­‰æ“ä½œã€‚ ","date":"2023-08-08","objectID":"/raft/:0:2","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Raft åè®®ä¸­çš„é€‰ä¸¾è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ Raft åè®®çš„é€‰ä¸¾è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šé€‰ä¸¾é˜¶æ®µå’Œæ—¥å¿—å¤åˆ¶é˜¶æ®µã€‚åœ¨é€‰ä¸¾é˜¶æ®µï¼Œfollower èŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€ RequestVote è¯·æ±‚ï¼Œè¯·æ±‚å…¶ä»–èŠ‚ç‚¹æŠ•ç¥¨æ”¯æŒè‡ªå·±æˆä¸º candidate èŠ‚ç‚¹ã€‚å½“ä¸€ä¸ª candidate èŠ‚ç‚¹è·å¾—äº†å¤§å¤šæ•°èŠ‚ç‚¹çš„æŠ•ç¥¨æ—¶ï¼Œå°±ä¼šæˆä¸ºæ–°çš„ leader èŠ‚ç‚¹ï¼Œå¹¶å¼€å§‹å‘å…¶ä»–èŠ‚ç‚¹å‘é€å¿ƒè·³ä¿¡å·å’Œæ—¥å¿—å¤åˆ¶ç­‰æ“ä½œã€‚ ","date":"2023-08-08","objectID":"/raft/:0:3","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Raft åè®®å¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ Raft åè®®é€šè¿‡ leader èŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹å‘é€å¿ƒè·³ä¿¡å·å’Œæ—¥å¿—å¤åˆ¶ç­‰ä¿¡æ¯æ¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚å½“ leader èŠ‚ç‚¹æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚è½¬æ¢æˆä¸€æ¡æ—¥å¿—ï¼Œå¹¶å°†è¯¥æ—¥å¿—å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»¥ä¿è¯æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:4","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Raft åè®®ä¸­å¦‚ä½•å¤„ç†ç½‘ç»œåˆ†åŒºé—®é¢˜ï¼Ÿ Raft åè®®ä¸­é€šè¿‡é€‰ä¸¾æœºåˆ¶æ¥é¿å…ç½‘ç»œåˆ†åŒºé—®é¢˜ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹ä¸å…¶ä½™èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå…¶ä½™èŠ‚ç‚¹ä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„ leader èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ­£å¸¸è¿è¡Œã€‚å½“ç½‘ç»œåˆ†åŒºé—®é¢˜è§£å†³åï¼Œå¤±å»è”ç³»çš„èŠ‚ç‚¹ä¼šé‡æ–°åŠ å…¥é›†ç¾¤ä¸­ï¼ŒåŒæ­¥æœ€æ–°çš„æ•°æ®ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:5","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Raft å’Œ zab åè®®çš„åŒºåˆ«ï¼Ÿ ç›¸åŒç‚¹ï¼š ä¸€è‡´æ€§éƒ½ç”± quorumï¼ˆä»²è£é›†ï¼Œå°‘æ•°æœä»å¤šæ•°ï¼‰æ¥ä¿è¯ï¼Œzookeeperå®ç°äº†å¸¦æƒé‡çš„quorum éƒ½ç”± leader æ¥å‘èµ·å†™æ“ä½œ å¿ƒè·³æœºåˆ¶æ£€æµ‹å­˜è´§è¡Œ leader election é€‰ä¸¾éƒ½é‡‡ç”¨å…ˆåˆ°å…ˆå¾—éƒ½æŠ•ç¥¨æ–¹å¼ ä¸åŒç‚¹ï¼š zab ç”¨çš„æ˜¯ epoch(æ—¶ä»£ï¼Œçºªå…ƒ) å’Œ count çš„ç»„åˆæ¥å”¯ä¸€è¡¨ç¤ºä¸€ä¸ªå€¼, è€Œ raft ç”¨çš„æ˜¯ term å’Œ indexã€‚ zab çš„ follower åœ¨æŠ•ç¥¨ç»™ä¸€ä¸ª leader ä¹‹å‰å¿…é¡»å’Œ leader çš„æ—¥å¿—è¾¾æˆä¸€è‡´,è€Œ raft çš„ followeråˆ™ç®€å•åœ°è¯´æ˜¯è°çš„ term é«˜å°±æŠ•ç¥¨ç»™è°ã€‚ raft åè®®æ•°æ®åªæœ‰å•å‘åœ°ä» leader åˆ° follower(æˆä¸º leader çš„æ¡ä»¶ä¹‹ä¸€å°±æ˜¯æ‹¥æœ‰æœ€æ–°çš„ log)ã€‚è€Œ zab åè®®åœ¨ discovery é˜¶æ®µ, ä¸€ä¸ª prospective(æ½œåœ¨çš„) leader éœ€è¦å°†è‡ªå·±çš„ log æ›´æ–°ä¸º quorum é‡Œé¢æœ€æ–°çš„ log,ç„¶åæ‰å¥½åœ¨ synchronization é˜¶æ®µå°† quorum é‡Œçš„å…¶ä»–æœºå™¨çš„ log éƒ½åŒæ­¥åˆ°ä¸€è‡´ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:6","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"Paxos vs Raftï¼Ÿ Paxosç®—æ³•å’ŒRaftåè®®éƒ½æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒä»¬çš„åŸºæœ¬æ€æƒ³å’Œç›®æ ‡æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯åœ¨å®ç°ç»†èŠ‚å’Œåº”ç”¨åœºæ™¯ä¸Šæœ‰ä¸€äº›ä¸åŒã€‚ å®ç°éš¾åº¦ Paxosç®—æ³•ç›¸å¯¹äºRaftåè®®æ›´åŠ å¤æ‚ï¼Œæ›´åŠ éš¾ä»¥ç†è§£å’Œå®ç°ã€‚Paxosç®—æ³•çš„å®ç°éœ€è¦è€ƒè™‘å¤šä¸ªå¤æ‚çš„æƒ…å†µï¼ŒåŒ…æ‹¬å¤šä¸ªé˜¶æ®µçš„æ¶ˆæ¯åè®®ã€å¤šä¸ªè§’è‰²çš„çŠ¶æ€è½¬æ¢ã€å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®åŒæ­¥ç­‰ã€‚Raftåè®®ç›¸å¯¹æ¥è¯´æ›´åŠ ç®€å•æ˜“æ‡‚ï¼Œå®ç°èµ·æ¥ä¹Ÿæ›´åŠ å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ å¯æ‰©å±•æ€§ Paxosç®—æ³•åœ¨èŠ‚ç‚¹æ•°é‡è¾ƒå¤§æ—¶ï¼Œæ¶ˆæ¯é€šä¿¡å’Œæ•°æ®åŒæ­¥çš„æ•ˆç‡ä¼šé™ä½ï¼Œå› æ­¤å®ƒçš„å¯æ‰©å±•æ€§ç›¸å¯¹è¾ƒå·®ã€‚Raftåè®®åœ¨èŠ‚ç‚¹æ•°é‡è¾ƒå¤§æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒè¾ƒå¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ é€‰ä¸¾æœºåˆ¶ Paxosç®—æ³•çš„é€‰ä¸¾æœºåˆ¶æ˜¯åŸºäº**ææ¡ˆï¼ˆproposalï¼‰**çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æå‡ºä¸€ä¸ªææ¡ˆï¼Œå¹¶é€šè¿‡åå•†è¿‡ç¨‹æ¥é€‰å‡ºä¸€ä¸ªæœ€ç»ˆçš„ææ¡ˆã€‚Raftåè®®çš„é€‰ä¸¾æœºåˆ¶æ˜¯åŸºäºè§’è‰²çš„ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿæˆä¸ºleaderï¼Œå…¶ä»–èŠ‚ç‚¹åˆ™æˆä¸ºfolloweræˆ–candidateã€‚ å¯è¯»æ€§ Raftåè®®ç›¸å¯¹äºPaxosç®—æ³•å…·æœ‰æ›´å¥½çš„å¯è¯»æ€§ã€‚Raftåè®®ä¸­çš„è§’è‰²å’Œæ¶ˆæ¯é€šä¿¡æ¯”è¾ƒç›´è§‚å’Œæ˜“æ‡‚ï¼Œå®¹æ˜“è®©äººç†è§£å’Œè®°å¿†ã€‚ æ€»çš„æ¥è¯´ï¼ŒPaxosç®—æ³•å’ŒRaftåè®®éƒ½æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œå®ƒä»¬çš„ç›®æ ‡å’ŒåŸºæœ¬æ€æƒ³ç›¸åŒï¼Œä½†æ˜¯åœ¨å®ç°ç»†èŠ‚ã€å¯æ‰©å±•æ€§ã€é€‰ä¸¾æœºåˆ¶å’Œå¯è¯»æ€§ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚é€‰æ‹©é€‚åˆçš„ç®—æ³•ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:7","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"å¦‚ä½•é€‰æ‹©ä¸€è‡´æ€§ç®—æ³•ï¼Ÿ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•éœ€è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€ç³»ç»Ÿè§„æ¨¡ã€å¯ç”¨æ€§ã€æ€§èƒ½ç­‰æ–¹é¢ã€‚ æ•°æ®ä¸€è‡´æ€§è¦æ±‚ é¦–å…ˆéœ€è¦æ ¹æ®å®é™…éœ€æ±‚æ¥ç¡®å®šæ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚ï¼ŒåŒ…æ‹¬å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§æˆ–æœ€ç»ˆä¸€è‡´æ€§ç­‰ã€‚å¦‚æœæ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦é€‰æ‹©èƒ½å¤Ÿæä¾›å¼ºä¸€è‡´æ€§çš„ç®—æ³•ï¼Œå¦‚Paxosç®—æ³•æˆ–Raftåè®®ã€‚å¦‚æœæ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥é€‰æ‹©æä¾›æœ€ç»ˆä¸€è‡´æ€§çš„ç®—æ³•ï¼Œå¦‚Gossipåè®®æˆ–CRDTç®—æ³•ã€‚ ç³»ç»Ÿè§„æ¨¡ å…¶æ¬¡éœ€è¦è€ƒè™‘ç³»ç»Ÿè§„æ¨¡ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹æ•°é‡ã€æ•°æ®é‡ã€æ•°æ®åˆ†å¸ƒç­‰æ–¹é¢ã€‚å¦‚æœç³»ç»Ÿè§„æ¨¡è¾ƒå°ï¼Œå¯ä»¥é€‰æ‹©ä¸€äº›ç®€å•æ˜“æ‡‚ã€æ˜“äºå®ç°çš„ç®—æ³•ï¼Œå¦‚Raftåè®®ã€‚å¦‚æœç³»ç»Ÿè§„æ¨¡è¾ƒå¤§ï¼Œéœ€è¦é€‰æ‹©èƒ½å¤Ÿæä¾›é«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§çš„ç®—æ³•ï¼Œå¦‚Paxosç®—æ³•æˆ–Gossipåè®®ã€‚ å¯ç”¨æ€§ è¿˜éœ€è¦è€ƒè™‘ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå³åœ¨èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œåˆ†åŒºç­‰æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿç»§ç»­æ­£å¸¸è¿è¡Œã€‚å¦‚æœå¯ç”¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦é€‰æ‹©èƒ½å¤Ÿæä¾›é«˜å¯ç”¨æ€§çš„ç®—æ³•ï¼Œå¦‚Raftåè®®ã€‚å¦‚æœå¯ç”¨æ€§è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥é€‰æ‹©ä¸€äº›æ€§èƒ½æ›´é«˜çš„ç®—æ³•ï¼Œå¦‚Paxosç®—æ³•ã€‚ æ€§èƒ½ æœ€åéœ€è¦è€ƒè™‘ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒåŒ…æ‹¬ååé‡ã€å»¶è¿Ÿã€è´Ÿè½½å‡è¡¡ç­‰æ–¹é¢ã€‚å¦‚æœæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦é€‰æ‹©èƒ½å¤Ÿæä¾›é«˜æ€§èƒ½çš„ç®—æ³•ï¼Œå¦‚Paxosç®—æ³•æˆ–Gossipåè®®ã€‚å¦‚æœæ€§èƒ½è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥é€‰æ‹©ä¸€äº›ç®€å•æ˜“æ‡‚ã€æ˜“äºå®ç°çš„ç®—æ³•ï¼Œå¦‚Raftåè®®ã€‚ æ€»çš„æ¥è¯´ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•éœ€è¦ç»¼åˆè€ƒè™‘æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€ç³»ç»Ÿè§„æ¨¡ã€å¯ç”¨æ€§å’Œæ€§èƒ½ç­‰æ–¹é¢ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©é€‚åˆçš„ç®—æ³•ã€‚åŒæ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæµ‹è¯•å’Œè°ƒä¼˜ï¼Œä»¥ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ ","date":"2023-08-08","objectID":"/raft/:0:8","tags":["Distributed"],"title":"ğŸš©Raft","uri":"/raft/"},{"categories":["interview"],"content":"åˆ†å¸ƒå¼äº‹åŠ¡ä¸åˆ†å¸ƒå¼é”çš„åŒºåˆ«ï¼Ÿ åˆ†å¸ƒå¼é”è§£å†³çš„æ˜¯åˆ†å¸ƒå¼èµ„æºæŠ¢å çš„é—®é¢˜ï¼›åˆ†å¸ƒå¼äº‹åŠ¡å’Œæœ¬åœ°äº‹åŠ¡æ˜¯è§£å†³æµç¨‹åŒ–æäº¤é—®é¢˜ã€‚ ","date":"2023-08-08","objectID":"/distributed/:0:1","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"ğŸŒŸå¦‚ä½•è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„ï¼Ÿ/Seata æ¶æ„ï¼Ÿ ä¸‰ç§è§’è‰²ï¼š TC äº‹åŠ¡åè°ƒè€… TM äº‹åŠ¡ç®¡ç†å™¨ RM èµ„æºç®¡ç†å™¨ è§£å†³æ–¹æ¡ˆï¼š Seata XAï¼šRM äº’ç›¸ç­‰å¾…ï¼Œå¼ºä¸€è‡´æ€§ã€CPï¼šé“¶è¡Œã€‘ Seata ATï¼šåˆ©ç”¨ undolog å®ç°é«˜å¯ç”¨ï¼Œä¸»è¦â½¤äºæ ¸â¼¼æ¨¡å—ï¼Œä¾‹å¦‚äº¤æ˜“/è®¢å•ç­‰ã€å¼ºä¸€è‡´æ€§åœºæ™¯ï¼šå•†å“äº¤æ˜“ã€‘ Seata TCCï¼šå¼ºè°ƒèµ„æºé¢„ç•™ï¼Œ é€šè¿‡TCçš„åè°ƒï¼Œä¿è¯æœ€ç»ˆâ¼€è‡´æ€§ï¼Œä¹Ÿå¯ä»¥ä¸šåŠ¡è§£è€¦ã€å¼±ä¸€è‡´æ€§åœºæ™¯ï¼šé€šçŸ¥å›æ˜¾ã€‘ MQï¼šå¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡ï¼Œå°† MQ å’Œ MySQL æ“ä½œæ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…æ‰§è¡Œï¼Œå®æ—¶æ€§é«˜ã€æœ€ç»ˆä¸€è‡´æ€§åœºæ™¯ï¼šé€šçŸ¥æ”¯ä»˜ç»“æœã€‘ å±æ€§ 2PC TCC Saga å¼‚æ­¥ç¡®ä¿å‹äº‹åŠ¡ å°½æœ€â¼¤åŠªâ¼’é€šçŸ¥ äº‹åŠ¡â¼€è‡´æ€§ å¼º å¼± å¼± å¼± å¼± å¤æ‚æ€§ ä¸­ â¾¼ ä¸­ ä½ ä½ ä¸šåŠ¡ä¾µâ¼Šæ€§ â¼© â¼¤ â¼© ä¸­ ä¸­ ä½¿â½¤å±€é™æ€§ â¼¤ â¼¤ ä¸­ â¼© ä¸­ æ€§èƒ½ ä½ ä¸­ â¾¼ â¾¼ â¾¼ ç»´æŠ¤æˆæœ¬ ä½ â¾¼ ä¸­ ä½ ä¸­ å¦‚ä½•ä½¿ç”¨ï¼Ÿ maven å¼•å…¥ seata-all ä¾èµ– åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„æ–¹æ³•ä¸Šæ·»åŠ @GlobalTransactionalæ³¨è§£ æ ¹æ®éœ€æ±‚é€‰æ‹©æ–¹æ¡ˆï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ XAï¼šenableAutoDataSourceProxy = falseï¼Œå› ä¸º XA æ¨¡å¼éœ€è¦ä½¿ç”¨AtomikosDataSourceBean ä»£ç†æ•°æ®æºã€‚ ATï¼šenableAutoDataSourceProxy = trueï¼Œå› ä¸º AT æ¨¡å¼éœ€è¦ä½¿ç”¨ DataSourceProxy ä»£ç†æ•°æ®æº TCCï¼šenableAutoDataSourceProxy = trueï¼Œåœ¨ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ  @TwoPhaseBusinessAction æ³¨è§£ï¼ŒåŒæ—¶ä¿®é¥°ä¸‰ä¸ªæ–¹æ³•ï¼štryï¼ˆï¼‰ã€confirmï¼ˆï¼‰ã€cancelï¼ˆï¼‰ ","date":"2023-08-08","objectID":"/distributed/:0:2","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"CAPå®šç† - ä¸‰é€‰äºŒ â¼€è‡´æ€§(Consistency) ï¼š å®¢æˆ·ç«¯çŸ¥é“â¼€ç³»åˆ—çš„æ“ä½œéƒ½ä¼šåŒæ—¶å‘â½£(â½£æ•ˆ) å¼ºä¸€è‡´æ€§ï¼šä¿è¯å®¢æˆ·ç«¯çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯â¼€è‡´çš„ æœ€ç»ˆä¸€è‡´æ€§ï¼šå…è®¸å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œåªè¦æ±‚ç»è¿‡â¼€æ®µæ—¶é—´åï¼Œæ•°æ®æœ€ç»ˆæ˜¯â¼€è‡´çš„ å¼±ä¸€è‡´æ€§ï¼šå­˜åœ¨éƒ¨åˆ†æ•°æ®ä¸ä¸€è‡´ å¯â½¤æ€§(Availability) ï¼š æ¯ä¸ªæ“ä½œéƒ½åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œè¿”å›å¯é¢„æœŸçš„å“åº”ã€‚ åˆ†åŒºå®¹é”™æ€§(Partition tolerance) ï¼š åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•â½¹ç»œåˆ†åŒºæ•…éšœæ—¶ï¼Œä»ç„¶éœ€è¦èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡â¾œâ¼€è‡´æ€§å’Œå¯â½¤æ€§çš„æœåŠ¡ï¼Œé™¤â¾®æ˜¯æ•´ä¸ªâ½¹ç»œç¯å¢ƒéƒ½å‘â½£äº†æ•…éšœã€‚ APç³»ç»Ÿï¼šåœ¨äº’è”â½¹é¢†åŸŸçš„ç»â¼¤å¤šæ•°çš„åœºæ™¯ä¸­ï¼Œéƒ½éœ€è¦ç‰ºç‰²å¼ºâ¼€è‡´æ€§æ¥æ¢å–ç³»ç»Ÿçš„â¾¼å¯â½¤æ€§ï¼Œç³»ç»Ÿå¾€å¾€åªéœ€è¦ä¿è¯æœ€ç»ˆâ¼€è‡´æ€§ã€‚ å¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰â¼€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒC å¿…é¡»ä¿è¯ã€‚â½¹ç»œå‘â½£æ•…éšœå®å¯åœâ½ŒæœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯ CAï¼Œèˆå¼ƒ Pã€‚è¿˜æœ‰â¼€ç§æ˜¯ä¿è¯ CPï¼Œèˆå¼ƒ Aã€‚ä¾‹å¦‚â½¹ç»œæ•…éšœæ˜¯åªè¯»ä¸å†™ã€‚ ","date":"2023-08-08","objectID":"/distributed/:0:3","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"BASEå®šç† æ ¸â¼¼æ€æƒ³ï¼šå³ä½¿â½†æ³•åšåˆ°å¼ºâ¼€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”â½¤éƒ½å¯ä»¥æ ¹æ®â¾ƒèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡â½¤é€‚å½“çš„â½…å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆâ¼€è‡´æ€§ã€‚ CAPæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç†è®ºï¼ŒBASEæ˜¯CAPç†è®ºä¸­APâ½…æ¡ˆçš„å»¶ä¼¸ï¼Œå¯¹äºCæˆ‘ä»¬é‡‡â½¤çš„â½…å¼å’Œç­–ç•¥å°±æ˜¯ä¿è¯æœ€ç»ˆâ¼€è‡´æ€§ï¼›BASEç†è®ºæ˜¯å¯¹CAPç†è®ºçš„å»¶ä¼¸ï¼Œæ ¸â¼¼æ€æƒ³æ˜¯å³ä½¿â½†æ³•åšåˆ°å¼ºâ¼€è‡´æ€§ï¼ˆStrongConsistencyï¼ŒCAPçš„â¼€è‡´æ€§å°±æ˜¯å¼ºâ¼€è‡´æ€§ï¼‰ï¼Œä½†åº”â½¤å¯ä»¥é‡‡â½¤é€‚åˆçš„â½…å¼è¾¾åˆ°æœ€ç»ˆâ¼€è‡´æ€§ï¼ˆEventual Consitencyï¼‰ã€‚ Basically Availableï¼ˆåŸºæœ¬å¯â½¤ï¼‰ï¼šå“åº”æ—¶é—´å¢åŠ  Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼šæŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯â½¤æ€§ã€‚ **Eventually consistentï¼ˆæœ€ç»ˆâ¼€è‡´æ€§ï¼‰ï¼š**é€šè¿‡ç‰ºç‰²â¼€è‡´æ€§æ¥è·å¾—å¯â½¤æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨â¼€æ®µæ—¶é—´å†…æ˜¯ä¸â¼€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°â¼€è‡´çŠ¶æ€ã€‚ ","date":"2023-08-08","objectID":"/distributed/:0:4","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"BASEä¸ACIDçš„åŒºåˆ«å’Œè”ç³» BASEç†è®ºâ¾¯å‘çš„æ˜¯â¼¤å‹â¾¼å¯â½¤å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå’Œä¼ ç»Ÿçš„äº‹ç‰©ACID ç‰¹æ€§æ˜¯ç›¸åçš„ã€‚ å®ƒå®Œå…¨ä¸åŒäºACIDçš„å¼ºâ¼€è‡´æ€§æ¨¡å‹ï¼Œâ½½æ˜¯é€šè¿‡ç‰ºç‰²å¼ºâ¼€è‡´æ€§æ¥è·å¾—å¯â½¤æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨â¼€æ®µæ—¶é—´å†…æ˜¯ä¸â¼€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°â¼€è‡´çŠ¶æ€ã€‚ ä½†åŒæ—¶ï¼Œåœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹æ•°æ®â¼€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åœ¨å…·ä½“çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡è¿‡ç¨‹ä¸­ï¼ŒACIDç‰¹æ€§å’ŒBASEç†è®ºå¾€å¾€â¼œä¼šç»“åˆåœ¨â¼€èµ·ã€‚ ","date":"2023-08-08","objectID":"/distributed/:0:5","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"CAPå’ŒACIDä¸­çš„Aå’ŒCæ˜¯å®Œå…¨ä¸â¼€æ ·çš„ Açš„åŒºåˆ« ACIDä¸­çš„AæŒ‡çš„æ˜¯åŸâ¼¦æ€§(Atomicity)ï¼Œæ˜¯æŒ‡äº‹åŠ¡è¢«è§†ä¸ºâ¼€ä¸ªä¸å¯åˆ†å‰²çš„æœ€â¼©â¼¯ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼› CAPä¸­çš„AæŒ‡çš„æ˜¯å¯â½¤æ€§(Availability)ï¼Œæ˜¯æŒ‡é›†ç¾¤ä¸­â¼€éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœåï¼Œé›†ç¾¤æ•´ä½“æ˜¯å¦è¿˜èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ï¼› Cçš„åŒºåˆ« ACIDçš„Cæ˜¯æœ‰å…³æ•°æ®åº“è§„åˆ™ï¼Œæ•°æ®åº“æ€»æ˜¯ä»â¼€ä¸ªâ¼€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦å¤–â¼€ä¸ªâ¼€è‡´æ€§çš„çŠ¶æ€ï¼›ã€æ•°æ®åº“å®Œæ•´æ€§ã€‘ CAPçš„Cæ˜¯åˆ†å¸ƒå¼å¤šæœåŠ¡å™¨ä¹‹é—´å¤åˆ¶æ•°æ®ä»¤è¿™äº›æœåŠ¡å™¨æ‹¥æœ‰åŒæ ·çš„æ•°æ®ï¼Œç”±äºâ½¹é€Ÿé™åˆ¶ï¼Œè¿™ç§å¤åˆ¶åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šæ‰€æ¶ˆè€—çš„æ—¶é—´æ˜¯ä¸å›ºå®šçš„ï¼Œé›†ç¾¤é€šè¿‡ç»„ç»‡å®¢æˆ·ç«¯æŸ¥çœ‹ä¸åŒèŠ‚ç‚¹ä¸Šè¿˜æœªåŒæ­¥çš„æ•°æ®ç»´æŒé€»è¾‘è§†å›¾ï¼Œè¿™æ˜¯â¼€ç§åˆ†å¸ƒå¼é¢†åŸŸçš„â¼€è‡´æ€§æ¦‚å¿µï¼›ã€åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ•°æ®çš„â¼€è‡´æ€§ã€‘ ","date":"2023-08-08","objectID":"/distributed/:0:6","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"ğŸŒŸå¦‚ä½•å®ç°åˆ†å¸ƒå¼æ¥å£å¹‚ç­‰æ€§ï¼Ÿ æ¯ä¸ªè¯·æ±‚å¯¹åº”å”¯ä¸€ tokenï¼Œåœ¨å¤„ç†å‰åˆ¤æ–­æ˜¯å¦å¤„ç†è¿‡ï¼Œå¤„ç†å®Œæˆåä¿å­˜ä¸šåŠ¡çŠ¶æ€åˆ° Redis ä¸­ã€‚ åˆ†å¸ƒå¼é” æ•°æ®åº“æ‚²è§‚é”ã€ä¹è§‚é”ï¼ˆversionï¼‰ å”¯ä¸€ç´¢å¼•ï¼ˆåªé’ˆå¯¹æ–°å¢è¯·æ±‚ï¼‰ ","date":"2023-08-08","objectID":"/distributed/:0:7","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"å¦‚æœæ’å…¥æ•°æ®åº“æˆåŠŸï¼Œä½†æ˜¯æ›´æ–° Redis ä¸Šçš„æ€»æ•°å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ å¦‚æœæ•°æ®çŸ­æ—¶é—´ä¸ä¸€è‡´ä½†æ˜¯ä¸šåŠ¡å¯ä»¥æ¥å—çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘å¼‚æ­¥åˆ·æ–° Redis ä¸Šçš„æ€»æ•°ã€‚ ä½¿ç”¨ Canal ä¹‹ç±»çš„å·¥å…·ç›‘å¬ MySQL binlogï¼Œç„¶ååˆ·æ–° Redis ä¸Šçš„æ€»æ•°ã€‚ ","date":"2023-08-08","objectID":"/distributed/:0:8","tags":["Distributed"],"title":"ğŸš©Distributed","uri":"/distributed/"},{"categories":["interview"],"content":"ä¸ºä»€ä¹ˆé€‰ç”¨ Consulï¼Ÿ CPç³»ç»Ÿï¼šå¼ºä¸€è‡´æ€§éœ€æ±‚ Go è¯­è¨€ç¼–å†™ API æ–‡æ¡£ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ æä¾›äº†ç®€æ˜“çš„äº‹åŠ¡èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ Consul API æˆ– HTTP è¯·æ±‚å°†äº‹åŠ¡ä»£ç æäº¤ç»™ Consul Agent æ‰§è¡Œ consul agent ä¸æœåŠ¡ä¹‹é—´æœ‰å¿ƒè·³æœºåˆ¶ï¼ŒåŸºäº Gossip åè®®ï¼Œå»ä¸­å¿ƒåŒ–ï¼Œæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ æä¾›ä¸‰ç§æœåŠ¡å‘ç°æ–¹å¼ DNSæœåŠ¡å‘ç°æ˜¯Consulæœ€åŸç”Ÿçš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå®ƒé€šè¿‡å°†æœåŠ¡å®ä¾‹çš„IPåœ°å€æ³¨å†Œä¸ºDNSè®°å½•ï¼Œæ¥å®ç°æœåŠ¡å‘ç°ã€‚ HTTP APIæœåŠ¡å‘ç°æ˜¯ä¸€ç§åŸºäºRESTful APIçš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå®ƒé€šè¿‡HTTPè¯·æ±‚æ¥è·å–æœåŠ¡å®ä¾‹çš„åœ°å€ä¿¡æ¯ã€‚ gRPCæœåŠ¡å‘ç° å®‰å…¨åŠŸèƒ½ï¼šTLS åŠ å¯†å’Œ ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰æœºåˆ¶ï¼Œå¯ä»¥å¯¹æœåŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ã€‚ Consul \u003e Eureka ï¼Ÿ Consul - CPï¼ˆRaft åè®®ï¼‰ï¼ŒEureka - AP Consul æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼ŒEureka åªæ”¯æŒå•ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½² Consul åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šéƒ½æœ‰ consul agentï¼Œæ•…éšœæ—¶é€šçŸ¥ leaderï¼›Eureka æ¯ 30s å¿ƒè·³æ£€æŸ¥ï¼Œå®ç°ç®€å• Consul ç”± Go ç¼–å†™ï¼Œå®‰è£…å¯åŠ¨å³å¯ï¼Œæä¾›äº†3ç§æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆDNSã€HTTPã€gRPCï¼‰ï¼›Eureka æ˜¯ä¸ª servlet ç¨‹åºï¼Œè·‘åœ¨ servlet å®¹å™¨ä¸­ï¼ŒEureka åªæ”¯æŒåŸºäº HTTP API çš„æœåŠ¡å‘ç°æœºåˆ¶ã€‚ Consul è¿˜æä¾›äº† ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰æœºåˆ¶ï¼Œå¯ä»¥å¯¹æœåŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ã€‚ Consul \u003e Zookeeper ï¼Ÿ æ›´é€‚åˆæœåŠ¡å‘ç°ï¼šConsul æ˜¯ä¸“é—¨ä¸ºæœåŠ¡å‘ç°è€Œè®¾è®¡çš„ï¼Œè€Œ ZooKeeper åˆ™æ˜¯ä¸€ä¸ªé€šç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚Consul æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå¦‚å¥åº·æ£€æŸ¥ã€DNS è§£æç­‰ï¼Œä½¿å¾—æœåŠ¡å‘ç°æ›´åŠ å®¹æ˜“ã€‚ æä¾›äº†åŸç”Ÿçš„åˆ†å¸ƒå¼é”ï¼ˆRaft åè®®ï¼‰ã€Leader é€‰ä¸¾æ”¯æŒ Consul å¥åº·æ£€æŸ¥åŸºäº Gossip åè®®ï¼Œå»ä¸­å¿ƒåŒ–ï¼Œæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œï¼›zookeeper é‡‡ç”¨ä¸´æ—¶èŠ‚ç‚¹ Consul æä¾›äº†ç®€æ˜“çš„äº‹åŠ¡èƒ½åŠ›ï¼Œzookeeper åªæä¾›äº†ç‰ˆæœ¬å·æ£€æŸ¥èƒ½åŠ› æ–‡æ¡£è¯¦å°½ã€ç¤¾åŒºæ´»è·ƒ ","date":"2023-08-08","objectID":"/microservice/:0:1","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"å¾®æœåŠ¡æ¶æ„ å•ä½“æ¶æ„ï¼šæ‰€æœ‰ä»£ç å…¨éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ¶æ„ç®€å•ã€éƒ¨ç½²æˆæœ¬ä½ï¼Œä½†è€¦åˆåº¦é«˜ å‚ç›´æ¶æ„ï¼šMVCä¸‰å±‚ç»“æ„ SOAæ¶æ„ï¼šService Oriented Architecture é¢å‘æœåŠ¡æ¶æ„ï¼Œå…³æ³¨ç‚¹æ˜¯æœåŠ¡ï¼ŒæœåŠ¡æ˜¯æœ€åŸºæœ¬çš„ä¸šåŠ¡åŠŸèƒ½å•å…ƒï¼Œç”±å¹³å°ä¸­ç«‹æ€§çš„æ¥å£å¥‘çº¦æ¥å®šä¹‰ã€‚ å¾®æœåŠ¡æ¶æ„ï¼šæ¯ä¸ªå°å¾®æœåŠ¡éƒ½è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œä¸€èˆ¬é‡‡ç”¨HTTPæ¥è½»é‡åŒ–é€šä¿¡ã€‚å•ä¸€èŒè´£ã€é¢å‘æœåŠ¡ã€è‡ªæ²»ï¼ˆå›¢é˜Ÿã€æŠ€æœ¯ã€æ•°æ®ã€éƒ¨ç½²éƒ½ç‹¬ç«‹ï¼‰ã€éš”ç¦»æ€§å¼º æœåŠ¡ç½‘æ ¼ï¼šæ˜¯ä¸€ç§å¾®æœåŠ¡æ¶æ„çš„æ‰©å±•ï¼Œæä¾›äº†æ›´åŠ ä¸°å¯Œçš„æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æµé‡æ§åˆ¶ã€æ•…éšœæ¢å¤å’Œå®‰å…¨ç®¡ç†ç­‰åŠŸèƒ½ã€‚æœåŠ¡ç½‘æ ¼å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´åŠ è½»æ¾åœ°ç®¡ç†å’Œç›‘æ§å¾®æœåŠ¡æ¶æ„ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ","date":"2023-08-08","objectID":"/microservice/:0:2","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"äº‘åŸç”Ÿ äº‘åŸç”Ÿåº”ç”¨ç¨‹åºé€šå¸¸é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªå°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„å®¹å™¨ä¸­ï¼Œå¹¶é€šè¿‡è½»é‡çº§çš„é€šä¿¡æœºåˆ¶ç›¸äº’åä½œã€‚äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š å®¹å™¨åŒ–éƒ¨ç½²ï¼šåº”ç”¨ç¨‹åºä»¥å®¹å™¨çš„å½¢å¼è¿›è¡Œéƒ¨ç½²å’Œè¿è¡Œï¼Œå®¹å™¨å¯ä»¥å¿«é€Ÿå¯åŠ¨ã€åœæ­¢å’Œè¿ç§»ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å¾®æœåŠ¡æ¶æ„ï¼šåº”ç”¨ç¨‹åºé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªå°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œå¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•ã€‚ è‡ªåŠ¨åŒ–è¿ç»´ï¼šåº”ç”¨ç¨‹åºé‡‡ç”¨è‡ªåŠ¨åŒ–çš„éƒ¨ç½²ã€ç›‘æ§å’Œç®¡ç†å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–åœ°è¿›è¡Œåº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ‰©å±•ã€å‡çº§å’Œæ•…éšœæ¢å¤ã€‚ å¼¹æ€§è®¾è®¡ï¼šåº”ç”¨ç¨‹åºé‡‡ç”¨å¼¹æ€§è®¾è®¡ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ„ŸçŸ¥è´Ÿè½½å˜åŒ–å’Œæ•…éšœæƒ…å†µï¼Œå¹¶è‡ªåŠ¨è°ƒæ•´èµ„æºåˆ†é…ï¼Œä¿è¯åº”ç”¨ç¨‹åºçš„é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½ã€‚ é¢å‘æœåŠ¡çš„æ¶æ„ï¼šåº”ç”¨ç¨‹åºé‡‡ç”¨é¢å‘æœåŠ¡çš„æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºçš„æœåŠ¡ä½œä¸ºåŸºæœ¬çš„æ„å»ºå—ï¼Œé€šè¿‡æœåŠ¡é—´çš„åä½œæ¥å®ç°åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ å¾®æœåŠ¡æŠ€æœ¯æ ˆï¼šSpring Cloud + Consul + APISIX + Prometheus + Grafana + Hystrix Spring Cloudå’ŒConsulç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ŒAPISIXç”¨äºæœåŠ¡ç½‘å…³ï¼ŒPrometheuså’ŒGrafanaç”¨äºç›‘æ§å’Œå¯è§†åŒ–ï¼ŒHystrixç”¨äºæœåŠ¡ä¿æŠ¤å’Œå®¹é”™ã€‚è¿™äº›ç»„ä»¶éƒ½å¯ä»¥åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä¸€èµ·å·¥ä½œï¼Œäº’ç›¸åä½œï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡æ¶æ„ã€‚ å…·ä½“æ¥è¯´ï¼ŒPrometheuså¯ä»¥é‡‡é›†Spring Cloudå’ŒAPISIXçš„æŒ‡æ ‡æ•°æ®ï¼ŒGrafanaå¯ä»¥å±•ç¤ºå’Œåˆ†æè¿™äº›æ•°æ®ï¼ŒHystrixå¯ä»¥ä¿æŠ¤å’Œå®¹é”™æœåŠ¡ï¼ŒConsulå¯ä»¥ç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ŒAPISIXå¯ä»¥ä½œä¸ºæœåŠ¡ç½‘å…³è¿›è¡Œè¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€‚è¿™äº›ç»„ä»¶å¯ä»¥é€šè¿‡REST APIã€JMXã€Webhookç­‰æ–¹å¼ç›¸äº’äº¤äº’ã€‚ REST APIï¼šREST APIæ˜¯ä¸€ç§åŸºäºHTTPåè®®çš„WebæœåŠ¡æ ‡å‡†ï¼Œç”¨äºä¸åŒåº”ç”¨ä¹‹é—´çš„æ•°æ®äº¤äº’å’Œè¿œç¨‹è°ƒç”¨ã€‚ APISIXå¯ä»¥é€šè¿‡REST APIä»Consulä¸­è·å–æœåŠ¡åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±ï¼ŒPrometheuså¯ä»¥é€šè¿‡REST APIä»Spring Cloudå’ŒAPISIXä¸­è·å–æŒ‡æ ‡æ•°æ®ï¼Œå¹¶å­˜å‚¨å’ŒæŸ¥è¯¢è¿™äº›æ•°æ®ã€‚ JMXï¼šJMXæ˜¯Java Management Extensionsçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§Javaå¹³å°çš„ç®¡ç†å’Œç›‘æ§æŠ€æœ¯ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶ç®¡ç†å’Œç›‘æ§Javaåº”ç”¨ç¨‹åºã€‚ Hystrixå¯ä»¥é€šè¿‡JMXæš´éœ²æœåŠ¡ç†”æ–­å’Œé™çº§çš„çŠ¶æ€ï¼Œå¹¶æä¾›ç›‘æ§å’Œç®¡ç†APIï¼ŒPrometheuså¯ä»¥é€šè¿‡JMXæŠ“å–Hystrixçš„ç›‘æ§æ•°æ®ã€‚ Webhookï¼šWebhookæ˜¯ä¸€ç§HTTPå›è°ƒæœºåˆ¶ï¼Œç”¨äºåœ¨å‘ç”Ÿäº‹ä»¶æ—¶å‘æŒ‡å®šçš„URLå‘é€HTTPè¯·æ±‚ã€‚ Hystrixå¯ä»¥é€šè¿‡Webhookå‘å¤–éƒ¨ç³»ç»Ÿå‘é€è­¦æŠ¥å’Œé€šçŸ¥ï¼ŒPrometheuså¯ä»¥é€šè¿‡Webhookè§¦å‘å‘Šè­¦è§„åˆ™å¹¶å‘é€é€šçŸ¥ã€‚ ","date":"2023-08-08","objectID":"/microservice/:0:3","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"æœåŠ¡æ‹†åˆ†åŸåˆ™ ä¸åŒå¾®æœåŠ¡å•ä¸€èŒè´£ï¼Œä¸è¦é‡å¤å¼€å‘ç›¸åŒä¸šåŠ¡ å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªåœ¨çº¿å•†åŸç³»ç»Ÿï¼Œå¯ä»¥æ‹†åˆ†ä¸ºè®¢å•æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ã€åº“å­˜æœåŠ¡å’Œç”¨æˆ·æœåŠ¡ç­‰å¾®æœåŠ¡ å¾®æœåŠ¡æ•°æ®ç‹¬ç«‹ï¼Œä¸è¦è®¿é—®å…¶ä»–å¾®æœåŠ¡çš„æ•°æ®åº“ å¾®æœåŠ¡å¯ä»¥å°†ä¸šåŠ¡æš´éœ²ä¸ºæ¥å£ï¼Œä¾›å…¶ä»–å¾®æœåŠ¡ä½¿ç”¨ ","date":"2023-08-08","objectID":"/microservice/:0:4","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"Eureka - æ³¨å†Œä¸­å¿ƒ Q1ï¼šæ¶ˆè´¹è€…å¦‚ä½•è·å–æœåŠ¡æä¾›è€…å…·ä½“ä¿¡æ¯ï¼Ÿ æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶å‘ eureka æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ æ¶ˆè´¹è€…æ ¹æ®æœåŠ¡åç§°å‘ eureka æ‹‰å–æä¾›è€…ä¿¡æ¯ Q2ï¼šå¦‚æœæœ‰å¤šä¸ªæœåŠ¡æä¾›è€…ï¼Œæ¶ˆè´¹è€…è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ Aï¼šæœåŠ¡æ¶ˆè´¹è€…åˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä»æœåŠ¡åˆ—è¡¨ä¸­æŒ‘é€‰ä¸€ä¸ª Q3ï¼šæ¶ˆè´¹è€…å¦‚ä½•æ„ŸçŸ¥æœåŠ¡æä¾›è€…å¥åº·çŠ¶æ€ï¼Ÿ Aï¼šæœåŠ¡æä¾›è€…æ¯éš” 30s å‘ EurekaServer å‘é€å¿ƒè·³è¯·æ±‚ï¼ŒæŠ¥å‘Šå¥åº·çŠ¶æ€ï¼Œ eureka ä¼šæ›´æ–°è®°å½•æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ã€‚ ","date":"2023-08-08","objectID":"/microservice/:0:5","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"Nacos vs Eureka ï¼Ÿ æ¶ˆè´¹è€…ç«¯ï¼ŒNacos å¢åŠ äº†æ³¨å†Œä¸­å¿ƒå‘ Consumer push æ¨é€å˜æ›´æ¶ˆæ¯ ä¸¤è€…é»˜è®¤AP ï¼Œ Nacos å¯é…ç½®ä¸´æ—¶å®ä¾‹spring.cloud.nacos.discovery.ephemeralï¼Œå®ç° CP Nacos æœåŠ¡ç«¯ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³ç›‘æµ‹ï¼Œå¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼›éä¸´æ—¶å®ä¾‹ä¸»åŠ¨è¯¢é—®ï¼Œä¸ä¼šè¢«å‰”é™¤ã€‚ Eureka åªæœ‰æ³¨å†Œä¸­å¿ƒï¼ŒNacos è¿˜æœ‰é…ç½®ä¸­å¿ƒ é…ç½®ä¸­å¿ƒ - çƒ­æ›´æ–° åœ¨@Valueæ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@RefreshScope ä½¿ç”¨ @ConfigurationProperties æ³¨è§£ æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰é…ç½®éƒ½é€‚åˆæ”¾åˆ°é…ç½®ä¸­å¿ƒï¼Œå»ºè®®åªæ”¾ä¸€äº›éœ€è¦è¿è¡Œæ—¶è°ƒæ•´çš„å…³é”®å‚æ•° ","date":"2023-08-08","objectID":"/microservice/:0:6","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"nginx åå‘ä»£ç† - æ­å»ºé›†ç¾¤ http { upstream nacos-cluster { server 127.0.0.1:8845; server 127.0.0.1:8846; server 127.0.0.1:8847; } Â·Â·Â· } ","date":"2023-08-08","objectID":"/microservice/:0:7","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"Ribbon - è´Ÿè½½å‡è¡¡ ç»™RestTemplateæ·»åŠ @LoadBalancedæ³¨è§£ï¼Œè´Ÿè½½å‡è¡¡åº•å±‚æµç¨‹ï¼š è°ƒç”¨æ¥å£å‘èµ·è¯·æ±‚ RibbonLoadBalancerClient è·å–urlä¸­çš„æœåŠ¡id DynamicServerListLoadBalancer æ‹‰å– eureka-server ä¸­çš„æœåŠ¡åˆ—è¡¨ ğŸŒŸIRule æ¥å£å†³å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶é€‰æ‹©æŸä¸ªæœåŠ¡ï¼š ZoneAvoidanceRuleï¼ˆé»˜è®¤ï¼‰ï¼šå¯¹ZoneåŒºåŸŸå†…å¤šä¸ªæœåŠ¡è½®è¯¢ï¼Œzoneå€¼å¯é…ç½® RoundRobinRuleï¼šè½®è¯¢ WeightedResponseTimeRuleï¼šæœåŠ¡å“åº”æ—¶é—´è¶Šé•¿ï¼ŒæœåŠ¡å™¨æƒé‡å°±è¶Šå°ï¼Œæ¦‚ç‡å°±è¶Šä½ RandomRuleï¼šéšæœº ä¿®æ”¹ urlï¼Œå‘èµ·è¯·æ±‚ å¤§è¯·æ±‚åœºæ™¯ Qï¼šæˆ‘ä»¬å…¬å¸ç”¨çš„æ˜¯è½®è¯¢æ¥ä½œä¸ºè´Ÿè½½å‡è¡¡ã€‚ä¸è¿‡å› ä¸ºè½®è¯¢æ²¡æœ‰å®é™…æŸ¥è¯¢æœåŠ¡ç«¯èŠ‚ç‚¹çš„è´Ÿè½½ï¼Œæ‰€ä»¥éš¾å…ä¼šå‡ºç°å¶å‘æ€§çš„è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ã€‚ A1ï¼šï¼ˆä¸šåŠ¡æ‹†åˆ†ï¼‰å‘è´¦æˆ·ä¸­å¿ƒæŸ¥è¯¢ loginName æ˜¯å¦å­˜åœ¨æ—¶ï¼Œä¼ çš„ list é™åˆ¶åœ¨ 100 ä»¥å†…ï¼Œé˜²æ­¢è¯·æ±‚è¿‡å¤§ã€‚ A2ï¼šï¼ˆéš”ç¦»è§’åº¦ï¼‰é­”æ”¹äº†ä¸€ä¸‹è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè®©å¤§å®¢æˆ·è¢«æ‰“åˆ°å‡ ä¸ªä¸“é—¨çš„èŠ‚ç‚¹ä¸Š åŠ æƒè´Ÿè½½å‡è¡¡çš„æƒé‡è®¾å®š æƒé‡ä»£è¡¨èŠ‚ç‚¹çš„å¤„ç†èƒ½åŠ›ï¼ŒæˆåŠ è´¥å‡ï¼Œæƒé‡çš„è°ƒæ•´è¦è®¾ç½®å¥½ä¸Šé™å’Œä¸‹é™ã€‚ ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ æ¯”å¦‚è¯´é’ˆå¯¹ç”¨æˆ·çš„æœ¬åœ°ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”¨æˆ· ID æ¥è®¡ç®—å“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®ä¿åŒä¸€ä¸ªç”¨æˆ·çš„æœ¬åœ°ç¼“å­˜å¿…ç„¶åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ä¸è¿‡å³ä¾¿æ˜¯é‡‡ç”¨äº†ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä¾æ—§ä¸èƒ½å½»åº•è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼ˆåº”ç”¨å‘å¸ƒæ—¶ï¼‰ã€‚ è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½® åœ¨ consumer æ¶ˆè´¹è€…ç«¯ï¼š é’ˆå¯¹æ‰€æœ‰æœåŠ¡æä¾›è€…ï¼šç›´æ¥æ³¨å…¥IRuleç±»å‹çš„Beané…ç½®ç­–ç•¥ é’ˆå¯¹ç‰¹å®šæœåŠ¡æä¾›è€…ï¼šymlï¼šuserservice.ribbon.NFLoadBlancerRuleClassName: com.netflix.loadbalancer.RandomRule åŠ è½½ç­–ç•¥ï¼šé»˜è®¤æ‡’åŠ è½½ï¼Œé™¤éé…ç½®ymlï¼šribbon.eager-load.enabled=true å¼€å¯é¥¥é¥¿åŠ è½½ ","date":"2023-08-08","objectID":"/microservice/:0:8","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"Feign - è¿œç¨‹è°ƒç”¨ ç³»ç»Ÿçº§é…ç½®å†™å…¥ bootstrap.yml åŸºæœ¬ä½¿ç”¨ æ·»åŠ  pom ä¾èµ– å¯åŠ¨ç±»æ·»åŠ @EnableFeignClients æ³¨è§£ å†™æ¥å£ï¼š @FeignClient(\"userservice\") public interface UserClient{ @GetMapping(\"/user/{id}\") User findById(@PathVariable(\"id\") Long id); } ä½¿ç”¨ FeignClient ä¸­å®šä¹‰çš„æ–¹æ³•å–ä»£ RestTemplateï¼ˆå¹¶é›†æˆäº† ribbonï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡ï¼‰ è‡ªå®šä¹‰é…ç½® ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼šfeign.Logger.Levelï¼ŒåŒ…å« NONEã€BASICï¼ˆè®°å½•è¯·æ±‚åŸºæœ¬ä¿¡æ¯ï¼‰ã€HEADERSï¼ˆBASIC+è¯·æ±‚å¤´ï¼‰ã€FULLï¼ˆHEADERS+è¯·æ±‚ä½“ï¼‰ å››ç§çº§åˆ«ï¼Œæ¨èä½¿ç”¨NONE æˆ– BASIC é…ç½®æ–‡ä»¶æ–¹å¼ Java æ³¨è§£æ–¹å¼ é…ç½®ä¸€ä¸ª Logger.Level è¿™ä¸ª Bean public class DefaultFeignConfiguration{ @Bean public Logger.Level feignLogLevel(){ return Logger.Level.BASIC; } } å…¨å±€ï¼š@EnableFeignClientsï¼ˆdefaultConfiguration = DefaultFeignConfiguration.class) å±€éƒ¨ï¼š@EnableFeignClientsï¼ˆvalue=â€œuserserviceâ€, defaultConfiguration = DefaultFeignConfiguration.class) å“åº”ç»“æœè§£æå™¨ï¼šfeign.codec.Decoderï¼ŒJson è½¬æ¢ä¸º POJO å¯¹è±¡ è¯·æ±‚å‚æ•°ç¼–ç ï¼šfeign.codec.Encoderï¼Œå¯¹è±¡è½¬æ¢ä¸º Json å¤±è´¥é‡è¯•æœºåˆ¶ï¼šfeign.Retryerï¼Œé»˜è®¤æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯• æ€§èƒ½ä¼˜åŒ– Feign åº•å±‚çš„å®¢æˆ·ç«¯å®ç°ï¼š URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ±  Apache HttpClientï¼šæ”¯æŒè¿æ¥æ± ï¼Œfeign.httpclient.enabled=true OKHttpï¼šæ”¯æŒè¿æ¥æ±  æœ€ä½³å®è·µ ç»§æ‰¿ï¼šç»™æ¶ˆè´¹è€…çš„ FeignClientå’Œæä¾›è€…çš„controllerå®šä¹‰ç»Ÿä¸€çš„çˆ¶æ¥å£ä½œä¸ºæ ‡å‡†ã€‚ æœåŠ¡ã€ç´§è€¦åˆã€‘ çˆ¶æ¥å£å‚æ•°åˆ—è¡¨ä¸­çš„æ˜ å°„ä¸ä¼šè¢«ç»§æ‰¿ âœ“æŠ½å–ï¼šå°† FeignClient æŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶æŠŠæ¥å£ç›¸å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ¶ˆè´¹è€…ç”¨ã€é™ä½è€¦åˆã€‘ Qï¼šå®šä¹‰çš„FeignClientä¸åœ¨SpringBootApplicationçš„æ‰«æåŒ…èŒƒå›´æ—¶ï¼ŒFeignClientæ— æ³•ä½¿ç”¨ï¼Ÿ æŒ‡å®šFeignClientæ‰€åœ¨åŒ…ï¼š@EnableFeignClients(basePackages = â€œedu.zjut.feign.clientsâ€) æŒ‡å®šFeignClientå­—èŠ‚ç ï¼š@EnableFeignClients(clients = {UserClient.class}) ï¼ˆæ¨èï¼‰ ","date":"2023-08-08","objectID":"/microservice/:0:9","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"ç½‘å…³ åŠŸèƒ½ è¯·æ±‚å…ˆç»è¿‡ç½‘å…³ï¼Œå†è¿›å…¥å¾®æœåŠ¡ï¼š èº«ä»½è®¤è¯å’Œæƒé™æ ¡éªŒ æœåŠ¡è·¯ç”±ã€è´Ÿè½½å‡è¡¡ è¯·æ±‚é™æµ ç½‘å…³æ¯”è¾ƒ gatewayï¼šåŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹ï¼ˆæ¨èï¼‰ zuulï¼šåŸºäºServletå®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ Apisixï¼šNginx+etcdï¼Œæ€§èƒ½å¥½ è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ï¼šAPISIXæ”¯æŒåŸºäºè¯·æ±‚å†…å®¹ã€è¯·æ±‚åœ°å€ã€è¯·æ±‚å¤´ç­‰å¤šç§æ–¹å¼è¿›è¡Œè¯·æ±‚è·¯ç”±ï¼Œå¹¶æä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€åŠ æƒè½®è¯¢ã€éšæœºç­‰ã€‚ æµé‡æ§åˆ¶å’Œé™æµï¼šAPISIXæ”¯æŒåŸºäºQPSã€è¿æ¥æ•°ã€å¹¶å‘æ•°ç­‰å¤šç§æ–¹å¼è¿›è¡Œæµé‡æ§åˆ¶å’Œé™æµï¼Œå¯ä»¥ä¿æŠ¤åç«¯æœåŠ¡å…å—çªå‘æµé‡çš„å†²å‡»ã€‚ è®¤è¯å’Œæˆæƒï¼šAPISIXæ”¯æŒå¤šç§è®¤è¯å’Œæˆæƒæ–¹å¼ï¼Œå¦‚åŸºäºJWTã€OAuth2ã€API Keyç­‰æ–¹å¼è¿›è¡Œè®¤è¯å’Œæˆæƒï¼Œå¯ä»¥ä¿æŠ¤APIæœåŠ¡çš„å®‰å…¨æ€§ã€‚ ","date":"2023-08-08","objectID":"/microservice/:0:10","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"è·¨åŸŸé—®é¢˜ è·¨åŸŸï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸajaxè¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜ã€‚ åŸŸåä¸åŒ åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒ ","date":"2023-08-08","objectID":"/microservice/:0:11","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"åˆ†å¸ƒå¼æœåŠ¡åŒ–ä¸ SOA/ESB çš„åŒºåˆ« æœ‰çŠ¶æ€éƒ¨åˆ†ï¼Œæ”¾åˆ°xxä¸­å¿ƒ é…ç½®ä¸­å¿ƒï¼šå…¨å±€éä¸šåŠ¡å‚æ•° Nacosï¼Œè¿è¡ŒæœŸæ”¹å˜é…ç½®ï¼Œé¿å…ä¸æ–­é‡å¯ æ³¨å†Œä¸­å¿ƒï¼šè¿è¡ŒæœŸä¸´æ—¶çŠ¶æ€ ä¸»åŠ¨æŠ¥å‘Š+å¿ƒè·³ï¼šè®©æ¶ˆè´¹è€…èƒ½åŠ¨æ€çŸ¥é“ç”Ÿäº§è€…é›†ç¾¤çš„çŠ¶æ€å˜åŒ– å…ƒæ•°æ®ä¸­å¿ƒï¼šä¸šåŠ¡æ¨¡å‹ å®šä¹‰äº†æ‰€æœ‰ä¸šåŠ¡æœåŠ¡çš„æ¨¡å‹ æ— çŠ¶æ€éƒ¨åˆ†ï¼Œæ”¾åˆ°åº”ç”¨ä¾§ï¼ˆæ¡†æ¶å’Œé…ç½®éƒ¨åˆ†ï¼Œå°½é‡ä¸å½±å“ä¸šåŠ¡ä»£ç ï¼‰ ","date":"2023-08-08","objectID":"/microservice/:0:12","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"ç†”æ–­ ç›®çš„ï¼šç»™æœåŠ¡ç«¯æ¢å¤çš„æœºä¼šã€‚ ä½¿ç”¨ï¼šHystrix é‡‡ç”¨@EnableCircuitBreaker æ³¨è§£ï¼Œ10s å†…å¤±è´¥ 50%ä»¥ä¸Šè§¦å‘ç†”æ–­ï¼Œä¹‹åæ¯ 5s é‡è¯•ã€‚ è®¾å®šåˆé€‚çš„é˜ˆå€¼â€”â€” å“åº”æ—¶é—´è¶…è¿‡ 1.2sï¼Œå¹¶ä¸”æŒç»­ 30s é˜²æ­¢æŠ–åŠ¨ æ€»çš„æ¥è¯´ï¼Œåœ¨ä»»ä½•çš„æ•…éšœå¤„ç†é‡Œé¢ï¼Œéƒ½è¦è€ƒè™‘æ¢å¤ç­–ç•¥ä¼šä¸ä¼šå¼•èµ·æŠ–åŠ¨é—®é¢˜ã€‚ è¶…è¿‡é˜ˆå€¼åï¼ŒæŒç»­ä¸€æ®µæ—¶é—´åå†ç†”æ–­ ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œå†æ”¾å¼€æµé‡ï¼ˆæ ¹æ®ç»“æœè°ƒæ•´è´Ÿè½½å‡è¡¡æƒé‡ï¼‰ åœºæ™¯ï¼šå½“ Redis å´©æºƒ or è¿”å›æŸä¸ªé”™è¯¯ç±»å‹æ—¶ï¼Œè§¦å‘ç†”æ–­ç­–ç•¥ï¼š å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè‡ªæ—‹åœ° ping Redisï¼Œç›´åˆ° Redis æ¢å¤ã€‚ å°†èŠ‚ç‚¹æŒªå‡ºè´Ÿè½½å‡è¡¡ç­–ç•¥çš„å¯ç”¨åˆ—è¡¨ï¼Œé™ä½æƒé‡ã€‚ä¸€æ®µæ—¶é—´åå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸï¼Œå°±å¢åŠ è°ƒæ•´è´Ÿè½½å‡è¡¡æƒé‡ï¼Œæµé‡å°±ä¼šå¢åŠ ï¼Œå¦åˆ™è¯¥èŠ‚ç‚¹å°±ç»§ç»­ç­‰å¾…ã€‚ å½“æ‰€æœ‰èŠ‚ç‚¹éƒ½è§¦å‘ç†”æ–­äº†ï¼Œå°±é€šè¿‡é’‰é’‰/ä¼å¾®æœºå™¨äººå‘èµ·å‘Šè­¦é€šçŸ¥ï¼Œäººå·¥ä»‹å…¥å¤„ç†ã€‚ ","date":"2023-08-08","objectID":"/microservice/:0:13","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"é™çº§ è‡ªæˆ‘ä¿æŠ¤ï¼Œç›®çš„åœ¨äºåº”å¯¹ç³»ç»Ÿè‡ªèº«çš„æ•…éšœï¼Œä¸ feign æ¥å£æ•´åˆï¼Œç¼–å†™é™çº§é€»è¾‘ï¼Œå»æ‰ä¸å¿…è¦çš„ä¸šåŠ¡é€»è¾‘ï¼Œåªä¿ç•™æ ¸å¿ƒé€»è¾‘ e.g. ç¬¬ä¸€æ¬¡æ¥è§¦é™çº§ï¼šåŒåä¸€æ·˜å®æ— æ³•æŸ¥çœ‹å…¨éƒ¨è®¢å•ç­‰è¾¹ç¼˜ä¸šåŠ¡ åœºæ™¯ï¼š è¯»å†™æœåŠ¡é™çº§å†™æœåŠ¡ é™çº§ä¸é‡è¦çš„å†™æ•°æ®ï¼šåŸ‹ç‚¹æ•°æ®ã€è§‚æµ‹æ€§æ•°æ® ä»»åŠ¡æ¨¡å—ï¼Œä¸»æ’­è¯»æœåŠ¡å¤šï¼Œè¿è¥å•†å†™æœåŠ¡å¤šï¼Œåœ¨qpsè¿‡é«˜æ—¶ï¼Œé™çº§å†™æœåŠ¡ï¼Œé™çº§éæ ¸å¿ƒæœåŠ¡ï¼ˆä¸èµšé’±çš„ï¼‰ å¿«æ…¢è·¯å¾„é™çº§æ…¢è·¯å¾„ï¼šç³»ç»Ÿçš„å¹¶å‘é«˜æ—¶ï¼Œå°†è¯·æ±‚æ ‡è®°ä¸ºé™çº§è¯·æ±‚ï¼ŒåªæŸ¥è¯¢ç¼“å­˜ï¼ˆå¿«è·¯å¾„ï¼‰ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼ˆæ…¢è·¯å¾„ï¼‰ã€‚ æ°´å¹³åˆ†åº“ï¼šæœ€çƒ­çš„æ•°æ®æ”¾ç¼“å­˜ï¼Œæ¸©æ•°æ®æ”¾æ•°æ®åº“ï¼Œå†·æ•°æ®æ”¾ç¡¬ç›˜ï¼ˆä¸æä¾›å®æ—¶æŸ¥è¯¢ï¼‰ ","date":"2023-08-08","objectID":"/microservice/:0:14","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"é™æµ é›ªå´©ï¼šä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå¯¼è‡´æ•´æ¡é“¾è·¯éƒ½å¤±è´¥ é™æµå¯ä»¥è§£å†³å¼‚å¸¸çªå‘æµé‡ä½¿ç³»ç»Ÿé›ªå´©çš„é—®é¢˜ï¼Œæ–¹å¼ï¼š Tomcat æœ€å¤§è¿æ¥æ•° Nginx æ¼æ¡¶ç®—æ³• ç½‘å…³ï¼šä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå›ºå®šé€Ÿç‡ç”Ÿæˆä»¤ç‰Œï¼Œæ”¾å…¥æ¡¶ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚æ‹¿åˆ°ä»¤ç‰Œæ‰ä¼šè¢«æ‰§è¡Œ ç¡®å®šé˜ˆå€¼ï¼šçº¿ä¸Šé«˜å³°æœŸ QPSï¼Œå…¨é“¾è·¯å‹æµ‹æµ‹é‡ç“¶é¢ˆï¼Œå¯åŠ¨æ€è°ƒæ•´ å“åº”æ—¶é—´ - æ€§èƒ½ èµ„æºåˆ©ç”¨ç‡ - é«˜å¹¶å‘ ååé‡ è‡ªå®šä¹‰æ‹¦æˆªå™¨ IP é™æµ è·å–ç”¨æˆ·çœŸå® IPï¼š åº”ç”¨å±‚æ–¹æ³•ï¼šX-Forwarded-Forï¼Œç¼ºç‚¹:ä¼šè¢«ä¼ªé€ ã€å¤šä¸ªX-Forwarded-Forå¤´éƒ¨ã€ä¸èƒ½è§£å†³HTTPå’ŒSMTPä¹‹å¤–çš„çœŸå®æºIPè·å–çš„éœ€æ±‚ ä¼ è¾“å±‚æ–¹æ³•ï¼šåˆ©ç”¨ TCP Options çš„å­—æ®µæ¥æ‰¿è½½çœŸå®æº IP ä¿¡æ¯ã€Proxy Protocolã€NetScaler çš„ TCP IP header ç½‘ç»œå±‚ï¼šéš§é“ +DSR æ¨¡å¼ ","date":"2023-08-08","objectID":"/microservice/:0:15","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"éš”ç¦» ç›®çš„ï¼šæå‡å¯ç”¨æ€§ã€æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚ çº¿ç¨‹æ± éš”ç¦»å¿«æ…¢ä»»åŠ¡ï¼Œé˜²æ­¢å®šæ—¶ä»»åŠ¡ä¸èƒ½å¾—åˆ°åŠæ—¶çš„è°ƒåº¦ï¼Œä¸€ä¸ªä»»åŠ¡è¿è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œå°±è½¬äº¤ç»™æ…¢ä»»åŠ¡çº¿ç¨‹æ± ã€‚ çº¿ç¨‹æ± åˆ†æˆä¸‰çº§ï¼šç‹¬äº«ï¼Œéƒ¨åˆ†å…±äº«ï¼Œå®Œå…¨å…±äº«ï¼Œå¹¶ä¸”è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ æ•°æ®åº“æ°´å¹³åˆ†åº“ï¼šç´ æåº“å’Œå‘å¸ƒåº“åˆ†ç¦»ï¼Œåªæœ‰æ­£å¼å‘å¸ƒçš„æ—¶å€™ï¼Œç´ ææ‰åŒæ­¥åˆ°ç¼“å­˜ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚ Redis éš”ç¦»ï¼šæ ¸å¿ƒä¸šåŠ¡ä¿è¯é«˜å¯ç”¨å¹¶ä¸” code reviewï¼Œéæ ¸å¿ƒä¸šåŠ¡ å¯ä»¥å®¹é”™ï¼Œä»¥é˜²ç¼“å­˜å¤§é‡å¤§å¯¹è±¡å¯¼è‡´é›†ç¾¤è¶…æ—¶ã€å®•æœºã€‚ æœåŠ¡å…±äº«ä¸€éƒ¨åˆ†åŸºç¡€è®¾æ–½ï¼Œå¦‚éƒ¨ç½²ä¸¤å¥— Redis ","date":"2023-08-08","objectID":"/microservice/:0:16","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"è¶…æ—¶æ§åˆ¶ ç›®çš„ï¼š ç”¨æˆ·ä½“éªŒ e.g. é¦–é¡µæ¥å£é™åˆ¶åœ¨ 100ms å†… åŠæ—¶é‡Šæ”¾èµ„æºã€‚ å¸¸ç”¨æŒ‡æ ‡ï¼š 99 çº¿ï¼š99%è¯·æ±‚éƒ½åœ¨é˜ˆå€¼å†… 999 çº¿ï¼š99.9%çš„è¯·æ±‚éƒ½åœ¨é˜ˆå€¼å†… é“¾è·¯è¶…æ—¶æ§åˆ¶ï¼šå°†è¶…æ—¶æ—¶é—´æ”¾åœ¨åè®®å¤´ï¼ˆå¯ä»¥å­˜æ”¾å‰©ä½™è¶…æ—¶æ—¶é—´æˆ–è¶…æ—¶æ—¶é—´æˆ³ï¼‰ ","date":"2023-08-08","objectID":"/microservice/:0:17","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"Dubbo ","date":"2023-08-08","objectID":"/microservice/:1:0","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"1. Dubbo æ•´ä½“æ¶æ„ config é…ç½®å±‚ï¼šå¯¹å¤–é…ç½®æ¥å£ï¼Œä»¥ ServiceConfigã€ReferenceConfig ä¸ºä¸­å¿ƒ proxy æœåŠ¡ä»£ç†å±‚ï¼šæœåŠ¡æ¥å£é€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡ç«¯ Skeletonï¼Œæ‰©å±•æ¥å£ä¸º ProxyFactory registry æ³¨å†Œä¸­å¿ƒå±‚ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸å‘ç°ï¼Œä»¥æœåŠ¡ URL ä¸ºä¸­å¿ƒ cluster è·¯ç”±å±‚ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ Invoker ä¸ºä¸­å¿ƒ monitor ç›‘æ§å±‚ï¼šRPCè°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ Protocol è¿œç¨‹è°ƒç”¨å±‚ï¼šå°è£… RPC è°ƒç”¨ï¼Œä»¥ Result ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Protocolï¼ŒInvoker exchange ä¿¡æ¯äº¤æ¢å±‚ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Requestï¼ŒResponse ä¸ºä¸­å¿ƒ transport ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒ serialize æ•°æ®åºåˆ—åŒ–å±‚ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æ¥å£ä¸º ThreadPool ","date":"2023-08-08","objectID":"/microservice/:1:1","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"2. åº”ç”¨åœºæ™¯ åˆ†å¸ƒå¼æœåŠ¡åŒ–æ”¹é€ ï¼šå‚ç›´æ‹†åˆ† å¼€æ”¾å¹³å°ï¼šå¼€æ”¾æ¨¡å¼ã€å®¹å™¨æ¨¡å¼ ç›´æ¥ä½œä¸ºå‰ç«¯ä½¿ç”¨çš„åç«¯ï¼ˆBFFï¼ŒBackend For Frontendï¼‰ï¼Œä¸€èˆ¬ä¸å»ºè®® é€šè¿‡æœåŠ¡åŒ–å»ºè®¾ä¸­å°ï¼šåŸºäºDubboå®ç°ä¸šåŠ¡ä¸­å° Qï¼šæœåŠ¡å¦‚ä½•æš´éœ²ï¼Ÿ Aï¼šå…·ä½“æœåŠ¡ -\u003e Invoker -\u003e Exporter ","date":"2023-08-08","objectID":"/microservice/:2:0","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["interview"],"content":"3. å¦‚ä½•è®¾è®¡å¹‚ç­‰æ¥å£ï¼Ÿ ç”¨ bitmap å»é‡ ä¹è§‚é”æœºåˆ¶ ","date":"2023-08-08","objectID":"/microservice/:2:1","tags":["MicroService"],"title":"ğŸš©MicroService","uri":"/microservice/"},{"categories":["ç”Ÿæ´»"],"content":"å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ","date":"2023-08-08","objectID":"/joke/","tags":["ç¬‘è¯"],"title":"ç¨‹åºå‘˜ç¬‘è¯","uri":"/joke/"},{"categories":["ç”Ÿæ´»"],"content":" ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å•¤é…’ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å’–å•¡ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº† 0.7 æ¯å•¤é…’ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº† -1 æ¯å•¤é…’ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº† 2^32 æ¯å•¤é…’ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯æ´—è„šæ°´ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯èœ¥èœ´ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€ä»½ adfgar@24dg!\u0026*(@ ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œä»€ä¹ˆä¹Ÿæ²¡è¦ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œåˆèµ°å‡ºå»åˆä»çª—æˆ·è¿›æ¥åˆä»åé—¨å‡ºå»ä»ä¸‹æ°´é“é’»è¿›æ¥ï¼Œä¸€åˆ‡ OK ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œåˆèµ°å‡ºå»åˆè¿›æ¥åˆå‡ºå»åˆè¿›æ¥åˆå‡ºå»ï¼Œæœ€ååœ¨å¤–é¢æŠŠè€æ¿æ‰“äº†ä¸€é¡¿ï¼Œä¸€åˆ‡ OK END: æµ‹è¯•å·¥ç¨‹å¸ˆä»¬æ»¡æ„åœ°ç¦»å¼€äº†é…’å§ã€‚ç„¶åä¸€åé¡¾å®¢ç‚¹äº†ä¸€ä»½ç‚’é¥­ï¼Œé…’å§ç‚¸äº† ","date":"2023-08-08","objectID":"/joke/:0:0","tags":["ç¬‘è¯"],"title":"ç¨‹åºå‘˜ç¬‘è¯","uri":"/joke/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/spring_draft/","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"9.1 Springæ¡†æ¶è®¾è®¡ ","date":"2023-08-08","objectID":"/spring_draft/:0:1","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"9.2 AOP è¯¦è§£ ","date":"2023-08-08","objectID":"/spring_draft/:0:2","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"9.3 Bean æ ¸å¿ƒåŸç† ","date":"2023-08-08","objectID":"/spring_draft/:0:3","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"9.4 XML é…ç½®åŸç† ","date":"2023-08-08","objectID":"/spring_draft/:0:4","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"10.1 Spring Boot æ ¸å¿ƒåŸç† ","date":"2023-08-08","objectID":"/spring_draft/:0:5","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"10.2 ORM-Hibernate/MyBatis ","date":"2023-08-08","objectID":"/spring_draft/:0:6","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"10.3 Spring é›†æˆ ORM/JPA ","date":"2023-08-08","objectID":"/spring_draft/:0:7","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"å®¹å™¨æ¥å£ä¸å®ç° BeanFactory Spring çš„æ ¸å¿ƒå®¹å™¨ï¼Œå®é™…ä¸Šæ§åˆ¶åè½¬ã€åŸºæœ¬çš„ä¾èµ–æ³¨å…¥ã€ç›´è‡³ Bean çš„ç”Ÿå‘½å‘¨æœŸçš„å„ç§åŠŸèƒ½ï¼Œéƒ½ç”±å®ƒçš„å®ç°ç±»æä¾›ã€‚ @SpringBootApplication public class DemoApplication { public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException { ConfigurableApplicationContext context = SpringApplication.run(DemoApplication.class, args); // å•ä¾‹å­˜å‚¨åœ¨ singletonObjects Field singletonObjects = DefaultSingletonBeanRegistry.class.getDeclaredField(\"singletonObjects\"); singletonObjects.setAccessible(true); ConfigurableListableBeanFactory beanFactory = context.getBeanFactory(); Map\u003cString, Object\u003e map = (Map\u003cString, Object\u003e) singletonObjects.get(beanFactory); map.forEach((k, v) -\u003e { System.out.println(\"beanName:\" + k + \",bean:\" + v); }); } } å°†å¸¸ç”¨åå¤„ç†å™¨æ·»åŠ åˆ°beanFactory AnnotationConfigUtils.registerAnnotationConfigProcessors(beanFactory); beanFactory åå¤„ç†å™¨ org.springframework.context.annotation.internalConfigurationAnnotationProcessorï¼šè§£æ@Configurationã€@Bean ConfigurationClassPostProcessor.class å¯ä»¥è§£æ @ComponentScan @Bean @Import @ImportResource MapperScannnerConfigurer.class å¯ä»¥è§£æ @MapperScanner beanFactory.getBeansOfType(BeanFactoryPostProcessor.class).values().forEach(beanFactoryPostProcessor -\u003e { beanFactoryPostProcessor.postProcessBeanFactory(beanFactory); }); bean åå¤„ç†å™¨ org.springframework.context.annotation.internalAutowiredAnnotationProcessorï¼šåœ¨ä¾èµ–æ³¨å…¥é˜¶æ®µï¼Œè§£æ@Autowired å¦‚æœæ˜¯ GenericApplicationContextï¼Œè¿˜éœ€è¦ context.getDefaultListableBeanFactory().setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver()) æ‰èƒ½è§£æ @Value org.springframework.context.annotation.internalCommonAnnotationProcessorï¼šè§£æ@Resourceï¼ˆä¾èµ–æ³¨å…¥é˜¶æ®µï¼‰ã€@PostConstructï¼ˆå®ä¾‹åŒ–åï¼Œå³åˆå§‹åŒ–å‰ï¼‰ã€@PreDestroyï¼ˆé”€æ¯å‰ï¼‰ org.springframework.context.event.internalEventListenerProcessor org.springframework.context.event.internalEventListenerFactory beanFactory.getBeansOfType(BeanPostProcessor.class).values().forEach(beanFactory::addBeanPostProcessor); å¦å¤–ï¼ŒConfigurationPropertiesBindingPostProcessor ç”¨äºè§£æ @ConfigurationProperties å•ä¾‹å¯¹è±¡é»˜è®¤åœ¨ä½¿ç”¨æ—¶æ‰åˆå§‹åŒ–ï¼Œè‹¥è¦é¢„å…ˆåˆå§‹åŒ–å•ä¾‹å¯¹è±¡ï¼š beanFactory.preInstantiateSingletons(); ç»¼ä¸Šï¼ŒbeanFactoryä¸ä¼šä¸»åŠ¨åšä»¥ä¸‹äº‹æƒ…ï¼š ä¸ä¼šä¸»åŠ¨è°ƒç”¨ BeanFactory åå¤„ç†å™¨ ä¸ä¼šä¸»åŠ¨æ·»åŠ  Bean åå¤„ç†å™¨ ä¸ä¼šä¸»åŠ¨åˆå§‹åŒ–å•ä¾‹ ä¸ä¼šè§£æ beanFactoryã€${}ã€#{} æ³¨ï¼šbeanFactory.addEmbeddedValueResolver(new StandardEnvironment()::resolvePlaceholders) æ˜¯ ${} çš„è§£æå™¨ Qï¼šåŒæ—¶æ·»åŠ  @Autowired å’Œ@Resourceæ³¨è§£ï¼Ÿ Autowiredé»˜è®¤æŒ‰ç…§ç±»å‹åŒ¹é…ï¼ˆé€šè¿‡beanFactory.doResolveDependency(â€¦)æ–¹æ³•ï¼‰ï¼Œ æœ‰ç›¸åŒç±»å‹æ—¶å†æŒ‰ç…§åç§°åŒ¹é…ï¼ŒResourceé»˜è®¤æŒ‰ç…§åç§°åŒ¹é…ã€‚ internalAutowiredAnnotationProcessoré»˜è®¤ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ‰€ä»¥Autowiredç”Ÿæ•ˆï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒå™¨æ¥æ”¹å˜ä¼˜å…ˆçº§ï¼ˆorderè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚ ApplicationContext ç»§æ‰¿äº† BeanFactoryï¼Œè¿›è¡Œäº†æ‰©å±•ã€‚ MessageSourceï¼šå›½é™…åŒ– ResourcePatternResolverï¼šèµ„æºé€šé…ç¬¦ ApplicationEventPublisherï¼šäº‹ä»¶å‘å¸ƒå™¨ï¼ˆç”¨äºè§£è€¦ï¼‰ EnvironmentCapableï¼šç¯å¢ƒå˜é‡ã€é…ç½®ä¿¡æ¯ DispatcherServlet ç§°ä¸ºå‰æ§åˆ¶å™¨ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å…ˆé€šè¿‡å®ƒã€‚ ","date":"2023-08-08","objectID":"/spring_draft/:0:8","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"Aware æ¥å£ æ˜¯ spring çš„å†…ç½®åŠŸèƒ½ beanåˆå§‹åŒ–ä¼˜å…ˆçº§ï¼š @PostConstruct Aware implements InitializingBean é‡å†™æ–¹æ³• @Bean(initMethod = â€œâ€) beané”€æ¯ä¼˜å…ˆçº§ï¼š @PreDestroy Aware implements DisposableBean é‡å†™æ–¹æ³• @Bean(destroyMethod = â€œâ€) ","date":"2023-08-08","objectID":"/spring_draft/:0:9","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"Scope singleton å•ä¾‹ï¼šQï¼šå•ä¾‹ä¸­æ³¨å…¥å¤šä¾‹ï¼Œå¤šä¾‹éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ¨è¿Ÿå…¶ä»– scope bean çš„è·å–ï¼ˆ2ç§ä»£ç†ï¼Œ2ç§éä»£ç†ï¼‰ åœ¨æ³¨å…¥ç›®æ ‡å‰é¢åŠ  @Lazy ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆæ¨èï¼‰ åœ¨è¢«æ³¨å…¥ç±»ä¸Šæ·»åŠ  @Scope(value=â€œprototypeâ€,proxyMode = ScopedProxyMode.TARGET_CLASS) ç”Ÿæˆä»£ç†å¯¹è±¡ å£°æ˜ ObjectFactory\u003c\u003eï¼Œé€šè¿‡getObject() æ¥å®ç° æ³¨å…¥ ApplicationContextï¼Œé€šè¿‡ context.getBean(Xxx.class) prototype åŸå‹ request è¯·æ±‚ session ä¼šè¯ï¼šä¸åŒæµè§ˆå™¨ï¼Œä¸åŒä¼šè¯ application åº”ç”¨ç¨‹åº Qï¼šjdk\u003e=9æ—¶ï¼Œåå°„è°ƒç”¨ jdk ä¸­æ–¹æ³•æŠ¥ IllegalAccessExceptionï¼Ÿ A1:é‡å†™toString()æ–¹æ³•ï¼Œä¸è®©å®ƒè°ƒç”¨ jdk ä¸­çš„æ–¹æ³• A2:æ·»åŠ å‚æ•°â€“add-opens java.base/java.lang=ALL-UNNAMED ","date":"2023-08-08","objectID":"/spring_draft/:0:10","tags":["Spring"],"title":"Spring æ‚è®°","uri":"/spring_draft/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/springboot_draft/","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"é…ç½® ","date":"2023-08-08","objectID":"/springboot_draft/:1:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"åŒ…æ‰«æ com +- example +- myproject +- Application.java | +- domain | +- Customer.java | +- CustomerRepository.java | +- service | +- CustomerService.java | +- web | +- CustomerController.java | @ComponentScan @SpringBootApplication @ComponentScan(basePackages=\"com.example\") public class Bootstrap { public static void main(String[] args) { SpringApplication.run(Bootstrap.class, args); } } @Bean @SpringBootApplication public class Bootstrap { public static void main(String[] args) { SpringApplication.run(Bootstrap.class, args); } @Bean public CustomerController customerController() { return new CustomerController(); } } ","date":"2023-08-08","objectID":"/springboot_draft/:1:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"YAML /ËˆjÃ¦mÉ™l/ spring: jpa: databaseplatform: mysql database-platform: mysql databasePlatform: mysql database_platform: mysql # ä»¥ä¸Šç­‰ä»· æ¨èä½¿ç”¨å…¨å°å†™é…åˆ**-**åˆ†éš”ç¬¦çš„æ–¹å¼æ¥é…ç½®ï¼Œæ¯”å¦‚ï¼šspring.jpa.database-platform=mysql ","date":"2023-08-08","objectID":"/springboot_draft/:1:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Listã€Mapç±»å‹ spring: my-example1: key: value url: - http://example.com - http://spring.io my-example2: url: http://example.com, http://spring.io '[key.me]': value å¦‚æœMapç±»å‹çš„keyåŒ…å«éå­—æ¯æ•°å­—å’Œ**-**çš„å­—ç¬¦ï¼Œéœ€è¦ç”¨**[]**æ‹¬èµ·æ¥ ","date":"2023-08-08","objectID":"/springboot_draft/:1:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"éšæœºæ•° # éšæœºå­—ç¬¦ä¸² com.didispace.blog.value=${random.value} # éšæœºint com.didispace.blog.number=${random.int} # éšæœºlong com.didispace.blog.bignumber=${random.long} # 10ä»¥å†…çš„éšæœºæ•° com.didispace.blog.test1=${random.int(10)} # 10-20çš„éšæœºæ•° com.didispace.blog.test2=${random.int[10,20]} ","date":"2023-08-08","objectID":"/springboot_draft/:1:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å‘½ä»¤è¡Œå‚æ•° java -jar xxx.jar --server.port=8888 ç­‰ä»·äºæˆ‘ä»¬åœ¨application.propertiesä¸­æ·»åŠ å±æ€§server.port=8888 ","date":"2023-08-08","objectID":"/springboot_draft/:1:5","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å¤šç¯å¢ƒé…ç½® application-dev.propertiesï¼šå¼€å‘ç¯å¢ƒ application-test.propertiesï¼šæµ‹è¯•ç¯å¢ƒ application-prod.propertiesï¼šç”Ÿäº§ç¯å¢ƒ é€šè¿‡spring.profiles.activeå±æ€§æ¥é…ç½®ï¼ˆå¦‚ï¼šspring.profiles.active=testï¼‰ ","date":"2023-08-08","objectID":"/springboot_draft/:1:6","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"ç»‘å®š API å‡è®¾åœ¨propertesé…ç½®ä¸­æœ‰è¿™æ ·ä¸€ä¸ªé…ç½®ï¼šcom.didispace.foo=bar æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºå¯¹åº”çš„é…ç½®ç±»ï¼š @Data @ConfigurationProperties(prefix = \"com.didispace\") public class FooProperties { private String foo; } æ¥ä¸‹æ¥ï¼Œé€šè¿‡æœ€æ–°çš„Binderå°±å¯ä»¥è¿™æ ·æ¥æ‹¿é…ç½®ä¿¡æ¯äº†ï¼š @SpringBootApplication public class Application { public static void main(String[] args) { ApplicationContext context = SpringApplication.run(Application.class, args); Binder binder = Binder.get(context.getEnvironment()); // ç»‘å®šç®€å•é…ç½® FooProperties foo = binder.bind(\"com.didispace\", Bindable.of(FooProperties.class)).get(); System.out.println(foo.getFoo()); } } ","date":"2023-08-08","objectID":"/springboot_draft/:1:7","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å…³ç³»å‹æ•°æ®åº“ Spring Bootæä¾›è‡ªåŠ¨é…ç½®çš„åµŒå…¥å¼æ•°æ®åº“æœ‰H2ã€HSQLã€Derbyï¼Œä½ ä¸éœ€è¦æä¾›ä»»ä½•è¿æ¥é…ç½®å°±èƒ½ä½¿ç”¨ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:2:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"JPA = Java Persistence API é€šè¿‡è§£ææ–¹æ³•ååˆ›å»ºæŸ¥è¯¢ ","date":"2023-08-08","objectID":"/springboot_draft/:2:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"JTA = Java Transaction API JTAäº‹åŠ¡æ¯”JDBCäº‹åŠ¡æ›´å¼ºå¤§ã€‚ä¸€ä¸ªJTAäº‹åŠ¡å¯ä»¥æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œè€Œä¸€ä¸ªJDBCäº‹åŠ¡åˆ™è¢«é™å®šåœ¨ä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“è¿æ¥ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬åœ¨åŒæ—¶æ“ä½œå¤šä¸ªæ•°æ®åº“çš„æ—¶å€™ï¼Œä½¿ç”¨JTAäº‹åŠ¡å°±å¯ä»¥å¼¥è¡¥JDBCäº‹åŠ¡çš„ä¸è¶³ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:2:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å•å…ƒæµ‹è¯• æ’å…¥ä¸€æ¡name=AAAï¼Œage=20çš„è®°å½•ï¼Œç„¶åæ ¹æ®name=AAAæŸ¥è¯¢ï¼Œå¹¶åˆ¤æ–­ageæ˜¯å¦ä¸º20 æµ‹è¯•ç»“æŸå›æ»šæ•°æ®ï¼Œä¿è¯æµ‹è¯•å•å…ƒæ¯æ¬¡è¿è¡Œçš„æ•°æ®ç¯å¢ƒç‹¬ç«‹ @Slf4j @RunWith(SpringRunner.class) @SpringBootTest public class Chapter35ApplicationTests { @Autowired private UserMapper userMapper; @Test @Rollback public void test() throws Exception { userMapper.insert(\"AAA\", 20); User u = userMapper.findByName(\"AAA\"); Assert.assertEquals(20, u.getAge().intValue()); } } é€šå¸¸æˆ‘ä»¬å•å…ƒæµ‹è¯•ä¸ºäº†ä¿è¯æ¯ä¸ªæµ‹è¯•ä¹‹é—´çš„æ•°æ®ç‹¬ç«‹ï¼Œä¼šä½¿ç”¨@Rollbackæ³¨è§£è®©æ¯ä¸ªå•å…ƒæµ‹è¯•éƒ½èƒ½åœ¨ç»“æŸæ—¶å›æ»šã€‚è€ŒçœŸæ­£åœ¨å¼€å‘ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨serviceå±‚æ¥å£ä¸­ä½¿ç”¨@Transactionalæ¥å¯¹å„ä¸ªä¸šåŠ¡é€»è¾‘è¿›è¡Œäº‹åŠ¡ç®¡ç†çš„é…ç½®ã€‚ @Transactionalæ³¨è§£ä¸ç”Ÿæ•ˆï¼Ÿ æ³¨è§£ä¿®é¥°çš„å‡½æ•°ä¸­catchäº†å¼‚å¸¸ï¼Œå¹¶æ²¡æœ‰å¾€æ–¹æ³•å¤–æŠ›ã€‚ @Transactionalæ³¨è§£ä¿®é¥°çš„å‡½æ•°ä¸æ˜¯publicç±»å‹ å¯¹åº”æ•°æ®åº“ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ¯”å¦‚ï¼šMyISAMã€‚ æ•°æ®æºæ²¡æœ‰é…ç½®äº‹åŠ¡ç®¡ç†å™¨ ","date":"2023-08-08","objectID":"/springboot_draft/:2:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"äº‹åŠ¡éš”ç¦»çº§åˆ« éš”ç¦»çº§åˆ«æ˜¯æŒ‡è‹¥å¹²ä¸ªå¹¶å‘çš„äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ï¼Œä¸æˆ‘ä»¬å¼€å‘æ—¶å€™ä¸»è¦ç›¸å…³çš„åœºæ™¯åŒ…æ‹¬ï¼šè„è¯»å–ã€é‡å¤è¯»ã€å¹»è¯»ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹org.springframework.transaction.annotation.Isolationæšä¸¾ç±»ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å€¼ï¼š public enum Isolation { DEFAULT(-1), READ_UNCOMMITTED(1), READ_COMMITTED(2), REPEATABLE_READ(4), SERIALIZABLE(8); } DEFAULTï¼šè¿™æ˜¯é»˜è®¤å€¼ï¼Œè¡¨ç¤ºä½¿ç”¨åº•å±‚æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚å¯¹å¤§éƒ¨åˆ†æ•°æ®åº“è€Œè¨€ï¼Œé€šå¸¸è¿™å€¼å°±æ˜¯ï¼šREAD_COMMITTEDã€‚ READ_UNCOMMITTEDï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ä½†è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚è¯¥çº§åˆ«ä¸èƒ½é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œå› æ­¤å¾ˆå°‘ä½¿ç”¨è¯¥éš”ç¦»çº§åˆ«ã€‚ READ_COMMITTEDï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ï¼Œè¿™ä¹Ÿæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹çš„æ¨èå€¼ã€‚ REPEATABLE_READï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥å¤šæ¬¡é‡å¤æ‰§è¡ŒæŸä¸ªæŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯æ¬¡è¿”å›çš„è®°å½•éƒ½ç›¸åŒã€‚å³ä½¿åœ¨å¤šæ¬¡æŸ¥è¯¢ä¹‹é—´æœ‰æ–°å¢çš„æ•°æ®æ»¡è¶³è¯¥æŸ¥è¯¢ï¼Œè¿™äº›æ–°å¢çš„è®°å½•ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚ SERIALIZABLEï¼šæ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚ æŒ‡å®šæ–¹æ³•ï¼šé€šè¿‡ä½¿ç”¨isolationå±æ€§è®¾ç½®ï¼Œä¾‹å¦‚ï¼š @Transactional(isolation = Isolation.DEFAULT) ","date":"2023-08-08","objectID":"/springboot_draft/:2:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"ä¼ æ’­è¡Œä¸º æ‰€è°“äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæ˜¯æŒ‡ï¼Œå¦‚æœåœ¨å¼€å§‹å½“å‰äº‹åŠ¡ä¹‹å‰ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸Šä¸‹æ–‡å·²ç»å­˜åœ¨ï¼Œæ­¤æ—¶æœ‰è‹¥å¹²é€‰é¡¹å¯ä»¥æŒ‡å®šä¸€ä¸ªäº‹åŠ¡æ€§æ–¹æ³•çš„æ‰§è¡Œè¡Œä¸ºã€‚ æˆ‘ä»¬å¯ä»¥çœ‹org.springframework.transaction.annotation.Propagationæšä¸¾ç±»ä¸­å®šä¹‰äº†6ä¸ªè¡¨ç¤ºä¼ æ’­è¡Œä¸ºçš„æšä¸¾å€¼ï¼š public enum Propagation { REQUIRED(0), SUPPORTS(1), MANDATORY(2), REQUIRES_NEW(3), NOT_SUPPORTED(4), NEVER(5), NESTED(6); } REQUIREDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚ MANDATORYï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ REQUIRES_NEWï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äºREQUIREDã€‚ æŒ‡å®šæ–¹æ³•ï¼šé€šè¿‡ä½¿ç”¨propagationå±æ€§è®¾ç½®ï¼Œä¾‹å¦‚ï¼š @Transactional(propagation = Propagation.REQUIRED) ","date":"2023-08-08","objectID":"/springboot_draft/:2:5","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Flyway Flywayæ˜¯ä¸€ä¸ªç®€å•å¼€æºæ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶å™¨ï¼ˆçº¦å®šå¤§äºé…ç½®ï¼‰ï¼Œä¸»è¦æä¾›migrateã€cleanã€infoã€validateã€baselineã€repairç­‰å‘½ä»¤ã€‚å®ƒæ”¯æŒSQLï¼ˆPL/SQLã€T-SQLï¼‰æ–¹å¼å’ŒJavaæ–¹å¼ï¼Œæ”¯æŒå‘½ä»¤è¡Œå®¢æˆ·ç«¯ç­‰ï¼Œè¿˜æä¾›ä¸€ç³»åˆ—çš„æ’ä»¶æ”¯æŒï¼ˆMavenã€Gradleã€SBTã€ANTç­‰ï¼‰ã€‚ å®˜æ–¹ç½‘ç«™ï¼šhttps://flywaydb.org/ ","date":"2023-08-08","objectID":"/springboot_draft/:2:6","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Mybatis ä½¿ç”¨@Param åœ¨ä¹‹å‰çš„æ•´åˆç¤ºä¾‹ä¸­æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†è¿™ç§æœ€ç®€å•çš„ä¼ å‚æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š @Insert(\"INSERT INTO USER(NAME, AGE) VALUES(#{name}, #{age})\") int insert(@Param(\"name\") String name, @Param(\"age\") Integer age); è¿™ç§æ–¹å¼å¾ˆå¥½ç†è§£ï¼Œ@Paramä¸­å®šä¹‰çš„nameå¯¹åº”äº†SQLä¸­çš„#{name}ï¼Œageå¯¹åº”äº†SQLä¸­çš„#{age}ã€‚ ä½¿ç”¨Map å¦‚ä¸‹ä»£ç ï¼Œé€šè¿‡Map\u003cString, Object\u003eå¯¹è±¡æ¥ä½œä¸ºä¼ é€’å‚æ•°çš„å®¹å™¨ï¼š @Insert(\"INSERT INTO USER(NAME, AGE) VALUES(#{name,jdbcType=VARCHAR}, #{age,jdbcType=INTEGER})\") int insertByMap(Map\u003cString, Object\u003e map); å¯¹äºInsertè¯­å¥ä¸­éœ€è¦çš„å‚æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨mapä¸­å¡«å…¥åŒåçš„å†…å®¹å³å¯ï¼Œå…·ä½“å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š Map\u003cString, Object\u003e map = new HashMap\u003c\u003e(); map.put(\"name\", \"CCC\"); map.put(\"age\", 40); userMapper.insertByMap(map); åŒ…æ‰«æ @MapperScan(\"com.didispace.chapter36.mapper\") ","date":"2023-08-08","objectID":"/springboot_draft/:2:7","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Lombok Valå¯ä»¥å°†å˜é‡ç”³æ˜æ˜¯finalç±»å‹ã€‚ public static void main(String[] args) { val setVar = new HashSet\u003cString\u003e(); val listsVar = new ArrayList\u003cString\u003e(); val mapVar = new HashMap\u003cString, String\u003e(); //=\u003eä¸Šé¢ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š final Set\u003cString\u003e setVar2 = new HashSet\u003c\u003e(); final List\u003cString\u003e listsVar2 = new ArrayList\u003c\u003e(); final Map\u003cString, String\u003e maps2 = new HashMap\u003c\u003e(); } @NonNullæ³¨è§£èƒ½å¤Ÿä¸ºæ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å‚æ•°æä¾›éç©ºæ£€æŸ¥ã€‚ public void notNullExample(@NonNull String string) { //æ–¹æ³•å†…çš„ä»£ç  } //=\u003eä¸Šé¢ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š public void notNullExample(String string) { if (string != null) { //æ–¹æ³•å†…çš„ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š } else { throw new NullPointerException(\"null\"); } } @Cleanupæ³¨è§£èƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚ public void jedisExample(String[] args) { try { @Cleanup Jedis jedis = redisService.getJedis(); } catch (Exception ex) { logger.error(â€œJediså¼‚å¸¸:â€,ex) } //=\u003eä¸Šé¢ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š Jedis jedis= null; try { jedis = redisService.getJedis(); } catch (Exception e) { logger.error(â€œJediså¼‚å¸¸:â€,ex) } finally { if (jedis != null) { try { jedis.close(); } catch (Exception e) { e.printStackTrace(); } } } } @Synchronizedæ³¨è§£ç±»ä¼¼Javaä¸­çš„Synchronized å…³é”®å­—ï¼Œä½†æ˜¯å¯ä»¥éšè—åŒæ­¥é”ã€‚ public class SynchronizedExample { private final Object readLock = new Object(); @Synchronized public static void hello() { System.out.println(\"world\"); } @Synchronized(\"readLock\") public void foo() { System.out.println(\"bar\"); } //ä¸Šé¢ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š public class SynchronizedExample { private static final Object $LOCK = new Object[0]; private final Object readLock = new Object(); public static void hello() { synchronized($LOCK) { System.out.println(\"world\"); } } public void foo() { synchronized(readLock) { System.out.println(\"bar\"); } } } ","date":"2023-08-08","objectID":"/springboot_draft/:2:8","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"PostgreSQL PostgreSQLæ˜¯ä¸€ç§ç‰¹æ€§éå¸¸é½å…¨çš„è‡ªç”±è½¯ä»¶çš„å¯¹è±¡-å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆORDBMSï¼‰ï¼Œæ˜¯ä»¥åŠ å·å¤§å­¦è®¡ç®—æœºç³»å¼€å‘çš„POSTGRESï¼Œ4.2ç‰ˆæœ¬ä¸ºåŸºç¡€çš„å¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚ æ”¯æŒå­˜å‚¨ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼šarrayã€jsonã€jsonb å¯¹åœ°ç†ä¿¡æ¯çš„å­˜å‚¨ä¸å¤„ç†æœ‰æ›´å¥½çš„æ”¯æŒï¼Œæ‰€ä»¥å®ƒå¯ä»¥æˆä¸ºä¸€ä¸ªç©ºé—´æ•°æ®åº“ï¼Œæ›´å¥½çš„ç®¡ç†æ•°æ®æµ‹é‡å’Œå‡ ä½•æ‹“æ‰‘åˆ†æ å¯ä»¥å¿«é€Ÿæ„å»ºREST APIï¼Œé€šè¿‡PostgRESTå¯ä»¥æ–¹ä¾¿çš„ä¸ºä»»ä½•PostgreSQLæ•°æ®åº“æä¾›RESTful APIçš„æœåŠ¡ æ”¯æŒæ ‘çŠ¶ç»“æ„ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„å¤„ç†å…·å¤‡æ­¤ç±»ç‰¹æ€§çš„æ•°æ®å­˜å‚¨ å¤–éƒ¨æ•°æ®æºæ”¯æŒï¼Œå¯ä»¥æŠŠMySQLã€Oracleã€CSVã€Hadoopç­‰å½“æˆè‡ªå·±æ•°æ®åº“ä¸­çš„è¡¨æ¥è¿›è¡ŒæŸ¥è¯¢ å¯¹ç´¢å¼•çš„æ”¯æŒæ›´å¼ºï¼ŒPostgreSQLæ”¯æŒ B-æ ‘ã€å“ˆå¸Œã€R-æ ‘å’Œ Gist ç´¢å¼•ã€‚è€ŒMySQLå–å†³äºå­˜å‚¨å¼•æ“ã€‚MyISAMï¼šBTREEï¼ŒInnoDBï¼šBTREEã€‚ äº‹åŠ¡éš”ç¦»æ›´å¥½ï¼ŒMySQL çš„äº‹åŠ¡éš”ç¦»çº§åˆ«repeatable readå¹¶ä¸èƒ½é˜»æ­¢å¸¸è§çš„å¹¶å‘æ›´æ–°ï¼Œå¾—åŠ é”æ‰å¯ä»¥ï¼Œä½†æ‚²è§‚é”ä¼šå½±å“æ€§èƒ½ï¼Œæ‰‹åŠ¨å®ç°ä¹è§‚é”åˆå¤æ‚ã€‚è€Œ PostgreSQL çš„åˆ—é‡Œæœ‰éšè—çš„ä¹è§‚é” version å­—æ®µï¼Œé»˜è®¤çš„ repeatable read çº§åˆ«å°±èƒ½ä¿è¯å¹¶å‘æ›´æ–°çš„æ­£ç¡®æ€§ï¼Œå¹¶ä¸”åˆæœ‰ä¹è§‚é”çš„æ€§èƒ½ã€‚ æ—¶é—´ç²¾åº¦æ›´é«˜ï¼Œå¯ä»¥ç²¾ç¡®åˆ°ç§’ä»¥ä¸‹ å­—ç¬¦æ”¯æŒæ›´å¥½ï¼ŒMySQLé‡Œéœ€è¦utf8mb4æ‰èƒ½æ˜¾ç¤ºemojiï¼ŒPostgreSQLæ²¡è¿™ä¸ªå‘ å­˜å‚¨æ–¹å¼æ”¯æŒæ›´å¤§çš„æ•°æ®é‡ï¼ŒPostgreSQLä¸»è¡¨é‡‡ç”¨å †è¡¨å­˜æ”¾ï¼ŒMySQLé‡‡ç”¨ç´¢å¼•ç»„ç»‡è¡¨ï¼Œèƒ½å¤Ÿæ”¯æŒæ¯”MySQLæ›´å¤§çš„æ•°æ®é‡ã€‚ åºåˆ—æ”¯æŒæ›´å¥½ï¼ŒMySQLä¸æ”¯æŒå¤šä¸ªè¡¨ä»åŒä¸€ä¸ªåºåˆ—ä¸­å–idï¼Œè€ŒPostgreSQLå¯ä»¥ å¢åŠ åˆ—æ›´ç®€å•ï¼ŒMySQLè¡¨å¢åŠ åˆ—ï¼ŒåŸºæœ¬ä¸Šæ˜¯é‡å»ºè¡¨å’Œç´¢å¼•ï¼Œä¼šèŠ±å¾ˆé•¿æ—¶é—´ã€‚PostgreSQLè¡¨å¢åŠ åˆ—ï¼Œåªæ˜¯åœ¨æ•°æ®å­—å…¸ä¸­å¢åŠ è¡¨å®šä¹‰ï¼Œä¸ä¼šé‡å»ºè¡¨ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:2:9","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"ç¼“å­˜ NoSQL ","date":"2023-08-08","objectID":"/springboot_draft/:3:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å¼•å…¥ç¼“å­˜ ç¬¬ä¸€æ­¥ï¼šåœ¨pom.xmlä¸­å¼•å…¥cacheä¾èµ–ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-cache\u003c/artifactId\u003e \u003c/dependency\u003e ç¬¬äºŒæ­¥ï¼šåœ¨Spring Bootä¸»ç±»ä¸­å¢åŠ @EnableCachingæ³¨è§£å¼€å¯ç¼“å­˜åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š @EnableCaching @SpringBootApplication public class Chapter51Application { public static void main(String[] args) { SpringApplication.run(Chapter51Application.class, args); } } ç¬¬ä¸‰æ­¥ï¼šåœ¨æ•°æ®è®¿é—®æ¥å£ä¸­ï¼Œå¢åŠ ç¼“å­˜é…ç½®æ³¨è§£ï¼Œå¦‚ï¼š @CacheConfig(cacheNames = \"users\") public interface UserRepository extends JpaRepository\u003cUser, Long\u003e { @Cacheable User findByName(String name); } ","date":"2023-08-08","objectID":"/springboot_draft/:3:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Redis å‘å¸ƒè®¢é˜…æ¨¡å¼æ¯”è§‚å¯Ÿè€…æ¨¡å¼å¤šäº†ä¸€ä¸ªä¸­é—´å±‚ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:3:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"MongoDB MongoDBæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯åœ¨é”®/å€¼å­˜å‚¨æ–¹å¼ï¼ˆæä¾›äº†é«˜æ€§èƒ½å’Œé«˜åº¦ä¼¸ç¼©æ€§ï¼‰å’Œä¼ ç»Ÿçš„RDBMSç³»ç»Ÿï¼ˆå…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½ï¼‰ä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ï¼Œå®ƒé›†ä¸¤è€…çš„ä¼˜åŠ¿äºä¸€èº«ã€‚ MongoDBæ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼jsonçš„bsonæ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå› ä¸ºä»–çš„å­˜å‚¨æ ¼å¼ä¹Ÿä½¿å¾—å®ƒæ‰€å­˜å‚¨çš„æ•°æ®åœ¨Nodejsç¨‹åºåº”ç”¨ä¸­ä½¿ç”¨éå¸¸æµç•…ã€‚ è¾ƒå¸¸è§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨MongoDBæ¥å­˜å‚¨é”®å€¼å¯¹ç±»å‹çš„æ•°æ®ï¼Œå¦‚ï¼šéªŒè¯ç ã€Sessionç­‰ï¼›ç”±äºMongoDBçš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®è§„æ¨¡ä¼šåœ¨æœªæ¥å˜çš„éå¸¸å·¨å¤§çš„æ•°æ®ï¼Œå¦‚ï¼šæ—¥å¿—ã€è¯„è®ºç­‰ï¼›ç”±äºMongoDBå­˜å‚¨æ•°æ®çš„å¼±ç±»å‹ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨ä¸€äº›å¤šå˜jsonæ•°æ®ï¼Œå¦‚ï¼šä¸å¤–ç³»ç»Ÿäº¤äº’æ—¶ç»å¸¸å˜åŒ–çš„JSONæŠ¥æ–‡ã€‚è€Œå¯¹äºä¸€äº›å¯¹æ•°æ®æœ‰å¤æ‚çš„é«˜äº‹åŠ¡æ€§è¦æ±‚çš„æ“ä½œï¼Œå¦‚ï¼šè´¦æˆ·äº¤æ˜“ç­‰å°±ä¸é€‚åˆä½¿ç”¨MongoDBæ¥å­˜å‚¨ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:3:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"LDAP = Lightweight Directory Access Protocol è½»é‡çº§ç›®å½•è®¿é—®åè®®æ˜¯å®ç°æä¾›è¢«ç§°ä¸ºç›®å½•æœåŠ¡çš„ä¿¡æ¯æœåŠ¡ã€‚ç›®å½•æœåŠ¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ç³»ç»Ÿï¼Œå…¶ä¸“é—¨é’ˆå¯¹è¯»å–ï¼Œæµè§ˆå’Œæœç´¢æ“ä½œè¿›è¡Œäº†ç‰¹å®šçš„ä¼˜åŒ–ã€‚ç›®å½•ä¸€èˆ¬ç”¨æ¥åŒ…å«æè¿°æ€§çš„ï¼ŒåŸºäºå±æ€§çš„ä¿¡æ¯å¹¶æ”¯æŒç²¾ç»†å¤æ‚çš„è¿‡æ»¤èƒ½åŠ›ã€‚ç›®å½•ä¸€èˆ¬ä¸æ”¯æŒé€šç”¨æ•°æ®åº“é’ˆå¯¹å¤§é‡æ›´æ–°æ“ä½œæ“ä½œéœ€è¦çš„å¤æ‚çš„äº‹åŠ¡ç®¡ç†æˆ–å›å·ç­–ç•¥ã€‚è€Œç›®å½•æœåŠ¡çš„æ›´æ–°åˆ™ä¸€èˆ¬éƒ½éå¸¸ç®€å•ã€‚è¿™ç§ç›®å½•å¯ä»¥å­˜å‚¨åŒ…æ‹¬ä¸ªäººä¿¡æ¯ã€webé“¾ç»“ã€jpegå›¾åƒç­‰å„ç§ä¿¡æ¯ã€‚ä¸ºäº†è®¿é—®å­˜å‚¨åœ¨ç›®å½•ä¸­çš„ä¿¡æ¯ï¼Œå°±éœ€è¦ä½¿ç”¨è¿è¡Œåœ¨TCP/IP ä¹‹ä¸Šçš„è®¿é—®åè®®â€”LDAPã€‚ oï¼šorganizationï¼ˆç»„ç»‡-å…¬å¸ï¼‰ ouï¼šorganization unitï¼ˆç»„ç»‡å•å…ƒ-éƒ¨é—¨ï¼‰ cï¼šcountryNameï¼ˆå›½å®¶ï¼‰ dcï¼šdomainComponentï¼ˆåŸŸåï¼‰ snï¼šsurnameï¼ˆå§“æ°ï¼‰ cnï¼šcommon nameï¼ˆå¸¸ç”¨åç§°ï¼‰ ","date":"2023-08-08","objectID":"/springboot_draft/:3:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"æ—¶åºæ•°æ®åº“InfluxDB æ—¶é—´åºåˆ—æ•°æ®åº“ä¸»è¦ç”¨äºæŒ‡å¤„ç†å¸¦æ—¶é—´æ ‡ç­¾ï¼ˆæŒ‰ç…§æ—¶é—´çš„é¡ºåºå˜åŒ–ï¼Œå³æ—¶é—´åºåˆ—åŒ–ï¼‰çš„æ•°æ®ï¼Œå¸¦æ—¶é—´æ ‡ç­¾çš„æ•°æ®ä¹Ÿç§°ä¸ºæ—¶é—´åºåˆ—æ•°æ®ã€‚ æ—¶é—´åºåˆ—æ•°æ®ä¸»è¦ç”±ç”µåŠ›è¡Œä¸šã€åŒ–å·¥è¡Œä¸šç­‰å„ç±»å‹å®æ—¶ç›‘æµ‹ã€æ£€æŸ¥ä¸åˆ†æè®¾å¤‡æ‰€é‡‡é›†ã€äº§ç”Ÿçš„æ•°æ®ï¼Œè¿™äº›å·¥ä¸šæ•°æ®çš„å…¸å‹ç‰¹ç‚¹æ˜¯ï¼šäº§ç”Ÿé¢‘ç‡å¿«ï¼ˆæ¯ä¸€ä¸ªç›‘æµ‹ç‚¹ä¸€ç§’é’Ÿå†…å¯äº§ç”Ÿå¤šæ¡æ•°æ®ï¼‰ã€ä¸¥é‡ä¾èµ–äºé‡‡é›†æ—¶é—´ï¼ˆæ¯ä¸€æ¡æ•°æ®å‡è¦æ±‚å¯¹åº”å”¯ä¸€çš„æ—¶é—´ï¼‰ã€æµ‹ç‚¹å¤šä¿¡æ¯é‡å¤§ï¼ˆå¸¸è§„çš„å®æ—¶ç›‘æµ‹ç³»ç»Ÿå‡æœ‰æˆåƒä¸Šä¸‡çš„ç›‘æµ‹ç‚¹ï¼Œç›‘æµ‹ç‚¹æ¯ç§’é’Ÿéƒ½äº§ç”Ÿæ•°æ®ï¼Œæ¯å¤©äº§ç”Ÿå‡ åGBçš„æ•°æ®é‡ï¼‰ å‡ ä¸ªé‡è¦åè¯ï¼š databaseï¼šæ•°æ®åº“ measurementï¼šç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„tableï¼ˆè¡¨ï¼‰ pointsï¼šç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„rowï¼ˆä¸€è¡Œæ•°æ®ï¼‰ timeï¼šæ—¶é—´æˆ³ fieldsï¼šè®°å½•çš„å€¼ tagsï¼šç´¢å¼•çš„å±æ€§ ","date":"2023-08-08","objectID":"/springboot_draft/:3:5","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Web å¼€å‘ ","date":"2023-08-08","objectID":"/springboot_draft/:4:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Thymeleaf å®ƒæ˜¯ä¸€ä¸ªXML/XHTML/HTML5æ¨¡æ¿å¼•æ“ï¼Œå¯ç”¨äºWebä¸éWebç¯å¢ƒä¸­çš„åº”ç”¨å¼€å‘ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„Javaåº“ï¼ŒåŸºäºApache License 2.0è®¸å¯ï¼Œç”±Daniel FernÃ¡ndezåˆ›å»ºï¼Œè¯¥ä½œè€…è¿˜æ˜¯JavaåŠ å¯†åº“Jasyptçš„ä½œè€…ã€‚ Thymeleafæä¾›äº†ä¸€ä¸ªç”¨äºæ•´åˆSpring MVCçš„å¯é€‰æ¨¡å—ï¼Œåœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨Thymeleafæ¥å®Œå…¨ä»£æ›¿JSPæˆ–å…¶ä»–æ¨¡æ¿å¼•æ“ï¼Œå¦‚Velocityã€FreeMarkerç­‰ã€‚Thymeleafçš„ä¸»è¦ç›®æ ‡åœ¨äºæä¾›ä¸€ç§å¯è¢«æµè§ˆå™¨æ­£ç¡®æ˜¾ç¤ºçš„ã€æ ¼å¼è‰¯å¥½çš„æ¨¡æ¿åˆ›å»ºæ–¹å¼ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨ä½œé™æ€å»ºæ¨¡ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒåˆ›å»ºç»è¿‡éªŒè¯çš„XMLä¸HTMLæ¨¡æ¿ã€‚ç›¸å¯¹äºç¼–å†™é€»è¾‘æˆ–ä»£ç ï¼Œå¼€å‘è€…åªéœ€å°†æ ‡ç­¾å±æ€§æ·»åŠ åˆ°æ¨¡æ¿ä¸­å³å¯ã€‚æ¥ä¸‹æ¥ï¼Œè¿™äº›æ ‡ç­¾å±æ€§å°±ä¼šåœ¨DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ä¸Šæ‰§è¡Œé¢„å…ˆåˆ¶å®šå¥½çš„é€»è¾‘ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:4:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å•å…ƒæµ‹è¯• å…¥é—¨ä¾‹å­ @SpringBootTest public class Chapter11ApplicationTests { private MockMvc mvc; @Before public void setUp() { mvc = MockMvcBuilders.standaloneSetup(new HelloController()).build(); } @Test public void getHello() throws Exception { mvc.perform(MockMvcRequestBuilders.get(\"/hello\").accept(MediaType.APPLICATION_JSON)) .andExpect(status().isOk()) .andExpect(content().string(equalTo(\"Hello World\"))); } } å¯¹äºæ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯httpè¯·æ±‚çš„å¤„ç†ï¼Œæ‰€ä»¥MockMvcä¾ç„¶é€ƒä¸æ‰ï¼Œå°±æ˜¯ä¸Šä¼ å†…å®¹å‘ç”Ÿäº†æ”¹å˜ï¼Œæˆ‘ä»¬åªéœ€è¦å»æ‰¾ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ çš„æ¨¡æ‹Ÿå¯¹è±¡æ˜¯å“ªä¸ªï¼Œå°±å¯ä»¥è½»æ¾å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚å…·ä½“å†™æ³•å¦‚ä¸‹ï¼š @SpringBootTest(classes = Chapter43Application.class) public class FileTest { @Autowired protected WebApplicationContext context; protected MockMvc mvc; @BeforeEach public void setUp() { mvc = MockMvcBuilders.webAppContextSetup(context).build(); } @Test public void uploadFile() throws Exception { MockMultipartFile file = new MockMultipartFile( \"file\", \"hello.txt\", MediaType.TEXT_PLAIN_VALUE, \"Hello, World!\".getBytes() ); final MvcResult result = mvc.perform( MockMvcRequestBuilders .multipart(\"/upload\") .file(file)) .andDo(print()) .andExpect(status().isOk()) .andReturn(); } } å¯ä»¥çœ‹åˆ°MockMvcçš„æµ‹è¯•ä¸»ä½“æ˜¯ä¸å˜çš„ï¼Œæ— éå°±æ˜¯è¯·æ±‚ç±»å‹å’Œè¯·æ±‚å†…å®¹å‘ç”Ÿäº†æ”¹å˜ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:4:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å®šæ—¶ä»»åŠ¡ Springbootè‡ªå¸¦çš„@Scheduled åœ¨Spring Bootçš„ä¸»ç±»ä¸­åŠ å…¥@EnableSchedulingæ³¨è§£ï¼Œå¯ç”¨å®šæ—¶ä»»åŠ¡çš„é…ç½® @SpringBootApplication @EnableScheduling public class Application { public static void main(String[] args) { SpringApplication.run(Application.class, args); } } åˆ›å»ºå®šæ—¶ä»»åŠ¡å®ç°ç±» @Component public class ScheduledTasks { private static final SimpleDateFormat dateFormat = new SimpleDateFormat(\"HH:mm:ss\"); @Scheduled(fixedRate = 5000) public void reportCurrentTime() { log.info(\"ç°åœ¨æ—¶é—´ï¼š\" + dateFormat.format(new Date())); } } è¿™ç§æ¨¡å¼å®ç°çš„å®šæ—¶ä»»åŠ¡ç¼ºå°‘åœ¨é›†ç¾¤ç¯å¢ƒä¸‹çš„åè°ƒæœºåˆ¶ã€‚è§£å†³è¿™æ ·é—®é¢˜çš„æ–¹å¼å¾ˆå¤šç§ï¼Œæ¯”è¾ƒé€šç”¨çš„å°±æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æ–¹å¼ï¼Œè®©åŒç±»ä»»åŠ¡ä¹‹å‰çš„æ—¶å€™ä»¥åˆ†å¸ƒå¼é”çš„æ–¹å¼æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œæ¯”å¦‚ï¼šä½¿ç”¨Redisã€Zookeeperç­‰å…·å¤‡åˆ†å¸ƒå¼é”åŠŸèƒ½çš„ä¸­é—´ä»¶é…åˆå°±èƒ½å¾ˆå¥½çš„å¸®åŠ©æˆ‘ä»¬æ¥åè°ƒè¿™ç±»ä»»åŠ¡åœ¨é›†ç¾¤æ¨¡å¼ä¸‹çš„æ‰§è¡Œè§„åˆ™ã€‚ Elastic Job Elastic Jobçš„å‰ç”Ÿæ˜¯å½“å½“å¼€æºçš„ä¸€æ¬¾åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œè€Œç›®å‰å·²ç»åŠ å…¥åˆ°äº†ApacheåŸºé‡‘ä¼šã€‚ pom.xmlä¸­æ·»åŠ elasticjob-liteçš„starter \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.shardingsphere.elasticjob\u003c/groupId\u003e \u003cartifactId\u003eelasticjob-lite-spring-boot-starter\u003c/artifactId\u003e \u003cversion\u003e3.0.0\u003c/version\u003e \u003c/dependency\u003e // ... \u003c/dependencies\u003e åˆ›å»ºä¸€ä¸ªç®€å•ä»»åŠ¡ @Slf4j @Service public class MySimpleJob implements SimpleJob { @Override public void execute(ShardingContext context) { log.info(\"MySimpleJob start : didispace.com {}\", System.currentTimeMillis()); } } ç¼–è¾‘é…ç½®æ–‡ä»¶ (properties) elasticjob.reg-center.server-lists=localhost:2181 elasticjob.reg-center.namespace=${spring.application.name} elasticjob.jobs.my-simple-job.elastic-job-class=com.didispace.chapter72.MySimpleJob elasticjob.jobs.my-simple-job.cron=0/5 * * * * ? elasticjob.jobs.my-simple-job.sharding-total-count=1 è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š ç¬¬ä¸€éƒ¨åˆ†ï¼šelasticjob.reg-centerå¼€å¤´çš„ï¼Œä¸»è¦é…ç½®elastic jobçš„æ³¨å†Œä¸­å¿ƒå’Œnamespace ç¬¬äºŒéƒ¨åˆ†ï¼šä»»åŠ¡é…ç½®ï¼Œä»¥elasticjob.jobså¼€å¤´ï¼Œè¿™é‡Œçš„my-simple-jobæ˜¯ä»»åŠ¡çš„åç§°ï¼Œæ ¹æ®ä½ çš„å–œå¥½å‘½åå³å¯ï¼Œä½†ä¸è¦é‡å¤ã€‚ä»»åŠ¡çš„ä¸‹çš„é…ç½®elastic-job-classæ˜¯ä»»åŠ¡çš„å®ç°ç±»ï¼Œcronæ˜¯æ‰§è¡Œè§„åˆ™è¡¨è¾¾å¼ï¼Œsharding-total-countæ˜¯ä»»åŠ¡åˆ†ç‰‡çš„æ€»æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æ¥æŠŠä»»åŠ¡åˆ‡åˆ†ï¼Œå®ç°å¹¶è¡Œå¤„ç†ã€‚ç”±äºæˆ‘ä»¬è®¾ç½®äº†åˆ†ç‰‡æ€»æ•°ä¸º1ï¼Œæ‰€ä»¥è¿™ä¸ªä»»åŠ¡å¯åŠ¨ä¹‹åï¼Œåªä¼šæœ‰ä¸€ä¸ªå®ä¾‹æ¥ç®¡æ‰§è¡Œã€‚è¿™æ ·å°±é¿å…äº†å¤šä¸ªè¿›è¡ŒåŒæ—¶é‡å¤çš„æ‰§è¡Œç›¸åŒé€»è¾‘è€Œäº§ç”Ÿé—®é¢˜çš„æƒ…å†µã€‚åŒæ—¶ï¼Œè¿™æ ·ä¹Ÿæ”¯æŒäº†ä»»åŠ¡æ‰§è¡Œçš„é«˜å¯ç”¨ã€‚ åœ¨æ•´ä¸ªå®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è‡ªå·±æ‰‹å·¥çš„å»ç¼–å†™ä»»ä½•çš„åˆ†å¸ƒå¼é”ç­‰ä»£ç å»å®ç°ä»»åŠ¡è°ƒåº¦é€»è¾‘ï¼Œåªéœ€è¦å…³æ³¨ä»»åŠ¡é€»è¾‘æœ¬èº«ï¼Œç„¶åé€šè¿‡é…ç½®åˆ†ç‰‡çš„æ–¹å¼æ¥æ§åˆ¶ä»»åŠ¡çš„åˆ†å‰²ï¼Œå°±å¯ä»¥è½»æ¾çš„å®ç°åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒä¸‹çš„å®šæ—¶ä»»åŠ¡ç®¡ç†äº†ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:4:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å¼‚æ­¥ä»»åŠ¡ ä¸ºäº†è®©@Asyncæ³¨è§£èƒ½å¤Ÿç”Ÿæ•ˆï¼Œéœ€è¦åœ¨Spring Bootçš„ä¸»ç¨‹åºä¸­é…ç½®@EnableAsync @Async æ‰€ä¿®é¥°çš„å‡½æ•°ä¸è¦å®šä¹‰ä¸ºstaticç±»å‹ï¼Œè¿™æ ·å¼‚æ­¥è°ƒç”¨ä¸ä¼šç”Ÿæ•ˆ å¼‚æ­¥å›è°ƒ @Test public void test() throws Exception { long start = System.currentTimeMillis(); CompletableFuture\u003cString\u003e task1 = asyncTasks.doTaskOne(); CompletableFuture\u003cString\u003e task2 = asyncTasks.doTaskTwo(); CompletableFuture\u003cString\u003e task3 = asyncTasks.doTaskThree(); CompletableFuture.allOf(task1, task2, task3).join(); long end = System.currentTimeMillis(); log.info(\"ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œæ€»è€—æ—¶ï¼š\" + (end - start) + \"æ¯«ç§’\"); } é»˜è®¤çº¿ç¨‹æ± å‚æ•° spring.task.execution.pool.core-sizeï¼šçº¿ç¨‹æ± åˆ›å»ºæ—¶çš„åˆå§‹åŒ–çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º8 spring.task.execution.pool.max-sizeï¼šçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸ºintæœ€å¤§å€¼ spring.task.execution.pool.queue-capacityï¼šç”¨æ¥ç¼“å†²æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œé»˜è®¤ä¸ºintæœ€å¤§å€¼ spring.task.execution.pool.keep-aliveï¼šçº¿ç¨‹ç»ˆæ­¢å‰å…è®¸ä¿æŒç©ºé—²çš„æ—¶é—´ spring.task.execution.pool.allow-core-thread-timeoutï¼šæ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶ spring.task.execution.shutdown.await-terminationï¼šæ˜¯å¦ç­‰å¾…å‰©ä½™ä»»åŠ¡å®Œæˆåæ‰å…³é—­åº”ç”¨ spring.task.execution.shutdown.await-termination-periodï¼šç­‰å¾…å‰©ä½™ä»»åŠ¡å®Œæˆçš„æœ€å¤§æ—¶é—´ spring.task.execution.thread-name-prefixï¼šçº¿ç¨‹åçš„å‰ç¼€ï¼Œè®¾ç½®å¥½äº†ä¹‹åå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬åœ¨æ—¥å¿—ä¸­æŸ¥çœ‹å¤„ç†ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹æ±  çº¿ç¨‹æ± éš”ç¦» ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–å¤šä¸ªçº¿ç¨‹æ± ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š @EnableAsync @Configuration public class TaskPoolConfig { @Bean public Executor taskExecutor1() { ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(2); executor.setMaxPoolSize(2); executor.setQueueCapacity(10); executor.setKeepAliveSeconds(60); executor.setThreadNamePrefix(\"executor-1-\"); executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); return executor; } @Bean public Executor taskExecutor2() { ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(2); executor.setMaxPoolSize(2); executor.setQueueCapacity(10); executor.setKeepAliveSeconds(60); executor.setThreadNamePrefix(\"executor-2-\"); executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); return executor; } } æ³¨æ„ï¼šè¿™é‡Œç‰¹åœ°ç”¨executor.setThreadNamePrefixè®¾ç½®äº†çº¿ç¨‹åçš„å‰ç¼€ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿è§‚å¯Ÿåé¢å…·ä½“æ‰§è¡Œçš„é¡ºåºã€‚ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶æŒ‡å®šè¦ä½¿ç”¨çš„çº¿ç¨‹æ± åç§° @Slf4j @Component public class AsyncTasks { public static Random random = new Random(); @Async(\"taskExecutor1\") public CompletableFuture\u003cString\u003e doTaskOne(String taskNo) throws Exception { log.info(\"å¼€å§‹ä»»åŠ¡ï¼š{}\", taskNo); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); log.info(\"å®Œæˆä»»åŠ¡ï¼š{}ï¼Œè€—æ—¶ï¼š{} æ¯«ç§’\", taskNo, end - start); return CompletableFuture.completedFuture(\"ä»»åŠ¡å®Œæˆ\"); } @Async(\"taskExecutor2\") public CompletableFuture\u003cString\u003e doTaskTwo(String taskNo) throws Exception { log.info(\"å¼€å§‹ä»»åŠ¡ï¼š{}\", taskNo); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); log.info(\"å®Œæˆä»»åŠ¡ï¼š{}ï¼Œè€—æ—¶ï¼š{} æ¯«ç§’\", taskNo, end - start); return CompletableFuture.completedFuture(\"ä»»åŠ¡å®Œæˆ\"); } } è¿™é‡Œ@Asyncæ³¨è§£ä¸­å®šä¹‰çš„taskExecutor1å’ŒtaskExecutor2å°±æ˜¯çº¿ç¨‹æ± çš„åå­—ã€‚ç”±äºåœ¨ç¬¬ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å…·ä½“å†™ä¸¤ä¸ªçº¿ç¨‹æ± Beançš„åç§°ï¼Œæ‰€ä»¥é»˜è®¤ä¼šä½¿ç”¨æ–¹æ³•åï¼Œä¹Ÿå°±æ˜¯taskExecutor1å’ŒtaskExecutor2ã€‚ çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ AbortPolicyç­–ç•¥ï¼šé»˜è®¤ç­–ç•¥ï¼Œå¦‚æœçº¿ç¨‹æ± é˜Ÿåˆ—æ»¡äº†ä¸¢æ‰è¿™ä¸ªä»»åŠ¡å¹¶ä¸”æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ DiscardPolicyç­–ç•¥ï¼šå¦‚æœçº¿ç¨‹æ± é˜Ÿåˆ—æ»¡äº†ï¼Œä¼šç›´æ¥ä¸¢æ‰è¿™ä¸ªä»»åŠ¡å¹¶ä¸”ä¸ä¼šæœ‰ä»»ä½•å¼‚å¸¸ã€‚ DiscardOldestPolicyç­–ç•¥ï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šå°†æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„ä»»åŠ¡åˆ æ‰è…¾å‡ºç©ºé—´ï¼Œå†å°è¯•åŠ å…¥é˜Ÿåˆ—ã€‚ CallerRunsPolicyç­–ç•¥ï¼šå¦‚æœæ·»åŠ åˆ°çº¿ç¨‹æ± å¤±è´¥ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¼šè‡ªå·±å»æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œä¸ä¼šç­‰å¾…çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å»æ‰§è¡Œã€‚ è€Œå¦‚æœä½ è¦è‡ªå®šä¹‰ä¸€ä¸ªæ‹’ç»ç­–ç•¥ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š executor.setRejectedExecutionHandler(new RejectedExecutionHandler() { @Override public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) { // æ‹’ç»ç­–ç•¥çš„é€»è¾‘ } }); å½“ç„¶å¦‚æœä½ å–œæ¬¢ç”¨Lambaè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š executor.setRejectedExecutionHandler((r, executor1) -\u003e { // æ‹’ç»ç­–ç•¥çš„é€»è¾‘ }); ","date":"2023-08-08","objectID":"/springboot_draft/:4:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Spring ç®€åŒ–æ•°æ®è®¿é—®çš„Spring Data æä¾›æ‰¹å¤„ç†èƒ½åŠ›çš„Spring Batch ç”¨äºä¿æŠ¤åº”ç”¨å®‰å…¨çš„Spring Security ","date":"2023-08-08","objectID":"/springboot_draft/:5:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"è‡ªåŠ¨è£…é…åŸç† ","date":"2023-08-08","objectID":"/springboot_draft/:6:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"ä¸»å¯åŠ¨å™¨ @SpringBootApplication @SpringBootConfiguration @Configuration @Component @EnableAutoConfiguration è‡ªåŠ¨å¯¼å…¥åŒ…ğŸŒŸ @AutoConfigurationPackage @Import(AutoConfigurationPackages.Registrar.class) @Import(AutoConfigurationImportSelector.class) è‡ªåŠ¨æ³¨å†ŒåŒ… getAutoConfigurationEntry(â€¦) è·å–è‡ªåŠ¨é…ç½®çš„å®ä½“ org.springframework.boot:springboot-auto-configure/META-INF/spring.factoriesæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½åœ¨è¿™é‡ŒğŸŒŸ XXXAutoConfigurationï¼šå‘å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ xxxPropertiesï¼šè‡ªåŠ¨é…ç½®ç±»ï¼Œè£…é…é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰çš„ä¸€äº›å†…å®¹ @ConditionalOnXXX é€‰æ‹©æ€§ç”Ÿæ•ˆ @ComponentScan æ‰«æå½“å‰ä¸»å¯åŠ¨ç±»åŒçº§çš„åŒ… ç»“è®ºï¼šSpringBootæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®éƒ½åœ¨å¯åŠ¨çš„æ—¶å€™æ‰«æå¹¶åŠ è½½ï¼Œåªæœ‰å¯¼å…¥å¯¹åº”çš„ start ï¼Œé€šè¿‡å¯åŠ¨å™¨è‡ªåŠ¨è£…é…æ‰ä¼šç”Ÿæ•ˆã€‚xxxConfiguration æ˜¯ç”¨äºæ‰©å±•çš„ã€‚ ","date":"2023-08-08","objectID":"/springboot_draft/:6:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å®ä½“ç±»æ˜ å°„ yaml @Component @ConfigurationProperties(prefix = \"spring.datasource\") æ¾æ•£ç»‘å®šï¼šlast-nameå¯ä»¥æ˜ å°„ä¸º lastName åœ¨ymlä¸­èƒ½é…ç½®çš„æ–‡ä»¶ï¼Œéƒ½å­˜åœ¨xxxPropertiesæ–‡ä»¶ï¼Œåœ¨å¯¹åº”çš„xxxAutoConfigurationå­˜åœ¨é»˜è®¤å€¼ ","date":"2023-08-08","objectID":"/springboot_draft/:6:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"é™æ€èµ„æº localhost:8080/webjars/xxx localhost:8080/xxx resources\u003estatic(é»˜è®¤)\u003epublic ","date":"2023-08-08","objectID":"/springboot_draft/:6:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Thymeleaf ç®€å•çš„è¡¨è¾¾ï¼š å˜é‡è¡¨è¾¾å¼ï¼š ${â€¦} é€‰æ‹©å˜é‡è¡¨è¾¾å¼ï¼š *{â€¦} \u003cdiv th:object=\"${session.user}\"\u003e \u003cp\u003eName: \u003cspan th:text=\"*{firstName}\"\u003eSebastian\u003c/span\u003e.\u003c/p\u003e \u003cp\u003eSurname: \u003cspan th:text=\"*{lastName}\"\u003ePepper\u003c/span\u003e.\u003c/p\u003e \u003cp\u003eNationality: \u003cspan th:text=\"*{nationality}\"\u003eSaturn\u003c/span\u003e.\u003c/p\u003e \u003c/div\u003e æ¶ˆæ¯è¡¨è¾¾ï¼š #{â€¦} [[#{login.btn}]] i18né…ç½®é¡µé¢å›½é™…åŒ– i18n = internationalization k8s = kubernetes é“¾æ¥ URL è¡¨è¾¾å¼ï¼š @{â€¦} æ‰€æœ‰é¡µé¢çš„é™æ€èµ„æºéƒ½éœ€è¦ä½¿ç”¨ thymeleaf æ¥ç®¡ ç‰‡æ®µè¡¨è¾¾å¼ï¼š ~{â€¦} \u003cdiv th:replace=\"~{dashboard::topbar}\"\u003e\u003c/div\u003e \u003cdiv th:insert=\"~{dashboard::sidebar(active='list.html')}\"\u003e\u003c/div\u003e å…¶ä»–ç¤ºä¾‹ï¼š \u003cp th:if=\"${not #strings.isEmpty(msg)}\"\u003e123\u003c/p\u003e \u003ctr th:each=\"emp:${emps}\"\u003e \u003ctd th:text=\"${emp.getId()}\"/\u003e \u003ctd\u003e[[${emp.getLastName()}]]\u003c/td\u003e \u003ctd th:text=\"${emp.getGender()==0?'å¥³':'ç”·'}\"/\u003e \u003ctd th:text=\"${#dates.format(emp.getBirth(),'yyyy-MM-dd')}\"/\u003e \u003ctd\u003e \u003cbutton class=\"btn btn-sm btn-primary\"\u003eç¼–è¾‘\u003c/button\u003e \u003cbutton class=\"btn btn-sm btn-danger\"\u003eåˆ é™¤\u003c/button\u003e \u003c/td\u003e \u003c/tr\u003e ","date":"2023-08-08","objectID":"/springboot_draft/:6:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"å…¶ä»– è½¯ä»¶å¼€å‘ï¼š å‰ç«¯ è®¾è®¡æ•°æ®åº“ æ¥å£å¯¹æ¥ï¼šjsonã€å¯¹è±¡ å‰åç«¯è”è°ƒ å¼€å‘è¦æ±‚ï¼š æœ‰ä¸€å¥—è‡ªå·±ç†Ÿæ‚‰çš„åå°æ¨¡æ¿ï¼ˆæ¨èx-adminï¼‰ å‰ç«¯ç•Œé¢ï¼šè‡³å°‘è‡ªå·±é€šè¿‡å‰ç«¯æ¡†æ¶ï¼Œç»„åˆå‡ºæ¥ä¸€ä¸ªç½‘ç«™é¡µé¢ index about blog post user è®©è¿™ä¸ªç½‘ç«™èƒ½ç‹¬ç«‹è¿è¡Œ ","date":"2023-08-08","objectID":"/springboot_draft/:6:5","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"SpringSecurity SecurityConfig.java @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { /** * è®¤è¯ * åœ¨ Spring Security 5.0+ æ–°å¢äº†åŠ å¯†æ–¹æ³•ï¼Œå¿…é¡»ä½¿ç”¨ï¼Œå¦åˆ™æŠ¥é”™ï¼š There is no PasswordEncoder mapped for the id \"null\" */ @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder()) .withUser(\"josh\").password(new BCryptPasswordEncoder().encode(\"josh\")).roles(\"vip2\", \"vip3\") .and() .withUser(\"root\").password(new BCryptPasswordEncoder().encode(\"123456\")).roles(\"vip1\", \"vip2\", \"vip3\") .and() .withUser(\"guest\").password(new BCryptPasswordEncoder().encode(\"123456\")).roles(\"vip1\"); } /** * æˆæƒ */ @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() // é¦–é¡µæ‰€æœ‰äººå¯ä»¥è®¿é—® .antMatchers(\"/\").permitAll() // åŠŸèƒ½é¡µæœ‰æƒé™çš„äººæ‰èƒ½è®¿é—® .antMatchers(\"/level1/**\").hasRole(\"vip1\") .antMatchers(\"/level2/**\").hasRole(\"vip2\") .antMatchers(\"/level3/**\").hasRole(\"vip3\") .and() // æ²¡æœ‰æƒé™è·³è½¬ç™»å½•é¡µé¢ .formLogin().loginPage(\"/toLogin\").loginProcessingUrl(\"/login\") .usernameParameter(\"user\").passwordParameter(\"pwd\") .and() // å¼€å¯æ³¨é”€åŠŸèƒ½ .logout().logoutSuccessUrl(\"/\") .and() // å¼€å¯è®°ä½æˆ‘åŠŸèƒ½ cookie é»˜è®¤ä¿å­˜ä¸¤å‘¨ .rememberMe().rememberMeParameter(\"remember\") .and() //å…³é—­ csrf è·¨ç«™è¯·æ±‚è„šæœ¬æ”»å‡» .csrf().disable(); } } ","date":"2023-08-08","objectID":"/springboot_draft/:7:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Shiro Tutorial.java public class Tutorial { private static final transient Logger log = LoggerFactory.getLogger(Tutorial.class); public static void main(String[] args) { log.info(\"My First Apache Shiro Application\"); Factory\u003cSecurityManager\u003e factory = new IniSecurityManagerFactory(\"classpath:shiro.ini\"); SecurityManager securityManager = factory.getInstance(); SecurityUtils.setSecurityManager(securityManager); /** * 1ã€è·å–å½“å‰ç”¨æˆ·å¯¹è±¡ */ Subject currentUser = SecurityUtils.getSubject(); /** * 2ã€ é€šè¿‡å½“å‰ç”¨æˆ·æ‹¿åˆ° session å¹¶å¯¹å…¶æ“ä½œ */ Session session = currentUser.getSession(); session.setAttribute(\"someKey\", \"aValue\"); String value = (String) session.getAttribute(\"someKey\"); /** * 3ã€ åˆ¤æ–­å½“å‰çš„ç”¨æˆ·æ˜¯å¦è¢«è®¤è¯ */ final boolean authenticated = currentUser.isAuthenticated(); /** * 4ã€ ç”¨æˆ·ä¿¡æ¯ */ final Object principal = currentUser.getPrincipal(); /** * 5ã€ æµ‹è¯•è§’è‰² */ final boolean schwartz = currentUser.hasRole(\"schwartz\"); /** * 6-1ã€ æµ‹è¯•æƒé™ - ç²—åŠ›åº¦ */ final boolean permitted = currentUser.isPermitted(\"lightsaber:wield\"); /** * 6-2ã€ æµ‹è¯•æƒé™ - ç»†åŠ›åº¦ */ final boolean permitted2 = currentUser.isPermitted(\"winnebago:drive:eagle5\"); /** * 7ã€ æ³¨é”€ */ currentUser.logout(); System.exit(0); } } Shiro ä¸‰å¤§å¯¹è±¡ï¼š Subjectï¼šç”¨æˆ· SecurityManagerï¼šç®¡ç†æ‰€æœ‰ç”¨æˆ· Realmï¼šè¿æ¥æ•°æ® ShiroConfig.java @Configuration public class ShiroConfig { // 1ã€åˆ›å»º realm å¯¹è±¡ï¼Œéœ€è¦è‡ªå®šä¹‰ @Bean(name = \"userRealm\") public UserRealm userRealm() { return new UserRealm(); } //2ã€ DefaultWebSecurityManager @Bean(name = \"defaultWebSecurityManager\") public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier(\"userRealm\") UserRealm userRealm) { DefaultWebSecurityManager defaultWebSecurityManager = new DefaultWebSecurityManager(); // å…³è” userRealm defaultWebSecurityManager.setRealm(userRealm); return defaultWebSecurityManager; } //3ã€ ShiroFilterFactoryBean @Bean public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Qualifier(\"defaultWebSecurityManager\") DefaultWebSecurityManager defaultWebSecurityManager) { ShiroFilterFactoryBean bean = new ShiroFilterFactoryBean(); // è®¾ç½®å®‰å…¨ç®¡ç†å™¨ bean.setSecurityManager(defaultWebSecurityManager); // æ·»åŠ  Shiro çš„å†…ç½®è¿‡æ»¤å™¨ /** * anonï¼šæ— éœ€è®¤è¯å°±å¯ä»¥è®¿é—® * authcï¼šå¿…é¡»è®¤è¯æ‰èƒ½è®¿é—® * userï¼šå¿…é¡»æ‹¥æœ‰\"è®°ä½æˆ‘\"åŠŸèƒ½æ‰èƒ½è®¿é—® * permsï¼šå¿…é¡»æ‹¥æœ‰å¯¹æŸä¸ªèµ„æºå¯¹æƒé™æ‰èƒ½è®¿é—® * roleï¼šå¿…é¡»æ‹¥æœ‰æŸä¸ªè§’è‰²æƒé™æ‰èƒ½è®¿é—® */ Map\u003cString ,String \u003e filterChainDefinitionMap = new HashMap\u003c\u003e(); filterChainDefinitionMap.put(\"/userList\",\"authc\"); filterChainDefinitionMap.put(\"/user/add\",\"perms[user:add\"); bean.setFilterChainDefinitionMap(filterChainDefinitionMap); // ç™»å½•å¯¹è¯·æ±‚ bean.setLoginUrl(\"/toLogin\"); // æœªæˆæƒé¡µé¢ bean.setUnauthorizedUrl(\"/noauth\"); return bean; } // 4. æ•´åˆ shiro å’Œ thymeleaf @Bean public ShiroDialect getShiroDialect(){ return new ShiroDialect(); } } UserRealm public class UserRealm extends AuthorizingRealm { @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { System.out.println(\"æ‰§è¡Œäº†æˆæƒ=======ã€‹doGetAuthorizationInfo\"); final SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.addStringPermission(\"user:add\"); final String permission = (String) SecurityUtils.getSubject().getPrincipal(); info.addStringPermission(permission); return info ; } @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { System.out.println(\"æ‰§è¡Œäº†è®¤è¯=======ã€‹Override\"); String name = \"root\"; String permission = \"user:add\"; String password = \"123456\"; Subject subject = SecurityUtils.getSubject(); Session session = subject.getSession(); session.setAttribute(\"name\",name); UsernamePasswordToken usernamePasswordToken = (UsernamePasswordToken)token; if (!usernamePasswordToken.getUsername().equals(name)){ // è‡ªåŠ¨æŠ›å‡ºå¼‚å¸¸ return null; } // å¯†ç è®¤è¯ shiro è‡ªåŠ¨åš return new SimpleAuthenticationInfo(permission,password,\"\"); } } ","date":"2023-08-08","objectID":"/springboot_draft/:8:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Swagger2 SwaggerConfig.java @Configuration @EnableSwagger2 public class SwaggerConfig { @Bean public Docket docket(Environment environment) { // è®¾ç½®è¦æ˜¾ç¤ºçš„ Swagger ç¯å¢ƒ Profiles profiles = Profiles.of(\"dev\", \"test\"); // è·å–é¡¹ç›®çš„ç¯å¢ƒ final boolean flag = environment.acceptsProfiles(profiles); 1 return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .groupName(\"A\") .enable(flag) .select() // basePackageï¼šæŒ‡å®šè¦æ‰«æçš„åŒ… .apis(RequestHandlerSelectors.basePackage(\"edu.zjut.demospringboot.controller\")) // withMethodAnnotationï¼šåªæ‰«æé™å®šæ–¹æ³•æ³¨è§£ .apis(RequestHandlerSelectors.withMethodAnnotation(RestController.class)) // antï¼šåªæ‰«ææŒ‡å®šè·¯ç”±è·¯å¾„ .paths(PathSelectors.ant(\"/hello/**\")) .build(); } @Bean public Docket docket2(Environment environment) { return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .groupName(\"B\"); } @Bean public Docket docket3(Environment environment) { return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .groupName(\"C\"); } private ApiInfo apiInfo() { return new ApiInfo( \"xxxxAPIæ–‡æ¡£\", \"æ–‡æ¡£æè¿°\", \"v1.0\", \"zjut\", new Contact(\"josh\", \"\", \"dujianghui537885@163.com\"), \"Apach 2.0\", \"http://www.apache.org/licenses/LICENSE-2.0\", new ArrayList\u003c\u003e()); } } æ³¨æ„ï¼šåœ¨æ­£å¼å‘å¸ƒçš„æ—¶å€™ï¼Œå…³é—­Swaggerï¼ ","date":"2023-08-08","objectID":"/springboot_draft/:9:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"é‚®ä»¶å‘é€ \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-mail\u003c/artifactId\u003e \u003c/dependency\u003e @Autowired private JavaMailSenderImpl mailSender; /** * ç®€å•é‚®ä»¶å‘é€ */ @Test void simpleMailMessage() { SimpleMailMessage simpleMailMessage = new SimpleMailMessage(); simpleMailMessage.setSubject(\"ä½ å¥½å‘€ï½\"); simpleMailMessage.setText(\"æµ‹è¯•ä¸€ä¸‹é‚®ç®±\"); simpleMailMessage.setTo(\"2869314652@qq.com\"); simpleMailMessage.setFrom(\"2869314652@qq.com\"); mailSender.send(simpleMailMessage); } /** * å¤æ‚é‚®ä»¶å‘é€ * @throws MessagingException */ @Test void mimeMessage() throws MessagingException { final MimeMessage mimeMessage = mailSender.createMimeMessage(); final MimeMessageHelper helper = new MimeMessageHelper(mimeMessage,true); helper.setSubject(\"ä½ å¥½å‘€ï½plus\"); helper.setText(\"\u003cp style='color:red'\u003eæµ‹è¯•ä¸€ä¸‹é‚®ç®±\u003c/p\u003e\",true); helper.setTo(\"2869314652@qq.com\"); helper.setFrom(\"2869314652@qq.com\"); mailSender.send(mimeMessage); } ","date":"2023-08-08","objectID":"/springboot_draft/:10:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"ä»»åŠ¡è°ƒåº¦ TaskSchedulerï¼šä»»åŠ¡è°ƒåº¦è€… TaskExecutorï¼šä»»åŠ¡æ‰§è¡Œè€… EnableSchedulingï¼šå¼€å¯å®šæ—¶åŠŸèƒ½çš„æ³¨è§£ Scheduledï¼šä»€ä¹ˆæ—¶å€™æ‰§è¡Œ Cron è¡¨è¾¾å¼ @Service public class ScheduledService { // ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´ @Scheduled(cron = \"0/3 * * * * ?\") public void hello(){ System.out.println(\"Scheduled.......\"); } } ","date":"2023-08-08","objectID":"/springboot_draft/:11:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Redis åº•å±‚ä» jedis å˜ä¸º lettuce jedisï¼šé‡‡ç”¨çš„ç›´è¿ï¼Œä¸å®‰å…¨ï¼Œé™¤éä½¿ç”¨ jedis pool çº¿ç¨‹æ± ï¼Œç±»ä¼¼ BIO lettuceï¼šé‡‡ç”¨ nettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ï¼Œå®‰å…¨ï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®ï¼Œç±»ä¼¼ NIO pom.xml \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-data-redis\u003c/artifactId\u003e \u003c/dependency\u003e application.yml spring: redis: host: 127.0.0.1 port: 6379 æ‰€æœ‰ pojo éƒ½è¦åºåˆ—åŒ– implements Serializableï¼Œå¦åˆ™å°±å¾—é€šè¿‡ä»¥ä¸‹æ–¹æ³•åºåˆ—åŒ– // åºåˆ—åŒ– final String jsonUser = new ObjectMapper().writeValueAsString(user); é…ç½®RedisTemplate @Configuration public class RedisConfig { @Bean @SuppressWarnings(\"all\") public RedisTemplate\u003cString, Object\u003e redisTemplate(RedisConnectionFactory redisConnectionFactory) { RedisTemplate\u003cString, Object\u003e template = new RedisTemplate(); template.setConnectionFactory(redisConnectionFactory); // keyã€hash çš„ key éƒ½é‡‡ç”¨ String çš„åºåˆ—åŒ–æ–¹å¼ StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); template.setKeySerializer(stringRedisSerializer); template.setHashKeySerializer(stringRedisSerializer); // valueã€hash çš„ value éƒ½é‡‡ç”¨ json çš„åºåˆ—åŒ–æ–¹å¼ Jackson2JsonRedisSerializer\u003cObject\u003e jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer\u003c\u003e(Object.class); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(objectMapper); template.setValueSerializer(jackson2JsonRedisSerializer); template.setHashValueSerializer(jackson2JsonRedisSerializer); template.afterPropertiesSet(); return template; } } RedisUtil.java package edu.zjut.demospingboot.utils; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.stereotype.Component; import java.util.List; import java.util.Map; import java.util.Set; import java.util.concurrent.TimeUnit; /** * æ“ä½œ Redis çš„å·¥å…·ç±» * @author dujianghui-zjut * @date 2021/12/6 09:01 * @email dujianghui537885@163.com */ @Component public class RedisUtil { @Autowired private RedisTemplate\u003cString,Object\u003e redisTemplate; /** * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´ * @param key é”® * @param time æ—¶é—´ * @return */ public boolean expire(String key,long time){ try{ if (time\u003e0){ redisTemplate.expire(key,time, TimeUnit.SECONDS); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * æ ¹æ® key è·å–è¿‡æœŸæ—¶é—´ * @param key ä¸èƒ½ä¸ºnull * @return æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¿”å› 0 è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ */ public long getExpire(String key){ return redisTemplate.getExpire(key,TimeUnit.SECONDS); } /** * åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨ * @param key é”® * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean hasKey(String key){ try{ return redisTemplate.hasKey(key); } catch (Exception e){ e.printStackTrace(); return false; } } /** * æ™®é€šç¼“å­˜è·å– * @param key é”® * @return å€¼ */ public Object get(String key){ return key==null?null:redisTemplate.opsForValue().get(key); } /** * æ™®é€šç¼“å­˜æ”¾å…¥ * @param key é”® * @param value å€¼ * @return true æˆåŠŸ falseå¤±è´¥ */ public boolean set(String key,Object value){ try{ redisTemplate.opsForValue().set(key,value); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ timeè¦å¤§äº0 å¦åˆ™è®²è®¾ç½®æ— é™æœŸ * @return true æˆåŠŸ falseå¤±è´¥ */ public boolean set(String key,Object value,long time){ try{ if (time\u003e0){ redisTemplate.opsForValue().set(key,value,time,TimeUnit.SECONDS); }else { set(key,value); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * é€’å¢ * @param key é”® * @param delta è¦å¢åŠ å‡ ï¼ˆå¤§äº0ï¼‰ * @return */ public long incr(String key,long delta){ if (delta\u003c0){ throw new RuntimeException(\"é€’å¢å› å­å¿…é¡»å¤§äº0\"); } return redisTemplate.opsForValue().increment(key,delta); } /** * é€’å¢ * @param key é”® * @param delta è¦å‡å°‘å‡ ï¼ˆå°äº0ï¼‰ * @return */ public long desr(String key,long delta){ if (delta\u003e0){ throw new RuntimeException(\"é€’å‡å› å­å¿…é¡»å°äº0\"); } return redisTemplate.opsForValue().increment(key,-delta); } /** * HashGet * @param key é”® notnull * @param item é¡¹ notnull * @return */ public Object hget(String key,String item){ return redisTemplate.opsForHash().get(key,item); } /** * è·å– hashKey å¯¹åº”çš„æ‰€æœ‰é”®å€¼ * @param key é”® * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼ */ public Map\u003cObject,Object\u003e hmget(String key){ return redisTemplate.opsForHash().entries(key); } /** * HashSet * @param key é”® * @param map å¯¹åº”å¤šä¸ªé”®å€¼ * @return */ public boolean hmset(String key,Map\u003cString,Object\u003e map){ try{ redisTemplate.opsForHash().putAll(key,map); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * HashSet å¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param map å¯¹åº”å¤šä¸ªé”®å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean hmset(String key,Map\u003cString,Object\u003e map,long time){ try{ redisTemplate.opsForHash().putAll(key,map); if (time\u003e0){ expire(key,time); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * å‘ä¸€å¼  hash è¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨å°†åˆ›å»º * @param key é”® * @param item é¡¹ * @param value å€¼ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean hset(String key,String item,Object value){ try{ redisTemplate.opsForHash().put(key,item,value); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * å‘ä¸€å¼  hash è¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨å°†åˆ›å»ºï¼Œå¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param item é¡¹ * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¦‚æœå·²å­˜åœ¨çš„ hash è¡¨æœ‰æ—¶é—´ï¼Œè¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰æ—¶é—´ * @return */ public boolean hset(String key,String item,Object value,long time){ try{ redisTemplate.opsForHash().put(key,item,value); if (time\u003e0){ expire(key,time); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * åˆ é™¤ hash è¡¨ä¸­çš„å€¼ * @param key é”® notnull * @param item é¡¹ notnull */ public void hdel(String key,Object... item){ redisTemplate.opsForHash().delete(key,item); } /** * åˆ¤æ–­ hash è¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼ * @param key é”® notnull * @param item é¡¹ notnull * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean hHasKey(String key,String item){ return redisTemplate.opsForHash().hasKey(key,item); } /** * hash é€’å¢ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªï¼Œå¹¶æŠŠæ–°å¢åçš„å€¼è¿”å› * @param key é”® * @param item é¡¹ * @param by è¦å¢åŠ å‡ ï¼ˆå¤§äº0ï¼‰ * @return */ public double hincr(String key,String item,double by){ return redisTemplate.opsForHash().increment(key,item,by); } /** * hash é€’å‡ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªï¼Œå¹¶æŠŠæ–°å¢åçš„å€¼è¿”å› * @param key é”® * @param item é¡¹ * @param by è¦å¢åŠ å‡ ï¼ˆå¤§äº0ï¼‰ * @return */ public double hdecr(String key,String item,double by){ return redisTemplate.opsForHash().increment(key,item,-by); } /** * æ ¹æ® key è·å– Set ä¸­çš„æ‰€æœ‰å€¼ * @param key é”® * @return */ public Set\u003cObject\u003e sGet(String key){ try{ return redisTemplate.opsForSet().members(key); }catch (Exception e){ e.printStackTrace(); return null; } } /** * æ ¹æ® valueï¼Œä»ä¸€ä¸ª set ä¸­æŸ¥è¯¢ï¼Œæ˜¯å¦å­˜åœ¨ * @param key é”® * @param value å€¼ * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean sHasKey(String key,Object value){ try{ return redisTemplate.opsForSet().isMember(key,value); }catch (Exception e){ e.printStackTrace(); return false; } } /** * å°†æ•°æ®æ”¾å…¥ set ç¼“å­˜ * @param key é”® * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * @return æˆåŠŸä¸ªæ•° */ public long sSet(String key,Object... values){ try{ return redisTemplate.opsForSet().add(key,values); } catch (Exception e){ e.printStackTrace(); return 0; } } /** * å°†æ•°æ®æ”¾å…¥ set ç¼“å­˜ï¼Œå¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * @return æˆåŠŸä¸ªæ•° */ public long sSetAndTime(String key,long time,Object... values){ try{ final Long count = redisTemplate.opsForSet().add(key, values); if (time\u003e0){ expire(key,time); } return count; } catch (Exception e){ e.printStackTrace(); return 0; } } /** * è·å– set ç¼“å­˜çš„é•¿åº¦ * @param key é”® * @return */ public long sGetSetSize(String key){ try{ return redisTemplate.opsForSet().size(key); }catch (Exception e){ e.printStackTrace(); return 0; } } /** * ç§»é™¤å€¼ä¸º value çš„ * @param key é”® * @param values å€¼ï¼Œå¯ä»¥æ˜¯å¤šä¸ª * @return ç§»é™¤çš„ä¸ªæ•° */ public long setRemove(String key,Object... values){ try { return redisTemplate.opsForSet().remove(key, values); }catch (Exception e){ e.printStackTrace(); return 0; } } /** * è·å– list ç¼“å­˜çš„å†…å®¹ * @param key é”® * @param start å¼€å§‹ * @param end ç»“æŸï¼Œ0 åˆ° -1 è¡¨ç¤ºæ‰€æœ‰å€¼ * @return */ public List\u003cObject\u003e lGet(String key,long start,long end){ try{ return redisTemplate.opsForList().range(key,start,end); }catch (Exception e){ e.printStackTrace(); return null; } } /** * è·å– list ç¼“å­˜çš„é•¿åº¦ * @param key é”® * @return */ public long lGetlistSize(String key){ try { return redisTemplate.opsForList().size(key); }catch (Exception e){ e.printStackTrace(); return 0; } } /** * é€šè¿‡ç´¢å¼•è·å– list ä¸­çš„å€¼ * @param key é”® * @param index ç´¢å¼•ï¼Œindex\u003e=0æ—¶ï¼Œ0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼›index\u003c0æ—¶ï¼Œ-1 è¡¨å°¾ï¼Œ-2 å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ã€‚ * @return */ public Object lGetIndex(String key,long index){ try{ return redisTemplate.opsForList().index(key,index); }catch (Exception e){ e.printStackTrace(); return null; } } /** * å°† list æ”¾å…¥ç¼“å­˜ * @param key é”® * @param value å€¼ * @return */ public boolean lSet(String key,Object value){ try{ redisTemplate.opsForList().rightPush(key,value); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * å°† list æ”¾å…¥ç¼“å­˜ * @param key é”® * @param value å€¼ * @return */ public boolean lSet(String key,List\u003cObject\u003e value){ try{ redisTemplate.opsForList().rightPushAll(key,value); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * å°† list æ”¾å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return */ public boolean lSet(String key,Object value,long time){ try{ redisTemplate.opsForList().rightPush(key,value); if (time\u003e0){ expire(key,time); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * å°† list æ”¾å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return */ public boolean lSet(String key,List\u003cObject\u003e value,long time){ try{ redisTemplate.opsForList().rightPushAll(key,value); if (time\u003e0){ expire(key,time); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * æ ¹æ®ç´¢å¼•ä¿®æ”¹ list ä¸­çš„æŸæ¡æ•°æ® * @param key é”® * @param index ç´¢å¼• * @param value å€¼ * @return */ public boolean lUpdateIndex(String key,long index,Object value){ try{ redisTemplate.opsForList().set(key,index,value); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * ç§»é™¤ N ä¸ªå€¼ä¸º value * @param key é”® * @param count ç§»é™¤å¤šå°‘ä¸ª * @param value å€¼ * @return ç§»é™¤çš„ä¸ªæ•° */ public long lRemove(String key,long count,Object value){ try{ return redisTemplate.opsForList().remove(key,count,value); }catch (Exception e){ e.printStackTrace(); return 0; } } } ","date":"2023-08-08","objectID":"/springboot_draft/:12:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"åˆ†å¸ƒå¼å¼€å‘ï¼šDubboï¼ˆRPCï¼‰+zookeeper Registry æ³¨å†Œä¸­å¿ƒ Monitor ç›‘æ§ä¸­å¿ƒï¼šDubbo å››ä¸ªé—®é¢˜ï¼š API ç½‘å…³ï¼ŒæœåŠ¡è·¯ç”± HTTPã€RPC æ¡†æ¶ï¼Œå¼‚æ­¥è°ƒç”¨ æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé«˜å¯ç”¨ ç†”æ–­æœºåˆ¶ï¼ŒæœåŠ¡é™çº§ ","date":"2023-08-08","objectID":"/springboot_draft/:13:0","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Spring Cloud Netflixï¼ˆ2018å¹´åœæ­¢ç»´æŠ¤ï¼‰ Eurekaï¼šæœåŠ¡æ³¨å†Œä¸å‘ç° Hystrixï¼šç†”æ–­æœºåˆ¶ ","date":"2023-08-08","objectID":"/springboot_draft/:13:1","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Apache Dubbo + zookeeper Dubboï¼šé«˜æ€§èƒ½çš„åŸºäº Java å®ç°çš„ RPC é€šä¿¡æ¡†æ¶ Zookeeperï¼šç®¡ç† Hadoopã€Hive ","date":"2023-08-08","objectID":"/springboot_draft/:13:2","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Springcloud Alibaba ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ ","date":"2023-08-08","objectID":"/springboot_draft/:13:3","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["draft"],"content":"Server Mesh+istio æœåŠ¡ç½‘æ ¼ ","date":"2023-08-08","objectID":"/springboot_draft/:13:4","tags":["SpringBoot"],"title":"SpringBoot æ‚è®°","uri":"/springboot_draft/"},{"categories":["interview"],"content":"ğŸŒŸAOPï¼ˆAspect Oriented Programmingï¼‰é¢å‘åˆ‡é¢ç¼–ç¨‹ ä½œç”¨ï¼šåœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šä¸ºå…¶è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚ï¼ˆæ— ä¾µå…¥å¼ï¼‰ AOP åŸºæœ¬æ¦‚å¿µ åœ¨ pom.xml ä¸­å¯¼å…¥ aspectjweaver ï¼Œé…ç½® @EnableAspectJAutoProxy è¿æ¥ç‚¹ï¼ˆJoinPointï¼‰ï¼šæ–¹æ³•ã€å¯åˆ©ç”¨çš„æœºä¼šã€‘ åˆ‡å…¥ç‚¹ï¼ˆPointCutï¼‰ï¼šæ˜¯è¿æ¥ç‚¹çš„å­é›†ï¼Œè¦è¿½åŠ åŠŸèƒ½çš„æ–¹æ³• ã€è§£å†³äº†åˆ‡é¢ç¼–ç¨‹ä¸­çš„ Where é—®é¢˜ï¼Œè®©ç¨‹åºå¯ä»¥çŸ¥é“å“ªäº›æœºä¼šç‚¹å¯ä»¥åº”ç”¨æŸä¸ªåˆ‡é¢åŠ¨ä½œã€‘ [@Pointcut(â€œexecution(void ](/Pointcut() com.dao.xxxDao.update())â€) ä¿®é¥°çš„æ–¹æ³• pt() é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šæœ‰å…±æ€§çš„åŠŸèƒ½ ã€æ˜ç¡®äº†åˆ‡é¢ç¼–ç¨‹ä¸­çš„ Whatï¼Œä¹Ÿå°±æ˜¯åšä»€ä¹ˆï¼›åŒæ—¶é€šè¿‡æŒ‡å®š Beforeã€After æˆ–è€… Aroundï¼Œå®šä¹‰äº† Whenï¼Œä¹Ÿå°±æ˜¯ä»€ä¹ˆæ—¶å€™åšã€‚ã€‘ @Before(â€œpt()â€) å½¢å‚ï¼šJoinPoint @After(â€œpt()â€) @Around (â€œpt()â€) public void around(ProceedingJoinPoint pjp) throws Throwable{ pjp.proceed();} ï¼ˆé‡ç‚¹ï¼Œå¸¸ç”¨ï¼‰ å½¢å‚ï¼šProceedingJoinPointï¼ˆå¿…é¡»æ”¾åœ¨å‚æ•°çš„ç¬¬ä¸€ä½ï¼‰ è¦æ³¨æ„è¿”å›å€¼å’ŒåŸå§‹æ–¹æ³•ä¸€è‡´ã€‚ å¦‚æœä¸æ‰§è¡Œpjp.proceed()ï¼Œå¯ä»¥å®ç°å¯¹åŸå§‹æ–¹æ³•çš„éš”ç¦»ï¼ˆæƒé™æ ¡éªŒï¼‰ @Component @Aspect public class ProjectAdvice{ @Pointcut(\"execution(* com.edu.zjut.service.*Service.*(..))\") private void servicePt(){} @Around(\"ProjectAdvice.servicePt()\") public void runSpeed(ProceedingJoinPoint pjp) throws Throwable{ Signature signature = pjp.getSignature(); String className = signature.getDeclaringTypeNmae(); String methodName = signature.getName(); long start = System.currentTimeMillis(); for(int i=0;i\u003c10000;i++){ pjp.proceed(); } long end = System.currentTimeMillis(); System.out.println(\"ä¸šåŠ¡å±‚æ¥å£ä¸‡æ¬¡æ‰§è¡Œ\"+ className + \".\" + methodName + \"------\u003e\" + (end-start)+\"ms\"); } } AfterReturning(â€œpt()â€) åªæœ‰ä¸æŠ›å¼‚å¸¸æ‰è¿è¡Œ AfterThrowing(â€œpt()\")åªæœ‰æŠ›å¼‚å¸¸æ‰è¿è¡Œ åˆ‡é¢ï¼ˆAspectï¼‰ï¼šé€šçŸ¥å’Œåˆ‡å…¥ç‚¹çš„è”ç³»ï¼ˆå¤šå¯¹å¤šï¼‰ é€šçŸ¥ç±»ï¼šå®šä¹‰é€šçŸ¥çš„ç±» @Aspect AOP å·¥ä½œæµç¨‹ AOPçš„æœ¬è´¨æ˜¯ä»£ç†æ¨¡å¼ Springå®¹å™¨å¯åŠ¨ è¯»å–åˆ‡é¢ä¸­é…ç½®çš„åˆ‡å…¥ç‚¹ åˆå§‹åŒ–beanï¼Œè‹¥ç±»ä¸­æ–¹æ³•åŒ¹é…åˆ°åˆ‡å…¥ç‚¹ï¼Œåˆ™åˆ›å»ºä»£ç†å¯¹è±¡ è·å–beanæ‰§è¡Œæ–¹æ³• åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ æ ‡å‡†æ ¼å¼ï¼šexecution(è¿”å›å€¼ åŒ….ç±».æ¥å£ï¼ˆæ¨èï¼‰/å®ç°ç±».æ–¹æ³•()) é€šé…ç¬¦ï¼š*åŒ¹é…ä»»æ„ç¬¦å·ï¼Œ..åŒ¹é…å¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¦‚ï¼šexecution(_ _..Service+.(..))`åŒ¹é…ä¸šåŠ¡å±‚æ‰€æœ‰æ¥å£ ä¹¦å†™æŠ€å·§ï¼š æ‰€æœ‰ç±»å‘½åéœ€è§„èŒƒï¼Œå¦åˆ™ä»¥ä¸‹å¤±æ•ˆ æè¿°åˆ‡å…¥ç‚¹é€šå¸¸æè¿°æ¥å£ï¼Œè€Œä¸æè¿°å®ç°ç±» å¢åˆ æ”¹ç±»ä½¿ç”¨ç²¾å‡†ç±»å‹åŠ é€ŸåŒ¹é…ï¼ŒæŸ¥è¯¢ç±»ä½¿ç”¨*é€šé…å¿«é€Ÿæè¿° æ–¹æ³•åä»¥åŠ¨è¯è¿›è¡Œç²¾å‡†åŒ¹é… åŒ…åä¹¦å†™å°½é‡ä¸ä½¿ç”¨ .. åŒ¹é…ï¼Œæ•ˆç‡å¤ªä½ï¼Œå¸¸ç”¨ * åšå•ä¸ªåŒ…æè¿°åŒ¹é… ä¸ä½¿ç”¨å¼‚å¸¸ä½œä¸ºåŒ¹é…è§„åˆ™ ","date":"2023-08-08","objectID":"/spring/:0:1","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†ï¼Ÿ åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ã€åŠ¨æ€å¤„ç†ä»£ç†æ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œå¾ˆå¤šåœºæ™¯éƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼æœºåˆ¶åšåˆ°çš„ï¼Œæ¯”å¦‚ç”¨æ¥åŒ…è£… RPC è°ƒç”¨ã€é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼Œæœ‰ä¸¤ç§å®ç°ï¼š JDKï¼šå®ç°æ¥å£ï¼Œè¿ç”¨åå°„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼ŒSpring AOPå°†ä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¥ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚ä»£ç†å¯¹è±¡å®ç°äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å‰åç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚JDKåŠ¨æ€ä»£ç†æ˜¯é€šè¿‡java.lang.reflect.Proxyç±»å’Œjava.lang.reflect.InvocationHandleræ¥å£å®ç°çš„ã€‚ cglibï¼šä¿®æ”¹å­—èŠ‚ç ï¼Œç”Ÿæˆå­ç±»ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ŒSpring AOPå°†ä½¿ç”¨CGLIBåº“ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚CGLIBä»£ç†é€šè¿‡ç»§æ‰¿ç›®æ ‡å¯¹è±¡çš„å­ç±»æ¥ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç„¶ååœ¨å­ç±»ä¸­ç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚CGLIBä»£ç†å¯ä»¥å¤„ç†æ²¡æœ‰æ¥å£çš„ç›®æ ‡å¯¹è±¡ã€‚ åŸºäº ASMï¼Œå¯ä»¥ç›´æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸º ","date":"2023-08-08","objectID":"/spring/:0:2","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"Spring äº‹åŠ¡ ç¼–ç¨‹å¼ï¼šTransactionTemplate å¯¹ä¸šåŠ¡æœ‰ä¾µå…¥æ€§ï¼Œå°‘ç”¨ã€‚ å£°æ˜å¼ï¼š@EnableTransactionManagement + @TranSactional é€šè¿‡ AOP å°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼ˆæ–¹æ³•å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•åé…Œæƒ…å›æ»šï¼‰ äº‹åŠ¡å¤±æ•ˆåœºæ™¯ å¼‚å¸¸æ•è· =\u003e åœ¨ catch ä¸­ throw å¼‚å¸¸ æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ =\u003e æŒ‡å®š rollbackforï¼Œå› ä¸ºé»˜è®¤åªå›æ»šéæ£€æŸ¥å¼‚å¸¸ é public æ–¹æ³• ","date":"2023-08-08","objectID":"/spring/:0:3","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿä¸‰çº§ç¼“å­˜ or @lazy ä¸‰çº§ç¼“å­˜åªèƒ½è§£å†³åˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„å¾ªç¯ä¾èµ–ï¼š ä¸€çº§ singletonObjectsï¼šå•ä¾‹æ± ï¼Œå­˜æ”¾å·²åˆå§‹åŒ–å®Œæˆçš„ bean äºŒçº§ earlySingletonObjectsï¼šå­˜æ”¾ç”Ÿå‘½å‘¨æœŸæœªèµ°å®Œçš„ bean ä¸‰çº§ singletonFactoriesï¼šå¯¹è±¡å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡ å¯¹äºæ„é€ æ–¹æ³•ä¸­çš„å¾ªç¯ä¾èµ–ï¼Œé‡‡ç”¨ @lazy è¿›è¡Œæ‡’åŠ è½½ ","date":"2023-08-08","objectID":"/spring/:0:4","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"Spring Cloud æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼Ÿ RestTemplateæ–¹å¼è°ƒç”¨ æ³¨å…¥ RestTemplate çš„beanï¼Œæ·»åŠ @Beanæ³¨è§£ è°ƒç”¨ .getForObject() æˆ– .postForObject() æ–¹æ³• Feignæ–¹å¼è°ƒç”¨ æ·»åŠ  pom ä¾èµ– å¯åŠ¨ç±»æ·»åŠ  @EnableFeignClients æ³¨è§£ å†™æ¥å£ï¼š @FeignClient(\"userservice\") public interface UserClient{ @GetMapping(\"/user/{id}\") User findById(@PathVariable(\"id\") Long id); } ä½¿ç”¨ FeignClient ä¸­å®šä¹‰çš„æ–¹æ³•å–ä»£ RestTemplateï¼ˆå¹¶é›†æˆäº† ribbonï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡ï¼‰ IRule æ¥å£å†³å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶é€‰æ‹©æŸä¸ªæœåŠ¡ï¼š 1. ZoneAvoidanceRuleï¼ˆé»˜è®¤ï¼‰ï¼šå¯¹ZoneåŒºåŸŸå†…å¤šä¸ªæœåŠ¡è½®è¯¢ï¼Œzoneå€¼å¯é…ç½® 2. RoundRobinRuleï¼šè½®è¯¢ 3. WeightedResponseTimeRuleï¼šæœåŠ¡å“åº”æ—¶é—´è¶Šé•¿ï¼ŒæœåŠ¡å™¨æƒé‡å°±è¶Šå°ï¼Œæ¦‚ç‡å°±è¶Šä½ 4. RandomRuleï¼šéšæœº ","date":"2023-08-08","objectID":"/spring/:0:5","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"SpringMVC æ‰§è¡Œæµç¨‹ï¼Ÿ ä¸ DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ ä¾æ¬¡äº¤äº’çš„æœ‰ï¼š HandlerMapping ï¼ˆå¤„ç†å™¨æ˜ å°„å™¨ï¼‰ï¼šæ‰¾åˆ°ç±»å#æ–¹æ³•å HandlerAdaptorï¼ˆé€‚é…å™¨ï¼‰ï¼šå¤„ç†å‚æ•°ã€è¿”å›å€¼ ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼Œç”¨äº JSPï¼‰ï¼šé€»è¾‘è§†å›¾ -\u003e è§†å›¾ å¯¹äºå‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ  @ResponseBodyï¼Œé€šè¿‡ HttpMessageConverter å“åº” JSON æ•°æ® @RestController = @Controller + @ResponseBody ","date":"2023-08-08","objectID":"/spring/:0:6","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"JWT JWT æ•°æ®ç»“æ„ï¼Ÿ head payload ç”¨æˆ·ä¿¡æ¯ åŠ å¯†ä¿¡æ¯ è¿‡æœŸæ—¶é—´ signature JWT å’Œ token çš„åŒºåˆ«ï¼Ÿ token éœ€è¦æŸ¥æ•°æ®åº“ï¼ŒJWT ä¸éœ€è¦ã€‚ securityå’Œjwtæ€ä¹ˆèåˆï¼Ÿ è®¤è¯ï¼šä¸»è¦ jwt çš„ token å®ç° é‰´æƒï¼šspringSecurityå®ç°ï¼ŒRBAC = Role-Based Access Control ä»cookieåˆ°jwtè§£å†³äº†ä»€ä¹ˆï¼Ÿ å¯ä»¥è½¬åŒ–ä¸º json ä¸²ï¼Œå¯è¯»æ€§å¼ºï¼› RESTful è®¾è®¡åŸåˆ™ï¼Œé¿å…åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯çŠ¶æ€ï¼Œé™ä½äº†æœåŠ¡å™¨ç«¯çš„è´Ÿæ‹…ï¼› ç­¾åæœºåˆ¶ï¼Œå®‰å…¨æ€§å¼ºã€‚ token æ³„éœ²æ€ä¹ˆå¤„ç†ï¼Ÿ é‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼šç»™å‰ç«¯ä¸€ä¸ªå…¬é’¥ï¼ŒåŠ å¯†æ•°æ®ä¼ åˆ°åå°ï¼Œç”¨ç§é’¥è§£å¯†åå¤„ç†æ•°æ®ã€‚ ","date":"2023-08-08","objectID":"/spring/:0:7","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"Springbootçš„è‡ªåŠ¨è£…é…åŸç†ï¼Ÿ @SpringbootApplication @SpringBootConfiguration å£°æ˜å½“å‰ç±»ä¸ºé…ç½®ç±» @ComponentScan ç»„ä»¶æ‰«æ @EnableAutoConfiguration è‡ªåŠ¨åŒ–é…ç½® @Import è¯»å–äº†é¡¹ç›®å’Œé¡¹ç›®å¼•ç”¨çš„ jar åŒ…ï¼Œä½äº classpath è·¯å¾„ä¸‹ META-INF/spring.factories æ–‡ä»¶ @ConditionalOnClass æœ‰åˆ™åŠ è½½ æ³¨å…¥æ–¹å¼ å¯¹äºå¼•ç”¨ç±»å‹ï¼š æŒ‰ç±»å‹ byTypeï¼ˆæ¨èï¼‰ï¼š**@Autowired **** ** ä½¿ç”¨çš„æ˜¯æš´åŠ›åå°„ï¼Œä¸éœ€è¦ setteræ–¹æ³• æŒ‰åç§° byNameï¼ˆå˜é‡åä¸é…ç½®è€¦åˆï¼Œä¸æ¨èï¼‰ @Autowired + @Qualifier(â€œbeanName â€œ) @Resource(â€œåç§°â€) æŒ‰æ„é€ æ–¹æ³•ï¼ˆä¸å¸¸ç”¨ï¼‰ å¯¹äºç®€å•å±æ€§ï¼šä½¿ç”¨ @Value(â€œxxxâ€)æ³¨å…¥ï¼Œå¯ä»¥æ¥è‡ªå¤–éƒ¨ propertyï¼Œå†™æ³•ï¼š@Value(\"${name}\") åŠ è½½å¤–éƒ¨properties ä½¿ç”¨ @PropertySource(â€œclasspath:jdbc.propertiesâ€)ï¼Œä¸å¯ä»¥ä½¿ç”¨æ˜Ÿå·* ","date":"2023-08-08","objectID":"/spring/:0:8","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"è°ˆè°ˆSpring Beançš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼Ÿ ç”Ÿå‘½å‘¨æœŸ å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒSpring ä¼šä½¿ç”¨é…ç½®å…ƒæ•°æ®ï¼ˆXMLã€æ³¨è§£æˆ–Javaé…ç½®ï¼‰æ¥åˆ›å»º Bean çš„å®ä¾‹ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°æ¥å®Œæˆçš„ã€‚ å±æ€§èµ‹å€¼ï¼ˆPopulationï¼‰ï¼šåœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpring å°†ä¼šé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰æˆ–å±æ€§èµ‹å€¼çš„æ–¹å¼æ¥è®¾ç½® Bean çš„å±æ€§å’Œä¾èµ–ã€‚è¿™å¯ä»¥é€šè¿‡ setter æ–¹æ³•æ³¨å…¥æˆ–ä½¿ç”¨å­—æ®µæ³¨å…¥æ¥å®ç°ã€‚ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šåœ¨å±æ€§èµ‹å€¼å®Œæˆåï¼ŒSpring å°†ä¼šè°ƒç”¨ Bean çš„åˆå§‹åŒ–å›è°ƒæ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¼€å‘è€…å¯ä»¥åœ¨ Bean ä¸­å®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œä½¿ç”¨ @PostConstruct æ³¨è§£æˆ–å®ç° InitializingBean æ¥å£æ¥æŒ‡å®šåˆå§‹åŒ–é€»è¾‘ã€‚ ä½¿ç”¨ï¼ˆIn Useï¼‰ï¼šåœ¨åˆå§‹åŒ–å®Œæˆåï¼ŒBean å¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨ã€‚æ­¤æ—¶ï¼ŒBean å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¯ä»¥è¢«å…¶ä»–ç»„ä»¶æˆ–è€…åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚ é”€æ¯ï¼ˆDestructionï¼‰ï¼šå½“åº”ç”¨ç¨‹åºå…³é—­æˆ–è€…ä¸å†éœ€è¦æŸä¸ª Bean æ—¶ï¼ŒSpring ä¼šè°ƒç”¨é”€æ¯å›è°ƒæ–¹æ³•æ¥è¿›è¡Œèµ„æºé‡Šæ”¾æˆ–æ¸…ç†æ“ä½œã€‚å¼€å‘è€…å¯ä»¥åœ¨ Bean ä¸­å®šä¹‰é”€æ¯æ–¹æ³•ï¼Œä½¿ç”¨ @PreDestroy æ³¨è§£æˆ–å®ç° DisposableBean æ¥å£æ¥æŒ‡å®šé”€æ¯é€»è¾‘ã€‚ ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼å®ç°ï¼š å®ä¾‹åŒ– Beanï¼šé¦–å…ˆï¼ŒSpringä¼šå®ä¾‹åŒ– Beanï¼Œå³åˆ›å»º Bean çš„å¯¹è±¡ã€‚ Awareæ¥å£å›è°ƒï¼šå¦‚æœ Bean å®ç°äº†ä»»ä½• Aware æ¥å£ï¼ˆä¾‹å¦‚ BeanNameAwareã€BeanFactoryAwareã€ApplicationContextAwareï¼‰ï¼Œåœ¨å®ä¾‹åŒ–ä¹‹åä½†åœ¨å±æ€§èµ‹å€¼ä¹‹å‰ï¼ŒSpringä¼šè°ƒç”¨ç›¸åº”çš„ Aware æ¥å£å›è°ƒæ–¹æ³•ï¼Œå°†ç›¸å…³çš„å¼•ç”¨æˆ–èµ„æºä¼ é€’ç»™ Beanã€‚ å±æ€§èµ‹å€¼ï¼šåœ¨ Aware æ¥å£å›è°ƒä¹‹åï¼ŒSpringä¼šè¿›è¡Œå±æ€§èµ‹å€¼ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼Œå°†é…ç½®æˆ–æ³¨å…¥çš„å±æ€§å€¼è®¾ç½®åˆ° Bean ä¸­ã€‚ BeanPostProcessorå‰ç½®å¤„ç†ï¼šåœ¨å±æ€§èµ‹å€¼ä¹‹åï¼ŒSpringä¼šè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor çš„ postProcessBeforeInitialization æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…åœ¨ Bean çš„åˆå§‹åŒ–ä¹‹å‰è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚ åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ï¼šå¦‚æœ Bean å®šä¹‰äº†åˆå§‹åŒ–æ–¹æ³•ï¼ˆä¾‹å¦‚é€šè¿‡ @PostConstruct æ³¨è§£æˆ–å®ç° InitializingBean æ¥å£ï¼‰ï¼Œåœ¨å‰ç½®å¤„ç†ä¹‹åï¼ŒSpringä¼šè°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ã€‚ BeanPostProcessoråç½®å¤„ç†ï¼šåœ¨åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹åï¼ŒSpringä¼šå†æ¬¡è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor çš„ postProcessAfterInitialization æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…åœ¨ Bean çš„åˆå§‹åŒ–ä¹‹åè¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚ Bean å¯ç”¨ï¼šæ­¤æ—¶ï¼ŒBeanå·²ç»å®Œæˆäº†åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ äº”ä¸ªä½œç”¨åŸŸ å…¶ä¸­æœ€åŸºç¡€çš„æœ‰ä¸‹é¢ä¸¤ç§ï¼š Singletonï¼Œè¿™æ˜¯ Spring çš„é»˜è®¤ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ª IOC å®¹å™¨åˆ›å»ºå”¯ä¸€çš„ä¸€ä¸ª Bean å®ä¾‹ã€‚ã€é€‚åˆæ— çŠ¶æ€ã€‘ Prototypeï¼Œé’ˆå¯¹æ¯ä¸ª getBean è¯·æ±‚ï¼Œå®¹å™¨éƒ½ä¼šå•ç‹¬åˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚ã€é€‚åˆæœ‰çŠ¶æ€ã€‘ å¦‚æœæ˜¯ Web å®¹å™¨ï¼š Requestï¼Œä¸ºæ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºå•ç‹¬çš„ Bean å®ä¾‹ã€‚ Sessionï¼Œå¾ˆæ˜¾ç„¶ Bean å®ä¾‹çš„ä½œç”¨åŸŸæ˜¯ Session èŒƒå›´ã€‚ GlobalSessionï¼Œç”¨äº Portlet å®¹å™¨ï¼Œå› ä¸ºæ¯ä¸ª Portlet æœ‰å•ç‹¬çš„ Sessionï¼ŒGlobalSession æä¾›ä¸€ä¸ªå…¨å±€æ€§çš„ HTTP Sessionã€‚ ","date":"2023-08-08","objectID":"/spring/:0:9","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬ ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œä¸å†é€šè¿‡ new äº§ç”Ÿå¯¹è±¡ï¼Œåˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè½¬ç§»åˆ°å¤–éƒ¨çš„IoCå®¹å™¨ï¼ˆApplicationContextï¼Œæ¥å£ï¼‰ bean ä¹‹é—´çš„ä¾èµ–æ³¨å…¥æ–¹å¼ setteræ³¨å…¥ï¼ˆå»ºè®®ï¼‰ï¼šæ›´åŠ çµæ´»ï¼Œå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºä»¥ååŠ¨æ€æ›´æ”¹ä¾èµ–å…³ç³» æ„é€ æ–¹æ³•æ³¨å…¥ï¼šä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œä¾èµ–å…³ç³»å°±ä¸èƒ½å†æ”¹å˜ ","date":"2023-08-08","objectID":"/spring/:0:10","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"Qï¼šæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸è¿‡æ»¤å™¨ï¼ˆFilterï¼‰çš„åŒºåˆ«ï¼Ÿ Aï¼š å½’å±ä¸åŒï¼šFilterå±äºServletæŠ€æœ¯ï¼ŒInterceptorå±äºSpringMVCæŠ€æœ¯ æ‹¦æˆªå†…å®¹ä¸åŒï¼šFilterå¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œå¢å¼ºï¼ŒInterceptorä»…é’ˆå¯¹SpringMVCçš„è®¿é—®è¿›è¡Œå¢å¼º æ‰§è¡Œæµç¨‹ preHandleï¼ˆreturn true æ‰èµ°ä¸‹ä¸€æ­¥ï¼Œfalseç»“æŸï¼‰ controller postHandle AfterCompletion æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œä½œç”¨ï¼š åœ¨æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç  ç»„ç»‡åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ // preHandle æ–¹æ³•ä¸­å¯ä»¥æ ¹æ®è¿”å›å€¼å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œæ–¹æ³• // å¹¶ä¸”å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‹¦æˆªæ–¹æ³•ï¼Œè¿›è¡Œæ›´å¤šæ“ä½œ HandlerMethod hm = (HandlerMethod) handler; hm.getMethod(); æ‹¦æˆªå™¨é“¾ preHandleåœ¨å‰çš„æ‹¦æˆªå™¨ï¼ŒpostHandle å’Œ afterCompletion åœ¨åã€‚ 123 éƒ½ä¸º trueï¼špre 123 -\u003e controller -\u003e post 321 -\u003e after 321 12 true 3 falseï¼špre12 -\u003e after 21 13 true 2 falseï¼š pre1 -\u003e after 1 23 true 1 falseï¼šéƒ½ä¸æ‰§è¡Œ ","date":"2023-08-08","objectID":"/spring/:0:11","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"å…¨å±€å¼‚å¸¸å¤„ç† è¡¨ç°å±‚é€šè¿‡AOPå¤„ç† @RestControllerAdvice public class GlobalExceptionHandler { @ExceptionHandler(value = Exception.class) public CommonResult handleUnknownException(Exception e) { return CommonResult.failed(ResultCode.UNKN0OWN_FAILED,\"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•ï¼\"); } } ä¸šåŠ¡å¼‚å¸¸ï¼šæé†’ç”¨æˆ·è§„èŒƒæ“ä½œ ç³»ç»Ÿå¼‚å¸¸ï¼šå®‰æŠšç”¨æˆ·ï¼Œé€šçŸ¥è¿ç»´ï¼Œè®°å½•æ—¥å¿— ","date":"2023-08-08","objectID":"/spring/:0:12","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"RESTé£æ ¼ï¼ˆRepresentational State Transferï¼‰è¡¨ç°å½¢å¼çŠ¶æ€è½¬æ¢ èµ„æºåç§°é‡‡ç”¨å¤æ•°ï¼Œå¦‚usersã€books GETï¼šæŸ¥è¯¢ POSTï¼šæ–°å¢ PUTï¼šä¿®æ”¹ DELETEï¼šåˆ é™¤ ","date":"2023-08-08","objectID":"/spring/:0:13","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"Qï¼šå¦‚ä½•é¿å…SpringåŠ è½½SpringMVCå·²åŠ è½½çš„Controllerï¼Ÿ Aï¼šåŠ è½½Springæ§åˆ¶çš„beançš„æ—¶å€™ï¼Œæ’é™¤æ‰SpringMVCæ§åˆ¶çš„beanã€‚ @ComponentScan(value = \"edu.zjut\",excludeFilters=@ComponentScan.Filter(type=FilterType.ANNOTATION,classes=Controller.class))æŒ‰ç…§æ³¨è§£æ’é™¤ @ComponentScan({\"edu.zjut.service\",\"edu.zjut.dao\"}) ä¸åŒºåˆ†Springå’ŒSpringMVCçš„ç¯å¢ƒï¼Œéƒ½åŠ è½½ ","date":"2023-08-08","objectID":"/spring/:0:14","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"å‚æ•°ä¼ é€’ @RequestParam(â€œxxxâ€)ï¼šè¯·æ±‚å‚æ•°å’Œå½¢å‚ä¸åŒæ—¶éœ€é…ç½®ï¼Œä¸å†™çš„è¯é»˜è®¤å–ç›¸åŒã€‚ @RequestParam ä¿®é¥° List å°±å¯ä»¥å®ç°é›†åˆä¼ å‚ã€‚ å‚æ•°å¯¹è±¡ä¸­æœ‰å¯¹è±¡æ—¶é‡‡ç”¨ address.city=beijing è¿™ç§å½¢å¼ã€‚ @RequestBodyï¼šè®¾ç½®controlleræ–¹æ³•è¿”å›å€¼ä¸ºå“åº”ä½“ã€‚ä¼ å­—ç¬¦ä¸²ï¼ˆjsonï¼‰ç”¨ HttpMessageConverter æ—¥æœŸå‚æ•°ï¼šæ¥æ”¶å¯ä»¥ç”¨ Date æ¥ï¼ŒåŠ ä¸Š @DateTimeFormat(pattern = â€œyyyy-MM-ddâ€) @PathVariable ä»è·¯å¾„ä¸­å–å€¼ ","date":"2023-08-08","objectID":"/spring/:0:15","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"SpringMVC åŸºäº Java å®ç° MVC æ¨¡å‹çš„è½»é‡çº§ web æ¡†æ¶ã€‚ åç«¯æœåŠ¡å™¨ï¼š è¡¨ç°å±‚ï¼šSpringMVCï¼ˆå–ä»£ Servletï¼‰ï¼Œå°è£…æ•°æ®ï¼ˆcodeã€msgã€dataï¼‰ï¼Œç”¨postmanæµ‹è¯• ä¸šåŠ¡å±‚ï¼šSpringï¼Œç”¨JUnitæµ‹è¯• @RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(classes = SpringConfig.class) æ•°æ®å±‚ï¼šMybatis è¿”å› json æ•°æ®ï¼Œéœ€è¦åŠ  @ResponseBody æ³¨è§£ã€‚ ","date":"2023-08-08","objectID":"/spring/:0:16","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["interview"],"content":"ğŸŒŸQï¼šå¦‚ä½•ä¿è¯æ— è®ºè½¬è´¦æ˜¯å¦æˆåŠŸéƒ½è®°å½•æ—¥å¿—ç•™ç—•ï¼Ÿ Aï¼šæ—¥å¿—å¯¹åº”çš„äº‹åŠ¡ä¸è¦åŠ å…¥è½¬è´¦çš„äº‹åŠ¡ä¸­ï¼Œåœ¨æ’å…¥æ—¥å¿—çš„æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional(propagation = Propagation.REQUIRES_NEW) äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šä½œä¸ºåè°ƒå‘˜ï¼Œ REQUIREDï¼ˆé»˜è®¤ï¼‰ï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡äº‹åŠ¡å°±æ–°å»º REQUIRED_NEWï¼šæ— è®ºå¦‚ä½•éƒ½æ–°å»ºäº‹åŠ¡ SUPPORTSï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ç®—äº† NOT_SUPPORTSï¼šæ— ä¹±å¦‚ä½•éƒ½ä¸æ”¯æŒäº‹åŠ¡ MANDATORYï¼šäº‹åŠ¡ç®¡ç†å‘˜æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ¥é”™ NEVERï¼šäº‹åŠ¡ç®¡ç†å‘˜æ²¡äº‹åŠ¡æ²¡å…³ç³»ï¼Œæœ‰äº‹åŠ¡å°±æŠ¥é”™ NESTEDï¼šè®¾ç½® savePoint ","date":"2023-08-08","objectID":"/spring/:0:17","tags":["Spring"],"title":"ğŸš©Spring","uri":"/spring/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-08","objectID":"/mysql_draft/","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"èŒƒå¼ 1NFï¼šæ¶ˆé™¤é‡å¤æ•°æ®ï¼Œæ¯ä¸€åˆ—éƒ½æ˜¯åŸå­çš„ï¼›æ‰€æœ‰å±æ€§éƒ½ä¸èƒ½å†åˆ†è§£ä¸ºæ›´åŸºæœ¬çš„æ•°æ®å•ä½ï¼› 2NFï¼šæ¶ˆé™¤éƒ¨åˆ†ä¾èµ–ï¼Œæ¯ä¸€è¡Œéƒ½è¢«ä¸»é”®å”¯ä¸€æ ‡è¯†ï¼›æ‰€æœ‰éä¸»å±æ€§éƒ½ä¾èµ–äºå…³é”®å±æ€§ï¼Œæ‰€æœ‰åˆ—éƒ½ä¾èµ–äºä»»æ„ä¸€ç»„å€™é€‰å…³é”®å­—ï¼› 3NFï¼šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼Œè¡¨ä¸­æ¯ä¸€åˆ—åªä¾èµ–ä¸»é”®è€Œä¸æ˜¯å…¶ä»–åˆ—ï¼›æ¯ä¸€åˆ—éƒ½ä¸ä»»æ„å€™é€‰å…³é”®å­—ç›´æ¥ç›¸å…³è€Œä¸æ˜¯é—´æ¥ç›¸å…³ï¼› BCNFï¼šæ¶ˆé™¤ä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ ","date":"2023-08-08","objectID":"/mysql_draft/:0:1","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"MySQL å­˜å‚¨ ç‹¬å æ¨¡å¼ï¼š æ—¥å¿—ç»„æ–‡ä»¶ï¼šé»˜è®¤5Mã€ib_logfile0ã€‘ã€ib_logfile1ã€‘ è¡¨ç»“æ„æ–‡ä»¶ï¼šã€*.frmã€‘ ç‹¬å è¡¨ç©ºé—´æ–‡ä»¶ï¼šã€*.ibdã€‘ å­—ç¬¦é›†å’Œæ’åºè§„åˆ™æ–‡ä»¶ï¼šã€db.optã€‘ binlog äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼šè®°å½•ä¸»æ•°æ®åº“æœåŠ¡å™¨çš„ DDL å’Œ DML æ“ä½œ DDLï¼šData Define Languageï¼Œæ•°æ®å®šä¹‰è¯­è¨€ï¼Œå¦‚ CREATEã€ALTERã€DROP DMLï¼šData Manipulation Languageï¼Œæ•°æ®æ“ä½œè¯­è¨€ï¼Œå¦‚ INSERTã€UPDATEã€DELETE äºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶ï¼šã€master-bin.indexã€‘ å…±äº«æ¨¡å¼ï¼š innodb_file_per_table = 1ï¼Œæ•°æ®éƒ½åœ¨ ibdata1 12.1.5 MySQL æ‰§è¡Œæµç¨‹ æŸ¥è¯¢ç¼“å­˜ï¼šé€šè¿‡ä¸€ä¸ªå¯¹å¤§å°å†™æ•æ„Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾å®ç°çš„ã€‚ è§£æå™¨ç”Ÿæˆè§£ææ ‘ï¼šè¯­æ³•å±‚é¢ï¼ŒéªŒè¯å…³é”®å­—æ˜¯å¦æ‹¼å†™æ­£ç¡®ã€é¡ºåºæ­£ç¡®ã€å¼•å·å¯¹åº”ã€‚ é¢„å¤„ç†å™¨ä¼˜åŒ–è§£ææ ‘ï¼šé€»è¾‘å±‚é¢ï¼Œæ£€æŸ¥æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼Œåå­—æ˜¯å¦æœ‰æ­§ä¹‰ï¼ŒéªŒè¯æƒé™ æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼š æœ€é‡è¦çš„ä¸€éƒ¨åˆ†æ˜¯å…³è”æŸ¥è¯¢ä¼˜åŒ–ï¼› ç”¨ distinct å’Œ group by ä¼šäº§ç”Ÿä¸´æ—¶ä¸­é—´è¡¨ï¼› é™æ€ä¼˜åŒ–ï¼šâ€œç¼–è¯‘æ—¶ä¼˜åŒ–â€ï¼Œä¸ä¾èµ–äºç‰¹åˆ«çš„æ•°å€¼ï¼Œåœ¨ç¬¬ä¸€æ¬¡å®Œæˆåå°±ä¸€ç›´æœ‰æ•ˆï¼› åŠ¨æ€ä¼˜åŒ–ï¼šâ€œè¿è¡Œæ—¶ä¼˜åŒ–â€ï¼Œå’ŒæŸ¥è¯¢çš„ä¸Šä¸‹æ–‡æœ‰å…³ã€‚ æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼Œç»“æœå­˜å…¥æŸ¥è¯¢ç¼“å­˜ è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£ æ‰§è¡Œå¼•æ“çš„çŠ¶æ€ï¼š sleepï¼šçº¿ç¨‹æ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°è¯·æ±‚ï¼› queryï¼šæ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢æˆ–æ­£åœ¨å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ï¼› lockedï¼šmysql æœåŠ¡å™¨å±‚ï¼Œçº¿ç¨‹æ­£åœ¨ç­‰å¾…è¡¨é”ï¼› analying and statisticsï¼šçº¿ç¨‹æ­£åœ¨æ”¶é›†å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶å£°ç§°æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚ copying to temp tableï¼šçº¿ç¨‹æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœå¤åˆ¶åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸€èˆ¬ä¸º GROUP BY æ“ä½œï¼Œè¦ä¹ˆæ˜¯æ–‡ä»¶æ’åºï¼Œæˆ– UNIONï¼› on diskï¼šå°†å†…å­˜ä¸­çš„ä¸´æ—¶è¡¨æ”¾åˆ°ç£ç›˜ä¸Šï¼› sorting resultï¼šçº¿ç¨‹æ­£åœ¨å¯¹ç»“æœé›†è¿›è¡Œæ’åºï¼› sending dataï¼šçº¿ç¨‹åœ¨å¤šä¸ªçŠ¶æ€ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œæˆ–ç”Ÿæˆç»“æœé›†ï¼Œæˆ–å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ã€‚ æ‰§è¡Œé¡ºåºï¼ˆå¹¶ä¸ç»å¯¹ï¼Œæ¯”å¦‚åœ¨ select ç­›é€‰å‡ºæ‰¾åˆ°çš„æ•°æ®é›†ï¼‰ï¼š å…³ç³»ç»“æ„ï¼šFROMï¼ŒONï¼ŒJOIN ç­›é€‰æ•°æ®ï¼šWHEREï¼ŒGROUP BYï¼ŒHAVINGï¼ŒSELECT å±•ç¤ºæ•°æ®ï¼šORDER BYï¼ŒLIMIT åˆ†ç»„ï¼š WHERE è¿‡æ»¤è¡Œï¼ˆåœ¨æ•°æ®åˆ†ç»„å‰ï¼‰ï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ UNION è‡ªåŠ¨å»é™¤é‡å¤è¡Œï¼Œå¦‚æœæƒ³è¿”å›æ‰€æœ‰ï¼Œä½¿ç”¨UNION ALL UNION åçš„ ORDER BY ä¼šæ’åºæ‰€æœ‰ç»“æœ havingå’Œwhereçš„åŒºåˆ«ï¼Ÿ WHERE å­å¥ç”¨æ¥ç­›é€‰ FROM å­å¥ä¸­æŒ‡å®šçš„æ“ä½œæ‰€äº§ç”Ÿçš„è¡Œã€‚ GROUP BY å­å¥ç”¨æ¥åˆ†ç»„ WHERE å­å¥çš„è¾“å‡ºã€‚ HAVING å­å¥ç”¨æ¥ä»åˆ†ç»„çš„ç»“æœä¸­ç­›é€‰è¡Œã€‚ ä¼˜å…ˆçº§ï¼šwhere\u003e èšåˆè¯­å¥(sum,min,max,avg,count) \u003ehavingå­å¥ LIMIT LIMIT a,bï¼šè¿”å›ä»è¡Œ a å¼€å§‹çš„ b è¡Œï¼Œaä»0å¼€å§‹ã€‚ ç­‰åŒäºï¼šLIMIT b OFFSET a REGEXP åœ¨åˆ—å€¼å†…åŒ¹é…ï¼Œå¤´å°¾åŠ ä¸Š^ $ æ‰ä¸ LIKE ç­‰ä»·ã€‚ |ï¼šè¡¨ç¤º or [123]ï¼šåŒ¹é… 1 æˆ– 2 æˆ– 3 ï¼Œå¯ä»¥å†™æˆ[1-3] [^123]ï¼šåŒ¹é…é™¤äº† 1 æˆ– 2 æˆ– 3 ä¹‹å¤–çš„å­—ç¬¦ .ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ ï¼Ÿ:å‰ä¸€ä¸ªå­—ç¬¦å‡ºç° 0 æˆ– 1 æ¬¡ {n}ï¼šå‡ºç° n æ¬¡ ^ï¼šæ–‡æœ¬çš„å¼€å§‹ $ï¼šæ–‡æœ¬çš„ç»“å°¾ [[:\u003c:]]ï¼šè¯çš„å¼€å§‹ [[:\u003e:]]ï¼šè¯çš„ç»“å°¾ å‡½æ•° Concat()ï¼šè¿æ¥ LTrim()ã€RTrim()ï¼šå»æ‰å·¦è¾¹æˆ–å³è¾¹çš„æ‰€æœ‰ç©ºæ ¼ Upper()ã€Lower()ï¼šè½¬æ¢å¤§å°å†™ Soundex()ï¼šè¿”å›ç±»ä¼¼å‘éŸ³çš„ç»“æœ Date()ï¼šæ—¥æœŸï¼Œæ ¼å¼ä¸º yyyy-mm-dd Time()ï¼šæ—¶é—´ï¼Œæ ¼å¼ä¸º hh:mm:ss AVG()ï¼šæ±‚å¹³å‡æ•°ï¼Œå¿½ç•¥åˆ—å€¼ä¸ºnull çš„è¡Œ countï¼šè®¡æ•°ï¼Œcount(*)ç»Ÿè®¡è¡Œæ•°ï¼ŒåŒ…æ‹¬ null å€¼ï¼›count(column) å¿½ç•¥ null å€¼ countï¼ˆï¼‰ countï¼ˆcolï¼‰ï¼šç»Ÿè®¡æœ‰å€¼çš„ç»“æœæ•°ï¼Œä¸åŒ…æ‹¬null countï¼ˆ*ï¼‰ï¼šç»Ÿè®¡ç»“æœé›†çš„è¡Œæ•° 1. MyISAM åœ¨ COUNT(*) å…¨è¡¨éå¸¸å¿« -- ä¼˜åŒ–å‰ï¼šè¦æ‰«æå…¨è¡¨ select count(*) from world.city where id \u003e5; -- ä¼˜åŒ–åï¼šåªæ‰«æ5è¡Œ select (select count(*) from world.city) - count(*) from world.city where id \u003c= 5; 2. ç”¨ count ä¹Ÿå¯ä»¥å®ç° sum -- sum select sum(if(color='blue',1,0)) as blue,sum(if(color='red',1,0)) as red from items -- count select count(color = 'blue' or null) as blue,count(color='red' or null) as red from items Match+Against # ç»“æœæ— åº WHERE column LIKE '%word%' # ç»“æœæœ‰åº WHERE Match(column) Against('word') Match() æŒ‡å®šè¢«æœç´¢çš„åˆ—ï¼ŒAgainst() æŒ‡å®šè¦ä½¿ç”¨çš„æœç´¢è¡¨è¾¾å¼ã€‚ 12.1.6 æ•°æ®ç»“æ„ ï¼ˆ1ï¼‰æ•´æ•°ç±»å‹ tinyintï¼š8ä½ smallintï¼š16ä½ mediumintï¼š24ä½ intï¼š32ä½ bigintï¼š64ä½ é»˜è®¤å…è®¸è´Ÿå€¼ï¼š-2(n-1) ~ 2(n-1)-1 ï¼Œæ·»åŠ  unsigned å±æ€§ä¸å…è®¸è´Ÿå€¼ï¼ŒèŒƒå›´ä¸º 0 ~ 2n-1 int(11)ï¼šä¸ä¼šé™åˆ¶å€¼çš„åˆæ³•èŒƒå›´ï¼Œåªä¼šæ§åˆ¶æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ã€‚ IPv4åœ°å€ç”¨ unsigned int æ¥å­˜å‚¨ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šæ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œ INET_ATON() ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²IPåœ°å€è½¬æ¢ä¸ºä¸€ä¸ª32ä½çš„ç½‘ç»œåºåˆ—IPåœ°å€ INET_NTOAï¼šè®²ä¸€ä¸ª32ä½çš„ç½‘ç»œåºåˆ—IPåœ°å€è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²IPåœ°å€ ï¼ˆ2ï¼‰å®æ•°ç±»å‹ floatï¼š4 å­—èŠ‚ doubleï¼š8 å­—èŠ‚ ï¼ˆ3ï¼‰å­—ç¬¦ä¸²ç±»å‹ å­—ç¬¦æ–¹å¼ï¼ˆæœ‰æ’åºè§„åˆ™å’Œå­—ç¬¦é›†ï¼‰/äºŒè¿›åˆ¶æ–¹å¼ï¼ˆæ²¡æœ‰æ’åºè§„åˆ™æˆ–å­—ç¬¦é›†ï¼‰ varchar/varbinaryï¼šéœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨é•¿åº¦ char/binaryï¼šä¼šæˆªæ–­æœ€åçš„ç©ºæ ¼ã€‚é€‚åˆå­˜å‚¨ä»¥ä¸‹ç±»å‹ï¼š çŸ­å­—ç¬¦ä¸² ç­‰é•¿å­—ç¬¦ä¸²ï¼ˆå¦‚ MD5 å€¼ï¼‰ ç»å¸¸å˜æ›´çš„æ•°æ®ï¼Œå› ä¸ºä¸æ˜“äº§ç”Ÿç¢ç‰‡ tinytext/tinyblob smalltext/smallblob text/blob mediumtext/mediumblob longtext/longblob ï¼ˆ4ï¼‰ğŸŒŸæ—¶é—´ç±»å‹ datetimeï¼š8 å­—èŠ‚ timestamp æ—¶é—´æˆ³ï¼šä¸å®¹æ˜“äº§ç”Ÿæ­§ä¹‰ã€‚4 å­—èŠ‚ï¼Œä»1970å¹´1æœˆ1æ—¥åˆå¤œï¼ˆæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼‰ä»¥æ¥çš„ç§’æ•°ï¼Œæ™ºèƒ½è¡¨ç¤ºä»1970å¹´åˆ°2038å¹´ï¼Œé»˜è®¤ä¸º NOT NULL 12.1.7 è¡¨è®¾è®¡åŸåˆ™ é¿å…è¿‡åº¦è®¾è®¡ ä½¿ç”¨å°è€Œç®€å•çš„åˆé€‚æ•°æ®ç±»å‹ï¼Œå°½é‡é¿å…ä½¿ç”¨ NULL å€¼ï¼ˆé™¤éå¿…è¦ï¼‰ å°½é‡ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç±»å‹å­˜å‚¨ç›¸ä¼¼æˆ–ç›¸å…³çš„å€¼ æ³¨æ„å¯å˜é•¿å­—ç¬¦ä¸² å°½é‡ä½¿ç”¨æ•´å‹å®šä¹‰æ ‡è¯†åˆ— å°å¿ƒä½¿ç”¨ ENUM å’Œ SETï¼Œé¿å…ä½¿ç”¨ BIT alter table å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šé”è¡¨å¹¶é‡å»ºæ•´å¼ è¡¨ï¼Œå¯ä»¥åœ¨å¤‡æœºæ‰§è¡Œ alter å¹¶åœ¨å®ŒæˆåæŠŠå®ƒåˆ‡æ¢ä¸ºä¸»åº“ ","date":"2023-08-08","objectID":"/mysql_draft/:0:2","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"MySQL é…ç½®ä¼˜åŒ– è¿æ¥è¯·æ±‚çš„å˜é‡ max_connections back_logï¼ˆç¼“å­˜ä¸­å°šæœªå¤„ç†çš„è¿æ¥æ•°é‡ï¼‰ wait_timeoutï¼ˆéäº¤äº’å¼è¿æ¥ï¼‰ã€ interactive_timeoutï¼ˆäº¤äº’å¼è¿æ¥ï¼‰ ç¼“å†²åŒºå˜é‡ key_buffer_size query_cache_sizeï¼ˆæŸ¥è¯¢ç¼“å­˜ï¼Œç®€ç§°QCï¼‰ max_connect_errors sort_buffer_size max_allowed_packet = 32M join_buffer_size = 2M thread_cache_size = 300 Innodb ç›¸å…³å˜é‡ innodb_buffer_pool_size innodb_flush_log_at_trx_commit innodb_thread_concurrency = 0 innodb_log_buffer_size innodb_log_file_size = 50M innodb_log_files_in_group = 3 read_buffer_size = 1M read_rnd_buffer_size = 16M bulk_insert_buffer_size = 64M binary log ","date":"2023-08-08","objectID":"/mysql_draft/:0:3","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"å¦‚ä½•é€‰æ‹©æ°å½“æ•°æ®ç±»å‹ï¼Ÿ æ˜ç¡®ã€å°½é‡å°ã€‚ charã€varchar çš„é€‰æ‹© varcharé€‚ç”¨çš„åœºæ™¯ï¼š å­—ç¬¦ä¸²åˆ—çš„æœ€å¤§é•¿åº¦æ¯”å¹³å‡é•¿åº¦è¦å¤§å¾ˆå¤šï¼› å­—ç¬¦ä¸²åˆ—çš„æ›´æ–°å¾ˆå°‘æ—¶ï¼Œå› ä¸ºæ²¡æœ‰æˆ–å¾ˆå°‘æœ‰å†…å­˜ç¢ç‰‡é—®é¢˜ï¼› ä½¿ç”¨äº†UTF-8è¿™æ ·å¤æ‚çš„å­—ç¬¦é›†ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°è¿›è¡Œå­˜å‚¨ï¼› charé€‚ç”¨çš„åœºæ™¯ï¼š åˆ—çš„é•¿åº¦ä¸ºå®šå€¼æ—¶é€‚åˆé€‚ç”¨ï¼Œæ¯”å¦‚ï¼šMD5å¯†æ–‡æ•°æ® text/blob/clob çš„ä½¿ç”¨é—®é¢˜ï¼Ÿ text åªèƒ½ä¿å­˜å­—ç¬¦æ•°æ®ï¼Œæ¯”å¦‚ä¸€éæ–‡ç« æˆ–æ—¥è®°ï¼› clobæŒ‡ä»£çš„æ˜¯å­—ç¬¦å¤§å¯¹è±¡ï¼Œé€šå¸¸ç”¨æ¥å­˜å‚¨å¤§é‡çš„æ–‡æœ¬æ•°æ®ï¼Œå³å­˜å‚¨å­—ç¬¦æ•°æ®ï¼› blobæŒ‡ä»£çš„æ˜¯äºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®æˆ–æ–‡ä»¶ï¼Œå¸¸å¸¸ä¸ºå›¾ç‰‡æˆ–éŸ³é¢‘ã€‚ æ•°å€¼çš„ç²¾åº¦é—®é¢˜ï¼Ÿ decimalçš„å­˜å‚¨ç»“æœæ²¡æœ‰ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€‚å› ä¸ºdecimalå†…éƒ¨ä»¥å­—ç¬¦å½¢å¼å­˜å‚¨å°æ•°ï¼Œå±äºå‡†ç¡®å­˜å‚¨ã€‚è€Œfloatå’Œ doubleç­‰åˆ™å±äºæµ®ç‚¹æ•°æ•°å­—å­˜å‚¨ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°å‡†ç¡®ï¼Œåªèƒ½å°½å¯èƒ½è¿‘ä¼¼ã€‚ æ˜¯å¦ä½¿ç”¨å¤–é”® å¤–é”®æä¾›çš„å‡ ç§åœ¨æ›´æ–°å’Œåˆ é™¤æ—¶çš„ä¸åŒè¡Œä¸ºéƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§å’Œå¼•ç”¨åˆæ³•æ€§ï¼Œä½†æ˜¯å¤–é”®çš„ä½¿ç”¨ä¹Ÿéœ€è¦æ•°æ®åº“æ‰¿æ‹…é¢å¤–çš„å¼€é”€ï¼Œåœ¨å¤§å¤šæ•°æœåŠ¡éƒ½å¯ä»¥æ°´å¹³æ‰©å®¹çš„ä»Šå¤©ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨å¤–é”®ç¡®å®ä¼šå½±å“æœåŠ¡çš„ååé‡ä¸Šé™ã€‚ å¦‚æœä¸ä½¿ç”¨å¤–é”®ç‰ºç‰²äº†æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å´èƒ½å¤Ÿå‡å°‘æ•°æ®åº“çš„è´Ÿè½½ï¼›å¦‚æœä½¿ç”¨å¤–é”®ä¿è¯äº†æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°†å…¨éƒ¨çš„è®¡ç®—ä»»åŠ¡å…¨éƒ¨äº¤ç»™äº†æ•°æ®åº“ã€‚ ","date":"2023-08-08","objectID":"/mysql_draft/:0:4","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"æ•°æ®åº“ç¢ç‰‡é—®é¢˜ï¼Ÿ æŸ¥çœ‹ç¢ç‰‡æ˜¯å¦äº§ç”Ÿï¼š show table status from table_name\\G; æ¸…ç†åŠæ³•ï¼š MyISAMï¼š optimize table è¡¨åï¼› # ï¼ˆOPTIMIZE å¯ä»¥æ•´ç†æ•°æ®æ–‡ä»¶,å¹¶é‡æ’ç´¢å¼•ï¼‰ Innodbï¼š # 1. é‡å»ºè¡¨å­˜å‚¨å¼•æ“ï¼Œé‡æ–°ç»„ç»‡æ•°æ® ALTER TABLE tablename ENGINE=InnoDB; # 2. è¿›è¡Œä¸€æ¬¡æ•°æ®çš„å¯¼å…¥å¯¼å‡º ","date":"2023-08-08","objectID":"/mysql_draft/:0:5","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"OLTP å’Œ OLAP OLTP = online transaction processing åœ¨çº¿äº‹åŠ¡å¤„ç† OLAP = online analytic processing åœ¨çº¿åˆ†æå¤„ç† ETL = Extract-Transform-Loadï¼Œæå–-è½¬æ¢-åŠ è½½ å±æ€§ OLTP OLAP è¯» åŸºäºkeyï¼Œæ¯æ¬¡æŸ¥è¯¢è¿”å›å°‘é‡è®°å½• å¯¹å¤§é‡è®°å½•è¿›è¡Œæ±‡æ€» å†™ éšæœºè®¿é—®ï¼Œä½å»¶è¿Ÿå†™å…¥ æ‰¹é‡å¯¼å…¥ï¼ˆETLï¼‰æˆ–äº‹ä»¶æµ ä½¿ç”¨åœºæ™¯ ç»ˆç«¯ç”¨æˆ·ï¼Œé€šè¿‡ç½‘ç»œåº”ç”¨ç¨‹åº å†…éƒ¨åˆ†æå¸ˆï¼Œæ”¯æŒå†³ç­– æ•°æ®è¡¨å¾ æœ€æ–°çš„æ•°æ®çŠ¶æ€ éšç€æ—¶é—´å˜åŒ–çš„æ‰€æœ‰äº‹ä»¶å†å² æ•°æ®è§„æ¨¡ GBåˆ°TB TBåˆ°PB ","date":"2023-08-08","objectID":"/mysql_draft/:0:6","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"é” åŠ é”æƒ…å†µåˆ—ä¸¾ selectï¼šä¸€è‡´æ€§è¯»ï¼Œè¯»å¿«ç…§ï¼Œä»…å½“ serializable éš”ç¦»çº§åˆ«æ‰ä¸Šä¸´é”®é”æˆ–ç´¢å¼•è®°å½•é”ã€‚ updateï¼šæ’ä»–ä¸´é”®é”æˆ–ç´¢å¼•è®°å½•é”ã€‚å½“ä¿®æ”¹èšé›†ç´¢å¼•è®°å½•æ—¶ï¼Œå°†å¯¹äºŒçº§ç´¢å¼•è®°å½•è¿›è¡Œéšå¼é”å®šï¼Œå¯¹å—å½±å“çš„äºŒçº§ç´¢å¼•è®°å½•è®¾ç½®å…±äº«é”ã€‚ deleteï¼šæ’ä»–ä¸´é”®é”æˆ–ç´¢å¼•è®°å½•é”ã€‚ insertï¼šæ’å…¥æ„å‘é—´éš™é”+å¯¹æ’å…¥çš„è¡Œè®¾ç½®æ’ä»–é”ï¼Œä»…ç´¢å¼•è®°å½•é”ï¼Œæ²¡æœ‰é—´éš™é”ï¼Œä¸ä¼šé˜»æ­¢å…¶ä»–ä¼šè¯æ’å…¥æ–°è¡Œåˆ°å‰é¢çš„é—´éš™ä¸­ã€‚å¦‚æœé”®é‡å¤ï¼Œåˆ™åœ¨é‡å¤çš„ç´¢å¼•è®°å½•ä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é”ï¼Œé‡åˆ°æ’ä»–é”æœ‰æ­»é”é£é™©ã€‚ insert ... on duplicate key updateï¼šé”®é‡å¤æ—¶è®¾ç½®æ’ä»–é” è¡¨çº§é”ï¼ˆMyISAMï¼‰ï¼š intention lockï¼šæ„å‘é”ï¼Œè¡¨æ˜å½“å‰äº‹åŠ¡ç¨åè¦å¯¹è¡¨ä¸­çš„è¡Œè¿›è¡Œå“ªç§ç±»å‹çš„é”å®š IX é”ï¼šæ’ä»–æ„å‘é” IS é”ï¼šå…±äº«æ„å‘é” auto-inc lockï¼šè‡ªå¢é”ï¼Œinnodb_autoin_lock_mode å¯ä»¥æ§åˆ¶æ˜¯å¦æ‰“å¼€è‡ªå¢é” å¼€å¯ï¼šä¿è¯è‡ªå¢åºåˆ— å…³é—­ï¼šinsert æ“ä½œé«˜å¹¶å‘ Xé”ä¸ä»»ä½•é”éƒ½å†²çªï¼ŒIXé”ä¸Sé”å†²çªï¼Œå…¶ä»–é”ä¹‹é—´æ˜¯å…¼å®¹çš„ã€‚ é”ç±»å‹çš„å…¼å®¹æ€§ X IX S IS X å†²çª å†²çª å†²çª å†²çª IX å†²çª å…¼å®¹ å†²çª å…¼å®¹ S å†²çª å†²çª å…¼å®¹ å…¼å®¹ IS å†²çª å…¼å®¹ å…¼å®¹ å…¼å®¹ è¡Œçº§é”ï¼ˆInnoDBï¼‰ï¼š è®°å½•é” record lockï¼šå§‹ç»ˆé”å®šç´¢å¼•è®°å½•ï¼Œå³ä½¿æ²¡æœ‰å®šä¹‰ç´¢å¼•çš„è¡¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ é—´éš™é” gap lockï¼š å¯¹ç´¢å¼•è®°å½•å‰åçš„é—´éš™è¿›è¡Œé”å®šã€‚â€œçº¯æŠ‘åˆ¶æ€§çš„â€ï¼Œå”¯ä¸€ç›®çš„æ˜¯é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨é—´éš™ä¸­æ’å…¥ï¼Œä¸åŒäº‹åŠ¡å¯ä»¥åœ¨åŒä¸€ä¸ªé—´éš™ä¸ŠæŒæœ‰å†²çªé”ã€‚ RCéš”ç¦»çº§åˆ«ä¼šæ˜¾å¼ç¦ç”¨é—´éš™é”ã€‚åœ¨ WHERE æ¡ä»¶è®¡ç®—å®Œæˆå, ä¼šâ½´å³é‡Šæ”¾ä¸åŒ¹é…â¾çš„è®°å½•é”ã€‚ å¯¹äº UPDATE è¯­å¥, InnoDBæ‰§â¾â€œåŠâ¼€è‡´æ€§è¯»(semi-consistent)â€, å°†æœ€æ–°çš„æäº¤ç‰ˆæœ¬è¿”å›ç»™MySQL, ä»¥ä¾¿MySQLç¡®å®šè¯¥â¾æ˜¯å¦ä¸ UPDATE çš„ WHERE æ¡ä»¶åŒ¹é…ã€‚ é—´éš™é”åœ¨æœç´¢å’Œç´¢å¼•æ‰«ææ—¶ä¼šè¢«ç¦â½¤, åªâ½¤äºå¤–é”®çº¦æŸæ£€æŸ¥å’Œé‡å¤é”®æ£€æŸ¥ã€‚ ä¸´é”®é” = è®°å½•é” + é—´éš™é”ï¼ˆè®°å½•ä¹‹å‰çš„é—´éš™ï¼‰next-key lock æ’å…¥æ„å‘é” insert intention lock è°“è¯é”ï¼šç©ºé—´ç´¢å¼•ä½¿ç”¨ï¼Œå¯¹åŒ…å« MBRï¼ˆminimum bounding rectangle, æœ€â¼©è¾¹ç•ŒçŸ©å½¢ï¼‰çš„ç´¢å¼•å¼ºåˆ¶æ‰§â¾â¼€è‡´æ€§è¯»ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½æ’å…¥æˆ–ä¿®æ”¹ã€‚ æ­»é”ï¼š å¾ªç¯ç­‰å¾… äº’æ–¥ è¯·æ±‚å’Œä¿æŒ ä¸å¯å‰¥å¤º å‡å°‘æ­»é”ï¼š ä¼˜å…ˆä½¿ç”¨äº‹åŠ¡ è®©æ‰§è¡Œ insert æˆ– update çš„äº‹åŠ¡è¶³å¤Ÿå° ä¸º update ç›¸å…³çš„åˆ—åˆ›å»ºç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨explain select æ¥ç¡®å®šé»˜è®¤ä½¿ç”¨å“ªä¸ªç´¢å¼• ç”¨æŸ¥çœ‹æœ€è¿‘å‘ç”Ÿçš„æ­»é”ï¼šshow engine innodb status æ‰“å°æ­»é”ç›¸å…³ä¿¡æ¯ï¼šinnodb_print_all_deadlocks é€‰é¡¹ å¦‚æœç»å¸¸å‘ç”Ÿæ­»é”ï¼Œä½¿ç”¨ Read Committed éš”ç¦»çº§åˆ«ï¼Œè¿™æ ·åŒä¸€äº‹åŠ¡ä¸­çš„æ¯æ¬¡ä¸€è‡´æ€§è¯»ï¼Œéƒ½æ˜¯ä»è‡ªå·±çš„æ–°å¿«ç…§ä¸­è¯»å– å®åœ¨ä¸è¡Œï¼Œä½¿ç”¨ LOCK TABLES è¯­å¥ï¼Œè¡¨çº§é”å¯ä»¥é˜²æ­¢å…¶ä»–ä¼šè¯å¯¹è¿™å¼ è¡¨è¿›è¡Œå¹¶å‘æ›´æ–° SET autocommit=0; LOCK TABLES t1 WRITE, t2 READ; ... do something with tables t1 and t2 here ... COMMIT; UNLOCK TABLES; ç¦ç”¨æ­»é”æ£€æµ‹ï¼šinnodb_deadlock_detect é€‰é¡¹ è¶…æ—¶äº‹åŠ¡å›æ»šï¼šinnodb_lock_wait_timeout é€‰é¡¹ ","date":"2023-08-08","objectID":"/mysql_draft/:0:7","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"14.1 MySQL ä¸»ä»å¤åˆ¶ ä¸»ä»å¤åˆ¶çš„å±€é™æ€§ï¼š ä¸»ä»å»¶è¿Ÿé—®é¢˜ åº”ç”¨ä¾§éœ€è¦é…åˆè¯»å†™åˆ†ç¦»æ¡†æ¶ ä¸è§£å†³é«˜å¯ç”¨é—®é¢˜ ","date":"2023-08-08","objectID":"/mysql_draft/:0:8","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"14.2 MySQL é«˜å¯ç”¨ 14.2.1 é«˜å¯ç”¨ æ›´å°‘çš„ä¸å¯æœåŠ¡æ—¶é—´ 1å¹´ = 365å¤© = 8760å°æ—¶ 99 -\u003e 8760*1% = 87.6 å°æ—¶ 99.9 -\u003e 8.76å°æ—¶ 99.99 -\u003e 0.876 å°æ—¶ = 52.6åˆ†é’Ÿ 99.999 -\u003e 5.26åˆ†é’Ÿ 14.2.2 MGRï¼šMySQL Group Replication ç‰¹ç‚¹ï¼š é«˜ä¸€è‡´æ€§ï¼šåŸºäº Paxos åè®®å®ç°ç»„å¤åˆ¶ é«˜å®¹é”™æ€§ï¼šè‡ªåŠ¨æ£€æµ‹æœºåˆ¶ï¼Œå†…ç½®é˜²è„‘è£‚ä¿æŠ¤æœºåˆ¶ é«˜æ‰©å±•æ€§ï¼šèŠ‚ç‚¹çš„å¢åŠ ä¸ç§»é™¤ä¼šè‡ªåŠ¨æ›´æ–°ç»„æˆå‘˜ä¿¡æ¯ï¼Œæ–°èŠ‚ç‚¹åŠ å…¥åï¼Œè‡ªåŠ¨ä»å…¶ä»–èŠ‚ç‚¹åŒæ­¥å¢é‡æ•°æ®ï¼Œç›´åˆ°ä¸å…¶ä»–èŠ‚ç‚¹æ•°æ®ä¸€è‡´ é«˜çµæ´»æ€§ï¼šæä¾›å•ä¸»æ¨¡å¼ï¼ˆå®•æœºåèƒ½è‡ªåŠ¨é€‰ä¸»ï¼Œåœ¨ä¸»èŠ‚ç‚¹è¿›è¡Œå†™å…¥ï¼‰å’Œå¤šä¸»æ¨¡å¼ï¼ˆæ”¯æŒå¤šèŠ‚ç‚¹å†™å…¥ï¼‰ æ­é…ä¸­é—´ä»¶ï¼š MySQL Shellï¼šé…ç½®ç®¡ç† InnoDB Cluster MySQL Routerï¼šæä¾›è´Ÿè½½å‡è¡¡å’Œåº”ç”¨è¿æ¥çš„æ•…éšœè½¬ç§» orchestratorï¼šé«˜å¯ç”¨å’Œå¤åˆ¶æ‹“æ‰‘ç®¡ç†å·¥å…·ï¼Œä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š ä¸€è‡´æ€§ç”± raft åè®®ä¿è¯ï¼Œæ•°æ®åº“ä¹‹é—´ä¸é€šä¿¡ ä¸€è‡´æ€§ç”±æ•°æ®åº“é›†ç¾¤ä¿è¯ï¼Œæ•°æ®åº“ç»“ç‚¹ä¹‹é—´é€šä¿¡ ","date":"2023-08-08","objectID":"/mysql_draft/:0:9","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"15.0 æ•°æ®åº“æ‹†åˆ† åˆ†åº“åˆ†è¡¨çš„é€‰æ‹©ï¼šå¦‚æœæ•°æ®æœ¬èº«çš„è¯»å†™å‹åŠ›è¾ƒå¤§ï¼Œç£ç›˜IOæˆä¸ºç“¶é¢ˆï¼Œé€‰æ‹©åˆ†åº“ï¼Œä½¿ç”¨ä¸åŒç£ç›˜å¯ä»¥å¹¶è¡Œæå‡æ•´ä¸ªé›†ç¾¤çš„å¹¶è¡Œæ•°æ®å¤„ç†èƒ½åŠ›ï¼›ç›¸åï¼Œé€‰æ‹©åˆ†è¡¨ï¼Œå‡å°‘å•è¡¨æ“ä½œçš„æ—¶é—´ã€‚ å•æœº MySQL çš„æŠ€æœ¯æ¼”è¿› è¯»å†™å‹åŠ›ï¼šå¤šæœºé›†ç¾¤ï¼Œä¸»ä»å¤åˆ¶ é«˜å¯ç”¨æ€§ï¼šæ•…éšœè½¬ç§»ï¼šMHAï¼ˆMaster High Availabilityï¼‰/MGR/Orchestrator å®¹é‡é—®é¢˜ï¼šæ•°æ®åº“æ‹†åˆ†ï¼Œåˆ†åº“åˆ†è¡¨ ä¸€è‡´æ€§é—®é¢˜ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒXA/æŸ”æ€§äº‹åŠ¡ å…¨éƒ¨æ•°æ®ï¼šæ•°æ®å¤åˆ¶ï¼Œä¸»ä»å¤åˆ¶ã€å¤‡ä»½ä¸é«˜å¯ç”¨ ä¸šåŠ¡åˆ†ç±»æ•°æ®ï¼šå‚ç›´åˆ†åº“åˆ†è¡¨ï¼Œåˆ†å¸ƒå¼æœåŠ¡åŒ–ã€å¾®æœåŠ¡ ä»»æ„æ•°æ®ï¼šæ°´å¹³åˆ†åº“åˆ†è¡¨ï¼Œåˆ†å¸ƒå¼ç»“æ„ã€ä»»æ„æ‰©å®¹ ","date":"2023-08-08","objectID":"/mysql_draft/:0:10","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"15.1 å‚ç›´æ‹†åˆ† ä¼˜ç‚¹ï¼š å•è¡¨å˜å°ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤ æå‡æ€§èƒ½ æ•°æ®å¤æ‚åº¦é™ä½ ä½œä¸ºå¾®æœåŠ¡æ”¹é€ çš„åŸºç¡€ ç¼ºç‚¹ï¼š åº“å˜å¤šï¼Œç®¡ç†å¤æ‚ å¯¹ä¸šåŠ¡ç³»ç»Ÿæœ‰è¾ƒå¼ºçš„ä¾µå…¥æ€§ æ”¹é€ è¿‡ç¨‹å¤æ‚ï¼Œå®¹æ˜“å‡ºæ•…éšœ æ‹†åˆ†æœ‰é™åº¦ åšæ³•ï¼š æ¢³ç†æ‹†åˆ†èŒƒå›´å’Œå½±å“èŒƒå›´ è¯„ä¼°å½±å“åˆ°çš„æœåŠ¡ å‡†å¤‡æ–°çš„æ•°æ®åº“é›†ç¾¤å¤åˆ¶æ•°æ® ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œå‘å¸ƒæ–°ç‰ˆä¸Šçº¿ ","date":"2023-08-08","objectID":"/mysql_draft/:0:11","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"15.2 æ°´å¹³æ‹†åˆ† ä¼˜ç‚¹ï¼š è§£å†³å®¹é‡é—®é¢˜ å¯¹ç³»ç»Ÿå½±å“å° éƒ¨åˆ†æå‡æ€§èƒ½å’Œç¨³å®šæ€§ ç¼ºç‚¹ï¼š é›†ç¾¤è§„æ¨¡å¤§ï¼Œç®¡ç†å¤æ‚ å¤æ‚SQLæ”¯æŒé—®é¢˜ æ•°æ®è¿ç§»é—®é¢˜ ä¸€è‡´æ€§é—®é¢˜ æ•°æ®çš„åˆ†ç±»ç®¡ç†ï¼š æ—¶é—´ æ ‡ç­¾ å­˜å‚¨ ä¸€å‘¨å†…ä¸‹å•ä½†æœªæ”¯ä»˜ çƒ­æ•°æ® æ•°æ®åº“å’Œå†…å­˜ ä¸‰ä¸ªæœˆå†… æ¸©æ•°æ® æ•°æ®åº“ï¼Œæä¾›æŸ¥è¯¢æ“ä½œ ä¸‰ä¸ªæœˆåˆ°ä¸‰å¹´ å†·æ•°æ® ä»æ•°æ®åº“åˆ é™¤ï¼Œå½’æ¡£åˆ°ä¾¿å®œçš„ç£ç›˜ï¼Œç”¨å‹ç¼©æ–¹å¼ï¼ˆtokuDBå¼•æ“ï¼‰å­˜å‚¨ï¼Œé‚®ä»¶æŸ¥è¯¢ ä¸‰å¹´ä»¥ä¸Š å†°æ•°æ® å¤‡ä»½åˆ°ç£ç›˜ä»‹è´¨ï¼Œä¸æä¾›ä»»ä½•æŸ¥è¯¢æ“ä½œ ","date":"2023-08-08","objectID":"/mysql_draft/:0:12","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"16.1 åˆ†å¸ƒå¼äº‹åŠ¡ å¼ºä¸€è‡´ï¼šXA å¼±ä¸€è‡´ï¼š ä¸ç”¨äº‹åŠ¡ï¼Œä¸šåŠ¡ä¾§è¡¥å¿å†²æ­£ æŸ”æ€§äº‹åŠ¡ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ ","date":"2023-08-08","objectID":"/mysql_draft/:0:13","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"16.2 XA åˆ†å¸ƒå¼äº‹åŠ¡ åˆå«ä¸¤é˜¶æ®µäº‹åŠ¡ï¼ˆ2PCï¼‰ ä¸»æµå¼€æºXAè§£å†³æ–¹æ¡ˆ Atomikos narayana seata TM å»ä¸­å¿ƒåŒ–ï¼Œé«˜æ€§èƒ½ å»ä¸­å¿ƒåŒ–ï¼Œé«˜æ€§èƒ½ ä¸­å¿ƒåŒ–ï¼Œä½æ€§èƒ½ï¼Œbugå¤š æ—¥å¿—å­˜å‚¨ ä»…æ–‡ä»¶ æ–‡ä»¶ï¼Œæ•°æ®åº“ æ–‡ä»¶ï¼Œæ•°æ®åº“ æ‰©å±•æ€§ å¥½ ä¸­ ä¸­ äº‹åŠ¡æ¢å¤ ä»…å•æœºäº‹åŠ¡æ¢å¤ æ”¯æŒé›†ç¾¤æ¨¡å¼æ¢å¤ é—®é¢˜å¤š XAå®ç° æ ‡å‡† æ ‡å‡† éæ ‡å‡† ","date":"2023-08-08","objectID":"/mysql_draft/:0:14","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"16.3 BASE æŸ”æ€§äº‹åŠ¡ï¼š å¯¹äºäº’è”ç½‘åº”ç”¨è€Œè¨€ï¼Œéšç€è®¿é—®é‡å’Œæ•°æ®é‡çš„æ¿€å¢ï¼Œä¼ ç»Ÿçš„å•ä½“æ¶æ„æ¨¡å¼å°†æ— æ³•æ»¡è¶³ä¸šåŠ¡çš„é«˜é€Ÿå‘å±•ã€‚è¿™æ—¶ï¼Œå¼€å‘è€…éœ€è¦æŠŠå•ä½“åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å°åº”ç”¨ï¼ŒæŠŠå•ä¸ªæ•°æ®åº“æŒ‰ç…§åˆ†ç‰‡è§„åˆ™æ‹†åˆ†ä¸ºå¤šä¸ªåº“å’Œå¤šä¸ªè¡¨ã€‚ æ•°æ®æ‹†åˆ†åï¼Œå¦‚ä½•åœ¨å¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹é—´ä¿è¯æœ¬åœ°äº‹åŠ¡çš„ACIDç‰¹æ€§åˆ™æˆä¸ºä¸€ä¸ªæŠ€æœ¯éš¾é¢˜ï¼Œå¹¶ä¸”ç”±æ­¤è€Œè¡ç”Ÿå‡ºäº†CAPå’ŒBASEç»å…¸ç†è®ºã€‚ CAPç†è®ºæŒ‡å‡ºï¼Œå¯¹äºåˆ†å¸ƒå¼çš„åº”ç”¨è€Œè¨€ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼ŒAï¼ˆå¯ç”¨æ€§ï¼‰ï¼ŒPï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œç”±äºç½‘ç»œåˆ†åŒºæ˜¯åˆ†å¸ƒå¼åº”ç”¨çš„åŸºæœ¬è¦ç´ ï¼Œå› æ­¤å¼€å‘è€…éœ€è¦åœ¨Cå’ŒAä¸Šåšå‡ºå¹³è¡¡ã€‚ ç”±äºCå’ŒAäº’æ–¥æ€§ï¼Œå…¶æƒè¡¡çš„ç»“æœå°±æ˜¯BASEç†è®ºã€‚ å¯¹äºå¤§éƒ¨åˆ†çš„åˆ†å¸ƒå¼åº”ç”¨è€Œè¨€ï¼Œåªè¦æ•°æ®åœ¨è§„å®šçš„æ—¶é—´å†…è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§å³å¯ã€‚æˆ‘ä»¬å¯ä»¥æŠŠç¬¦åˆä¼ ç»Ÿçš„ACIDå«åšåˆšæ€§äº‹åŠ¡ï¼ŒæŠŠæ»¡è¶³BASEç†è®ºçš„æœ€ç»ˆä¸€è‡´æ€§äº‹åŠ¡å«åšæŸ”æ€§äº‹åŠ¡ã€‚ ä¸€å‘³çš„è¿½æ±‚å¼ºä¸€è‡´æ€§ï¼Œå¹¶éæœ€ä½³æ–¹æ¡ˆã€‚å¯¹äºåˆ†å¸ƒå¼åº”ç”¨æ¥è¯´ï¼ŒåˆšæŸ”å¹¶æµæ˜¯æ›´åŠ åˆç†çš„è®¾è®¡æ–¹æ¡ˆï¼Œå³åœ¨æœ¬åœ°æœåŠ¡ä¸­é‡‡ç”¨å¼ºä¸€è‡´äº‹åŠ¡ï¼Œåœ¨è·¨ç³»ç»Ÿè°ƒç”¨ä¸­é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ã€‚å¦‚ä½•æƒè¡¡ç³»ç»Ÿçš„æ€§èƒ½ä¸ä¸€è‡´æ€§ï¼Œæ˜¯ååˆ†è€ƒéªŒæ¶æ„å¸ˆä¸å¼€å‘è€…çš„è®¾è®¡åŠŸåŠ›çš„ã€‚ æœ¬åœ°äº‹åŠ¡ -\u003e XA(2PC) -\u003e BASE æœ¬åœ°äº‹åŠ¡ 2PCã€3PCäº‹åŠ¡ æŸ”æ€§äº‹åŠ¡BASE ä¸šåŠ¡æ”¹é€  - - å®ç°ç›¸å…³æ¥å£ ä¸€è‡´æ€§ ä¸æ”¯æŒ æ”¯æŒ æœ€ç»ˆä¸€è‡´ éš”ç¦»å‹ ä¸æ”¯æŒ æ”¯æŒ ä¸šåŠ¡æ–¹ä¿è¯ å¹¶å‘æ€§èƒ½ æ— å½±å“ ä¸¥é‡è¡°é€€ ç•¥å¾®è¡°é€€ é€‚åˆåœºæ™¯ ä¸šåŠ¡æ–¹å¤„ç†ä¸ä¸€è‡´ çŸ­äº‹åŠ¡\u0026ä½å¹¶å‘ é•¿äº‹åŠ¡\u0026é«˜å¹¶å‘ BASEï¼š åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å‚ä¸æ–¹ä¸ä¸€å®šåŒæ—¶åœ¨çº¿ æŸ”æ€§çŠ¶æ€ï¼ˆSoft stateï¼‰ï¼šå…è®¸ç³»ç»Ÿæ›´æ–°æœ‰ä¸€å®šå»¶æ—¶ æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually consistentï¼‰ï¼šæ¶ˆæ¯ä¼ é€’æ–¹å¼ä¿è¯ç³»ç»Ÿæœ€ç»ˆä¸€è‡´æ€§ ACID æ˜¯åœ¨èµ„æºå±‚é¢éš”ç¦»äº‹åŠ¡ï¼ŒBASE æ˜¯åœ¨ä¸šåŠ¡é€»è¾‘å±‚é¢å®ç°äº’æ–¥ã€‚BASEé€šè¿‡æ”¾å®½å¼ºä¸€è‡´æ€§è¦æ±‚ï¼Œæ¥æ¢å–ç³»ç»Ÿååé‡çš„æå‡ã€‚ BASE æŸ”æ€§äº‹åŠ¡å¸¸è§æ¨¡å¼ï¼š TCCï¼šé€šè¿‡æ‰‹åŠ¨è¡¥å¿å¤„ç† ATï¼šé€šè¿‡è‡ªåŠ¨è¡¥å¿å¤„ç† ","date":"2023-08-08","objectID":"/mysql_draft/:0:15","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["draft"],"content":"16.4 TCC/AT ä»¥åŠç›¸å…³æ¡†æ¶ TCC æ¨¡å¼ï¼šå¯¹ä¸šåŠ¡çš„ä¾µå…¥å¼ºï¼Œæ”¹é€ çš„éš¾åº¦å¤§ã€‚ Try å‡†å¤‡ï¼šå°è¯•æ‰§è¡Œä¸šåŠ¡ï¼Œå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œé¢„ç•™ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰ï¼› Confirm ç¡®è®¤ï¼šæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œåªä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ï¼Œä¿è¯äº‹åŠ¡èƒ½ä¸”åªèƒ½æˆåŠŸä¸€æ¬¡ï¼› Cancel å–æ¶ˆï¼šé‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œæ“ä½œä¹Ÿæ»¡è¶³å¹‚ç­‰æ€§ã€‚ TCCéœ€è¦æ³¨æ„çš„å‡ ä¸ªé—®é¢˜ï¼š å…è®¸ç©ºå›æ»š é˜²æ‚¬æŒ‚æ§åˆ¶ å¹‚ç­‰è®¾è®¡ ATæ¨¡å¼ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œè‡ªåŠ¨ç”Ÿæˆåå‘SQL ","date":"2023-08-08","objectID":"/mysql_draft/:0:16","tags":["MySQL"],"title":"MySQL æ‚è®°","uri":"/mysql_draft/"},{"categories":["practice"],"content":"åŸºæ“è¦ç»ƒ6","date":"2023-08-08","objectID":"/mysql-50-%E9%A2%98/","tags":["MySQL"],"title":"MySQL 50 é¢˜","uri":"/mysql-50-%E9%A2%98/"},{"categories":["practice"],"content":"æ•°æ®æº -- åˆ›å»ºæ•°æ®åº“exercise create database exercise; -- ä½¿ç”¨æ•°æ®åº“exercise use exercise; -- åˆ›å»ºå­¦ç”Ÿè¡¨student create table student (Sno varchar(10) not null, Sname varchar(10) , Sage date , Ssex varchar(10) , primary key (Sno)); start transaction; insert into student values ('01', 'èµµé›·', '1990-01-01', 'ç”·'); insert into student values ('02', 'é’±ç”µ', '1990-12-21', 'ç”·'); insert into student values ('03', 'å­™é£', '1990-05-20', 'ç”·'); insert into student values ('04', 'æäº‘', '1990-08-06', 'ç”·'); insert into student values ('05', 'å‘¨æ¢…', '1991-12-01', 'å¥³'); insert into student values ('06', 'å´å…°', '1992-03-01', 'å¥³'); insert into student values ('07', 'éƒ‘ç«¹', '1989-07-01', 'å¥³'); insert into student values ('08', 'ç‹èŠ', '1990-01-20', 'å¥³'); commit; -- åˆ›å»ºç§‘ç›®è¡¨course create table course (Cno varchar(10) not null, Cname varchar(10) , Tno varchar(10) , primary key (Cno)); start transaction; insert into course values ('01', 'è¯­æ–‡', '02'); insert into course values ('02', 'æ•°å­¦', '01'); insert into course values ('03', 'è‹±è¯­', '03'); commit; -- åˆ›å»ºæ•™å¸ˆè¡¨teacher create table teacher (Tno varchar(10) not null, Tname varchar(10) , primary key (Tno)); strat transaction; insert into teacher values ('01', 'å¼ ä¸‰'); insert into teacher values ('02', 'æå››'); insert into teacher values ('03', 'ç‹äº”'); commit; -- åˆ›å»ºæˆç»©è¡¨ sc create table sc (Sno varchar (10) , Cno varchar (10) , score decimal(18,1), primary key (Sno, Cno)); start transaction; insert into SC values('01' , '01' , 80); insert into SC values('01' , '02' , 90); insert into SC values('01' , '03' , 99); insert into SC values('02' , '01' , 70); insert into SC values('02' , '02' , 60); insert into SC values('02' , '03' , 80); insert into SC values('03' , '01' , 80); insert into SC values('03' , '02' , 80); insert into SC values('03' , '03' , 80); insert into SC values('04' , '01' , 50); insert into SC values('04' , '02' , 30); insert into SC values('04' , '03' , 20); insert into SC values('05' , '01' , 76); insert into SC values('05' , '02' , 87); insert into SC values('06' , '01' , 31); insert into SC values('06' , '03' , 34); insert into SC values('07' , '02' , 89); insert into SC values('07' , '03' , 98); commit; ","date":"2023-08-08","objectID":"/mysql-50-%E9%A2%98/:0:1","tags":["MySQL"],"title":"MySQL 50 é¢˜","uri":"/mysql-50-%E9%A2%98/"},{"categories":["practice"],"content":"é—®é¢˜ æŸ¥è¯¢è¯¾ç¨‹ç¼–å· 01 æ¯” 02 é«˜çš„å­¦ç”Ÿçš„å­¦å·å’Œå§“å æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„å­¦å·ã€å§“åã€é€‰è¯¾æ•°å’Œæ€»æˆç»© æŸ¥è¯¢[æ²¡]å­¦è¿‡â€™å¼ ä¸‰â€™è€å¸ˆè¯¾çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å æŸ¥è¯¢å­¦è¿‡â€™å¼ ä¸‰â€™è€å¸ˆ[æ‰€æœ‰è¯¾]çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å æŸ¥è¯¢æ²¡æœ‰å­¦å…¨æ‰€æœ‰è¯¾çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å æŸ¥è¯¢å’Œ'01â€™å·åŒå­¦æ‰€å­¦è¯¾ç¨‹å®Œå…¨ç›¸åŒçš„å…¶ä»–åŒå­¦çš„å­¦å· æŒ‰å¹³å‡æˆç»©ä»é«˜åˆ°ä½æ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ä»¥åŠå¹³å‡æˆç»© æŸ¥è¯¢å„ç§‘æˆç»©æœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€å¹³å‡åˆ†ï¼Œå±•ç¤ºï¼šè¯¾ç¨‹å·ã€è¯¾ç¨‹åã€æœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€å¹³å‡åˆ†ã€åŠæ ¼ç‡ã€ä¸­ç­‰ç‡ã€ä¼˜è‰¯ç‡ã€ä¼˜ç§€ç‡ æŒ‰å„ç§‘æˆç»©æ’åºï¼Œå¹¶æ˜¾ç¤ºæ’å 80 85 85 90 æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ç¬¬ 2 ååˆ°ç¬¬ 3 åçš„å­¦ç”Ÿä¿¡æ¯å’Œè¯¥è¯¾ç¨‹æˆç»© ä½¿ç”¨åˆ†æ®µ(100-85,85-70,70-60,\u003c60)æ¥ç»Ÿè®¡å„ç§‘æˆç»©ï¼Œåˆ†åˆ«ç»Ÿè®¡å„åˆ†æ®µäººæ•°ï¼Œè¯¾ç¨‹ id å’Œè¯¾ç¨‹åç§° æŸ¥è¯¢å­¦ç”Ÿçš„å¹³å‡æˆç»©åŠå…¶åæ¬¡ æŸ¥è¯¢å‡ºåªæœ‰ä¸¤é—¨è¯¾ç¨‹çš„å…¨éƒ¨å­¦ç”Ÿçš„å­¦å·å’Œå§“å æŸ¥è¯¢ç”·å¥³ç”Ÿäººæ•° æŸ¥è¯¢ 1990 å¹´å‡ºç”Ÿçš„å­¦ç”Ÿåå• æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„è¯¾ç¨‹å’Œåˆ†æ•°æƒ…å†µ æŸ¥è¯¢é€‰ä¿®å¼ ä¸‰è€å¸ˆæ‰€æ•™è¯¾ç¨‹çš„å­¦ç”Ÿä¸­æœ€é«˜çš„å­¦ç”Ÿçš„å§“åå’Œæˆç»© æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹æˆç»©ç›¸åŒçš„å­¦ç”Ÿçš„å­¦å·ã€è¯¾ç¨‹å·ã€æˆç»© æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯ æŸ¥è¯¢å„å­¦ç”Ÿçš„å¹´é¾„ æŸ¥è¯¢ä¸‹å‘¨è¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ æŸ¥è¯¢ä¸‹ä¸ªæœˆè¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ ","date":"2023-08-08","objectID":"/mysql-50-%E9%A2%98/:0:2","tags":["MySQL"],"title":"MySQL 50 é¢˜","uri":"/mysql-50-%E9%A2%98/"},{"categories":["practice"],"content":"ç­”æ¡ˆ -- 1. æŸ¥è¯¢è¯¾ç¨‹ç¼–å· 01 æ¯” 02 é«˜çš„å­¦ç”Ÿçš„å­¦å·å’Œå§“å select a.s_id 'å­¦å·', c.s_name 'å§“å' from (select s_id, s_score 's01' from Score where c_id = '01') a inner join (select s_id, s_score 's02' from Score where c_id = '02') b on a.s_id = b.s_id inner join Student as c on c.s_id = a.s_id where s01 \u003e s02; -- 3. æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„å­¦å·ã€å§“åã€é€‰è¯¾æ•°å’Œæ€»æˆç»© select a.s_id 'å­¦å·', a.s_name 'å§“å', sum(ifnull(b.s_score, 0)) 'æ€»æˆç»©', count(b.c_id) 'é€‰è¯¾æ•°' from Student as a left join Score b on a.s_id = b.s_id group by a.s_id, a.s_name; -- 5. æŸ¥è¯¢[æ²¡]å­¦è¿‡'å¼ ä¸‰'è€å¸ˆè¯¾çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å select s_id 'å­¦å·', s_name 'å§“å' from Student where s_id not in (select s_id from Score where c_id = (select c_id from Course where t_id = (select t_id from Teacher where t_name = 'å¼ ä¸‰'))); select s_id 'å­¦å·', s_name 'å§“å' from Student where s_id not in (select s_id from Score as s inner join Course as c on s.c_id = c.c_id inner join Teacher t on c.t_id = t.t_id where t.t_name = 'å¼ ä¸‰'); -- 6. æŸ¥è¯¢å­¦è¿‡'å¼ ä¸‰'è€å¸ˆ[æ‰€æœ‰è¯¾]çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å select s.s_id 'å­¦å·', s.s_name 'å§“å' from Student as s inner join Score s2 on s.s_id = s2.s_id inner join Course c on s2.c_id = c.c_id inner join Teacher t on c.t_id = t.t_id where t.t_name = 'å¼ ä¸‰' group by s.s_id having count(*) = (select count(*) from Course c inner join Teacher t on c.t_id = t.t_id where t_name = 'å¼ ä¸‰' group by t.t_id, t.t_name); -- 10. æŸ¥è¯¢æ²¡æœ‰å­¦å…¨æ‰€æœ‰è¯¾çš„å­¦ç”Ÿçš„å­¦å·ã€å§“å select s.s_id 'å­¦å·', s.s_name 'å§“å' from Student as s left join Score s2 on s.s_id = s2.s_id group by s.s_id having count(distinct c_id) \u003c (select count(distinct c_id) from Course); -- 12. æŸ¥è¯¢å’Œ'01'å·åŒå­¦æ‰€å­¦è¯¾ç¨‹å®Œå…¨ç›¸åŒçš„å…¶ä»–åŒå­¦çš„å­¦å· select distinct s.s_id 'å­¦å·', s.s_name 'å§“å' from Student as s inner join Score s2 on s.s_id = s2.s_id -- å»é™¤é€‰äº† 01 å­¦ç”Ÿæ‰€å­¦è¯¾ç¨‹ä¹‹å¤–è¯¾ç¨‹çš„å­¦ç”Ÿ where s2.s_id not in (select s_id from Score where c_id not in (select c_id from Score where s_id = '01')) and s.s_id != '01' group by s.s_id, s.s_name having count(distinct c_id) = (select count(*) from Score where s_id = '01'); -- 17. æŒ‰å¹³å‡æˆç»©ä»é«˜åˆ°ä½æ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ä»¥åŠå¹³å‡æˆç»© select distinct s.s_id 'å­¦å·', st.s_name 'å§“å', c_01_score 'è¯­æ–‡', c_02_score 'æ•°å­¦', c_03_score 'è‹±è¯­', c_04_score 'å¥¥æ•°', avg_score 'å¹³å‡æˆç»©' from Score s inner join (select s_id, max(case when c_id = '01' then s_score end) 'c_01_score', max(case when c_id = '02' then s_score end) 'c_02_score', max(case when c_id = '03' then s_score end) 'c_03_score', max(case when c_id = '04' then s_score end) 'c_04_score', avg(s_score) 'avg_score' from Score group by s_id) s2 on s.s_id = s2.s_id inner join Student st on s.s_id = st.s_id order by avg_score desc; -- 18. æŸ¥è¯¢å„ç§‘æˆç»©æœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€å¹³å‡åˆ†ï¼Œå±•ç¤ºï¼šè¯¾ç¨‹å·ã€è¯¾ç¨‹åã€æœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€å¹³å‡åˆ†ã€åŠæ ¼ç‡ã€ä¸­ç­‰ç‡ã€ä¼˜è‰¯ç‡ã€ä¼˜ç§€ç‡ select sc.c_id 'è¯¾ç¨‹å·', c.c_name 'è¯¾ç¨‹å', max(sc.s_score) 'max', min(sc.s_score) 'min', avg(sc.s_score) 'avg', sum(IF(sc.s_score \u003e= 60, 1, 0)) / count(sc.s_id) 'åŠæ ¼ç‡', sum(IF(sc.s_score \u003e= 70 and sc.s_score \u003c 80, 1, 0)) / count(sc.s_id) 'ä¸­ç­‰ç‡', sum(IF(sc.s_score \u003e= 80 and sc.s_score \u003c 90, 1, 0)) / count(sc.s_id) 'ä¼˜è‰¯ç‡', sum(IF(sc.s_score \u003e= 90, 1, 0)) / count(sc.s_id) 'ä¼˜ç§€ç‡' from Score sc inner join Course c on sc.c_id = c.c_id group by sc.c_id; -- 19. æŒ‰å„ç§‘æˆç»©æ’åºï¼Œå¹¶æ˜¾ç¤ºæ’å 80 85 85 90 -- MySQL 8.0 çª—å£å‡½æ•°ï¼šä¸ä¼šæ”¹å˜è®°å½•æ¡æ•° -- row_number() æ’åºä¸ä¼šé‡å¤ 1 2 3 4 æ²¡æœ‰å¹¶åˆ— -- dense_rank() æœ‰å¹¶åˆ—ï¼Œ1 2 2 3 æœ€åä¸€åä¸ä¸€å®šç­‰äºæ€»äººæ•° -- rank() æœ‰å¹¶åˆ—ï¼Œ 1 2 2 4 æœˆè€ƒæ’å select *, rank() over (partition by c_id order by s_score desc) 'rank', dense_rank() over (partition by c_id order by s_score desc) 'dense_rank', row_number() over (partition by c_id order by s_score desc) 'row_number' from Score; # where c_id ='01'; -- æµ‹è¯•æœ€å·¦åŒ¹é…åŸåˆ™ CREATE INDEX idx_test2 ON Student (s_birth, s_name, s_sex); explain select s_name from Student where s_birth = '12345' # and s_name = 'èµµé›·' and s_sex = 'ç”·'; -- 22. æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æˆç»©ç¬¬ 2 ååˆ°ç¬¬ 3 åçš„å­¦ç”Ÿä¿¡æ¯å’Œè¯¥è¯¾ç¨‹æˆç»© -- row_number() æ’åºä¸ä¼šé‡å¤ 1 2 3 4 æ²¡æœ‰å¹¶åˆ— (è§ 19 é¢˜) select * from (select sc.c_id 'è¯¾ç¨‹å·', C.c_name 'è¯¾ç¨‹', sc.s_score 'åˆ†æ•°', row_number() over (partition by sc.c_id order by s_score desc) 'sort', st.* from Score sc inner join Student st on sc.s_id = st.s_id join Course C on sc.c_id = C.c_id) a where sort in (2, 3); -- 23. ä½¿ç”¨åˆ†æ®µ(100-85,85-70,70-60,\u003c60)æ¥ç»Ÿè®¡å„ç§‘æˆç»©ï¼Œåˆ†åˆ«ç»Ÿè®¡å„åˆ†æ®µäººæ•°ï¼Œè¯¾ç¨‹ id å’Œè¯¾ç¨‹åç§° select c.c_id 'è¯¾ç¨‹ id', c.c_name 'è¯¾ç¨‹åç§°', sum(IF(sc.s_score \u003c= 100 and sc.s_score \u003e 85, 1, 0)) '100-85', sum(IF(sc.s_score \u003c= 85 and sc.s_score \u003e 70, 1, 0)) '85-70', sum(IF(sc.s_score \u003c= 70 and sc.s_score \u003e 60, 1, 0)) '70-60', sum(IF(sc.s_score \u003c 60, 1, 0)) '\u003c60' from score as sc inner join Course c on sc.c_id = c.c_id group by c.c_id, c.c_name; -- 24. æŸ¥è¯¢å­¦ç”Ÿçš„å¹³å‡æˆç»©åŠå…¶åæ¬¡ -- å¯ä»¥æ²¡æœ‰ partition by select s.s_id 'å­¦å·', st.s_name 'å§“å', avg(s_score) 'å¹³å‡åˆ†', rank() over (order by avg(s.s_score) desc) 'rank' from Score s join Student st on s.s_id = st.s_id group by s.s_id; -- 27. æŸ¥è¯¢å‡ºåªæœ‰ä¸¤é—¨è¯¾ç¨‹çš„å…¨éƒ¨å­¦ç”Ÿçš„å­¦å·å’Œå§“å select s_id 'å­¦å·', s_name 'å§“å' from Student where s_id in (select s.s_id from Score s group by s.s_id having count(distinct s.c_id) = 2); -- 28. æŸ¥è¯¢ç”·å¥³ç”Ÿäººæ•° -- ä¸¤è¡Œ select s_sex, count(s_sex) from Student group by s_sex; -- åˆ—è½¬è¡Œï¼ŒåŒä¸€è¡Œå±•ç¤º select sum(if(s_sex = 'ç”·', 1, 0)) 'ç”·ç”Ÿæ•°', sum(if(s_sex = 'å¥³', 1, 0)) 'å¥³ç”Ÿæ•°' from Student; -- 31. æŸ¥è¯¢ 1990 å¹´å‡ºç”Ÿçš„å­¦ç”Ÿåå• -- æ—¥æœŸ varchar å­˜å‚¨æ—¶ï¼ˆä¸æ¨èï¼‰ select * from Student where s_birth like '1990%'; -- year() å‡½æ•°ï¼Œå…¼å®¹å¤šç§æ ¼å¼: -- YYYY-MM-DD -- YYYYMMDD -- YYYY/MM/DD -- YYMMDD select * from Student where year(s_birth) = 1990; -- 35. æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„è¯¾ç¨‹å’Œåˆ†æ•°æƒ…å†µ select s.s_id 'å­¦å·', s2.s_name 'å§“å', max(if(c.c_name = 'æ•°å­¦', s.s_score, null)) 'æ•°å­¦æˆç»©', max(if(c.c_name = 'è¯­æ–‡', s.s_score, null)) 'è¯­æ–‡æˆç»©', max(if(c.c_name = 'è‹±è¯­', s.s_score, null)) 'è‹±è¯­æˆç»©', max(if(c.c_name = 'å¥¥æ•°', s.s_score, null)) 'å¥¥æ•°æˆç»©' from Score s inner join Course c on s.c_id = c.c_id inner join Student s2 on s.s_id = s2.s_id group by s.s_id, s2.s_name; -- 40. æŸ¥è¯¢é€‰ä¿®å¼ ä¸‰è€å¸ˆæ‰€æ•™è¯¾ç¨‹çš„å­¦ç”Ÿä¸­æœ€é«˜çš„å­¦ç”Ÿçš„å§“åå’Œæˆç»© explain select * from (select sc.c_id 'è¯¾ç¨‹å·', c.c_name 'è¯¾ç¨‹å', sc.s_score 'æˆç»©', st.s_id 'å­¦å·', st.s_name 'å§“å', rank() over (partition by sc.c_id order by s_score desc) 'rank' from Score sc inner join Course c on sc.c_id = c.c_id inner join Student st on sc.s_id = st.s_id inner join Teacher t on c.t_id = t.t_id where t.t_name = 'å¼ ä¸‰') a where `rank` = 1; -- 41. æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹æˆç»©ç›¸åŒçš„å­¦ç”Ÿçš„å­¦å·ã€è¯¾ç¨‹å·ã€æˆç»© select s_id 'å­¦å·', c_id 'è¯¾ç¨‹å·', s_score 'æˆç»©' from Score where s_id = (select a.s_id as_id from (select s_id, s_score, count(*) count from Score group by s_id, s_score) a where count \u003e 1); -- 45. æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿä¿¡æ¯ select * from Student where s_id = (select s_id from Score group by s_id having count(distinct c_id) = (select count(*) from Course)); -- 46. æŸ¥è¯¢å„å­¦ç”Ÿçš„å¹´é¾„ -- datediffï¼ˆa,bï¼‰ä¸¤ä¸ªæ—¶é—´ç›¸å·®å‡ å¤© -- round å››èˆäº”å…¥å–æ•´ -- floor å‘ä¸‹å–æ•´ select s_id, s_name, s_birth, floor(DATEDIFF(now(), s_birth) / 365) from Student; -- 48. æŸ¥è¯¢ä¸‹å‘¨è¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ select *, week('1990-05-20', 1), week('2019-05-20', 1), concat(year(now()), substring(s_birth, 5, 6)) from Student -- weekå‡½æ•°å¯¹äºä¸åŒå¹´ä»½ä¼šæœ‰ä¸€ç‚¹é—®é¢˜ # where week(s_birth,1) = week(now(),1)+1 where week(now(), 1) + 1 = week(concat(year(now()), substring(s_birth, 5, 6)), 1); -- 50. æŸ¥è¯¢ä¸‹ä¸ªæœˆè¿‡ç”Ÿæ—¥çš„å­¦ç”Ÿ select * from Student # where month(s_birth) = if(month(now()) = 12, 1, month(now()) + 1) where month(s_birth) = month(date_add(now(),interval 1 month )); ","date":"2023-08-08","objectID":"/mysql-50-%E9%A2%98/:0:3","tags":["MySQL"],"title":"MySQL 50 é¢˜","uri":"/mysql-50-%E9%A2%98/"},{"categories":["interview"],"content":"æ˜¯ç”¨å¾—æœ€å¤šçš„æ•°æ®åº“äº†","date":"2023-08-08","objectID":"/mysql/","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"MySQL ä¸­çš„é” InnoDB å¼•æ“åŠ é”çš„æœ¬è´¨æ˜¯é”ä½ç´¢å¼•è®°å½•ï¼ˆå¯ä»¥ç†è§£ä¸º B+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼‰ã€‚åœ¨å¯é‡å¤è¯» RR çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œ ä¸€èˆ¬éƒ½åŠ ä¸´é”®é”ï¼Œå·¦å¼€å³é—­ ï¼ˆé˜²æ­¢å¹»è¯»ï¼‰ ä¸Šç•Œæ— ç©·é—´éš™é” å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢è®°å½•é” ","date":"2023-08-08","objectID":"/mysql/:0:1","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"Innodb å’Œ MyISAM çš„åŒºåˆ«ï¼Ÿ innodb æ”¯æŒäº‹åŠ¡å’Œå¤–é”® innodb é»˜è®¤è¡¨é”ï¼Œä½¿ç”¨ç´¢å¼•æ£€ç´¢æ¡ä»¶æ—¶æ˜¯è¡Œé”ï¼Œè€Œ myisam æ˜¯è¡¨é”ï¼ˆæ¯æ¬¡æ›´æ–°å¢åŠ åˆ é™¤éƒ½ä¼šé”ä½è¡¨ï¼‰ innodb å’Œ myisam çš„ç´¢å¼•éƒ½æ˜¯åŸºäº b+æ ‘ï¼Œä½† innodb çš„ b+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å­˜æ”¾æ•°æ®çš„ï¼Œmyisam çš„ b+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å­˜æ”¾æŒ‡é’ˆçš„ innodb æ˜¯èšç°‡ç´¢å¼•ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼Œä¸€å®šä¼šåŸºäºä¸»é”®æŸ¥è¯¢ï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•å°±ä¼šæŸ¥è¯¢ä¸¤æ¬¡ï¼Œmyisam æ˜¯éèšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•é‡Œä¿å­˜çš„æ˜¯æ•°æ®åœ°å€çš„æŒ‡é’ˆï¼Œä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯åˆ†å¼€çš„ã€‚ innodb ä¸å­˜å‚¨è¡¨çš„è¡Œæ•°ï¼Œæ‰€ä»¥ select count( _ )çš„æ—¶å€™ä¼šå…¨è¡¨æŸ¥è¯¢ï¼Œè€Œ myisam ä¼šå­˜æ”¾è¡¨çš„è¡Œæ•°ï¼Œselect count(_ï¼‰çš„æ—¶å€™ä¼šæŸ¥çš„å¾ˆå¿«ã€‚ MyISAM å­˜å‚¨é™åˆ¶ 256TBï¼Œæ›´é€‚åˆä½å¹¶å‘ã€å¼±ä¸€è‡´æ€§åœºæ™¯ï¼›Innodb å­˜å‚¨é™åˆ¶ 64TBï¼Œæ›´é€‚åˆé«˜å¹¶å‘ã€æ›´æ–°é¢‘ç¹çš„åœºæ™¯ã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:2","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€çš„ 6 ä¸ªéƒ¨åˆ† DDLï¼šData Define Languageï¼Œæ•°æ®å®šä¹‰è¯­è¨€ï¼Œå¦‚ CREATEã€ALTERã€DROP DMLï¼šData Manipulation Languageï¼Œæ•°æ®æ“ä½œè¯­è¨€ï¼Œå¦‚ INSERTã€UPDATEã€DELETE DQLï¼šData Query Languageï¼Œæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¦‚ SELECTã€WHEREã€ORDER BYã€GROUP BYã€HAVING TCLï¼šTransactional Control Languageï¼Œäº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼Œç¡®ä¿ DML å½±å“çš„æ‰€æœ‰è¡ŒåŠæ—¶å¾—ä»¥æ›´æ–°ï¼Œå¦‚ COMMITã€SAVEPOINTã€ROLLBACK DCLï¼šData Control Languageï¼Œæ•°æ®æ§åˆ¶è¯­è¨€ï¼Œå®ç°æƒé™æ§åˆ¶ï¼Œå¦‚ GRANTã€REVOKE CCLï¼šCursor Control Languageï¼ŒæŒ‡é’ˆæ§åˆ¶è¯­è¨€ï¼Œå¦‚ DECLARE CURSORã€FETCH INTOã€UPDATE WHERE CURRENT ","date":"2023-08-08","objectID":"/mysql/:0:3","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"binlog ã€redolog å’Œ undolog çš„åŒºåˆ«ï¼Ÿ binlogï¼š æ‰€æœ‰å¼•æ“å¢é‡è®°å½•é€»è¾‘æ—¥å¿—ï¼ˆäºŒè¿›åˆ¶ï¼‰ æ•°æ®åº“è¿˜åŸ ä¸»ä»åŒæ­¥ï¼ˆCanal ç±»ä¸­é—´ä»¶æœ¬è´¨æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆä»èŠ‚ç‚¹ï¼‰ï¼š ä¸»åº“æäº¤ï¼Œå°† DDL ä¸ DML æ•°æ®å†™å…¥ binlogï¼› ä»åº“å°†ä¸»åº“çš„ binlog å†™å…¥è‡ªå·±çš„ä¸­ç»§æ—¥å¿— relay log ä»åº“æ‰§è¡Œ relay log ä¸­çš„äº‹ä»¶ sync_binlog = 0ï¼šå†™å…¥ page cache å°±ç®—æˆåŠŸï¼ˆé»˜è®¤ï¼‰ sync_binlog = Nï¼šæ¯æäº¤ N æ¬¡å°±åˆ·æ–°åˆ°ç£ç›˜ï¼ŒN è¶Šå°æ€§èƒ½è¶Šå·®ã€‚ redologï¼šInnoDB å¾ªç¯è®°å½•ç‰©ç†æ—¥å¿—ï¼ˆæŸä¸ªé¡µçš„ä¿®æ”¹ï¼‰ï¼Œå¤§å°å›ºå®šï¼Œå†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ï¼Œä¿è¯äº†æŒä¹…æ€§ã€‚ å…ˆæ›´æ–° buffer poolï¼Œå†å†™ redo logï¼Œç­‰äº‹åŠ¡ç»“æŸååˆ·ç›˜åˆ°ç£ç›˜ é¡ºåºå†™ï¼Œæ€§èƒ½ä¼˜äºéšæœºå†™ undologï¼š è®°å½•é€»è¾‘ç›¸åæ“ä½œé€»è¾‘æ—¥å¿—ï¼Œç”¨äºå›æ»š deleteï¼šè®°å½•ä¸»é”®é€»è¾‘åˆ é™¤ insertï¼šè®°å½•ä¸»é”® update æ²¡æœ‰æ›´æ–°ä¸»é”®ï¼šä¸»é”®+åŸå€¼ æ›´æ–°ä¸»é”®ï¼šdelete+insert äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ å®•æœºæƒ…å½¢ï¼š åœ¨ redo log åˆ·æ–°åˆ°ç£ç›˜ï¼ˆäº‹åŠ¡æäº¤ï¼‰ä¹‹å‰ï¼Œéƒ½æ˜¯å›æ»š undo logã€‚ å¦‚æœåœ¨ redo log å·²ç»åˆ·æ–°åˆ°ç£ç›˜ï¼Œåœ¨ MySQL é‡å¯ä¹‹åå°±ä¼šå›æ”¾è¿™ä¸ª redo logï¼Œä»¥çº æ­£æ•°æ®åº“é‡Œçš„æ•°æ®ã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:4","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"åˆ†åº“åˆ†è¡¨ - sharding-sphere ä¸­é—´ä»¶ æ°´å¹³åˆ†åº“ï¼šåº”å¯¹å¤§æ•°æ®ï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸åŒçš„æ•°æ®è¿›è¡Œåˆ†åº“ sync_binlog = 0/1 å‚ç›´åˆ†åº“ï¼šæ ¹æ®ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†å¾®æœåŠ¡ å‚ç›´åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»ï¼ˆé›¶é›¶æ’­é¡¹ç›®ä¸­çš„ userã€streamerã€ownerï¼‰ ","date":"2023-08-08","objectID":"/mysql/:0:5","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ç´¢å¼•åˆ†ç±» èšç°‡/éèšç°‡ï¼šå¶å­èŠ‚ç‚¹æ˜¯å¦å­˜å‚¨è¡Œæ•°æ® è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•åŒ…å«æŸæ¬¡æŸ¥è¯¢çš„æ‰€æœ‰åˆ— å”¯ä¸€ç´¢å¼• uniqueï¼šå¯ä»¥ä¸ºç©ºï¼Œä½†æœ€å¤šä¸€ä¸ªç©º ä¸»é”®ç´¢å¼• primary keyï¼šä¸èƒ½ä¸ºç©º å‰ç¼€ç´¢å¼•ï¼šå¯ä»¥é€‰æ‹©åœ¨ varchar(128)çš„åˆ—ä¸Šé€‰æ‹©å‰ 32 ä¸ªå­—ç¬¦ä½œä¸ºç´¢å¼• è”åˆç´¢å¼•ï¼šæœ€å·¦åŒ¹é…åŸåˆ™ å…¨æ–‡ç´¢å¼• full text ï¼šæ”¯æŒæ–‡æœ¬æ¨¡ç³ŠæŸ¥è¯¢ç”¨äº charã€varcharã€text å“ˆå¸Œç´¢å¼•ï¼šInnodb å’Œ MyISAM éƒ½ä¸é€‚ç”¨ ","date":"2023-08-08","objectID":"/mysql/:0:6","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"å¦‚ä½•ä½¿ç”¨æ…¢ SQL ä¼˜åŒ–ï¼Ÿ # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— SET GLOBAL slow_query_log = 'ON'; # è›®æŸ¥è¯¢æ—¥å¿—å­˜æ”¾ä½ç½® SET GLOBAL slow_query_log_file = 'var/lib/mysql/slow_query.log' # æœªè¢«ç´¢å¼•çš„è®°å½• SET GLOBAL log_queries_not_using_indexes = 'ON'; # æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆç§’ï¼‰ SET SESSION long_query_time = 1; # æ…¢æŸ¥è¯¢è®°å½•æ‰«æè¡Œæ•°é˜ˆå€¼ SET SESSION min_examined_row_limit = 100; æ‰¾åˆ°æ…¢ SQL ä¹‹åï¼Œç”¨ EXPLAIN å‘½ä»¤åˆ†æï¼š possible_keyï¼šå¯èƒ½ç”¨åˆ°çš„ç´¢å¼• keyï¼šå®é™…å‘½ä¸­çš„ç´¢å¼• key_lenï¼šç´¢å¼•å ç”¨çš„å¤§å° rowsï¼šæ‰«æçš„è¡Œæ•° filteredï¼šæ‰€éœ€æ•°æ®å  rows çš„æ¯”ä¾‹ extraï¼šé¢å¤–çš„ä¼˜åŒ–å»ºè®® Using whereï¼›Using Index ç”¨åˆ°ç´¢å¼•ï¼Œä¸ç”¨å›è¡¨ Using index** condition** ç”¨åˆ°ç´¢å¼•ï¼Œéœ€è¦å›è¡¨ typeï¼šæ€§èƒ½ä»å¥½åˆ°å·® systemï¼šmysql è‡ªå¸¦çš„è¡¨ constï¼šæ ¹æ®ä¸»é”®æŸ¥è¯¢ eq_refï¼šä¸»é”®ç´¢å¼•/å”¯ä¸€ç´¢å¼• refï¼šç´¢å¼•æŸ¥è¯¢ rangeï¼šèŒƒå›´æŸ¥è¯¢ indexï¼šç´¢å¼•æ ‘æ‰«æ allï¼šå…¨ç›˜æ‰«æ é€‰æ‹©ç´¢å¼•åˆ— æ•°æ®é‡å¤§ã€æŸ¥è¯¢é¢‘ç¹çš„è¡¨ï¼Œæ¶‰åŠ whereã€orderbyã€groupby é¢‘ç¹çš„å­—æ®µ åŒºåˆ†åº¦é«˜çš„å­—æ®µå»ºç«‹å”¯ä¸€ç´¢å¼•æˆ–æ”¾åœ¨å·¦è¾¹ å­—ç¬¦ä¸²ç±»å‹ä¼˜å…ˆä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå ç”¨ç©ºé—´æ›´å° not null çº¦æŸ ä¸é€‰æ‹©ç´¢å¼•æƒ…å†µ è¢«é¢‘ç¹æ›´æ–°çš„å­—æ®µ é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•ï¼šsys åº“çš„schema_unused_indexesè§†å›¾ ","date":"2023-08-08","objectID":"/mysql/:0:7","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ç´¢å¼•å¤±æ•ˆæƒ…å†µï¼Ÿ æ²¡æœ‰è¦†ç›–ç´¢å¼•ï¼Œå¦‚ select * è”åˆç´¢å¼•æœªéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ Mysql ä»å·¦åˆ°å³çš„ä½¿ç”¨ç´¢å¼•ä¸­çš„å­—æ®µï¼Œä¸€ä¸ªæŸ¥è¯¢å¯ä»¥åªä½¿ç”¨ç´¢å¼•ä¸­çš„ä¸€éƒ¨ä»½ï¼Œä½†åªèƒ½æ˜¯æœ€å·¦ä¾§éƒ¨åˆ† ä¾‹å¦‚ç´¢å¼•æ˜¯ key index ï¼ˆa,b,cï¼‰ã€‚ å¯ä»¥æ”¯æŒ a ã€a,b ã€a,b,c 3 ç§ç»„åˆè¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒ b,c è¿›è¡ŒæŸ¥æ‰¾ã€‚ èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ä¼šå¤±æ•ˆï¼ŒèŒƒå›´è¿‡å¤§ä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æ åœ¨ç´¢å¼•åˆ—ä¸Šè¿ç®—æ“ä½œ å¦‚æœæŸ¥è¯¢ä¸­å¿…é¡»ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼ï¼Œè€Œä¸”è¿™äº›å‡½æ•°æˆ–è¡¨è¾¾å¼æ— æ³•ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨è®¡ç®—åˆ—ï¼ˆComputed Columnï¼‰æ¥åŠ é€ŸæŸ¥è¯¢ã€‚è®¡ç®—åˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ—ï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡è®¡ç®—å¾—åˆ°çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥å­˜å‚¨åœ¨è¡¨ä¸­ã€‚åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿåˆ—ï¼ˆVirtual Columnï¼‰æˆ–å­˜å‚¨åˆ—ï¼ˆStored Columnï¼‰æ¥å®ç°è®¡ç®—åˆ—ã€‚è™šæ‹Ÿåˆ—æ˜¯ä¸€ç§åªå­˜åœ¨äºæŸ¥è¯¢ç»“æœä¸­çš„è®¡ç®—åˆ—ï¼Œå®ƒä¸ä¼šåœ¨è¡¨ä¸­å­˜å‚¨ä»»ä½•æ•°æ®ã€‚è™šæ‹Ÿåˆ—å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ¥è®¡ç®—ï¼Œä¾‹å¦‚ï¼šALTER TABLE table ADD COLUMN virtual_col INT AS (YEAR(date_col)) VIRTUAL; like â€˜%abcâ€™ or çš„å‰åæ¡ä»¶ä¸­æœ‰ä¸€ä¸ªåˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæ¶‰åŠçš„ç´¢å¼•ä¹Ÿå¤±æ•ˆ in()æŸ¥è¯¢æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½å‡å°‘å€¼åˆ—è¡¨çš„é•¿åº¦ï¼Œé¿å…æŸ¥è¯¢è½¬åŒ–æˆè¿‡é•¿çš„ OR å­å¥ï¼Œä»¥åŠé¿å…åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ NULL å€¼ã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:8","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ğŸŒŸ ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿ æ¯ä¸ªè¡¨åœ¨ MySQL ä¸­å¯¹åº”ç€ä¸€ä¸ªèšç°‡ç´¢å¼•å’Œå¤šä¸ªè¾…åŠ©ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ B+ æ ‘ã€‚æ¯ä¸ª B+ æ ‘ç´¢å¼•éƒ½åŒ…å«äº†ç›¸åº”ç´¢å¼•ç±»å‹çš„æ‰€æœ‰ç´¢å¼•é”®å€¼ï¼Œä½†å¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ B+ æ ‘ç´¢å¼•åŒ…å«äº†æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è¯´åœ¨ MySQL ä¸­ï¼Œæ¯ä¸ªè¡¨å¯¹åº”å¤šæ£µ B+ æ ‘ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ ä¸»é”® pk \u003e å”¯ä¸€ç´¢å¼• unique \u003e è‡ªåŠ¨ç”Ÿæˆ row_id éèšç°‡ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹å…³è”ä¸»é”®ï¼ŒæŒ‡å‘äº†æ•°æ®çš„å¯¹åº”è¡Œï¼Œè‹¥æ²¡æœ‰è¦†ç›–ç´¢å¼•åˆ™éœ€è¦å›è¡¨èµ°èšç°‡ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ï¼š ç”±äºè¡Œæ•°æ®å’Œå¶å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸€èµ·ï¼ŒåŒä¸€é¡µä¸­ä¼šæœ‰å¤šæ¡è¡Œæ•°æ®ï¼Œè®¿é—®åŒä¸€æ•°æ®é¡µä¸åŒè¡Œè®°å½•æ—¶ï¼Œå·²ç»æŠŠé¡µåŠ è½½åˆ°äº† Buffer ä¸­ï¼Œå†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œä¼šåœ¨å†…å­˜ä¸­å®Œæˆè®¿é—®ï¼Œä¸å¿…è®¿é—®ç£ç›˜ã€‚è¿™æ ·ä¸»é”®å’Œè¡Œæ•°æ®æ˜¯ä¸€èµ·è¢«è½½å…¥å†…å­˜çš„ï¼Œæ‰¾åˆ°å¶å­èŠ‚ç‚¹å°±å¯ä»¥ç«‹åˆ»å°†è¡Œæ•°æ®è¿”å›äº†ï¼Œå¦‚æœæŒ‰ç…§ä¸»é”® Id æ¥ç»„ç»‡æ•°æ®ï¼Œè·å¾—æ•°æ®æ›´å¿«ã€‚ è¾…åŠ©ç´¢å¼•ä½¿ç”¨ä¸»é”®ä½œä¸º\"æŒ‡é’ˆ\"è€Œä¸æ˜¯ä½¿ç”¨åœ°å€å€¼ä½œä¸ºæŒ‡é’ˆçš„å¥½å¤„æ˜¯ï¼Œå‡å°‘äº†å½“å‡ºç°è¡Œç§»åŠ¨æˆ–è€…æ•°æ®é¡µåˆ†è£‚æ—¶è¾…åŠ©ç´¢å¼•çš„ç»´æŠ¤å·¥ä½œï¼Œä½¿ç”¨ä¸»é”®å€¼å½“ä½œæŒ‡é’ˆä¼šè®©è¾…åŠ©ç´¢å¼•å ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œæ¢æ¥çš„å¥½å¤„æ˜¯ InnoDB åœ¨ç§»åŠ¨è¡Œæ—¶æ— é¡»æ›´æ–°è¾…åŠ©ç´¢å¼•ä¸­çš„è¿™ä¸ª\"æŒ‡é’ˆ\"ã€‚ä¹Ÿå°±æ˜¯è¯´è¡Œçš„ä½ç½®ï¼ˆå®ç°ä¸­é€šè¿‡ 16K çš„ Page æ¥å®šä½ï¼‰ä¼šéšç€æ•°æ®åº“é‡Œæ•°æ®çš„ä¿®æ”¹è€Œå‘ç”Ÿå˜åŒ–ï¼ˆå‰é¢çš„ B+æ ‘èŠ‚ç‚¹åˆ†è£‚ä»¥åŠ Page çš„åˆ†è£‚ï¼‰ï¼Œä½¿ç”¨èšç°‡ç´¢å¼•å°±å¯ä»¥ä¿è¯ä¸ç®¡è¿™ä¸ªä¸»é”® B+æ ‘çš„èŠ‚ç‚¹å¦‚ä½•å˜åŒ–ï¼Œè¾…åŠ©ç´¢å¼•æ ‘éƒ½ä¸å—å½±å“ã€‚ èšç°‡ç´¢å¼•é€‚åˆç”¨åœ¨æ’åºçš„åœºåˆï¼Œéèšç°‡ç´¢å¼•ä¸é€‚åˆ å–å‡ºä¸€å®šèŒƒå›´æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨ç”¨èšç°‡ç´¢å¼• äºŒçº§ç´¢å¼•éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ‰èƒ½å–åˆ°æ•°æ®ï¼Œå› ä¸ºå­˜å‚¨å¼•æ“ç¬¬ä¸€æ¬¡éœ€è¦é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼Œä»è€Œæ‰¾åˆ°æ•°æ®çš„ä¸»é”®ï¼Œç„¶ååœ¨èšç°‡ç´¢å¼•ä¸­ç”¨ä¸»é”®å†æ¬¡æŸ¥æ‰¾ç´¢å¼•ï¼Œå†æ‰¾åˆ°æ•°æ® å¯ä»¥æŠŠç›¸å…³æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚å®ç°ç”µå­é‚®ç®±æ—¶ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ· ID æ¥èšé›†æ•°æ®ï¼Œè¿™æ ·åªéœ€è¦ä»ç£ç›˜è¯»å–å°‘æ•°çš„æ•°æ®é¡µå°±èƒ½è·å–æŸä¸ªç”¨æˆ·çš„å…¨éƒ¨é‚®ä»¶ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Œåˆ™æ¯å°é‚®ä»¶éƒ½å¯èƒ½å¯¼è‡´ä¸€æ¬¡ç£ç›˜ I/Oã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:9","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ğŸŒŸSQL ä¼˜åŒ–ç»éªŒï¼Ÿ é¿å… select *ï¼Œä¸»æŸ¥è¯¢èšç°‡ç´¢å¼•ï¼Œå­æŸ¥è¯¢è¦†ç›–ç´¢å¼• **ç”¨ union all **ä»£æ›¿ unionï¼ˆå»é‡ã€æ’åºæ¶ˆè€—æ€§èƒ½ï¼‰ where è¯­å¥ä¸­ä¸ä½¿ç”¨è¡¨è¾¾å¼ï¼Œé˜²æ­¢ç´¢å¼•å¤±æ•ˆ èƒ½ç”¨ inner joinï¼ˆä¼˜å…ˆä»¥å°è¡¨é©±åŠ¨å¤§è¡¨ï¼‰ å°±ä¸ç”¨ left/right joinã€‚ å°† HAVING ä¸­éƒ¨åˆ†æ¡ä»¶æå‰åˆ° WHERE é‡Œ ç”¨ EXPLAIN è¿”å›çš„é¢„ä¼°è¡Œæ•° SELECT rows FROM (EXPLAIN SELECT * FROM xxx WHERE uid = 123) a; å°† RR é™ä½ä¸º RCï¼Œé¿å…ä¸´é”®é”å¼•å‘æ­»é”ï¼Œæé«˜æ€§èƒ½ã€‚ å¯ä»¥é€šè¿‡ç¼“å­˜ç¬¬ä¸€æ¬¡æ•°æ®ï¼Œæ¥é¿å…ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæ¥ä¿è¯å‡ ä¹å…¨éƒ¨äº‹åŠ¡å†…éƒ¨å¯¹æŸä¸€æ•°æ®éƒ½åªè¯»å–ä¸€æ¬¡ å¯ä»¥å•ç‹¬æŒ‡å®š Session æˆ–è€…äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:10","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"ğŸŒŸ å¹¶å‘äº‹åŠ¡é—®é¢˜ éš”ç¦»çº§åˆ« è„è¯»ï¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ® ä¸å¯é‡å¤è¯»ï¼šåŒä¸€äº‹åŠ¡å†…ï¼Œå…ˆåè¯»å–çš„æ•°æ®ä¸åŒï¼Œå› ä¸ºå…¶ä»–äº‹åŠ¡ update æˆ– delete ä¼šå½±å“ç»“æœé›†ã€‚ å¹»è¯»ï¼šåŒä¸€äº‹åŠ¡å†…ï¼Œå…ˆåè¯»å–çš„ count ä¸åŒã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢æ—¶æ²¡æœ‰æŸ idï¼Œæ’å…¥æ—¶ id å·²å­˜åœ¨ã€‚ åŸå› ï¼šåŠ é”åï¼Œä¸é”å®šé—´éš™ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥ INSERTï¼Œå¯¼è‡´ç›¸åŒçš„æŸ¥è¯¢åœ¨ä¸åŒçš„æ—¶é—´å¾—åˆ°ä¸åŒçš„ç»“æœã€‚ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä¸´é”®é”ï¼Œå¯¹äºä½¿ç”¨äº†å”¯ä¸€ç´¢å¼•ç­‰å”¯ä¸€æŸ¥è¯¢æ¡ä»¶ï¼ŒInnoDB åªé”å®šç´¢å¼•è®°å½•ï¼Œä¸é”å®šé—´éš™ï¼›å¯¹äºå…¶ä»–æŸ¥è¯¢æ¡ä»¶ï¼ŒInnoDB ä¼šé”å®šæ‰«æåˆ°çš„ç´¢å¼•èŒƒå›´ï¼Œé€šè¿‡ä¸´é”®é”æ¥é˜»æ­¢å…¶ä»–ä¼šè¯åœ¨è¿™ä¸ªèŒƒå›´ä¸­æ’å…¥æ–°å€¼ã€‚ RU è¯»æœªæäº¤ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»éƒ½ä¼šå‡ºç° RC è¯»å·²æäº¤ï¼šè§£å†³è„è¯»ï¼Œæ¯ä¸€æ¬¡å¿«ç…§è¯»æ—¶ç”Ÿæˆ** ReadView è¯»å–è‡ªå·±çš„æ–°å¿«ç…§** å¤šæ•°æ•°æ®åº“é»˜è®¤ ä»…æ”¯æŒåŸºäºè¡Œçš„ bin log å½“ä¸€ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶ï¼Œæ•°æ®åº“ä¼šä¸ºè¯¥äº‹åŠ¡åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬é“¾ï¼Œè¯¥ç‰ˆæœ¬é“¾åŒ…å«äº†æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®å¯¹è±¡çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚å½“äº‹åŠ¡è¯»å–æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šæ ¹æ®äº‹åŠ¡çš„å¯åŠ¨æ—¶é—´æˆ³é€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨ç‰ˆæœ¬é“¾ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œä»¥ä¿è¯è¯¥äº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ã€‚ RR å¯é‡å¤è¯»ï¼šè§£å†³ä¸å¯é‡å¤è¯»ï¼Œä»…ç¬¬ä¸€æ¬¡ç”Ÿæˆ ReadView çš„æ´»è·ƒäº‹åŠ¡ m_idsï¼Œåç»­å¤ç”¨ï¼ˆä¸€è‡´æ€§å¿«ç…§ï¼‰ èšç°‡ç´¢å¼•æ›´æ–° = æ›¿æ¢ï¼Œéèšç°‡ç´¢å¼•æ›´æ–° = åˆ é™¤+æ–°å»º MVCC = multiple version concurrent control å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ ç›®çš„ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé”çš„æ€§èƒ½å·®ï¼ŒMVCC å¯ä»¥é¿å…è¯»å†™é˜»å¡ DB_ROW_IDï¼šéšè—åˆ— DB_ROLL_PIRï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ç‰ˆæœ¬ ç‰ˆæœ¬é“¾å­˜å‚¨åœ¨ undo log ä¸­ DB_TRX_IDï¼šæœ€è¿‘ä¿®æ”¹çš„äº‹åŠ¡ id ç†è®ºä¸Š RR å­˜åœ¨å¹»è¯»ï¼Œä½† MySQL ä¸´é”®é” next key lock è§£å†³äº†å¹»è¯»é—®é¢˜ é—®ï¼šå¦‚ä½•ä¿è¯ REPEATABLE READ çº§åˆ«ç»å¯¹ä¸äº§â½£å¹»è¯»ï¼Ÿ ç­”ï¼šåœ¨ SQL ä¸­åŠ â¼Š** for update (æ’ä»–é”) æˆ– lock in share mode (å…±äº«é”)**è¯­å¥å®ç°ã€‚å°±æ˜¯é”ä½äº†å¯èƒ½é€ æˆå¹»è¯»çš„æ•°æ®ï¼Œé˜»â½Œæ•°æ®çš„å†™â¼Šæ“ä½œã€‚ Serializable ä¸²è¡ŒåŒ– åŠ é”è¯»ï¼šåœ¨æ¯ä¸€è¡Œæ•°æ®ä¸Šéƒ½åŠ é”ï¼Œå¯¼è‡´å¤§é‡çš„è¶…æ—¶å’Œé”äº‰ç”¨çš„é—®é¢˜ï¼Œåªæœ‰åœ¨éå¸¸éœ€è¦ç¡®ä¿æ•°æ®ä¸€è‡´æ€§å¹¶ä¸”å¯ä»¥æ¥å—æ²¡æœ‰å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ‰è€ƒè™‘é‡‡ç”¨è¯¥çº§åˆ« äº‹åŠ¡ç‰¹æ€§ Atomic åŸå­æ€§ ä¸€ä¸ªäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š é€šè¿‡ undo log è®°å½•é€»è¾‘æ—¥å¿—ï¼Œå›æ»šæ—¶é€šè¿‡é€†æ“ä½œæ¥æ¢å¤ ä¿å­˜ä½ç½®ï¼šsystem tablespace(mysql5.7) æˆ– undo tablespaces(mysql8.0) Consistent ä¸€è‡´æ€§ äº‹åŠ¡æ€»æ˜¯ç”±ä¸€ç§çŠ¶æ€è½¬æ¢ä¸ºå¦ä¸€ç§çŠ¶æ€ï¼Œè€Œä¸ä¼šåœç•™åœ¨æ‰§è¡Œä¸­çš„æŸä¸ªçŠ¶æ€ Aã€Iã€D åŒæ—¶ä½œç”¨ï¼Œä¿è¯äº† Cï¼ˆä¸€è‡´æ€§ï¼‰ Isolate éš”ç¦»æ€§ è¯»å†™éš”ç¦»ï¼šMVCCï¼Œundo log ç‰ˆæœ¬é“¾ï¼ˆä»æœ€æ–°è®°å½•ä¾æ¬¡æŒ‡å‘æœ€æ—§è®°å½•çš„é“¾è¡¨ï¼‰ï¼ŒReadView åœ¨ RC å’Œ RR çš„ä¸åŒ å†™å†™éš”ç¦»ï¼šé” Ddurable æŒä¹…æ€§ äº‹åŠ¡åªè¦æäº¤äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­çš„æ•°æ®ä¹Ÿæ°¸ä¹…çš„å‘ç”Ÿäº†å˜åŒ– é€šè¿‡ redo log å¢é‡è®°å½•æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼ŒæœåŠ¡å®•æœºæ—¶ç”¨æ¥åŒæ­¥æ•°æ®ï¼Œå…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ æ—¥å¿—æ–‡ä»¶ï¼šã€ib_logfile0ã€‘ã€ib_logfile1ã€‘ æ—¥å¿—ç¼“å†²ï¼šinnodb_logh_buffer_size å¼ºåˆ·ï¼šfsync() ","date":"2023-08-08","objectID":"/mysql/:0:11","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"delete/truncate/drop çš„åŒºåˆ«ï¼Ÿ DELETE åˆ é™¤è¡¨ä¸­çš„è¡Œï¼Œä¸åˆ é™¤è¡¨æœ¬èº« é¡¹ç›®ä¸­ä¸€èˆ¬ä½¿ç”¨é€»è¾‘åˆ é™¤ï¼Œå¢åŠ  deleted å­—æ®µ TRUNCATE åˆ é™¤è¡¨ï¼Œå†åˆ›å»ºä¸€ä¸ªç©ºè¡¨ åˆå§‹åŒ–æ•°æ® DROP åˆ é™¤è¡¨ ","date":"2023-08-08","objectID":"/mysql/:0:12","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"æ•°æ®è¿ç§» mysqldump -u root -p db_name \u003e 'Desktop/test.sql' åŠ å¿«å¯¼å…¥é€Ÿåº¦ å…³é—­å”¯ä¸€æ€§æ£€æŸ¥ å¼€å¯ extended-insert å°†å¤šè¡Œåˆå¹¶ä¸ºä¸€ä¸ª INSERT è¯­å¥ å…³é—­ binlogï¼Œè¿ç§»åå†å¼€å¯ è°ƒæ•´ redolog æ—¶æœº æ•°æ®æ ¡éªŒ å…ˆè¯» binlogï¼Œä¸ä¸€è‡´å†è¯»æºè¡¨ï¼Œä»¥æºè¡¨ä¸ºå‡†ã€‚ å…ˆè¯»ä»åº“ï¼Œä¸ä¸€è‡´å†è¯»ä¸»åº“ï¼Œä»¥ä¸»åº“ä¸ºå‡†ã€‚ å¢é‡åŒæ­¥æ•°æ® æ—¶é—´æˆ³ binlog ","date":"2023-08-08","objectID":"/mysql/:0:13","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"éš¾ç‚¹ Situationï¼šå‡ºç°ç¦»èŒäººå‘˜è¢«ä¼ä¸šå¾®ä¿¡æœºå™¨äºº at çš„é—®é¢˜ Action-Wrongï¼šåœ¨è§¦å‘æœºå™¨äººæ¶ˆæ¯çš„æ—¶å€™æŸ¥è¯¢äººå‘˜æœ€æ–°çŠ¶æ€æ˜¯å¦ç¦»èŒï¼Œç¦»èŒåˆ™ä¸ atã€æ²»æ ‡ä¸æ²»æœ¬ã€‘ Taskï¼šç”¨æˆ·ç™»å½•ä»¥åéœ€è¦æ›´æ–°å‡ ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥ï¼Œæœ€æ–°æ•°æ®æ¥è‡ªäºå…¶ä»–éƒ¨é—¨å‘˜å·¥è´¦æˆ·ä¸­å¿ƒçš„å¾®æœåŠ¡ï¼Œï¼ˆç»è¿‡é€‚é…å™¨è®¾è®¡æ¨¡å¼ï¼Œæœ‰äº›å­—æ®µéœ€è¦è½¬åŒ–ï¼Œæœ‰äº›å­—æ®µç›´æ¥å¤åˆ¶ï¼Œæ¯”å¦‚ç¦»èŒæ—¶é—´ä¸º null ä»£è¡¨æœªç¦»èŒï¼Œæ›´æ–°ä¸º 0ï¼‰ï¼Œä¿¡æ¯éœ€è¦é€šè¿‡ç”¨æˆ· id æŸ¥è¯¢ï¼Œä¸€ä¸ªæ¥å£åªèƒ½æŸ¥è¯¢ 100 æ¡ã€‚ Action-Wrongï¼šä¼šæœ‰æ­»é”çš„å¯èƒ½æ€§ï¼šå¹¶å‘+ä¸šåŠ¡è€—æ—¶ = ä¸¤ä¸ªä¸´é”®é”å‘ç”Ÿæ­»é” BEGIN; // for update ä¸ºæ‚²è§‚é” SELECT * FROM biz WHERE id = ? FOR UPDATE // ä¸­é—´æœ‰å¾ˆå¤šä¸šåŠ¡æ“ä½œ INSERT INTO biz(id, data) VALUE(?, ?); COMMIT; Actionï¼š âœ“ ä¸ç®¡æœ‰æ²¡æœ‰æ•°æ®ï¼Œç›´æ¥æ’å…¥ï¼Œè§„é¿æ­»é”ã€‚ è°ƒæ•´éš”ç¦»çº§åˆ«ä¸º RCï¼ˆå½±å“å¤ªå¤§ï¼‰ ä¹è§‚é”ï¼ˆæ•°æ®åº“çš„ CAS æ“ä½œï¼Œå¼•å…¥ version åˆ—ï¼Œæˆ–è€…ä½¿ç”¨ update_time æ¥ç¡®ä¿æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜æ›´ï¼‰ Result è§£å†³äº†é—®é¢˜ï¼ŒåŒæ—¶æœç»äº†æ­»é”çš„å‘ç”Ÿï¼Œå¦‚æœä½¿ç”¨ä¹è§‚é”è¿˜èƒ½æå‡æ€§èƒ½ã€‚ ","date":"2023-08-08","objectID":"/mysql/:0:14","tags":["MySQL"],"title":"ğŸš©MySQL","uri":"/mysql/"},{"categories":["interview"],"content":"äº”ç§åŸºç¡€æ•°æ®ç»“æ„ï¼Ÿ stringï¼šæœ€å¤§å­˜å‚¨512M hashï¼šhgetã€hmgetã€hsetã€hmset list å¯ä»¥ä½œä¸ºé˜Ÿåˆ—ï¼Œrpush ç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“lpopæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ï¼Œæˆ–è€…ä½¿ç”¨blpopï¼Œå®ƒåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ å¦‚æœæƒ³ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡ï¼Œå°±ä½¿ç”¨ pub/sub ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç°1ï¼šNçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä½†æ˜¯æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦é‡‡ç”¨æ›´ä¸“ä¸šçš„MQï¼Œå¦‚RabbitMQã€‚ set sorted set æ¯ä¸ªæˆå‘˜ä¼šæœ‰ä¸€ä¸ªåˆ†æ•°ä¸ä¹‹å…³è” å¯ä»¥å®ç°å»¶æ—¶é˜Ÿåˆ—ã€‚æ‹¿æ—¶é—´æˆ³ä½œä¸º scoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºkeyè°ƒç”¨ zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨ zrangebyscoreè·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ ","date":"2023-08-08","objectID":"/redis/:0:1","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"ğŸŒŸå¦‚ä½•ä¿è¯MySQLå’ŒRedisçš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ-åˆ†å¸ƒå¼é” å…ˆæ‹¿ setnxæ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œç”¨expireç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢å¿˜è®°é‡Šæ”¾å¼•å‘æ­»é”ã€‚setæŒ‡ä»¤æœ‰å¤æ‚çš„å‚æ•°ï¼Œæ˜¯æŠŠsetnxå’Œexpireåˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨ã€‚ ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”ï¼Œ**åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±åŠ çš„é”åªèƒ½è‡ªå·±å»è§£ã€‚**åªè¦å¤§å¤šæ•° Redis èŠ‚ç‚¹æ­£å¸¸ï¼Œå®¢æˆ·ç«¯å°±èƒ½æ­£å¸¸ä½¿ç”¨é”ã€‚ åº•å±‚ setnx é€šè¿‡ lua è„šæœ¬å®ç°ï¼Œä¿è¯åŸå­æ€§ã€‚ redisson å®ç°çš„åˆ†å¸ƒå¼é”å¯¹åŒä¸€çº¿ç¨‹å¯é‡å…¥ RedLock çº¢é”ï¼šåœ¨å¤šä¸ªå®ä¾‹ä¸Šåˆ›å»ºé”ï¼Œæ€§èƒ½å·®ï¼Œè¿èƒŒäº† Redis çš„ AP æ€æƒ³ï¼Œä¸å¦‚ä½¿ç”¨ zookeeper å®ç°å¼ºä¸€è‡´æ€§çš„ CP ç³»ç»Ÿ WatchDog çœ‹é—¨ç‹—ï¼šç»™æŒæœ‰é”çš„çº¿ç¨‹ç»­æœŸï¼ˆé»˜è®¤ 10sï¼‰ é«˜å¯ç”¨æ–¹æ¡ˆ-å¼‚æ­¥é€šçŸ¥ï¼šå°†binlogæ—¥å¿—é‡‡é›†å‘é€åˆ°MQé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åé€šè¿‡ACKæœºåˆ¶ç¡®è®¤å¤„ç†è¿™æ¡æ›´æ–°æ¶ˆæ¯ï¼Œåˆ é™¤ç¼“å­˜ï¼Œä¿è¯æ•°æ®ç¼“å­˜ä¸€è‡´æ€§ã€‚ ","date":"2023-08-08","objectID":"/redis/:0:2","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ RDBï¼ˆRedis DataBaseï¼‰ï¼šç”¨æ•°æ®é›†å¿«ç…§çš„æ–¹å¼åŠæŒä¹…åŒ–ï¼ˆé«˜æ•ˆï¼ŒæŒä¹…åŒ–ä¹‹é—´è®°å½•ä¼šä¸¢å¤±ï¼‰ AOFï¼ˆAppend-Only Fileï¼‰ï¼šæ‰€æœ‰çš„å‘½ä»¤è¡Œè®°å½•ä»¥ redis å‘½ä»¤è¯·æ±‚åè®®çš„æ ¼å¼å®Œå…¨æŒä¹…åŒ–å­˜å‚¨ä¿å­˜ä¸º aof æ–‡ä»¶ï¼ˆæ–‡ä»¶å¤§ã€å®‰å…¨ï¼‰ å¤‡ä»½ï¼š saveå¯ä»¥åœ¨ redis æ•°æ®ç›®å½•ç”Ÿæˆæ•°æ®æ–‡ä»¶ dump.rdb bgsave ç”¨å­çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œâ€œsave 300 10â€ è¡¨ç¤º 300s å†…æœ‰ 10 ä¸ª key è¢«ä¿®æ”¹å°±æ‰§è¡Œ bgsave appendonly é»˜è®¤å…³é—­ï¼Œè‹¥é…ç½®ä¸º yesï¼Œåˆ™ä»¥AOFæ–¹å¼å¤‡ä»½æ•°æ®ï¼Œåœ¨ç‰¹å®šçš„æ—¶å€™æ‰§è¡Œè¿½åŠ å‘½ä»¤ appendfsync everysec æ¯ç§’åˆ·ç›˜ bgrewriteaof é‡å†™ä¼˜åŒ– aof æ–‡ä»¶ æ¢å¤ï¼šé‡å¯æœåŠ¡ï¼Œè‡ªåŠ¨åŠ è½½redisæ•°æ®ç›®å½•çš„ dump.rdb ","date":"2023-08-08","objectID":"/redis/:0:3","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"è¿‡æœŸkeyçš„åˆ é™¤ç­–ç•¥ï¼Ÿ ä¸¤è€…é…åˆä½¿ç”¨ï¼š å®šæœŸï¼šè¯»å–é…ç½®server.hzçš„å€¼ï¼Œé»˜è®¤ä¸º10 æƒ°æ€§ï¼šget keyæ—¶ï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ï¼Œå¦‚æœæ²¡è¿‡æœŸå°±è¿”å› ","date":"2023-08-08","objectID":"/redis/:0:4","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"å“¨å…µSentinel - é«˜å¯ç”¨ é€šè¿‡å¿ƒè·³æœºåˆ¶ï¼Œæ¯ç§’å‘é€ ping å‘½ä»¤ï¼Œæ£€æŸ¥ master å’Œ slave æ˜¯å¦æŒ‰æœŸå·¥ä½œï¼Œåœ¨ master æ•…éšœæ—¶ï¼ŒSentinel å°†ä¸€ä¸ª slave æå‡ä¸º masterã€‚ è‡ªåŠ¨é€‰ä¸» é‡‡ç”¨ Raft å…±è¯†ç®—æ³•ï¼Œorder byï¼š æ–­çº¿æ—¶é—´è¶Šä½ ä¼˜å…ˆçº§è¶Šé«˜ slave-priority offset è¶Šå¤§ è¿è¡Œ id è¶Šå° Sentinelï¼ˆå“¨å…µï¼‰ä¸æä¾›è¯»å†™æœåŠ¡ï¼Œé»˜è®¤è¿è¡Œåœ¨ 26379 ç«¯å£ï¼Œå»ºè®®å¤šä¸ª sentinel èŠ‚ç‚¹ï¼ˆå‚æ•°ï¼šquorumï¼‰åä½œè¿è¡Œï¼Œé€šè¿‡æŠ•ç¥¨çš„æ–¹å¼æ¥é¿å…è¯¯åˆ¤ï¼š å•ä¸ªæœªå“åº”ï¼Œä¸»è§‚ä¸‹çº¿ å¤šä¸ªæœªå“åº”ï¼Œå®¢è§‚ä¸‹çº¿ è„‘è£‚ Sentinel ä¸ master å¤±è”ï¼Œé€‰å‡ºäº†æ–°çš„ masterâ€™ï¼Œäºæ˜¯è¦†ç›–äº†æ—§ master ç”¨æˆ·å†™å…¥çš„æ•°æ®ã€‚ è§£å†³æ–¹æ¡ˆï¼š min-replicas-to-write = 1ï¼šè‡³å°‘ 1 ä¸ª** slave æˆåŠŸå†™å…¥** min-replicas-max-lay = 5ï¼šåŒæ­¥å»¶è¿Ÿä¸è¶…è¿‡ 5s ","date":"2023-08-08","objectID":"/redis/:0:5","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"å›æ”¶ï¼ˆæ·˜æ±°ï¼‰ç­–ç•¥ï¼Ÿå¦‚ä½•ä¿è¯Redisé‡Œå­˜å‚¨çš„éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ no-envictionï¼šä¸æ·˜æ±°ï¼Œæ»¡äº†å°±æŠ¥é”™ï¼ˆé»˜è®¤ï¼‰ volatile-ï¼šä»å·²è¿‡æœŸçš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰ ttlï¼šå‰©ä½™ ttl è¶ŠçŸ­çš„ä¼˜å…ˆæ·˜æ±° randomï¼šéšæœº lruï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨ã€ä¸šåŠ¡æ•°æ®æœ‰å†·çƒ­åŒºåˆ†ï¼Œä¸”æœ‰ç½®é¡¶éœ€æ±‚ã€‘ lfuï¼šæœ€å°‘é¢‘ç‡ä½¿ç”¨ allkeys-ï¼šé’ˆå¯¹å…¨ä½“ randomã€æ— æ˜æ˜¾å†·çƒ­æ•°æ®åŒºåˆ†æ—¶ã€‘ lruã€ä¸šåŠ¡æ•°æ®æœ‰å†·çƒ­åŒºåˆ†ã€‘ lfuã€çŸ­æ—¶é«˜é¢‘ã€‘ ","date":"2023-08-08","objectID":"/redis/:0:6","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"ğŸŒŸä»€ä¹ˆæ˜¯ç©¿é€ã€å‡»ç©¿ä¸é›ªå´©ï¼Ÿ ç©¿é€ Qï¼šå¤§é‡å¹¶å‘æŸ¥è¯¢ä¸å­˜åœ¨çš„ keyï¼Œå¯¼è‡´å‹åŠ›ä¼ åˆ°æ•°æ®åº“ã€‚ Aï¼šè®©ç¼“å­˜èƒ½å¤ŸåŒºåˆ† key ä¸å­˜åœ¨å’ŒæŸ¥è¯¢åˆ°ä¸€ä¸ªç©ºå€¼ ç¼“å­˜ç©ºå€¼çš„ï¼ˆæ— æ•ˆçš„ï¼‰ keyï¼Œè¿™æ ·ç¬¬ä¸€æ¬¡ä¸å­˜åœ¨ä¹Ÿä¼šè¢«åŠ è½½å¹¶è®°å½•ï¼Œä¸‹æ¬¡æ‹¿åˆ°æœ‰è¿™ä¸ªkeyï¼› Bloomè¿‡æ»¤ã€åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‘æˆ–RoaringBitmap åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨ï¼›ï¼ˆRoaringBitMapå’Œbloom filteræœ¬è´¨ä¸Šéƒ½æ˜¯ä½¿ç”¨bitmapè¿›è¡Œå­˜å‚¨ã€bitmapçš„åº•å±‚æ•°æ®ç»“æ„å°±æ˜¯0/1bit çš„äºŒè¿›åˆ¶æ•°å€¼ï¼Œæœ€å¤§é•¿åº¦512Mb = 512 _ 1024 _ 1024 * 8 = 2^32ã€‘ã€‚ä½†bloom filter ä½¿ç”¨çš„æ˜¯å¤šä¸ªhashå‡½æ•°å¯¹å­˜å‚¨æ•°æ®è¿›è¡Œæ˜ å°„å­˜å‚¨ï¼Œå¦‚æœä¸¤ä¸ªæ¸¸æˆappIdç»è¿‡hashæ˜ å°„åå¾—å‡ºçš„æ•°æ®ä¸€è‡´ï¼Œåˆ™åˆ¤å®šä¸¤è€…é‡å¤ï¼Œè¿™ä¸­é—´æœ‰ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼Œæ‰€ä»¥ä¸ºæ»¡è¶³åœ¨è¯¥ä¸šåŠ¡åœºæ™¯å…¶ç©ºé—´å¼€é”€ä¼šéå¸¸çš„å¤§ã€‚è€ŒRoaringBitMapæ˜¯ç›´æ¥å°†å…ƒæ•°æ®è¿›è¡Œå­˜å‚¨å‹ç¼©ï¼Œå…¶å‡†ç¡®ç‡æ˜¯100%çš„ï¼‰ å®Œå…¨ä»¥ç¼“å­˜ä¸ºå‡†ï¼Œä½¿ç”¨å»¶è¿Ÿå¼‚æ­¥åŠ è½½ã€‚ å‡»ç©¿ Qï¼šæŸä¸ªkeyå¤±æ•ˆçš„æ—¶å€™ï¼Œæ­£å¥½æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è®¿é—®è¿™ä¸ªkey Aï¼škeyçš„æ›´æ–°æ“ä½œæ·»åŠ å…¨å±€äº’æ–¥é”ï¼ˆå¼ºä¸€è‡´æ€§ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¿åˆ°æ•°æ®ï¼‰ æˆ– ä½¿ç”¨å»¶è¿Ÿå¼‚æ­¥åŠ è½½ï¼ˆé«˜å¯ç”¨ï¼‰ï¼Œæˆ–watchdogé€»è¾‘è¿‡æœŸã€‚ é›ªå´© Qï¼šæŸä¸€æ—¶åˆ»å‘ç”Ÿå¤§è§„æ¨¡çš„ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼Œä¼šæœ‰å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´å‹åŠ›è¿‡å¤§ç”šè‡³å®•æœºã€‚ Aï¼š åˆ†æ•£è¯·æ±‚ çƒ­æ•°æ®åˆ†æ•£åˆ°ä¸åŒæœºå™¨ä¸Šï¼› é™æµ æ§åˆ¶è¿‡æœŸæ—¶é—´ï¼šèŒƒå›´å†…éšæœºï¼› å¤šå°æœºå™¨åšä¸»ä»å¤åˆ¶æˆ–å¤šå‰¯æœ¬ï¼Œå®ç°é«˜å¯ç”¨ï¼› å‡»ç©¿å’Œç©¿é€çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç©¿é€ï¼šæŸ¥è¯¢çš„** key ä¸åœ¨ç¼“å­˜ä¸­**ï¼Œç¼“å­˜æ²¡æœ‰èµ·åˆ°ç¼“å†²çš„æ•ˆæœ å‡»ç©¿ï¼šæŸ¥è¯¢çš„ key** æ›¾ç»æœ‰æ•ˆ**ï¼Œåœ¨å¤±æ•ˆçš„ç¬æ—¶æ‰“å‡»äº†æ•°æ®åº“ ","date":"2023-08-08","objectID":"/redis/:0:7","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"Redis é›†ç¾¤ - ä¸»ä»å¤åˆ¶ï¼Ÿ æ¦‚å¿µ ä¸»èŠ‚ç‚¹å†™ï¼Œä»èŠ‚ç‚¹è¯»ã€‚ RDBåŒæ­¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼š replication idï¼šæ ‡è®°æ•°æ®é›† offsetï¼šslave \u003c master æ—¶éœ€è¦æ›´æ–° å…¨é‡åŒæ­¥ï¼šä¸»èŠ‚ç‚¹æ‰§è¡Œ **bgsave ç”Ÿæˆ dump.rdb **æ–‡ä»¶ç»™ slave å¢é‡åŒæ­¥ï¼šslave é‡å¯æ—¶ï¼Œè·å–ç›¸åŒ replication id çš„ offset ä¹‹åçš„æ•°æ® ä¸»ä»å¤åˆ¶ä¸è¦ä½¿ç”¨ç½‘çŠ¶ç»“æ„ï¼Œä½¿ç”¨å•å‘é“¾è¡¨ç»“æ„ï¼Œå¦‚ Master \u003c- slave1 \u003c- slave2 \u003c- slave3ï¼Œæ›´æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ã€‚ Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hashï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½æ¦‚å¿µï¼Œæœ‰ 16384ï¼ˆ2çš„14æ¬¡ï¼‰ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡**CRC16ï¼ˆä¸Šé™ 2 çš„ 16 æ¬¡ï¼‰**æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚ ä½¿ç”¨ ä½¿ç”¨ Docker Compose å·¥å…·æ¥åˆ›å»º Redis é›†ç¾¤å®¹å™¨ version: '3' services: redis-7000: image: redis command: redis-server /usr/local/etc/redis/redis.conf ports: - \"7000:6379\" volumes: - ./conf/redis-7000.conf:/usr/local/etc/redis/redis.conf networks: - redis-net redis-7001: image: redis command: redis-server /usr/local/etc/redis/redis.conf ports: - \"7001:6379\" volumes: - ./conf/redis-7001.conf:/usr/local/etc/redis/redis.conf networks: - redis-net redis-7002: image: redis command: redis-server /usr/local/etc/redis/redis.conf ports: - \"7002:6379\" volumes: - ./conf/redis-7002.conf:/usr/local/etc/redis/redis.conf networks: - redis-net networks: redis-net: è¯¥é…ç½®æ–‡ä»¶å®šä¹‰äº†ä¸‰ä¸ª Redis èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç›‘å¬ä¸åŒçš„ç«¯å£ï¼Œä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ Docker Compose å·¥å…·æ¥å¯åŠ¨ Redis é›†ç¾¤å®¹å™¨ï¼š docker-compose up -d ","date":"2023-08-08","objectID":"/redis/:0:8","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"Redis é›†ç¾¤ä¸é«˜å¯ç”¨ Redis Sentinal ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨ master å®•æœºæ—¶ä¼šè‡ªåŠ¨å°† slave æå‡ä½ masterï¼Œç»§ç»­æä¾›æœåŠ¡ï¼› Redis Cluster ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª redis å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨ Cluster è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚ # ä»èŠ‚ç‚¹åªè¯»ã€å¼‚æ­¥å¤åˆ¶ SLAVEOF 127.0.0.1 6379 # ä¸»ä»åˆ‡æ¢åŸºäº raft åè®®,ä¸¤ç§å¯åŠ¨æ–¹å¼ redis-sentinel sentinel.conf redis-server redis.conf --sentinel sentinel.conf é…ç½®ï¼š sentinel monitor mymaster 127.0.0.1 6379 2 sentinel down-after-milliseconds mymaster 60000 sentinel failover-timeout mymaster 180000 sentinel parallel-syncs mymaster 1 # æ•°æ®åˆ†ç‰‡ cluster-enabled yes æ³¨æ„ï¼š èŠ‚ç‚¹é—´ä½¿ç”¨ gossip é€šä¿¡ï¼Œè§„æ¨¡\u003c1000 é»˜è®¤æ‰€æœ‰æ§½ä½å¯ç”¨ï¼Œæ‰æä¾›æœåŠ¡ ä¸€èˆ¬ä¼šé…åˆä¸»ä»æ¨¡å¼ä½¿ç”¨ ","date":"2023-08-08","objectID":"/redis/:0:9","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"ğŸŒŸRedis å•çº¿ç¨‹å—ï¼Œä¸ºä»€ä¹ˆå¿«ï¼Ÿ Redis ç½‘ç»œæ¨¡å‹ = IO å¤šè·¯å¤ç”¨+äº‹ä»¶æ´¾å‘ï¼ˆæ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼ŒRedis6 ä¹‹åå‘½ä»¤çš„è½¬æ¢é‡‡ç”¨å¤šçº¿ç¨‹ï¼Œæ‰§è¡Œé‡‡ç”¨å•çº¿ç¨‹ï¼‰ å†…å­˜å¤„ç†çº¿ç¨‹æ˜¯å•çº¿ç¨‹ï¼Œçº¯å†…å­˜æ“ä½œï¼Œé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¿è¯äº†é«˜æ€§èƒ½ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿç°æˆå®‰å…¨é—®é¢˜ã€‚ ä½¿ç”¨äº† I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œæ˜¯éé˜»å¡ IOï¼Œåˆ©ç”¨å•çº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œåœ¨æŸä¸ª socket å¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œå¯¹å°±ç»ªçš„ socket è°ƒç”¨ recvfromï¼Œé¿å…æ— æ•ˆç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨ CPUã€‚ select å’Œ poll åªé€šçŸ¥æœ‰æŸä¸ª socket å°±ç»ªï¼ˆä¸çŸ¥é“æ˜¯å“ªä¸ªï¼‰ï¼Œéœ€è¦éå†ç¡®å®šå…·ä½“çš„ socketï¼Œè€Œ epoll é€šçŸ¥å¹¶æŠŠå·²å°±ç»ªçš„ socket å†™å…¥ç”¨æˆ·ç©ºé—´ã€‚ ","date":"2023-08-08","objectID":"/redis/:0:10","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"Spring Cache å’Œ Redis çš„åŒºåˆ«ï¼Ÿ Spring cacheæ˜¯ä»£ç çº§çš„ç¼“å­˜ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨ä¸€ä¸ª** ConcurrentMap**ï¼Œä¹Ÿå°±æ˜¯è¯´å®é™…ä¸Šè¿˜æ˜¯æ˜¯ä½¿ç”¨JVMçš„å†…å­˜æ¥ç¼“å­˜å¯¹è±¡çš„ï¼Œè¿™åŠ¿å¿…ä¼šé€ æˆå¤§é‡çš„å†…å­˜æ¶ˆè€—ã€‚ä½†å¥½å¤„æ˜¯æ˜¾ç„¶çš„ï¼šä½¿ç”¨æ–¹ä¾¿ã€‚ Redis æ˜¯å†…å­˜çº§çš„ç¼“å­˜ã€‚å®ƒæ˜¯ä½¿ç”¨å•çº¯çš„å†…å­˜æ¥è¿›è¡Œç¼“å­˜ã€‚ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œæ¯å°æœåŠ¡å™¨çš„spring cacheæ˜¯ä¸åŒæ­¥çš„ï¼Œè¿™æ ·ä¼šå‡ºé—®é¢˜çš„ï¼Œspring cacheåªé€‚åˆå•æœºç¯å¢ƒã€‚ Redisæ˜¯è®¾ç½®å•ç‹¬çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œæ‰€æœ‰é›†ç¾¤æœåŠ¡å™¨ç»Ÿä¸€è®¿é—®redisï¼Œä¸ä¼šå‡ºç°ç¼“å­˜ä¸åŒæ­¥çš„æƒ…å†µã€‚ ","date":"2023-08-08","objectID":"/redis/:0:11","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"Redis çš„ä½¿ç”¨ï¼Ÿ âŒJedisï¼šåŸºäºBIOï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€è¦é…ç½®è¿æ¥æ± ç®¡ç†è¿æ¥ Lettuceï¼šä¸»æµæ¨èçš„é©±åŠ¨ï¼ŒåŸºäº** Netty NIO**ï¼ŒAPI çº¿ç¨‹å®‰å…¨ Redissionï¼šåŸºäº Netty NIOï¼ŒAPI çº¿ç¨‹å®‰å…¨ï¼Œå¤§é‡ä¸°å¯Œçš„åˆ†å¸ƒå¼ä¾›èƒ½ç‰¹æ€§ JUC çš„çº¿ç¨‹å®‰å…¨é›†åˆå’Œå·¥å…·çš„åˆ†å¸ƒå¼ç‰ˆæœ¬ åˆ†å¸ƒå¼çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œé” Rediså¦‚ä½•è®¾ç½®å¯†ç å’ŒéªŒè¯å¯†ç ï¼Ÿ è®¾ç½®å¯†ç ï¼šconfig set requirepass 123456 è®¤è¯å¯†ç ï¼šauth 123456 Redis äº‹åŠ¡ å¼€å¯äº‹åŠ¡ï¼šmulti æ‰§è¡Œäº‹åŠ¡ï¼šexec æ’¤é”€äº‹åŠ¡ï¼šdiscard å®ç°ä¹è§‚é”ï¼šwatch Qï¼šå‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ Aï¼šä½¿ç”¨ keys æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ Q2ï¼šå¦‚æœè¿™ä¸ª redis æ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨ keys æŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ A2ï¼šredis å†…å­˜å¤„ç†æ˜¯å•çº¿ç¨‹çš„ã€‚keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨** scan æŒ‡ä»¤**ï¼Œscan æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„key åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ keys æŒ‡ä»¤é•¿ã€‚ ","date":"2023-08-08","objectID":"/redis/:0:12","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["interview"],"content":"Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ å°†å¤šæ¬¡ IO å¾€è¿”æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯ pipeline æ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æœç›¸å…³æ€§ã€‚ ä½¿ç”¨ redis-benchmark è¿›è¡Œå‹æµ‹çš„æ—¶å€™å¯ä»¥å‘ç°å½±å“ redis çš„ QPS å³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯ pipeline æ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚ ","date":"2023-08-08","objectID":"/redis/:0:13","tags":["Redis"],"title":"ğŸš©Redis","uri":"/redis/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-07","objectID":"/k8s_note/","tags":["k8s"],"title":"k8s æ‚è®°","uri":"/k8s_note/"},{"categories":["draft"],"content":"åŸºæœ¬æ¦‚å¿µ è®¾è®¡æ€æƒ³ï¼šä»æ›´å®è§‚çš„è§’åº¦ï¼Œä»¥ç»Ÿä¸€çš„æ–¹å¼æ¥å®šä¹‰ä»»åŠ¡ä¹‹é—´çš„å„ç§å…³ç³»ï¼Œå¹¶ä¸”ä¸ºå°†æ¥æ”¯æŒæ›´å¤šç§ç±»çš„å…³ç³»ç•™æœ‰ä½™åœ°ã€‚ Namespace åšéš”ç¦»ï¼Œå®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹ Cgroups åšé™åˆ¶ rootfs åšæ–‡ä»¶ç³»ç»Ÿã€‚ Pod Podæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œæ˜¯ Kubernetes é¡¹ç›®ä¸­æœ€åŸºç¡€çš„ä¸€ä¸ªåŸå­è°ƒåº¦å•ä½ï¼ŒPod é‡Œçš„å®¹å™¨å…±äº«åŒä¸€ä¸ª Network Namespaceã€åŒä¸€ç»„æ•°æ®å· Volumeï¼Œä»è€Œè¾¾åˆ°é«˜æ•ˆç‡äº¤æ¢ä¿¡æ¯çš„ç›®çš„ã€‚ Infra å®¹å™¨æ°¸è¿œéƒ½æ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„å®¹å™¨ï¼Œè€Œå…¶ä»–ç”¨æˆ·å®šä¹‰çš„å®¹å™¨ï¼Œåˆ™é€šè¿‡ Join Network Namespace çš„æ–¹å¼ï¼Œä¸ Infra å®¹å™¨å…³è”åœ¨ä¸€èµ·ã€‚Infra å®¹å™¨ä¸€å®šè¦å ç”¨æå°‘çš„èµ„æºï¼Œæ‰€ä»¥å®ƒä½¿ç”¨çš„æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„é•œåƒï¼Œå«ä½œï¼šk8s.gcr.io/pauseã€‚è¿™ä¸ªé•œåƒæ˜¯ä¸€ä¸ªç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ã€æ°¸è¿œå¤„äºâ€œæš‚åœâ€çŠ¶æ€çš„å®¹å™¨ï¼Œè§£å‹åçš„å¤§å°ä¹Ÿåªæœ‰ 100~200 KB å·¦å³ serviceï¼šç»™ Pod ç»‘å®šä¸€ä¸ª Service æœåŠ¡ï¼Œæ‹¥æœ‰ä¸å˜çš„ IP åœ°å€ç­‰ä¿¡æ¯ï¼Œä½œä¸º pod çš„ä»£ç†å…¥å£ï¼ˆPortalï¼‰ï¼Œä»è€Œä»£æ›¿ Pod å¯¹å¤–æš´éœ²ä¸€ä¸ªå›ºå®šçš„ç½‘ç»œåœ°å€ã€‚ è¿™æ ·ï¼Œå¯¹äº Web åº”ç”¨çš„ Pod æ¥è¯´ï¼Œå®ƒéœ€è¦å…³å¿ƒçš„å°±æ˜¯æ•°æ®åº“ Pod çš„ Service ä¿¡æ¯ã€‚ä¸éš¾æƒ³è±¡ï¼ŒService åç«¯çœŸæ­£ä»£ç†çš„ Pod çš„ IP åœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯çš„è‡ªåŠ¨æ›´æ–°ã€ç»´æŠ¤ï¼Œåˆ™æ˜¯ Kubernetes é¡¹ç›®çš„èŒè´£ã€‚ master æ§åˆ¶èŠ‚ç‚¹ apiserverï¼šapiæœåŠ¡ï¼Œæ•´ä¸ªé›†ç¾¤çš„æŒä¹…åŒ–æ•°æ®ç”±å…¶å¤„ç†åä¿å­˜çš„ etcd ä¸­ controller managerï¼šå®¹å™¨ç¼–æ’ schedulerï¼šè°ƒåº¦ node è®¡ç®—èŠ‚ç‚¹ ","date":"2023-08-07","objectID":"/k8s_note/:0:1","tags":["k8s"],"title":"k8s æ‚è®°","uri":"/k8s_note/"},{"categories":["draft"],"content":"kubeadm æŠŠ kubelet ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œç„¶åä½¿ç”¨å®¹å™¨éƒ¨ç½²å…¶ä»–çš„ Kubernetes ç»„ä»¶ã€‚ apt-get install kubeadmï¼šå®‰è£… kubeadmã€kubelet å’Œ kubectl è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ kubeadm init è¿›è¡Œä¸€ç³»åˆ—çš„æ£€æŸ¥å·¥ä½œï¼Œä»¥ç¡®å®šè¿™å°æœºå™¨å¯ä»¥ç”¨æ¥éƒ¨ç½² Kubernetes ç”Ÿæˆ Kubernetes å¯¹å¤–æä¾›æœåŠ¡æ‰€éœ€çš„å„ç§è¯ä¹¦å’Œå¯¹åº”çš„ç›®å½•ã€‚ ä¼šä¸ºå…¶ä»–ç»„ä»¶ç”Ÿæˆè®¿é—® kube-apiserver æ‰€éœ€çš„é…ç½®æ–‡ä»¶ ä¼šä¸º Master ç»„ä»¶ç”Ÿæˆ Pod é…ç½®æ–‡ä»¶ kubeadm å°±ä¼šä¸ºé›†ç¾¤ç”Ÿæˆä¸€ä¸ª bootstrap tokenã€‚åœ¨åé¢ï¼Œåªè¦æŒæœ‰è¿™ä¸ªtokenï¼Œä»»ä½•ä¸€ä¸ªå®‰è£…äº† kubelet å’Œ kubadm çš„èŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥é€šè¿‡ kubeadm join åŠ å…¥åˆ°è¿™ä¸ªé›†ç¾¤å½“ä¸­ã€‚ åœ¨ token ç”Ÿæˆä¹‹åï¼Œkubeadm ä¼šå°† ca.crt ç­‰ Master èŠ‚ç‚¹çš„é‡è¦ä¿¡æ¯ï¼Œé€šè¿‡ ConfigMap çš„æ–¹å¼ä¿å­˜åœ¨ Etcd å½“ä¸­ï¼Œä¾›åç»­éƒ¨ç½² Node èŠ‚ç‚¹ä½¿ç”¨ã€‚è¿™ä¸ª ConfigMap çš„åå­—æ˜¯ cluster-infoã€‚ å°±æ˜¯å®‰è£…é»˜è®¤æ’ä»¶ï¼š kube-proxy å’Œ DNS kubeadm joinï¼šï¼Œkubeadm è‡³å°‘éœ€è¦å‘èµ·ä¸€æ¬¡â€œä¸å®‰å…¨æ¨¡å¼â€çš„è®¿é—®åˆ° kube-apiserverï¼Œä»è€Œæ‹¿åˆ°ä¿å­˜åœ¨ ConfigMap ä¸­çš„ cluster-infoï¼ˆå®ƒä¿å­˜äº† APIServer çš„æˆæƒä¿¡æ¯ï¼‰ã€‚è€Œ bootstrap tokenï¼Œæ‰®æ¼”çš„å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­çš„å®‰å…¨éªŒè¯çš„è§’è‰²ã€‚ k8s é›†ç¾¤ï¼š ä¸€ä¸ª Master èŠ‚ç‚¹å’Œå¤šä¸ª Worker èŠ‚ç‚¹ Weave å®¹å™¨ç½‘ç»œæ’ä»¶ Rook å®¹å™¨æŒä¹…åŒ–å­˜å‚¨æ’ä»¶ Dashboard å¯è§†åŒ–çš„ Web ç•Œé¢ã€‚ æ›´æ–°é…ç½®æ–‡ä»¶ï¼škubectl apply -f nginx-deployment.yaml ","date":"2023-08-07","objectID":"/k8s_note/:0:2","tags":["k8s"],"title":"k8s æ‚è®°","uri":"/k8s_note/"},{"categories":["draft"],"content":"Stateful å®ƒæŠŠçœŸå®ä¸–ç•Œé‡Œçš„åº”ç”¨çŠ¶æ€ï¼ŒæŠ½è±¡ä¸ºäº†ä¸¤ç§æƒ…å†µï¼š æ‹“æ‰‘çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³»ã€‚è¿™äº›åº”ç”¨å®ä¾‹ï¼Œå¿…é¡»æŒ‰ç…§æŸäº›é¡ºåºå¯åŠ¨ï¼Œæ¯”å¦‚åº”ç”¨çš„ä¸»èŠ‚ç‚¹ A è¦å…ˆäºä»èŠ‚ç‚¹ B å¯åŠ¨ã€‚è€Œå¦‚æœä½ æŠŠ A å’Œ B ä¸¤ä¸ª Pod åˆ é™¤æ‰ï¼Œå®ƒä»¬å†æ¬¡è¢«åˆ›å»ºå‡ºæ¥æ—¶ä¹Ÿå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰è¡Œã€‚å¹¶ä¸”ï¼Œæ–°åˆ›å»ºå‡ºæ¥çš„ Podï¼Œå¿…é¡»å’ŒåŸæ¥ Pod çš„ç½‘ç»œæ ‡è¯†ä¸€æ ·ï¼Œè¿™æ ·åŸå…ˆçš„è®¿é—®è€…æ‰èƒ½ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œè®¿é—®åˆ°è¿™ä¸ªæ–° Podã€‚ å­˜å‚¨çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®ã€‚å¯¹äºè¿™äº›åº”ç”¨å®ä¾‹æ¥è¯´ï¼ŒPod A ç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œå’Œéš”äº†ååˆ†é’Ÿä¹‹åå†æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œåº”è¯¥æ˜¯åŒä¸€ä»½ï¼Œå“ªæ€•åœ¨æ­¤æœŸé—´ Pod A è¢«é‡æ–°åˆ›å»ºè¿‡ã€‚è¿™ç§æƒ…å†µæœ€å…¸å‹çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹ã€‚ StatefulSet è¿™ä¸ªæ§åˆ¶å™¨çš„ä¸»è¦ä½œç”¨ä¹‹ä¸€ï¼Œå°±æ˜¯ä½¿ç”¨ Pod æ¨¡æ¿åˆ›å»º Pod çš„æ—¶å€™ï¼Œå¯¹å®ƒä»¬è¿›è¡Œç¼–å·ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–å·é¡ºåºé€ä¸€å®Œæˆåˆ›å»ºå·¥ä½œã€‚è€Œå½“StatefulSet çš„â€œæ§åˆ¶å¾ªç¯â€å‘ç° Pod çš„â€œå®é™…çŠ¶æ€â€ä¸â€œæœŸæœ›çŠ¶æ€â€ä¸ä¸€è‡´ï¼Œéœ€è¦æ–°å»ºæˆ–è€…åˆ é™¤ Pod è¿›è¡Œâ€œè°ƒè°â€çš„æ—¶å€™ï¼Œå®ƒä¼šä¸¥æ ¼æŒ‰ç…§è¿™äº› Pod ç¼–å·çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè¿™äº›æ“ä½œã€‚ StatefulSet å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„Deploymentï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒçš„æ¯ä¸ª Pod éƒ½è¢«ç¼–å·äº†ã€‚è€Œä¸”ï¼Œè¿™ä¸ªç¼–å·ä¼šä½“ç°åœ¨ Pod çš„åå­—å’Œ hostname ç­‰æ ‡è¯†ä¿¡æ¯ä¸Šï¼Œè¿™ä¸ä»…ä»£è¡¨äº† Pod çš„åˆ›å»ºé¡ºåºï¼Œä¹Ÿæ˜¯ Pod çš„é‡ è¦ç½‘ç»œæ ‡è¯†ï¼ˆå³ï¼šåœ¨æ•´ä¸ªé›†ç¾¤é‡Œå”¯ä¸€çš„ã€å¯è¢«çš„è®¿é—®èº«ä»½ï¼‰ã€‚æœ‰äº†è¿™ä¸ªç¼–å·åï¼ŒStatefulSet å°±ä½¿ç”¨ Kubernetes é‡Œçš„ä¸¤ä¸ªæ ‡å‡†åŠŸèƒ½ï¼šHeadless Service å’Œ PV/PVCï¼Œå®ç°äº†å¯¹ Pod çš„æ‹“æ‰‘çŠ¶æ€å’Œå­˜å‚¨çŠ¶æ€çš„ç»´æŠ¤ã€‚ ","date":"2023-08-07","objectID":"/k8s_note/:0:3","tags":["k8s"],"title":"k8s æ‚è®°","uri":"/k8s_note/"},{"categories":["draft"],"content":"è‰ç¨¿å¤ªå¤šï¼Œæœ‰ç©ºå†æ•´ç†å§ã€‚ã€‚","date":"2023-08-07","objectID":"/netty_note/","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"äº”ç§ IO æ¨¡å‹ é€šä¿¡æ¨¡å¼ï¼šåŒæ­¥ã€å¼‚æ­¥ çº¿ç¨‹å¤„ç†æ¨¡å¼ï¼šé˜»å¡ã€éé˜»å¡ äº”ç§ IO æ¨¡å‹ BIOï¼ˆé˜»å¡å¼ï¼‰ï¼šåœ¨while(true)ä¸­è°ƒç”¨accept()æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯ã€‚ä¸€ä¸ªçº¿ç¨‹åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¿æ¥è¯·æ±‚ éé˜»å¡å¼IOï¼šå†…æ ¸ä¼šç«‹å³è¿”å›ï¼Œå·²è·å¾—è¶³å¤Ÿçš„CPUäº‹ä»¶ç»§ç»­åšå…¶ä»–äº‹æƒ…ï¼Œç”¨æˆ·è¿›ç¨‹çš„ç¬¬ä¸€é˜¶æ®µä¸é˜»å¡ï¼Œéœ€è¦ä¸æ–­ä¸»åŠ¨è¯¢é—®kernelæ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œç¬¬äºŒé˜¶æ®µä»ç„¶é˜»å¡ã€‚ å¤šè·¯å¤ç”¨IO/äº‹ä»¶é©±åŠ¨IOï¼šåœ¨å•çº¿ç¨‹é‡ŒåŒäº‹ç›‘æ§å¤šä¸ªå¥—æ¥å­—ï¼Œé€šè¿‡selectæˆ–pollè½®è¯¢æ‰€è´Ÿè´£çš„socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†å°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚è¿›ç¨‹é¦–å…ˆé˜»å¡åœ¨select/pollä¸Šï¼Œå†é˜»å¡åœ¨è¯»æ“ä½œçš„ç¬¬äºŒé˜¶æ®µä¸Šã€‚ ä¿¡å·é©±åŠ¨IOï¼šåœ¨IOæ‰§è¡Œçš„æ•°æ®å‡†å¤‡é˜¶æ®µï¼Œä¸ä¼šé˜»å¡ç”¨æˆ·è¿›ç¨‹ï¼Œå½“ç”¨æˆ·è¿›ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œæ‰å»æŸ¥æ”¶æ•°æ®ã€‚ å¼‚æ­¥IOï¼šç”¨æˆ·è¿›ç¨‹å‘å‡ºç³»ç»Ÿè°ƒç”¨åç«‹å³è¿”å›ï¼Œå†…æ ¸ç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆåï¼Œå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ç¼“å†²åŒºï¼Œç„¶åå‘Šè¯‰ç”¨æˆ·è¿›ç¨‹IOæ“ä½œæ‰§è¡Œå®Œæ¯•ã€‚ ","date":"2023-08-07","objectID":"/netty_note/:0:1","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"ä»€ä¹ˆæ˜¯ Nettyï¼Ÿ Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼ŒåŸºäº NIO æŠ€æœ¯å®ç°ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘æœåŠ¡å¼€å‘ä¸­ï¼ŒåŒ…æ‹¬ Web æœåŠ¡å™¨ã€RPCã€æ¶ˆæ¯ä¸­é—´ä»¶ç­‰é¢†åŸŸã€‚ å¸¸è§„ IO NIOï¼šå°‘äº†ä¸€æ¬¡ç¼“å†²åŒºçš„å¤åˆ¶ ","date":"2023-08-07","objectID":"/netty_note/:0:2","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"ä¸ JDK åŸç”Ÿ NIO ç›¸æ¯”ï¼ŒNetty çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ Netty ç›¸æ¯”äº JDK åŸç”Ÿ NIO å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š æ›´å¥½çš„æ€§èƒ½ï¼šNetty åœ¨ NIO çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ I/O å¤„ç†çš„æ•ˆç‡å’Œååé‡ã€‚ æ›´æ˜“ç”¨çš„æ¥å£ï¼šNetty æä¾›äº†ä¸€å¥—æ›´åŠ æ˜“ç”¨çš„ API æ¥å£ï¼Œç®€åŒ–äº† NIO çš„å¤æ‚æ€§ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ã€‚ æ›´å¤šçš„åŠŸèƒ½æ‰©å±•ï¼šNetty æä¾›äº†ä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½ï¼Œå¦‚ç¼–è§£ç å™¨ã€å¿ƒè·³æ£€æµ‹ã€SSL/TLS åŠ å¯†ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´åŠ å¿«é€Ÿåœ°æ„å»ºé«˜æ•ˆã€å®‰å…¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ ","date":"2023-08-07","objectID":"/netty_note/:0:3","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"ä»€ä¹ˆæ˜¯ Channel å’Œ ChannelPipelineï¼Ÿ åœ¨ Netty ä¸­ï¼ŒChannel æ˜¯ç½‘ç»œé€šä¿¡çš„åŸºç¡€ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯é çš„ç½‘ç»œè¿æ¥ã€‚ChannelPipeline æ˜¯ä¸€ç³»åˆ— ChannelHandler çš„é“¾è¡¨ï¼Œç”¨äºå¤„ç† Channel ä¸Šçš„äº‹ä»¶å’Œæ•°æ®ï¼Œç±»ä¼¼äº Servlet ä¸­çš„ Filterã€‚ ","date":"2023-08-07","objectID":"/netty_note/:0:4","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"ä»€ä¹ˆæ˜¯ EventLoop å’Œçº¿ç¨‹æ¨¡å‹ï¼Ÿ EventLoop æ˜¯ Netty ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œç”¨äºå¤„ç† Channel ä¸Šçš„äº‹ä»¶å’Œä»»åŠ¡ã€‚æ¯ä¸ª Channel éƒ½ä¼šç»‘å®šä¸€ä¸ª EventLoop**ï¼Œä¸€ä¸ª EventLoop å¯ä»¥å¤„ç†å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶å’Œä»»åŠ¡**ã€‚Netty é‡‡ç”¨äº†å¤šç§çº¿ç¨‹æ¨¡å‹ï¼Œå¦‚å•çº¿ç¨‹æ¨¡å‹ã€å¤šçº¿ç¨‹æ¨¡å‹ã€ä¸»ä»çº¿ç¨‹æ¨¡å‹ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ä¸åŒçš„çº¿ç¨‹æ¨¡å‹å¯ä»¥æ›´å¥½åœ°æé«˜ç¨‹åºçš„æ€§èƒ½å’Œå¹¶å‘æ€§ã€‚ EventLoop EventLoopå®šä¹‰äº†Nettyçš„æ ¸å¿ƒæŠ½è±¡ï¼Œç”¨äºå¤„ç†è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰€å‘ç”Ÿçš„äº‹ä»¶ï¼Œè´Ÿè´£ç›‘å¬ç½‘ç»œäº‹ä»¶å¹¶è°ƒç”¨äº‹ä»¶å¤„ç†å™¨è¿›è¡Œç›¸å…³I/Oæ“ä½œã€‚ Channel æ˜¯ Netty ç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼ŒEventLoopè´Ÿè´£å¤„ç†æ³¨å†Œåˆ°å…¶ä¸Šçš„Channel çš„ I/Oæ“ä½œã€‚ EventloopGrupåŒ…å«å¤šä¸ªEventLoopï¼ˆEventLoopï¼šThread = 1 : 1ï¼‰ï¼Œå®ƒç®¡ç†ç€æ‰€æœ‰çš„EventLoopçš„ç”Ÿå‘½å‘¨æœŸã€‚ NioEventLoopGroup é»˜è®¤çš„æ„é€ å‡½æ•°å®é™…ä¼šèµ·çš„çº¿ç¨‹æ•°ä¸º CPUæ ¸å¿ƒæ•°*2 æ ¸å¿ƒæ¦‚å¿µ ServerBootstrapï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºçš„å…¥å£ï¼Œè¿™æ˜¯ Netty ä¸ºç®€åŒ–ç½‘ç»œç¨‹åºé…ç½®å’Œå…³é—­ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ‰€å¼•å…¥çš„ Bootstrapping æœºåˆ¶ã€‚æˆ‘ä»¬é€šå¸¸è¦åšçš„åˆ›å»º Channelã€ç»‘å®šç«¯å£ã€æ³¨å†Œ Handler ç­‰ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œä»¥ Fluent API ç­‰å½¢å¼å®Œæˆï¼Œç›¸å¯¹ç®€åŒ–äº† API ä½¿ç”¨ã€‚ä¸ä¹‹ç›¸å¯¹åº”ï¼Œ Bootstrapåˆ™æ˜¯ Client ç«¯çš„é€šå¸¸å…¥å£ã€‚ Channelï¼šå¯ä»¥ç†è§£ä¸ºè¯»æ“ä½œæˆ–å†™æ“ä½œï¼Œå› æ­¤å¯ä»¥è¢«æ‰“å¼€æˆ–è¢«å…³é—­ ã€‚ä½œä¸ºä¸€ä¸ªåŸºäº NIO çš„æ‰©å±•æ¡†æ¶ï¼ŒChannel å’Œ Selector ç­‰æ¦‚å¿µä»ç„¶æ˜¯ Netty çš„åŸºç¡€ç»„ä»¶ï¼Œä½†æ˜¯é’ˆå¯¹åº”ç”¨å¼€å‘å…·ä½“éœ€æ±‚ï¼Œæä¾›äº†ç›¸å¯¹æ˜“ç”¨çš„æŠ½è±¡ã€‚ EventLoopï¼šåªç”±ä¸€ä¸ªçº¿ç¨‹é©±åŠ¨ï¼Œå¤„ç†ä¸€ä¸ª Channelä¸­ çš„æ‰€æœ‰ I/O äº‹ä»¶ã€‚è¿™æ˜¯ Netty å¤„ç†äº‹ä»¶çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä¾‹å­ä¸­ä½¿ç”¨äº† EventLoopGroupã€‚æˆ‘ä»¬åœ¨ NIO ä¸­é€šå¸¸è¦åšçš„å‡ ä»¶äº‹æƒ…ï¼Œå¦‚æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ã€è°ƒåº¦ç›¸åº”çš„ Handler ç­‰ï¼Œéƒ½æ˜¯ EventLoop è´Ÿè´£ã€‚ ChannelFutureï¼Œè¿™æ˜¯ Netty å®ç°å¼‚æ­¥ IO çš„åŸºç¡€ä¹‹ä¸€ï¼Œä¿è¯äº†åŒä¸€ä¸ª Channel æ“ä½œçš„è°ƒç”¨é¡ºåºã€‚Netty æ‰©å±•äº† Java æ ‡å‡†çš„ Futureï¼Œæä¾›äº†é’ˆå¯¹è‡ªå·±åœºæ™¯çš„ç‰¹æœ‰Futureå®šä¹‰ã€‚ ChannelHandlerï¼Œè¿™æ˜¯åº”ç”¨å¼€å‘è€…æ”¾ç½®ä¸šåŠ¡é€»è¾‘çš„ä¸»è¦åœ°æ–¹ï¼Œä¹Ÿæ˜¯æˆ‘ä¸Šé¢æåˆ°çš„â€œSeparation Of Concernsâ€åŸåˆ™çš„ä½“ç°ã€‚æ¯ä¸ªäº‹ä»¶éƒ½å¯ä»¥è¢«åˆ†å‘ç»™ ChannelHandler ç±»ä¸­çš„æŸä¸ªç”¨æˆ·å®ç°çš„æ–¹æ³•ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ä¸ç½‘ç»œå¤„ç†ä»£ç åˆ†ç¦»ã€‚ ChannelPipelineï¼šå®ƒæ˜¯ ChannelHandler é“¾æ¡çš„å®¹å™¨ï¼Œæ¯ä¸ª Channel åœ¨åˆ›å»ºåï¼Œè‡ªåŠ¨è¢«åˆ†é…ä¸€ä¸ª ChannelPipelineã€‚ ","date":"2023-08-07","objectID":"/netty_note/:0:5","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"ä»€ä¹ˆæ˜¯ ByteBufï¼Ÿ ByteBuf æ˜¯ Netty ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œç”¨äºå¤„ç†æ•°æ®çš„ç¼“å†²åŒºã€‚ä¸ JDK ä¸­çš„ ByteBuffer ç›¸æ¯”ï¼ŒByteBuf å…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€æ›´é«˜çš„æ€§èƒ½å’Œæ›´ä¸°å¯Œçš„åŠŸèƒ½ã€‚ByteBuf æ”¯æŒè¯»å†™ç´¢å¼•åˆ†ç¦»ï¼Œå†…å­˜æ± åŒ–å’Œå¼•ç”¨è®¡æ•°ç­‰åŠŸèƒ½ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†å†…å­˜å’Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ ByteBuffer çš„ç§ç±»ï¼Ÿ java.nio.HeapByteBufferï¼šjava å †å†…å­˜ï¼Œè¯»å†™æ•ˆç‡è¾ƒä½ï¼Œå—åˆ° GC çš„å½±å“ java.nio.DirectByteBufferï¼šç›´æ¥å†…å­˜ï¼Œè¯»å†™æ•ˆç‡é«˜ï¼ˆå°‘ä¸€æ¬¡æ‹·è´ï¼‰ï¼Œä¸å— GC å½±å“ï¼Œåˆ†é…æ•ˆç‡ä½ ","date":"2023-08-07","objectID":"/netty_note/:0:6","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"å››ç§äº‹ä»¶ç±»å‹ acceptï¼šåœ¨æœ‰è¿æ¥è¯·æ±‚æ—¶è§¦å‘ connectï¼šå®¢æˆ·ç«¯ï¼Œè¿æ¥å»ºç«‹åè§¦å‘ readï¼šå¯è¯»äº‹ä»¶ writeï¼šå¯å†™äº‹ä»¶ åœ¨ select åï¼Œäº‹ä»¶è¦ä¹ˆå¤„ç† acceptï¼Œè¦ä¹ˆå–æ¶ˆ cancelï¼ˆcatch å¼‚å¸¸ä¹‹åï¼‰ï¼Œ ","date":"2023-08-07","objectID":"/netty_note/:0:7","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"å¦‚ä½•å¤„ç†ç²˜åŒ…ä¸æ‹†åŒ…ï¼Ÿ ByteToMessageDecoder æä¾›äº†ä¸€äº›å¸¸è§çš„å®ç°ç±»ï¼š FixedLengthFrameDecoderï¼šå®šé•¿åè®®è§£ç å™¨ï¼ŒæŒ‡å®šå›ºå®šçš„å­—èŠ‚æ•° LineBasedFrameDecoderï¼šè¡Œåˆ†éš”ç¬¦è§£ç å™¨ï¼Œè¯†åˆ« \\næˆ–\\r\\n DelimiterBasedFrameDecoderï¼šåˆ†éš”ç¬¦è§£ç å™¨ LengthFieldBasedFrameDecoderï¼šé•¿åº¦ç¼–ç è§£ç å™¨ï¼Œå°†æŠ¥æ–‡åˆ’åˆ†ä¸ºheaderå’Œbody JsonObjectDecoderï¼šç›‘æµ‹åˆ°åŒ¹é…çš„{}æˆ–[]å°±è®¤ä¸ºæ˜¯å®Œæ•´çš„jsonå¯¹è±¡æˆ–jsonæ•°ç»„ ","date":"2023-08-07","objectID":"/netty_note/:0:8","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"API ç½‘å…³ API ç½‘å…³çš„å››å¤§èŒèƒ½ï¼š è¯·æ±‚æ¥å…¥ï¼šä½œä¸ºæ‰€æœ‰APIæ¥å£æœåŠ¡è¯·æ±‚çš„æ¥å…¥ç‚¹ ä¸šåŠ¡èšåˆï¼šä½œä¸ºæ‰€æœ‰åç«¯ä¸šåŠ¡æœåŠ¡çš„èšåˆç‚¹ ä¸­ä»‹ç­–ç•¥ï¼šå®ç°å®‰å…¨ã€éªŒè¯ã€è·¯ç”±ã€è¿‡æ»¤ã€æµæ§ç­‰ç­–ç•¥ ç»Ÿä¸€ç®¡ç†ï¼šå¯¹æ‰€æœ‰APIæœåŠ¡å’Œç­–ç•¥è¿›è¡Œç»Ÿä¸€ç®¡ç† ","date":"2023-08-07","objectID":"/netty_note/:0:9","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["draft"],"content":"é¢è¯•è€ƒç‚¹â“ Reactor æ¨¡å¼å’Œ Netty çº¿ç¨‹æ¨¡å‹ã€‚ Pipeliningã€EventLoop ç­‰éƒ¨åˆ†çš„è®¾è®¡å®ç°ç»†èŠ‚ã€‚ Netty çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€å¼•ç”¨è®¡æ•°ç­‰ç‰¹åˆ«æ‰‹æ®µã€‚ æœ‰çš„æ—¶å€™é¢è¯•å®˜ä¹Ÿå–œæ¬¢å¯¹æ¯” Java æ ‡å‡† NIO APIï¼Œä¾‹å¦‚ï¼Œä½ æ˜¯å¦çŸ¥é“ Java NIO æ—©æœŸç‰ˆæœ¬ä¸­çš„ Epollç©ºè½¬é—®é¢˜ï¼Œä»¥åŠ Netty çš„è§£å†³æ–¹å¼ç­‰ã€‚ ","date":"2023-08-07","objectID":"/netty_note/:0:10","tags":["Network"],"title":"Netty æ‚è®°","uri":"/netty_note/"},{"categories":["ChatGPT"],"content":"åœ¨ gpt é¢å‰å°± stay foolish å§","date":"2023-08-07","objectID":"/java_code_gpt/","tags":["Java"],"title":"ChatGPT è¯´ Java æºç åº”è¯¥è¿™æ ·è¯»","uri":"/java_code_gpt/"},{"categories":["ChatGPT"],"content":"ä»¥ä¸‹æ˜¯ gpt3.5 æ¨èçš„ Java æºç æŒæ¡é¡ºåºï¼ˆæŒ‰ç…§é‡è¦ç¨‹åº¦æ’åºï¼‰ï¼š Java åŸºç¡€ç±»åº“ï¼ˆJava SEï¼‰ - Java åŸºç¡€ç±»åº“æ˜¯ Java å¼€å‘æœ€åŸºæœ¬çš„ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…å«äº†å¤§é‡çš„æ ¸å¿ƒç±»å’Œæ¥å£ï¼Œå¦‚é›†åˆæ¡†æ¶ã€IO æ“ä½œã€å¤šçº¿ç¨‹ã€åå°„ç­‰ã€‚ç†Ÿç»ƒæŒæ¡ Java åŸºç¡€ç±»åº“æ˜¯å…¥é—¨ Java å¼€å‘çš„å¿…è¦æ¡ä»¶ã€‚ é›†åˆæ¡†æ¶ï¼ˆCollection Frameworkï¼‰ - é›†åˆæ¡†æ¶æ˜¯ JavaSE ä¸­æœ€åŸºæœ¬çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼ŒåŒ…å«äº†ä¼—å¤šçš„æ•°æ®ç»“æ„ï¼Œå¦‚ Listã€Setã€Map ç­‰ã€‚ç†Ÿç»ƒæŒæ¡é›†åˆæ¡†æ¶çš„å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨é›†åˆæ¡†æ¶ã€‚ å¹¶å‘ç¼–ç¨‹ï¼ˆConcurrencyï¼‰ - å¹¶å‘ç¼–ç¨‹æ˜¯ JavaSE ä¸­ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹ã€é”ã€å¹¶å‘é›†åˆç­‰å†…å®¹ã€‚ç†Ÿç»ƒæŒæ¡å¹¶å‘ç¼–ç¨‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬å†™å‡ºé«˜æ•ˆã€å¯é çš„å¤šçº¿ç¨‹ç¨‹åºã€‚ IO æ“ä½œï¼ˆInput/Outputï¼‰ - IO æ“ä½œæ˜¯ JavaSE ä¸­å¸¸ç”¨çš„æ“ä½œä¹‹ä¸€ï¼ŒåŒ…æ‹¬æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æŒæ¡ IO æ“ä½œçš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™é«˜æ•ˆã€å¯é çš„ IO ç¨‹åºã€‚ åå°„ï¼ˆReflectionï¼‰ - åå°„æ˜¯ JavaSE ä¸­ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€è·å–ç±»çš„ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ç­‰ã€‚æŒæ¡åå°„çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´åŠ çµæ´»çš„ç¨‹åºã€‚ JVMï¼ˆJava Virtual Machineï¼‰ - JVM æ˜¯ JavaSE ä¸­ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯ Java è¯­è¨€çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ Java ç¨‹åºè¿è¡Œçš„åŸºç¡€ã€‚æŒæ¡ JVM çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£ Java è¯­è¨€çš„ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ ç½‘ç»œç¼–ç¨‹ï¼ˆNetwork Programmingï¼‰ - ç½‘ç»œç¼–ç¨‹æ˜¯ JavaSE ä¸­ä¸€ä¸ªå¸¸ç”¨çš„éƒ¨åˆ†ï¼Œæ¶‰åŠåˆ° Socket ç¼–ç¨‹ã€HTTP ç¼–ç¨‹ç­‰ã€‚æŒæ¡ç½‘ç»œç¼–ç¨‹çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™é«˜æ•ˆã€ç¨³å®šçš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ åºåˆ—åŒ–ï¼ˆSerializationï¼‰ - åºåˆ—åŒ–æ˜¯ JavaSE ä¸­ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå¯ä»¥å°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œä¾¿äºç½‘ç»œä¼ è¾“æˆ–å­˜å‚¨ã€‚æŒæ¡åºåˆ—åŒ–çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™é«˜æ•ˆã€å¯é çš„åºåˆ—åŒ–ç¨‹åºã€‚ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ - Java è™šæ‹Ÿæœºæ˜¯ Java è¯­è¨€çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ Java ç¨‹åºè¿è¡Œçš„åŸºç¡€ã€‚æŒæ¡ Java è™šæ‹Ÿæœºçš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£ Java è¯­è¨€çš„ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ Java å¹¶å‘ç¼–ç¨‹ï¼ˆJava Concurrencyï¼‰ - Java å¹¶å‘ç¼–ç¨‹æ¶‰åŠåˆ°çº¿ç¨‹ã€é”ã€å¹¶å‘é›†åˆç­‰å†…å®¹ï¼Œæ˜¯ Java ç¨‹åºå¼€å‘ä¸­ä¸å¯é¿å…çš„ä¸€éƒ¨åˆ†ã€‚æŒæ¡å¹¶å‘ç¼–ç¨‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬å†™å‡ºé«˜æ•ˆã€å¯é çš„å¤šçº¿ç¨‹ç¨‹åºã€‚ Spring æ¡†æ¶ - Spring æ¡†æ¶æ˜¯ç›®å‰æœ€æµè¡Œçš„ Java å¼€å‘æ¡†æ¶ä¹‹ä¸€ï¼ŒåŒ…å«äº†ä¼—å¤šçš„æ¨¡å—ï¼Œå¦‚ Spring Coreã€Spring MVCã€Spring Boot ç­‰ã€‚ç†Ÿç»ƒæŒæ¡ Spring æ¡†æ¶å¯ä»¥æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚ Netty - Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘æœåŠ¡å¼€å‘ä¸­ã€‚æŒæ¡ Netty çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™é«˜æ€§èƒ½ã€ç¨³å®šçš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ Tomcat - Tomcat æ˜¯ä¸€ä¸ªå¼€æºçš„ Web æœåŠ¡å™¨å’Œ Servlet å®¹å™¨ï¼Œæ˜¯ Java Web åº”ç”¨ç¨‹åºå¼€å‘çš„é‡è¦å·¥å…·ã€‚æŒæ¡ Tomcat çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ Web åº”ç”¨ç¨‹åºçš„å·¥ä½œåŸç†ã€‚ MySQL - MySQL æ˜¯ç›®å‰æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯äº’è”ç½‘åº”ç”¨ç¨‹åºå¼€å‘ä¸­æœ€å¸¸ç”¨çš„æ•°æ®åº“ä¹‹ä¸€ã€‚æŒæ¡ MySQL çš„åŸç†å’Œå®ç°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™é«˜æ•ˆã€å®‰å…¨çš„æ•°æ®åº“åº”ç”¨ç¨‹åºã€‚ é€šè¿‡æŒ‰ç…§ä»¥ä¸Šé¡ºåºå­¦ä¹ å’ŒæŒæ¡è¿™äº›Javaæºç çš„çŸ¥è¯†ï¼Œæ‚¨å°†èƒ½å¤Ÿå»ºç«‹åšå®çš„åŸºç¡€ï¼Œå¹¶é€æ­¥æ‰©å±•æ‚¨çš„æŠ€èƒ½å’Œç†è§£ï¼Œä¸ºJavaç¼–ç¨‹æä¾›æ›´å¥½çš„æ”¯æŒã€‚ ","date":"2023-08-07","objectID":"/java_code_gpt/:0:0","tags":["Java"],"title":"ChatGPT è¯´ Java æºç åº”è¯¥è¿™æ ·è¯»","uri":"/java_code_gpt/"},{"categories":["interview"],"content":"1ã€åœ¨ java ä¸­å®ˆæŠ¤çº¿ç¨‹å’Œæœ¬åœ°çº¿ç¨‹åŒºåˆ«ï¼Ÿ java ä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç§ï¼šå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemonï¼‰å’Œç”¨æˆ·çº¿ç¨‹ï¼ˆUserï¼‰ã€‚ ä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ï¼Œé€šè¿‡æ–¹æ³• Thread.setDaemon(boolon)ï¼›true åˆ™æŠŠè¯¥çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œåä¹‹åˆ™ä¸ºç”¨æˆ·çº¿ç¨‹ã€‚Thread.setDaemon()å¿…é¡»åœ¨ Thread.start()ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ ä¸¤è€…çš„åŒºåˆ«ï¼š å”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ¤æ–­è™šæ‹Ÿæœº(JVM)ä½•æ—¶ç¦»å¼€ï¼ŒDaemon æ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ï¼Œå¦‚æœå…¨éƒ¨çš„ User Thread å·²ç»æ’¤ç¦»ï¼ŒDaemon æ²¡æœ‰å¯æœåŠ¡çš„çº¿ç¨‹ï¼ŒJVM æ’¤ç¦»ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå®ˆæŠ¤çº¿ç¨‹æ˜¯ JVM è‡ªåŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼ˆä½†ä¸ä¸€å®šï¼‰ï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹ï¼›æ¯”å¦‚ JVM çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æ‰€æœ‰çº¿ç¨‹å·²ç»æ’¤ç¦»ï¼Œä¸å†äº§ç”Ÿåƒåœ¾ï¼Œå®ˆæŠ¤çº¿ç¨‹è‡ªç„¶å°±æ²¡äº‹å¯å¹²äº†ï¼Œå½“åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯ Java è™šæ‹Ÿæœºä¸Šä»…å‰©çš„çº¿ç¨‹æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šè‡ªåŠ¨ç¦»å¼€ã€‚ æ‰©å±•ï¼šThread Dump æ‰“å°å‡ºæ¥çš„çº¿ç¨‹ä¿¡æ¯ï¼Œå«æœ‰ daemon å­—æ ·çš„çº¿ç¨‹å³ä¸ºå®ˆæŠ¤ è¿›ç¨‹ï¼Œå¯èƒ½ä¼šæœ‰ï¼šæœåŠ¡å®ˆæŠ¤è¿›ç¨‹ã€ç¼–è¯‘å®ˆæŠ¤è¿›ç¨‹ã€windows ä¸‹çš„ç›‘å¬ Ctrl+breakçš„å®ˆæŠ¤è¿›ç¨‹ã€Finalizer å®ˆæŠ¤è¿›ç¨‹ã€å¼•ç”¨å¤„ç†å®ˆæŠ¤è¿›ç¨‹ã€GC å®ˆæŠ¤è¿›ç¨‹ã€‚ 2ã€çº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒã€‚ ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ 3ã€ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ å¤šçº¿ç¨‹ä¼šå…±åŒä½¿ç”¨ä¸€ç»„è®¡ç®—æœºä¸Šçš„ CPUï¼Œè€Œçº¿ç¨‹æ•°å¤§äºç»™ç¨‹åºåˆ†é…çš„ CPU æ•°é‡æ—¶ï¼Œä¸ºäº†è®©å„ä¸ªçº¿ç¨‹éƒ½æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œå°±éœ€è¦è½®è½¬ä½¿ç”¨ CPUã€‚ä¸åŒçš„çº¿ç¨‹åˆ‡æ¢ä½¿ç”¨ CPUå‘ç”Ÿçš„åˆ‡æ¢æ•°æ®ç­‰å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ 4ã€æ­»é”ä¸æ´»é”çš„åŒºåˆ«ï¼Œæ­»é”ä¸é¥¥é¥¿çš„åŒºåˆ«ï¼Ÿ æ­»é”ï¼šæ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚ äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šæ‰€è°“äº’æ–¥å°±æ˜¯è¿›ç¨‹åœ¨æŸä¸€æ—¶é—´å†…ç‹¬å èµ„æºã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²è·å¾—èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚æ´»é”ï¼šä»»åŠ¡æˆ–è€…æ‰§è¡Œè€…æ²¡æœ‰è¢«é˜»å¡ï¼Œç”±äºæŸäº›æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå¯¼è‡´ä¸€ç›´é‡å¤å°è¯•ï¼Œå¤±è´¥ï¼Œå°è¯•ï¼Œå¤±è´¥ã€‚ æ´»é”å’Œæ­»é”çš„åŒºåˆ«åœ¨äºï¼Œå¤„äºæ´»é”çš„å®ä½“æ˜¯åœ¨ä¸æ–­çš„æ”¹å˜çŠ¶æ€ï¼Œæ‰€è°“çš„ â€œæ´»â€ï¼Œ è€Œå¤„äºæ­»é”çš„å®ä½“è¡¨ç°ä¸ºç­‰å¾…ï¼›æ´»é”æœ‰å¯èƒ½è‡ªè¡Œè§£å¼€ï¼Œæ­»é”åˆ™ä¸èƒ½ã€‚ é¥¥é¥¿ï¼šä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹å› ä¸ºç§ç§åŸå› æ— æ³•è·å¾—æ‰€éœ€è¦çš„èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•æ‰§è¡Œçš„çŠ¶æ€ã€‚ Java ä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› ï¼š é«˜ä¼˜å…ˆçº§çº¿ç¨‹åå™¬æ‰€æœ‰çš„ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„ CPU æ—¶é—´ã€‚ çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½åœ¨å®ƒä¹‹å‰æŒç»­åœ°å¯¹è¯¥åŒæ­¥å—è¿›è¡Œè®¿é—®ã€‚ çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæœ¬èº«ä¹Ÿå¤„äºæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡(æ¯”å¦‚è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ wait æ–¹æ³•)ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯è¢«æŒç»­åœ°è·å¾—å”¤é†’ã€‚ 5ã€Java ä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼ã€‚å¯ä»¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¼šæ˜ å°„åˆ°ä¸‹å±‚çš„ç³»ç»Ÿä¸Šé¢çš„ä¼˜å…ˆçº§ä¸Šï¼Œå¦‚éç‰¹åˆ«éœ€è¦ï¼Œå°½é‡ä¸è¦ç”¨ï¼Œé˜²æ­¢çº¿ç¨‹é¥¥é¥¿ã€‚ 6ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹ç»„ï¼Œä¸ºä»€ä¹ˆåœ¨ Java ä¸­ä¸æ¨èä½¿ç”¨ï¼Ÿ ThreadGroup ç±»ï¼Œå¯ä»¥æŠŠçº¿ç¨‹å½’å±åˆ°æŸä¸€ä¸ªçº¿ç¨‹ç»„ä¸­ï¼Œçº¿ç¨‹ç»„ä¸­å¯ä»¥æœ‰çº¿ç¨‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æœ‰çº¿ç¨‹ç»„ï¼Œç»„ä¸­è¿˜å¯ä»¥æœ‰çº¿ç¨‹ï¼Œè¿™æ ·çš„ç»„ç»‡ç»“æ„æœ‰ç‚¹ç±»ä¼¼äºæ ‘çš„å½¢å¼ã€‚ ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ï¼Ÿå› ä¸ºä½¿ç”¨æœ‰å¾ˆå¤šçš„å®‰å…¨éšæ‚£å§ï¼Œæ²¡æœ‰å…·ä½“è¿½ç©¶ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ï¼Œæ¨èä½¿ç”¨çº¿ç¨‹æ± ã€‚ 7ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Executor æ¡†æ¶ï¼Ÿ æ¯æ¬¡æ‰§è¡Œä»»åŠ¡åˆ›å»ºçº¿ç¨‹ new Thread()æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶ã€è€—èµ„æºçš„ã€‚ è°ƒç”¨ new Thread()åˆ›å»ºçš„çº¿ç¨‹ç¼ºä¹ç®¡ç†ï¼Œè¢«ç§°ä¸ºé‡çº¿ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºï¼Œçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’ç«äº‰ä¼šå¯¼è‡´è¿‡å¤šå ç”¨ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªï¼Œè¿˜æœ‰çº¿ç¨‹ä¹‹é—´çš„é¢‘ç¹äº¤æ›¿ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚ æ¥ä½¿ç”¨ new Thread() å¯åŠ¨çš„çº¿ç¨‹ä¸åˆ©äºæ‰©å±•ï¼Œæ¯”å¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å®šæ—¶å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ç­‰éƒ½ä¸ä¾¿å®ç°ã€‚ 8ã€åœ¨ Java ä¸­ Executor å’Œ Executors çš„åŒºåˆ«ï¼Ÿ Executors å·¥å…·ç±»çš„ä¸åŒæ–¹æ³•æŒ‰ç…§æˆ‘ä»¬çš„éœ€æ±‚åˆ›å»ºäº†ä¸åŒçš„çº¿ç¨‹æ± ï¼Œæ¥æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ã€‚ Executor æ¥å£å¯¹è±¡èƒ½æ‰§è¡Œæˆ‘ä»¬çš„çº¿ç¨‹ä»»åŠ¡ã€‚ ExecutorService æ¥å£ç»§æ‰¿äº† Executor æ¥å£å¹¶è¿›è¡Œäº†æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šçš„æ–¹æ³•æˆ‘ä»¬èƒ½è·å¾—ä»»åŠ¡æ‰§è¡Œçš„çŠ¶æ€å¹¶ä¸”å¯ä»¥è·å–ä»»åŠ¡çš„è¿”å›å€¼ã€‚ ä½¿ç”¨ ThreadPoolExecutor å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚ Future è¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œä»–æä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œä»¥ç­‰å¾…è®¡ç®—çš„å®Œæˆï¼Œå¹¶å¯ä»¥ä½¿ç”¨ get()æ–¹æ³•è·å–è®¡ç®—çš„ç»“æœã€‚ 9ã€å¦‚ä½•åœ¨ Windows å’Œ Linux ä¸ŠæŸ¥æ‰¾å“ªä¸ªçº¿ç¨‹ä½¿ç”¨çš„ CPU æ—¶é—´æœ€é•¿ï¼Ÿ 10ã€ä»€ä¹ˆæ˜¯åŸå­æ“ä½œï¼Ÿåœ¨ Java Concurrency API ä¸­æœ‰å“ªäº›åŸå­ç±»(atomic classes)ï¼Ÿ åŸå­æ“ä½œï¼ˆatomic operationï¼‰æ„ä¸ºâ€ä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ ã€‚ å¤„ç†å™¨ä½¿ç”¨åŸºäºå¯¹ç¼“å­˜åŠ é”æˆ–æ€»çº¿åŠ é”çš„æ–¹å¼æ¥å®ç°å¤šå¤„ç†å™¨ä¹‹é—´çš„åŸå­æ“ ä½œã€‚åœ¨ Java ä¸­å¯ä»¥é€šè¿‡é”å’Œå¾ªç¯ CAS çš„æ–¹å¼æ¥å®ç°åŸå­æ“ä½œã€‚ CAS æ“ä½œâ€” â€”Compare \u0026 Setï¼Œæˆ–æ˜¯ Compare \u0026 Swapï¼Œç°åœ¨å‡ ä¹æ‰€æœ‰çš„ CPU æŒ‡ä»¤éƒ½æ”¯æŒ CASçš„åŸå­æ“ä½œã€‚ åŸå­æ“ä½œæ˜¯æŒ‡ä¸€ä¸ªä¸å—å…¶ä»–æ“ä½œå½±å“çš„æ“ä½œä»»åŠ¡å•å…ƒã€‚åŸå­æ“ä½œæ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é¿å…æ•°æ®ä¸ä¸€è‡´å¿…é¡»çš„æ‰‹æ®µã€‚ int++å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰€ä»¥å½“ä¸€ä¸ªçº¿ç¨‹è¯»å–å®ƒçš„å€¼å¹¶åŠ  1 æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æœ‰å¯èƒ½ä¼šè¯»åˆ°ä¹‹å‰çš„å€¼ï¼Œè¿™å°±ä¼šå¼•å‘é”™è¯¯ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä¿è¯å¢åŠ æ“ä½œæ˜¯åŸå­çš„ï¼Œåœ¨ JDK1.5 ä¹‹å‰æˆ‘ä»¬å¯ä»¥ä½¿ ç”¨åŒæ­¥æŠ€æœ¯æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åˆ° JDK1.5ï¼Œjava.util.concurrent.atomic åŒ…æä¾›äº† int å’Œlong ç±»å‹çš„åŸå­åŒ…è£…ç±»ï¼Œå®ƒä»¬å¯ä»¥è‡ªåŠ¨çš„ä¿è¯å¯¹äºä»–ä»¬çš„æ“ä½œæ˜¯åŸå­çš„å¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨åŒæ­¥ã€‚ java.util.concurrent è¿™ä¸ªåŒ…é‡Œé¢æä¾›äº†ä¸€ç»„åŸå­ç±»ã€‚å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”± JVM ä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚ åŸå­ç±»ï¼šAtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReference åŸå­æ•°ç»„ï¼šAtomicIntegerArrayï¼ŒAtomicLongArrayï¼ŒAtomicReferenceArray åŸå­å±æ€§æ›´æ–°å™¨ï¼šAtomicLongFieldUpdaterï¼ŒAtomicIntegerFieldUpdaterï¼Œ AtomicReferenceFieldUpdater è§£å†³ ABA é—®é¢˜çš„åŸå­ç±»ï¼šAtomicMarkableReferenceï¼ˆé€šè¿‡å¼•å…¥ä¸€ä¸ª boolean æ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰ï¼ŒAtomicStampedReferenceï¼ˆé€šè¿‡å¼•å…¥ä¸€ä¸ª int æ¥ç´¯åŠ æ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰ 11ã€Java Concurrency API ä¸­çš„ Lock æ¥å£(Lock interface)æ˜¯ä»€ä¹ˆï¼Ÿå¯¹æ¯”åŒæ­¥å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ Lock æ¥å£æ¯”åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—æä¾›äº†æ›´å…·æ‰©å±•æ€§çš„é”æ“ä½œã€‚ ä»–ä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯ä»¥å…·æœ‰å®Œå…¨ä¸åŒçš„æ€§è´¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³ç±»çš„æ¡ä»¶å¯¹è±¡ã€‚å®ƒçš„ä¼˜åŠ¿æœ‰ï¼šå¯ä»¥ä½¿é”æ›´å…¬å¹³å¯ä»¥ä½¿çº¿ç¨‹åœ¨ç­‰å¾…é”çš„æ—¶å€™å“åº”ä¸­æ–­å¯ä»¥è®©çº¿ç¨‹å°è¯•è·å–é”ï¼Œå¹¶åœ¨æ— æ³•è·å–é”çš„æ—¶å€™ç«‹å³è¿”å›æˆ–è€…ç­‰å¾…ä¸€æ®µæ—¶é—´å¯ä»¥åœ¨ä¸åŒçš„èŒƒå›´ï¼Œä»¥ä¸åŒçš„é¡ºåºè·å–å’Œé‡Šæ”¾é” æ•´ä½“ä¸Šæ¥è¯´ Lock æ˜¯ synchronized çš„æ‰©å±•ç‰ˆï¼ŒLock æä¾›äº†æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„(tryLock æ–¹æ³•)ã€å®šæ—¶çš„(tryLock å¸¦å‚æ–¹æ³•)ã€å¯ä¸­æ–­çš„ (lockInterruptibly)ã€å¯å¤šæ¡ä»¶é˜Ÿåˆ—çš„(newCondition æ–¹æ³•)é”æ“ä½œã€‚å¦å¤– Lock çš„å®ç°ç±»åŸºæœ¬éƒ½æ”¯æŒéå…¬å¹³é”(é»˜è®¤)å’Œå…¬å¹³é”ï¼Œsynchronized åªæ”¯æŒéå…¬å¹³é”ï¼Œå½“ç„¶ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéå…¬å¹³é”æ˜¯é«˜æ•ˆçš„é€‰æ‹©ã€‚ 12ã€ä»€ä¹ˆæ˜¯ Executors æ¡†æ¶ï¼Ÿ Executor æ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ã€‚ æ— é™åˆ¶çš„åˆ›å»ºçº¿ç¨‹ä¼šå¼•èµ·åº”ç”¨ç¨‹åºå†…å­˜æº¢å‡ºã€‚æ‰€ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± æ˜¯ä¸ªæ›´å¥½çš„ çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå¯ä»¥é™åˆ¶çº¿ç¨‹çš„æ•°é‡å¹¶ä¸”å¯ä»¥å›æ”¶å†åˆ©ç”¨è¿™äº›çº¿ç¨‹ã€‚åˆ©ç”¨ Executors æ¡†æ¶å¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚ 13ã€ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿé˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚ è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚ å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚ JDK7 æä¾›äº† 7 ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚åˆ†åˆ«æ˜¯ï¼š ArrayBlockingQueue ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ LinkedBlockingQueue ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ PriorityBlockingQueue ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ DelayQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚ LinkedTransferQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ LinkedBlockingDequeï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚ Java 5 ä¹‹å‰å®ç°åŒæ­¥å­˜å–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ™®é€šçš„ä¸€ä¸ªé›†åˆï¼Œç„¶ååœ¨ä½¿ç”¨çº¿ç¨‹çš„å ä½œå’Œçº¿ç¨‹åŒæ­¥å¯ä»¥å®ç°ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸»è¦çš„æŠ€æœ¯å°±æ˜¯ç”¨å¥½ï¼Œ wait ,notify,notifyAll,sychronized è¿™äº›å…³é”®å­—ã€‚è€Œåœ¨ java 5 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ï¼Œæ­¤æ–¹å¼å¤§å¤§ç®€å°‘äº†ä»£ç é‡ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼Œå®‰å…¨æ–¹é¢ä¹Ÿæœ‰ä¿éšœã€‚ BlockingQueue æ¥å£æ˜¯ Queue çš„å­æ¥å£ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å¹¶ä¸æ˜¯ä½œä¸ºå®¹å™¨ï¼Œè€Œæ˜¯ä½œä¸ºçº¿ç¨‹åŒæ­¥çš„çš„å·¥å…·ï¼Œå› æ­¤ä»–å…·æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç‰¹æ€§ï¼Œå½“ç”Ÿäº§è€…çº¿ç¨‹è¯•å›¾å‘ BlockingQueue æ”¾å…¥å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™çº¿ç¨‹è¢«é˜»å¡ï¼Œå½“æ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œæ­£æ˜¯å› ä¸ºå®ƒæ‰€å…·æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨ç¨‹åºä¸­å¤šä¸ªçº¿ç¨‹äº¤æ›¿å‘ BlockingQueue ä¸­æ”¾å…¥å…ƒç´ ï¼Œå–å‡ºå…ƒç´ ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ é˜»å¡é˜Ÿåˆ—ä½¿ç”¨æœ€ç»å…¸çš„åœºæ™¯å°±æ˜¯ socket å®¢æˆ·ç«¯æ•°æ®çš„è¯»å–å’Œè§£æï¼Œè¯»å–æ•°æ®çš„çº¿ç¨‹ä¸æ–­å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åè§£æçº¿ç¨‹ä¸æ–­ä»é˜Ÿåˆ—å–æ•°æ®è§£æã€‚ ä»€ä¹ˆæ˜¯ Callable å’Œ Future? Callable æ¥å£ç±»ä¼¼äº Runnableï¼Œä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥äº†ï¼Œä½†æ˜¯ Runnable ä¸ä¼šè¿”å›ç»“æœï¼Œå¹¶ä¸”æ— æ³•æŠ›å‡ºè¿”å›ç»“æœçš„å¼‚å¸¸ï¼Œè€Œ Callable åŠŸèƒ½æ›´å¼ºå¤§ä¸€äº›ï¼Œè¢«çº¿ç¨‹æ‰§è¡Œåï¼Œå¯ä»¥è¿”å›å€¼ï¼Œè¿™ä¸ªè¿”å›å€¼å¯ä»¥è¢« Future æ‹¿åˆ°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ Future å¯ä»¥æ‹¿åˆ°å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„è¿”å›å€¼ã€‚ å¯ä»¥è®¤ä¸ºæ˜¯å¸¦æœ‰å›è°ƒçš„ Runnableã€‚ Future æ¥å£è¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡ï¼Œæ˜¯è¿˜æ²¡æœ‰å®Œæˆçš„ä»»åŠ¡ç»™å‡ºçš„æœªæ¥ç»“æœã€‚æ‰€ä»¥è¯´ Callableç”¨äºäº§ç”Ÿç»“æœï¼ŒFuture ç”¨äºè·å–ç»“æœã€‚ ä»€ä¹ˆæ˜¯ FutureTask?ä½¿ç”¨ ExecutorService å¯åŠ¨ä»»åŠ¡ã€‚ åœ¨ Java å¹¶å‘ç¨‹åºä¸­ FutureTask è¡¨ç¤ºä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„å¼‚æ­¥è¿ç®—ã€‚å®ƒæœ‰å¯åŠ¨å’Œå–æ¶ˆè¿ç®—ã€æŸ¥è¯¢è¿ç®—æ˜¯å¦å®Œæˆå’Œå–å›è¿ç®—ç»“æœç­‰æ–¹æ³•ã€‚åªæœ‰å½“è¿ç®—å®Œæˆçš„æ—¶å€™ç»“æœæ‰èƒ½å–å›ï¼Œå¦‚æœè¿ç®—å°šæœªå®Œæˆ get æ–¹æ³•å°†ä¼šé˜»å¡ã€‚ä¸€ä¸ª FutureTask å¯¹è±¡å¯ä»¥å¯¹è°ƒç”¨äº† Callable å’Œ Runnable çš„å¯¹è±¡è¿›è¡ŒåŒ…è£…ï¼Œç”±äº FutureTask ä¹Ÿæ˜¯è°ƒç”¨äº† Runnableæ¥å£æ‰€ä»¥å®ƒå¯ä»¥æäº¤ç»™ Executor æ¥æ‰§è¡Œã€‚ 16ã€ä»€ä¹ˆæ˜¯å¹¶å‘å®¹å™¨çš„å®ç°ï¼Ÿ ä½•ä¸ºåŒæ­¥å®¹å™¨ï¼šå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºé€šè¿‡ synchronized æ¥å®ç°åŒæ­¥çš„å®¹å™¨ï¼Œå¦‚ æœæœ‰å¤šä¸ªçº¿ç¨‹è°ƒç”¨åŒæ­¥å®¹å™¨çš„æ–¹æ³•ï¼Œå®ƒä»¬å°†ä¼šä¸²è¡Œæ‰§è¡Œã€‚æ¯”å¦‚ Vectorï¼Œ Hashtableï¼Œä»¥åŠ Collections.synchronizedSetï¼ŒsynchronizedList ç­‰æ–¹æ³•è¿”å›çš„å®¹å™¨ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹ Vectorï¼ŒHashtable ç­‰è¿™äº›åŒæ­¥å®¹å™¨çš„å®ç°ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›å®¹å™¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼å°±æ˜¯å°†å®ƒä»¬çš„çŠ¶æ€å°è£…èµ·æ¥ï¼Œå¹¶åœ¨éœ€è¦åŒæ­¥çš„æ–¹æ³•ä¸ŠåŠ ä¸Šå…³é”®å­— synchronizedã€‚ å¹¶å‘å®¹å™¨ä½¿ç”¨äº†ä¸åŒæ­¥å®¹å™¨å®Œå…¨ä¸åŒçš„åŠ é”ç­–ç•¥æ¥æä¾›æ›´é«˜çš„å¹¶å‘æ€§å’Œä¼¸ç¼© æ€§ï¼Œä¾‹å¦‚åœ¨ ConcurrentHashMap ä¸­é‡‡ç”¨äº†ä¸€ç§ç²’åº¦æ›´ç»†çš„åŠ é”æœºåˆ¶ï¼Œå¯ä»¥ç§°ä¸ºåˆ†æ®µé”ï¼Œåœ¨è¿™ç§é”æœºåˆ¶ä¸‹ï¼Œå…è®¸ä»»æ„æ•°é‡çš„è¯»çº¿ç¨‹å¹¶å‘åœ°è®¿é—® mapï¼Œå¹¶ä¸”æ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹å’Œå†™æ“ä½œçš„çº¿ç¨‹ä¹Ÿå¯ä»¥å¹¶å‘çš„è®¿é—® mapï¼ŒåŒæ—¶å…è®¸ä¸€å®šæ•°é‡çš„å†™æ“ä½œçº¿ç¨‹å¹¶å‘åœ°ä¿®æ”¹ mapï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸‹å®ç°æ›´é«˜çš„ååé‡ã€‚ 17ã€å¤šçº¿ç¨‹åŒæ­¥å’Œäº’æ–¥æœ‰å‡ ç§å®ç°æ–¹æ³•ï¼Œéƒ½æ˜¯ä»€ä¹ˆï¼Ÿ çº¿ç¨‹åŒæ­¥æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´æ‰€å…·æœ‰çš„ä¸€ç§åˆ¶çº¦å…³ç³»ï¼Œä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯ï¼Œå½“å®ƒæ²¡æœ‰å¾—åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯æ—¶åº”ç­‰å¾…ï¼Œç›´åˆ°æ¶ˆæ¯åˆ°è¾¾æ—¶æ‰è¢«å”¤é†’ã€‚çº¿ç¨‹äº’æ–¥æ˜¯æŒ‡å¯¹äºå…±äº«çš„è¿›ç¨‹ç³»ç»Ÿèµ„æºï¼Œåœ¨å„å•ä¸ªçº¿ç¨‹è®¿é—®æ—¶çš„æ’å®ƒæ€§ã€‚å½“æœ‰è‹¥å¹²ä¸ªçº¿ç¨‹éƒ½è¦ä½¿ç”¨æŸä¸€å…±äº«èµ„æºæ—¶ï¼Œä»»ä½•æ—¶åˆ»æœ€å¤šåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»ä½¿ç”¨ï¼Œå…¶å®ƒè¦ä½¿ç”¨è¯¥èµ„æºçš„çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°å ç”¨èµ„æºè€…é‡Šæ”¾è¯¥èµ„æºã€‚çº¿ç¨‹äº’æ–¥å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹åŒæ­¥ã€‚ çº¿ç¨‹é—´çš„åŒæ­¥æ–¹æ³•å¤§ä½“å¯åˆ†ä¸ºä¸¤ç±»ï¼šç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼ã€‚é¡¾åæ€ä¹‰ï¼Œå†…æ ¸æ¨¡å¼å°±æ˜¯æŒ‡åˆ©ç”¨ç³»ç»Ÿå†…æ ¸å¯¹è±¡çš„å•ä¸€æ€§æ¥è¿›è¡ŒåŒæ­¥ï¼Œä½¿ç”¨æ—¶éœ€è¦åˆ‡æ¢å†…æ ¸æ€ä¸ç”¨æˆ·æ€ï¼Œè€Œç”¨æˆ·æ¨¡å¼å°±æ˜¯ä¸éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œåªåœ¨ç”¨æˆ·æ€å®Œæˆæ“ä½œã€‚ ç”¨æˆ·æ¨¡å¼ä¸‹çš„æ–¹æ³•æœ‰ï¼šåŸå­æ“ä½œï¼ˆä¾‹å¦‚ä¸€ä¸ªå•ä¸€çš„å…¨å±€å˜é‡ï¼‰ï¼Œä¸´ç•ŒåŒºã€‚å†…æ ¸æ¨¡å¼ä¸‹çš„æ–¹æ³•æœ‰ï¼šäº‹ä»¶ï¼Œä¿¡å·é‡ï¼Œäº’æ–¥é‡ã€‚ 18ã€ä»€ä¹ˆæ˜¯ç«äº‰æ¡ä»¶ï¼Ÿä½ æ€æ ·å‘ç°å’Œè§£å†³ç«äº‰ï¼Ÿ å½“å¤šä¸ªè¿›ç¨‹éƒ½ä¼å›¾å¯¹å…±äº«æ•°æ®è¿›è¡ŒæŸç§å¤„ç†ï¼Œè€Œæœ€åçš„ç»“æœåˆå–å†³äºè¿›ç¨‹è¿è¡Œçš„é¡ºåºæ—¶ï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºè¿™å‘ç”Ÿäº†ç«äº‰æ¡ä»¶ï¼ˆrace conditionï¼‰ã€‚ 19ã€ä½ å°†å¦‚ä½•ä½¿ç”¨ thread dumpï¼Ÿä½ å°†å¦‚ä½•åˆ†æ Thread dumpï¼Ÿ æ–°å»ºçŠ¶æ€ï¼ˆNewï¼‰ç”¨ new è¯­å¥åˆ›å»ºçš„çº¿ç¨‹å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶å®ƒå’Œå…¶ä»– Java å¯¹è±¡ä¸€æ ·ï¼Œä»…ä»…åœ¨å †åŒºä¸­è¢«åˆ†é…äº†å†…å­˜ã€‚å°±ç»ªçŠ¶æ€ï¼ˆRunnableï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨å®ƒçš„ start()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ŒJava è™šæ‹Ÿæœºä¼šä¸ºå®ƒåˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œæ± ä¸­ï¼Œç­‰å¾…è·å¾— CPU çš„ä½¿ç”¨æƒã€‚ è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰ å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹å ç”¨ CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚åªæœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚ é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸäº›åŸå› æ”¾å¼ƒ CPUï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚å½“çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¸ä¼šç»™çº¿ç¨‹åˆ†é… CPUã€‚ç›´åˆ°çº¿ç¨‹é‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå®ƒæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚ é˜»å¡çŠ¶æ€å¯åˆ†ä¸ºä»¥ä¸‹ 3 ç§ï¼š ä½äºå¯¹è±¡ç­‰å¾…æ± ä¸­çš„é˜»å¡çŠ¶æ€ï¼ˆBlocked in objectâ€™s wait poolï¼‰ï¼š å½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¦‚æœæ‰§è¡Œäº†æŸä¸ªå¯¹è±¡çš„ wait()æ–¹æ³•ï¼ŒJava è™šæ‹Ÿæœºå°± ä¼šæŠŠçº¿ç¨‹æ”¾åˆ°è¿™ä¸ªå¯¹è±¡çš„ç­‰å¾…æ± ä¸­ï¼Œè¿™æ¶‰åŠåˆ°â€œçº¿ç¨‹é€šä¿¡â€çš„å†…å®¹ã€‚ä½äºå¯¹è±¡é”æ± ä¸­çš„é˜»å¡çŠ¶æ€ï¼ˆBlocked in objectâ€™s lock poolï¼‰ï¼š å½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè¯•å›¾è·å¾—æŸä¸ªå¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡çš„åŒæ­¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹æ”¾åˆ°è¿™ä¸ªå¯¹è±¡çš„é”æ± ä¸­ï¼Œè¿™æ¶‰åŠåˆ°â€œçº¿ç¨‹åŒæ­¥â€çš„å†…å®¹ã€‚ å…¶ä»–é˜»å¡çŠ¶æ€ï¼ˆOtherwise Blockedï¼‰ï¼š å½“å‰çº¿ç¨‹æ‰§è¡Œäº† sleep()æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨äº†å…¶ä»–çº¿ç¨‹çš„ join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº† I/Oè¯·æ±‚æ—¶ï¼Œå°±ä¼šè¿›å…¥è¿™ä¸ªçŠ¶æ€ã€‚ æ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰ å½“çº¿ç¨‹é€€å‡º run()æ–¹æ³•æ—¶ï¼Œå°±è¿›å…¥æ­»äº¡çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚ 20ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬è°ƒç”¨ start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œ run() æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ run()æ–¹æ³•ï¼Ÿ å½“ä½ è°ƒç”¨ start()æ–¹æ³•æ—¶ä½ å°†åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä¸”æ‰§è¡Œåœ¨ run()æ–¹æ³•é‡Œçš„ä»£ç ã€‚ ä½†æ˜¯å¦‚æœä½ ç›´æ¥è°ƒç”¨ run()æ–¹æ³•ï¼Œå®ƒä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ä¹Ÿä¸ä¼šæ‰§è¡Œè°ƒç”¨çº¿ç¨‹çš„ä»£ç ï¼Œåªä¼šæŠŠ run æ–¹æ³•å½“ä½œæ™®é€šæ–¹æ³•å»æ‰§è¡Œã€‚ 21ã€Java ä¸­ä½ æ€æ ·å”¤é†’ä¸€ä¸ªé˜»å¡çš„çº¿ç¨‹ï¼Ÿ åœ¨ Java å‘å±•å²ä¸Šæ›¾ç»ä½¿ç”¨ suspend()ã€resume()æ–¹æ³•å¯¹äºçº¿ç¨‹è¿›è¡Œé˜»å¡å”¤é†’ï¼Œä½†éšä¹‹å‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”è¾ƒå…¸å‹çš„è¿˜æ˜¯æ­»é”é—®é¢˜ã€‚ è§£å†³æ–¹æ¡ˆå¯ä»¥ä½¿ç”¨ä»¥å¯¹è±¡ä¸ºç›®æ ‡çš„é˜»å¡ï¼Œå³åˆ©ç”¨ Object ç±»çš„ wait()å’Œ notify()æ–¹æ³•å®ç°çº¿ç¨‹é˜»å¡ã€‚ é¦– å…ˆ ï¼Œwaitã€notify æ–¹æ³•æ˜¯é’ˆå¯¹å¯¹è±¡çš„ï¼Œè°ƒç”¨ä»»æ„å¯¹è±¡çš„ wait()æ–¹æ³•éƒ½å°†å¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œé˜»å¡çš„åŒæ—¶ä¹Ÿå°†é‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œç›¸åº”åœ°ï¼Œè°ƒç”¨ä»»æ„å¯¹è±¡çš„ notify()æ–¹æ³•åˆ™å°†éšæœºè§£é™¤è¯¥å¯¹è±¡é˜»å¡çš„çº¿ç¨‹ï¼Œä½†å®ƒéœ€è¦é‡æ–°è·å–æ”¹å¯¹è±¡çš„é”ï¼Œç›´åˆ°è·å–æˆåŠŸæ‰èƒ½å¾€ä¸‹æ‰§è¡Œï¼›å…¶æ¬¡ï¼Œwaitã€notify æ–¹æ³•å¿…é¡»åœ¨ synchronized å—æˆ–æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œå¹¶ä¸”è¦ä¿è¯åŒæ­¥å—æˆ–æ–¹æ³•çš„é”å¯¹è±¡ä¸è°ƒç”¨ waitã€notify æ–¹æ³•çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œå¦‚æ­¤ä¸€æ¥åœ¨è°ƒç”¨ wait ä¹‹å‰å½“å‰çº¿ç¨‹å°±å·²ç»æˆåŠŸè·å–æŸå¯¹è±¡çš„é”ï¼Œæ‰§è¡Œ wait é˜»å¡åå½“å‰çº¿ç¨‹å°±å°†ä¹‹å‰è·å–çš„å¯¹è±¡é”é‡Šæ”¾ã€‚ 22ã€åœ¨ Java ä¸­ CycliBarriar å’Œ CountdownLatch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ CyclicBarrier å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œè€Œ CountdownLatch ä¸èƒ½é‡å¤ä½¿ç”¨ã€‚ Java çš„ concurrent åŒ…é‡Œé¢çš„ CountDownLatch å…¶å®å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªè®¡æ•°å™¨ï¼Œåªä¸è¿‡è¿™ä¸ªè®¡æ•°å™¨çš„æ“ä½œæ˜¯åŸå­æ“ä½œï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»æ“ä½œè¿™ä¸ªè®¡ æ•°å™¨ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»å‡è¿™ä¸ªè®¡æ•°å™¨é‡Œé¢çš„å€¼ã€‚ä½ å¯ä»¥å‘ CountDownLatch å¯¹è±¡è®¾ç½®ä¸€ä¸ªåˆå§‹çš„æ•°å­—ä½œä¸ºè®¡æ•°å€¼ï¼Œä»»ä½•è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸Šçš„ await()æ–¹æ³•éƒ½ä¼šé˜»å¡ï¼Œç›´åˆ°è¿™ä¸ªè®¡æ•°å™¨çš„è®¡æ•°å€¼è¢«å…¶ä»–çš„çº¿ç¨‹å‡ä¸º 0 ä¸ºæ­¢ã€‚æ‰€ä»¥åœ¨å½“å‰è®¡æ•°åˆ°è¾¾é›¶ä¹‹å‰ï¼Œawait æ–¹æ³•ä¼šä¸€ç›´å—é˜»å¡ã€‚ä¹‹åï¼Œä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œawait çš„æ‰€æœ‰åç»­è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ã€‚è¿™ç§ç°è±¡åªå‡ºç°ä¸€æ¬¡â€”â€”è®¡æ•°æ— æ³•è¢«é‡ç½®ã€‚å¦‚æœéœ€è¦é‡ç½®è®¡æ•°ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ CyclicBarrierã€‚ CountDownLatch çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯ï¼šæœ‰ä¸€ä¸ªä»»åŠ¡æƒ³è¦å¾€ä¸‹æ‰§è¡Œï¼Œä½†å¿…é¡»è¦ç­‰åˆ°å…¶ä»–çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å‡å¦‚æˆ‘ä»¬è¿™ä¸ªæƒ³è¦ç»§ç»­å¾€ä¸‹æ‰§è¡Œçš„ä»»åŠ¡è°ƒç”¨ä¸€ä¸ª CountDownLatch å¯¹è±¡çš„ await()æ–¹æ³•ï¼Œå…¶ä»–çš„ä»»åŠ¡æ‰§è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡åè°ƒç”¨åŒä¸€ä¸ª CountDownLatch å¯¹è±¡ä¸Šçš„ countDown()æ–¹ æ³•ï¼Œè¿™ä¸ªè°ƒç”¨ await()æ–¹æ³•çš„ä»»åŠ¡å°†ä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ª CountDownLatch å¯¹è±¡çš„è®¡æ•°å€¼å‡åˆ° 0 ä¸ºæ­¢ã€‚ CyclicBarrier ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå®ƒå…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ (common barrier point)ã€‚åœ¨æ¶‰åŠä¸€ç»„å›ºå®šå¤§å°çš„çº¿ç¨‹çš„ç¨‹åºä¸­ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»ä¸æ—¶åœ°äº’ç›¸ç­‰å¾…ï¼Œæ­¤æ—¶ CyclicBarrier å¾ˆæœ‰ç”¨ã€‚å› ä¸ºè¯¥ barrier åœ¨é‡Šæ”¾ç­‰å¾…çº¿ç¨‹åå¯ä»¥é‡ç”¨ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºå¾ªç¯ çš„ barrierã€‚ 23ã€ä»€ä¹ˆæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå®ƒå¯¹å†™å¹¶å‘åº”ç”¨æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿ ä¸å¯å˜å¯¹è±¡(Immutable Objects)å³å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºå®ƒçš„çŠ¶æ€ï¼ˆå¯¹è±¡çš„æ•°æ®ï¼Œä¹Ÿå³å¯¹è±¡å±æ€§å€¼ï¼‰å°±ä¸èƒ½æ”¹å˜ï¼Œåä¹‹å³ä¸ºå¯å˜å¯¹è±¡(Mutable Objects)ã€‚ ä¸å¯å˜å¯¹è±¡çš„ç±»å³ä¸ºä¸å¯å˜ç±»(Immutable Class)ã€‚Java å¹³å°ç±»åº“ä¸­åŒ…å«è®¸å¤šä¸å¯å˜ç±»ï¼Œå¦‚ Stringã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€BigInteger å’Œ BigDecimal ç­‰ã€‚ä¸å¯å˜å¯¹è±¡å¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å®ƒä»¬çš„å¸¸é‡ï¼ˆåŸŸï¼‰æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºçš„ã€‚æ—¢ç„¶å®ƒä»¬çš„çŠ¶æ€æ— æ³•ä¿®æ”¹ï¼Œè¿™äº›å¸¸é‡æ°¸è¿œä¸ä¼šå˜ã€‚ ä¸å¯å˜å¯¹è±¡æ°¸è¿œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åªæœ‰æ»¡è¶³å¦‚ä¸‹çŠ¶æ€ï¼Œä¸€ä¸ªå¯¹è±¡æ‰æ˜¯ä¸å¯å˜çš„ï¼› å®ƒçš„çŠ¶æ€ä¸èƒ½åœ¨åˆ›å»ºåå†è¢«ä¿®æ”¹ï¼›æ‰€æœ‰åŸŸéƒ½æ˜¯ final ç±»å‹ï¼›å¹¶ä¸”ï¼Œå®ƒè¢«æ­£ç¡®åˆ›å»ºï¼ˆåˆ›å»ºæœŸé—´æ²¡æœ‰å‘ç”Ÿ this å¼•ç”¨çš„é€¸å‡ºï¼‰ã€‚ 24ã€ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒCPU ä¼šåœæ­¢å¤„ç†å½“å‰è¿è¡Œçš„ç¨‹åºï¼Œå¹¶ä¿å­˜å½“å‰ç¨‹åºè¿è¡Œçš„å…·ä½“ä½ç½®ä»¥ä¾¿ä¹‹åç»§ç»­è¿è¡Œã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰ç‚¹åƒæˆ‘ä»¬åŒæ—¶é˜…è¯»å‡ æœ¬ä¹¦ï¼Œåœ¨æ¥å›åˆ‡æ¢ä¹¦æœ¬çš„åŒæ—¶æˆ‘ä»¬éœ€è¦è®°ä½æ¯æœ¬ä¹¦å½“å‰è¯»åˆ°çš„é¡µç ã€‚åœ¨ç¨‹åºä¸­ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­çš„â€œé¡µç â€ä¿¡æ¯æ˜¯ä¿å­˜åœ¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ä¸­çš„ã€‚ PCB è¿˜ç»å¸¸è¢«ç§°ä½œâ€œåˆ‡æ¢æ¡¢â€ï¼ˆswitchframeï¼‰ã€‚â€œé¡µç â€ä¿¡æ¯ä¼šä¸€ç›´ä¿å­˜åˆ° CPU çš„å†…å­˜ä¸­ï¼Œç›´åˆ°ä»–ä»¬è¢«å†æ¬¡ä½¿ç”¨ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å­˜å‚¨å’Œæ¢å¤ CPU çŠ¶æ€çš„è¿‡ç¨‹ï¼Œå®ƒä½¿å¾—çº¿ç¨‹æ‰§è¡Œèƒ½å¤Ÿä»ä¸­æ–­ç‚¹æ¢å¤æ‰§è¡Œã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå’Œå¤šçº¿ç¨‹ç¯å¢ƒçš„åŸºæœ¬ç‰¹å¾ã€‚ 25ã€Java ä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ è®¡ç®—æœºé€šå¸¸åªæœ‰ä¸€ä¸ª CPU,åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤,æ¯ä¸ªçº¿ç¨‹åªæœ‰è·å¾—CPU çš„ä½¿ç”¨æƒæ‰èƒ½æ‰§è¡ŒæŒ‡ä»¤.æ‰€è°“å¤šçº¿ç¨‹çš„å¹¶å‘è¿è¡Œ,å…¶å®æ˜¯æŒ‡ä»å®è§‚ä¸Šçœ‹, å„ä¸ªçº¿ç¨‹è½®æµè·å¾— CPU çš„ä½¿ç”¨æƒ,åˆ†åˆ«æ‰§è¡Œå„è‡ªçš„ä»»åŠ¡.åœ¨è¿è¡Œæ± ä¸­,ä¼šæœ‰å¤šä¸ªå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åœ¨ç­‰å¾… CPU,JAVA è™šæ‹Ÿæœºçš„ä¸€é¡¹ä»»åŠ¡å°±æ˜¯è´Ÿè´£çº¿ç¨‹çš„è°ƒåº¦, çº¿ç¨‹è°ƒåº¦æ˜¯æŒ‡æŒ‰ç…§ç‰¹å®šæœºåˆ¶ä¸ºå¤šä¸ªçº¿ç¨‹åˆ†é… CPU çš„ä½¿ç”¨æƒ. æœ‰ä¸¤ç§è°ƒåº¦æ¨¡å‹ï¼šåˆ†æ—¶è°ƒåº¦æ¨¡å‹å’ŒæŠ¢å å¼è°ƒåº¦æ¨¡å‹ã€‚ åˆ†æ—¶è°ƒåº¦æ¨¡å‹æ˜¯æŒ‡è®©æ‰€æœ‰çš„çº¿ç¨‹è½®æµè·å¾— cpu çš„ä½¿ç”¨æƒ,å¹¶ä¸”å¹³å‡åˆ†é…æ¯ä¸ªçº¿ç¨‹å ç”¨çš„ CPU çš„æ—¶é—´ç‰‡è¿™ä¸ªä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚ Javaè™šæ‹Ÿæœºé‡‡ç”¨æŠ¢å å¼è°ƒåº¦æ¨¡å‹ï¼Œæ˜¯æŒ‡ä¼˜å…ˆè®©å¯è¿è¡Œæ± ä¸­ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹å ç”¨ CPUï¼Œå¦‚æœå¯è¿è¡Œæ± ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§ç›¸åŒï¼Œé‚£ä¹ˆå°±éšæœºé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿å…¶å ç”¨ CPUã€‚å¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ä¼šä¸€ç›´è¿è¡Œï¼Œç›´è‡³å®ƒä¸å¾—ä¸æ”¾å¼ƒ CPUã€‚ 26ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹ç»„ï¼Œä¸ºä»€ä¹ˆåœ¨ Java ä¸­ä¸æ¨èä½¿ç”¨ï¼Ÿ çº¿ç¨‹ç»„å’Œçº¿ç¨‹æ± æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä»–ä»¬çš„ä½œç”¨å®Œå…¨ä¸åŒï¼Œå‰è€…æ˜¯ä¸ºäº†æ–¹ä¾¿çº¿ç¨‹çš„ç®¡ç†ï¼Œåè€…æ˜¯ä¸ºäº†ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¤ç”¨çº¿ç¨‹ï¼Œå‡å°‘åˆ›å»ºé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚ 27ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Executor æ¡†æ¶æ¯”ä½¿ç”¨åº”ç”¨åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹å¥½ï¼Ÿ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Executor çº¿ç¨‹æ± æ¡†æ¶ æ¯æ¬¡æ‰§è¡Œä»»åŠ¡åˆ›å»ºçº¿ç¨‹ new Thread()æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶ã€è€—èµ„æºçš„ã€‚ è°ƒç”¨ new Thread()åˆ›å»ºçš„çº¿ç¨‹ç¼ºä¹ç®¡ç†ï¼Œè¢«ç§°ä¸ºé‡çº¿ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºï¼Œçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’ç«äº‰ä¼šå¯¼è‡´è¿‡å¤šå ç”¨ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªï¼Œè¿˜æœ‰çº¿ç¨‹ä¹‹é—´çš„é¢‘ç¹äº¤æ›¿ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚ ç›´æ¥ä½¿ç”¨ new Thread() å¯åŠ¨çš„çº¿ç¨‹ä¸åˆ©äºæ‰©å±•ï¼Œæ¯”å¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å®šæ—¶å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ç­‰éƒ½ä¸ä¾¿å®ç°ã€‚ ä½¿ç”¨ Executor çº¿ç¨‹æ± æ¡†æ¶çš„ä¼˜ç‚¹ èƒ½å¤ç”¨å·²å­˜åœ¨å¹¶ç©ºé—²çš„çº¿ç¨‹ä»è€Œå‡å°‘çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºä»è€Œå‡å°‘äº†æ¶ˆäº¡çº¿ç¨‹çš„å¼€é”€ã€‚ å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ã€‚ æ¡†æ¶ä¸­å·²ç»æœ‰å®šæ—¶ã€å®šæœŸã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æ§åˆ¶ç­‰åŠŸèƒ½ã€‚ ç»¼ä¸Šæ‰€è¿°ä½¿ç”¨çº¿ç¨‹æ± æ¡†æ¶ Executor èƒ½æ›´å¥½çš„ç®¡ç†çº¿ç¨‹ã€æä¾›ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ã€‚ 28ã€java ä¸­æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ ç»§æ‰¿ Thread ç±»å®ç° Runnable æ¥å£ å®ç° Callable æ¥å£ï¼Œéœ€è¦å®ç°çš„æ˜¯ call() æ–¹æ³• 29ã€å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ ä½¿ç”¨å…±äº«å˜é‡çš„æ–¹å¼åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œä¹‹æ‰€ä»¥å¼•å…¥å…±äº«å˜é‡ï¼Œæ˜¯å› ä¸ºè¯¥å˜é‡å¯ä»¥è¢«å¤šä¸ªæ‰§è¡Œç›¸åŒä»»åŠ¡çš„çº¿ç¨‹ç”¨æ¥ä½œä¸ºæ˜¯å¦ä¸­æ–­çš„ä¿¡å·ï¼Œé€šçŸ¥ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œã€‚ ä½¿ç”¨ interrupt æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ å¦‚æœä¸€ä¸ªçº¿ç¨‹ç”±äºç­‰å¾…æŸäº›äº‹ä»¶çš„å‘ç”Ÿè€Œè¢«é˜»å¡ï¼Œåˆè¯¥æ€æ ·åœæ­¢è¯¥çº¿ç¨‹å‘¢ï¼Ÿè¿™ç§æƒ…å†µç»å¸¸ä¼šå‘ç”Ÿï¼Œæ¯”å¦‚å½“ä¸€ä¸ªçº¿ç¨‹ç”±äºéœ€è¦ç­‰å€™é”®ç›˜è¾“å…¥è€Œè¢«é˜»å¡ï¼Œæˆ–è€…è°ƒç”¨Thread.join()æ–¹æ³•ï¼Œæˆ–è€… Thread.sleep()æ–¹æ³•ï¼Œåœ¨ç½‘ç»œä¸­è°ƒç”¨ ServerSocket.accept()æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨äº† DatagramSocket.receive()æ–¹æ³• æ—¶ï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œä½¿çº¿ç¨‹å¤„äºå¤„äºä¸å¯è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå³ä½¿ä¸»ç¨‹åºä¸­å°†è¯¥çº¿ç¨‹çš„å…±äº«å˜é‡è®¾ç½®ä¸º trueï¼Œä½†è¯¥çº¿ç¨‹æ­¤æ—¶æ ¹æœ¬æ— æ³•æ£€æŸ¥å¾ªç¯æ ‡å¿—ï¼Œå½“ç„¶ä¹Ÿå°±æ— æ³•ç«‹å³ä¸­æ–­ã€‚è¿™é‡Œæˆ‘ä»¬ç»™å‡ºçš„å»ºè®®æ˜¯ï¼Œä¸è¦ä½¿ç”¨ stop()æ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨ Thread æä¾›çš„interrupt()æ–¹æ³•ï¼Œå› ä¸ºè¯¥æ–¹æ³•è™½ç„¶ä¸ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œä½†æ˜¯å®ƒå¯ä»¥ä½¿ä¸€ä¸ªè¢«é˜»å¡çš„çº¿ç¨‹æŠ›å‡ºä¸€ä¸ªä¸­æ–­å¼‚å¸¸ï¼Œä»è€Œä½¿çº¿ç¨‹æå‰ç»“æŸé˜»å¡çŠ¶æ€ï¼Œé€€å‡ºå µå¡ä»£ç ã€‚ 30ã€notify()å’Œ notifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ wait ä¹‹åï¼Œå°±å¿…é¡»ç­‰å…¶ä»–çº¿ç¨‹ notify/notifyall,ä½¿ç”¨ notifyall,å¯ä»¥å”¤é†’æ‰€æœ‰å¤„äº wait çŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶é‡æ–°è¿›å…¥é”çš„äº‰å¤ºé˜Ÿåˆ—ä¸­ï¼Œè€Œ notify åªèƒ½å”¤é†’ä¸€ä¸ªã€‚ å¦‚æœæ²¡æŠŠæ¡ï¼Œå»ºè®® notifyAllï¼Œé˜²æ­¢ notigy å› ä¸ºä¿¡å·ä¸¢å¤±è€Œé€ æˆç¨‹åºå¼‚å¸¸ã€‚ 31ã€ä»€ä¹ˆæ˜¯ Daemon çº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ æ‰€è°“åå°(daemon)çº¿ç¨‹ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ¨åå°æä¾›ä¸€ç§é€šç”¨æœåŠ¡çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªçº¿ç¨‹å¹¶ä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå½“æ‰€æœ‰çš„éåå°çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢äº†ï¼ŒåŒæ—¶ä¼šæ€æ­»è¿›ç¨‹ä¸­çš„æ‰€æœ‰åå°çº¿ç¨‹ã€‚åè¿‡æ¥è¯´ï¼Œåªè¦æœ‰ä»»ä½•éåå°çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œç¨‹åºå°±ä¸ä¼šç»ˆæ­¢ã€‚å¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰è°ƒç”¨ setDaemon()æ–¹æ³•ï¼Œæ‰èƒ½æŠŠå®ƒè®¾ç½®ä¸ºåå°çº¿ç¨‹ã€‚æ³¨æ„ï¼šåå°è¿›ç¨‹åœ¨ä¸æ‰§è¡Œ finallyå­å¥çš„æƒ…å†µä¸‹å°±ä¼šç»ˆæ­¢å…¶ run()æ–¹æ³•ã€‚ æ¯”å¦‚ï¼šJVM çš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ Daemon çº¿ç¨‹ï¼ŒFinalizer ä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚ 32ã€java å¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œï¼Ÿ ä¸­æ–­ å’Œ å…±äº«å˜é‡ 33ã€ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰ï¼Ÿ ä¸¾ä¾‹æ¥è¯´æ˜é”çš„å¯é‡å…¥æ€§ public class UnReentrant{ Lock lock = new Lock(); public void outer(){ lock.lock(); inner(); lock.unlock(); } public void inner(){ lock.lock(); //do something lock.unlock(); } }å¤åˆ¶ä»£ç  outer ä¸­è°ƒç”¨äº† innerï¼Œouter å…ˆé”ä½äº† lockï¼Œè¿™æ · inner å°±ä¸èƒ½å†è·å– lockã€‚å…¶å®è°ƒç”¨ outer çš„çº¿ç¨‹å·²ç»è·å–äº† lock é”ï¼Œä½†æ˜¯ä¸èƒ½åœ¨ inner ä¸­é‡å¤åˆ©ç”¨å·²ç»è·å–çš„é”èµ„æºï¼Œè¿™ç§é”å³ç§°ä¹‹ä¸º ä¸å¯é‡å…¥å¯é‡å…¥å°±æ„å‘³ç€ï¼šçº¿ç¨‹å¯ä»¥è¿›å…¥ä»»ä½•ä¸€ä¸ªå®ƒå·²ç»æ‹¥æœ‰çš„é”æ‰€åŒæ­¥ç€çš„ä»£ç å—ã€‚ synchronizedã€ReentrantLock éƒ½æ˜¯å¯é‡å…¥çš„é”ï¼Œå¯é‡å…¥é”ç›¸å¯¹æ¥è¯´ç®€åŒ–äº†å¹¶å‘ç¼–ç¨‹çš„å¼€å‘ã€‚ 34ã€å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æŸä¸ªå¯¹è±¡çš„ä¸€ä¸ª synchronized çš„å®ä¾‹æ–¹æ³•åï¼Œå…¶å®ƒçº¿ç¨‹æ˜¯å¦å¯è¿›å…¥æ­¤å¯¹è±¡çš„å…¶å®ƒæ–¹æ³•ï¼Ÿ å¦‚æœå…¶ä»–æ–¹æ³•æ²¡æœ‰ synchronized çš„è¯ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯å¯ä»¥è¿›å…¥çš„ã€‚ æ‰€ä»¥è¦å¼€æ”¾ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯¹è±¡æ—¶ï¼Œå¾—ä¿è¯æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 35ã€ä¹è§‚é”å’Œæ‚²è§‚é”çš„ç†è§£åŠå¦‚ä½•å®ç°ï¼Œæœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œ è¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚å†æ¯”å¦‚ Java é‡Œé¢çš„åŒæ­¥åŸè¯­ synchronized å…³é”®å­—çš„å®ç°ä¹Ÿæ˜¯æ‚²è§‚é”ã€‚ ä¹è§‚é”ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äº write_condition æœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨ Javaä¸­ java.util.concurrent.atomic åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ CAS å®ç°çš„ã€‚ ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼š ä½¿ç”¨ç‰ˆæœ¬æ ‡è¯†æ¥ç¡®å®šè¯»åˆ°çš„æ•°æ®ä¸æäº¤æ—¶çš„æ•°æ®æ˜¯å¦ä¸€è‡´ã€‚æäº¤åä¿®æ”¹ç‰ˆæœ¬æ ‡è¯†ï¼Œä¸ä¸€è‡´æ—¶å¯ä»¥é‡‡å–ä¸¢å¼ƒå’Œå†æ¬¡å°è¯•çš„ç­–ç•¥ã€‚ java ä¸­çš„ Compare and Swap å³ CAS ï¼Œå½“å¤šä¸ªçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS åŒæ—¶æ›´æ–°åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡çš„å€¼ï¼Œè€Œå…¶å®ƒçº¿ç¨‹éƒ½å¤±è´¥ï¼Œå¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯è¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰ä¸­å¤±è´¥ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚ CAS æ“ä½œä¸­åŒ…å«ä¸‰ä¸ªæ“ä½œæ•° â€”â€” éœ€è¦è¯»å†™çš„å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€è¿›è¡Œæ¯”è¾ƒçš„é¢„æœŸåŸå€¼ ï¼ˆAï¼‰å’Œæ‹Ÿå†™å…¥çš„æ–°å€¼(B)ã€‚å¦‚æœå†…å­˜ä½ç½® V çš„å€¼ä¸é¢„æœŸåŸå€¼ A ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆ å¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ Bã€‚å¦åˆ™å¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚ CAS ç¼ºç‚¹ï¼š ABA é—®é¢˜ï¼šæ¯”å¦‚è¯´ä¸€ä¸ªçº¿ç¨‹ one ä»å†…å­˜ä½ç½® V ä¸­å–å‡º Aï¼Œè¿™æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹ two ä¹Ÿä»å†…å­˜ä¸­å–å‡º Aï¼Œå¹¶ä¸” two è¿›è¡Œäº†ä¸€äº›æ“ä½œå˜æˆäº† Bï¼Œç„¶å two åˆå°† V ä½ç½®çš„æ•°æ®å˜æˆ Aï¼Œè¿™æ—¶å€™çº¿ç¨‹ one è¿›è¡Œ CAS æ“ä½œå‘ç°å†…å­˜ä¸­ä»ç„¶æ˜¯ Aï¼Œç„¶å one æ“ ä½œæˆåŠŸã€‚å°½ç®¡çº¿ç¨‹ one çš„ CAS æ“ä½œæˆåŠŸï¼Œä½†å¯èƒ½å­˜åœ¨æ½œè—çš„é—®é¢˜ã€‚ä» Java1.5 å¼€å§‹ JDK çš„ atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±» AtomicStampedReference æ¥è§£å†³ ABA é—®é¢˜ã€‚ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ï¼š å¯¹äºèµ„æºç«äº‰ä¸¥é‡ï¼ˆçº¿ç¨‹å†²çªä¸¥é‡ï¼‰çš„æƒ…å†µï¼ŒCAS è‡ªæ—‹çš„æ¦‚ç‡ä¼šæ¯”è¾ƒå¤§ï¼Œä»è€Œæµªè´¹æ›´å¤šçš„ CPU èµ„æºï¼Œæ•ˆç‡ä½äº synchronizedã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼šå½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯ CAS çš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯ CAS å°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚ 36ã€SynchronizedMap å’Œ ConcurrentHashMap æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ SynchronizedMap ä¸€æ¬¡é”ä½æ•´å¼ è¡¨æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è®¿ä¸º mapã€‚ ConcurrentHashMap ä½¿ç”¨åˆ†æ®µé”æ¥ä¿è¯åœ¨å¤šçº¿ç¨‹ä¸‹çš„æ€§èƒ½ã€‚ ConcurrentHashMap ä¸­åˆ™æ˜¯ä¸€æ¬¡é”ä½ä¸€ä¸ªæ¡¶ã€‚ConcurrentHashMap é»˜è®¤å°†hash è¡¨åˆ†ä¸º 16 ä¸ªæ¡¶ï¼Œè¯¸å¦‚ get,put,remove ç­‰å¸¸ç”¨æ“ä½œåªé”å½“å‰éœ€è¦ç”¨åˆ°çš„æ¡¶ã€‚è¿™æ ·ï¼ŒåŸæ¥åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œç°åœ¨å´èƒ½åŒæ—¶æœ‰ 16 ä¸ªå†™çº¿ç¨‹æ‰§è¡Œï¼Œå¹¶å‘æ€§èƒ½çš„æå‡æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ å¦å¤– ConcurrentHashMap ä½¿ç”¨äº†ä¸€ç§ä¸åŒçš„è¿­ä»£æ–¹å¼ã€‚åœ¨è¿™ç§è¿­ä»£æ–¹å¼ä¸­ï¼Œå½“ iterator è¢«åˆ›å»ºåé›†åˆå†å‘ç”Ÿæ”¹å˜å°±ä¸å†æ˜¯æŠ›å‡º ConcurrentModificationExceptionï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨æ”¹å˜æ—¶ new æ–°çš„æ•°æ®ä»è€Œä¸å½±å“åŸæœ‰çš„æ•°æ® ï¼Œiterator å®Œæˆåå†å°†å¤´æŒ‡é’ˆæ›¿æ¢ä¸ºæ–°çš„æ•°æ® ï¼Œè¿™æ · iteratorçº¿ç¨‹å¯ä»¥ä½¿ç”¨åŸæ¥è€çš„æ•°æ®ï¼Œè€Œå†™çº¿ç¨‹ä¹Ÿå¯ä»¥å¹¶å‘çš„å®Œæˆæ”¹å˜ã€‚ 37ã€CopyOnWriteArrayList å¯ä»¥ç”¨äºä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ CopyOnWriteArrayList(å…é”å®¹å™¨)çš„å¥½å¤„ä¹‹ä¸€æ˜¯å½“å¤šä¸ªè¿­ä»£å™¨åŒæ—¶éå†å’Œä¿®æ”¹è¿™ä¸ªåˆ—è¡¨æ—¶ï¼Œä¸ä¼šæŠ›å‡º ConcurrentModificationExceptionã€‚åœ¨ CopyOnWriteArrayList ä¸­ï¼Œå†™å…¥å°†å¯¼è‡´åˆ›å»ºæ•´ä¸ªåº•å±‚æ•°ç»„çš„å‰¯æœ¬ï¼Œè€Œæºæ•°ç»„å°†ä¿ç•™åœ¨åŸåœ°ï¼Œä½¿å¾—å¤åˆ¶çš„æ•°ç»„åœ¨è¢«ä¿®æ”¹æ—¶ï¼Œè¯»å–æ“ä½œå¯ä»¥å®‰å…¨åœ°æ‰§è¡Œã€‚ ç”±äºå†™æ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦æ‹·è´æ•°ç»„ï¼Œä¼šæ¶ˆè€—å†…å­˜ï¼Œå¦‚æœåŸæ•°ç»„çš„å†…å®¹æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´ young gc æˆ–è€… full gcï¼› ä¸èƒ½ç”¨äºå®æ—¶è¯»çš„åœºæ™¯ï¼Œåƒæ‹·è´æ•°ç»„ã€æ–°å¢å…ƒç´ éƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥è°ƒç”¨ä¸€ä¸ª setæ“ä½œåï¼Œè¯»å–åˆ°æ•°æ®å¯èƒ½è¿˜æ˜¯æ—§çš„,è™½ç„¶ CopyOnWriteArrayList èƒ½åšåˆ°æœ€ç»ˆä¸€è‡´æ€§,ä½†æ˜¯è¿˜æ˜¯æ²¡æ³•æ»¡è¶³å®æ—¶æ€§è¦æ±‚ï¼› CopyOnWriteArrayList é€éœ²çš„æ€æƒ³ è¯»å†™åˆ†ç¦»ï¼Œè¯»å’Œå†™åˆ†å¼€ æœ€ç»ˆä¸€è‡´æ€§ ä½¿ç”¨å¦å¤–å¼€è¾Ÿç©ºé—´çš„æ€è·¯ï¼Œæ¥è§£å†³å¹¶å‘å†²çª 38ã€ä»€ä¹ˆå«çº¿ç¨‹å®‰å…¨ï¼Ÿservlet æ˜¯çº¿ç¨‹å®‰å…¨å—? çº¿ç¨‹å®‰å…¨æ˜¯ç¼–ç¨‹ä¸­çš„æœ¯è¯­ï¼ŒæŒ‡æŸä¸ªå‡½æ•°ã€å‡½æ•°åº“åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«è°ƒç”¨æ—¶ï¼Œèƒ½ å¤Ÿæ­£ç¡®åœ°å¤„ç†å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡ï¼Œä½¿ç¨‹åºåŠŸèƒ½æ­£ç¡®å®Œæˆã€‚ Servlet ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œservlet æ˜¯å•å®ä¾‹å¤šçº¿ç¨‹çš„ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸èƒ½ä¿è¯å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨æ€§çš„ã€‚ Struts2 çš„ action æ˜¯å¤šå®ä¾‹å¤šçº¿ç¨‹çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªè¯·æ±‚è¿‡æ¥éƒ½ä¼š new ä¸€ä¸ªæ–°çš„ action åˆ†é…ç»™è¿™ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚å®Œæˆåé”€æ¯ã€‚ SpringMVC çš„ Controller æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸æ˜¯çš„ï¼Œå’Œ Servlet ç±»ä¼¼çš„å¤„ç†æµç¨‹ã€‚ Struts2 å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›Servlet å’Œ SpringMVC éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¯ä»¥æå‡ä¸ç”¨å¤„ç†å¤ªå¤šçš„ gcï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal æ¥å¤„ç†å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚ 39ã€volatile æœ‰ä»€ä¹ˆç”¨ï¼Ÿèƒ½å¦ç”¨ä¸€å¥è¯è¯´æ˜ä¸‹ volatile çš„åº”ç”¨åœºæ™¯ï¼Ÿ volatile ä¿è¯å†…å­˜å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚ volatile ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å•æ¬¡æ“ä½œ(å•æ¬¡è¯»æˆ–è€…å•æ¬¡å†™)ã€‚ 40ã€ä¸ºä»€ä¹ˆä»£ç ä¼šé‡æ’åºï¼Ÿ åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æä¾›æ€§èƒ½ï¼Œå¤„ç†å™¨å’Œç¼–è¯‘å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½† æ˜¯ä¸èƒ½éšæ„é‡æ’åºï¼Œä¸æ˜¯ä½ æƒ³æ€ä¹ˆæ’åºå°±æ€ä¹ˆæ’åºï¼Œå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼šåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœï¼›å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åºéœ€è¦æ³¨æ„çš„æ˜¯ï¼šé‡æ’åºä¸ä¼šå½±å“å•çº¿ç¨‹ç¯å¢ƒçš„æ‰§è¡Œç»“æœï¼Œä½†æ˜¯ä¼šç ´åå¤šçº¿ç¨‹çš„æ‰§è¡Œè¯­ä¹‰ã€‚ 41ã€åœ¨ java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒï¼Ÿ æœ€å¤§çš„ä¸åŒæ˜¯åœ¨ç­‰å¾…æ—¶ wait ä¼šé‡Šæ”¾é”ï¼Œè€Œ sleep ä¸€ç›´æŒæœ‰é”ã€‚Wait é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’ï¼Œsleep é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œã€‚ 42ã€ç”¨ Java å®ç°é˜»å¡é˜Ÿåˆ— 43ã€ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ—¶å‘ç”Ÿå¼‚å¸¸ä¼šæ€æ ·ï¼Ÿ å¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«æ•è·è¯¥çº¿ç¨‹å°†ä¼šåœæ­¢æ‰§è¡Œã€‚Thread.UncaughtExceptionHandler æ˜¯ç”¨äºå¤„ç†æœªæ•è·å¼‚å¸¸é€ æˆçº¿ç¨‹çªç„¶ä¸­æ–­æƒ…å†µçš„ä¸€ä¸ªå†…åµŒæ¥å£ã€‚å½“ä¸€ä¸ªæœªæ•è·å¼‚å¸¸å°†é€ æˆçº¿ç¨‹ä¸­æ–­çš„æ—¶å€™ JVM ä¼šä½¿ç”¨ Thread.getUncaughtExceptionHandler()æ¥æŸ¥è¯¢çº¿ç¨‹çš„ UncaughtExceptionHandler å¹¶å°†çº¿ç¨‹å’Œå¼‚å¸¸ä½œä¸ºå‚æ•°ä¼ é€’ç»™handler çš„ uncaughtException()æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ 44ã€å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Ÿ åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«å˜é‡å³å¯å®ç°å…±äº«ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå…±äº«å˜é‡è¦æ±‚å˜é‡æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç„¶ååœ¨çº¿ç¨‹å†…ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¯¹å…±äº«å˜é‡çš„å¤åˆæ“ä½œï¼Œé‚£ä¹ˆä¹Ÿå¾—ä¿è¯å¤åˆæ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚ 45ã€Java ä¸­ notify å’Œ notifyAll æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ notify() æ–¹æ³•ä¸èƒ½å”¤é†’æŸä¸ªå…·ä½“çš„çº¿ç¨‹ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…çš„æ—¶å€™å®ƒæ‰æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚è€Œ notifyAll()å”¤é†’æ‰€æœ‰çº¿ç¨‹å¹¶å…è®¸ä»–ä»¬äº‰å¤ºé”ç¡®ä¿äº†è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ç»§ç»­è¿è¡Œã€‚ 46ã€ä¸ºä»€ä¹ˆ wait, notify å’Œ notifyAll è¿™äº›æ–¹æ³•ä¸åœ¨ threadç±»é‡Œé¢ï¼Ÿ ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„åŸå› æ˜¯ JAVA æä¾›çš„é”æ˜¯å¯¹è±¡çº§çš„è€Œä¸æ˜¯çº¿ç¨‹çº§çš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰é”ï¼Œé€šè¿‡çº¿ç¨‹è·å¾—ã€‚ç”±äº waitï¼Œnotify å’Œ notifyAll éƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œæ‰€ä»¥æŠŠä»–ä»¬å®šä¹‰åœ¨ Object ç±»ä¸­å› ä¸ºé”å±äºå¯¹è±¡ã€‚ ","date":"2023-08-07","objectID":"/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9D%A2%E8%AF%95%E9%A2%98/:0:0","tags":["draft"],"title":"å¤šçº¿ç¨‹é¢è¯•é¢˜","uri":"/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"categories":["interview"],"content":"47ã€ä»€ä¹ˆæ˜¯ ThreadLocal å˜é‡ï¼Ÿ ThreadLocal æ˜¯ Java é‡Œä¸€ç§ç‰¹æ®Šçš„å˜é‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª ThreadLocal å°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªå˜é‡ï¼Œç«äº‰æ¡ä»¶è¢«å½»åº•æ¶ˆé™¤äº†ã€‚å®ƒæ˜¯ä¸ºåˆ›å»ºä»£ä»·é«˜æ˜‚çš„å¯¹è±¡è·å–çº¿ç¨‹å®‰å…¨çš„å¥½æ–¹æ³•ï¼Œæ¯”å¦‚ä½ å¯ä»¥ç”¨ ThreadLocal è®© SimpleDateFormat å˜æˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºé‚£ä¸ªç±»åˆ›å»ºä»£ä»·é«˜æ˜‚ä¸”æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦åˆ›å»ºä¸åŒçš„å®ä¾‹æ‰€ä»¥ä¸å€¼å¾—åœ¨å±€éƒ¨èŒƒå›´ä½¿ç”¨å®ƒï¼Œå¦‚æœä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªè‡ªå·±ç‹¬æœ‰çš„å˜é‡æ‹·è´ï¼Œå°†å¤§å¤§æé«˜æ•ˆç‡ã€‚é¦–å…ˆï¼Œé€šè¿‡å¤ç”¨å‡å°‘äº†ä»£ä»·é«˜æ˜‚çš„å¯¹è±¡çš„åˆ›å»ºä¸ªæ•°ã€‚å…¶æ¬¡ï¼Œä½ åœ¨æ²¡æœ‰ä½¿ç”¨é«˜ä»£ä»·çš„åŒæ­¥æˆ–è€…ä¸å˜æ€§çš„æƒ…å†µä¸‹è·å¾—äº†çº¿ç¨‹å®‰å…¨ã€‚ 48ã€Java ä¸­ interrupted å’Œ isInterrupted æ–¹æ³•çš„åŒºåˆ«ï¼Ÿ interrupt interrupt æ–¹æ³•ç”¨äºä¸­æ–­çº¿ç¨‹ã€‚è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹çš„çŠ¶æ€ä¸ºå°†è¢«ç½®ä¸ºâ€ä¸­æ–­â€ çŠ¶æ€ã€‚ æ³¨æ„ï¼šçº¿ç¨‹ä¸­æ–­ä»…ä»…æ˜¯ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œä¸ä¼šåœæ­¢çº¿ç¨‹ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±å»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€ä¸ºå¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­åä¼šæŠ›å‡º interruptedException çš„æ–¹æ³•ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚ interrupted æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸”æ¸…é™¤åŸçŠ¶æ€ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è¢«ä¸­æ–­äº†ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ interrupted åˆ™è¿”å› trueï¼Œç¬¬äºŒæ¬¡å’Œåé¢çš„å°±è¿”å› false äº†ã€‚ isInterrupted ä»…ä»…æ˜¯æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ 49ã€ä¸ºä»€ä¹ˆ wait å’Œ notify æ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ Java API å¼ºåˆ¶è¦æ±‚è¿™æ ·åšï¼Œå¦‚æœä½ ä¸è¿™ä¹ˆåšï¼Œä½ çš„ä»£ç ä¼šæŠ›å‡º IllegalMonitorStateException å¼‚å¸¸ã€‚è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†é¿å… wait å’Œ notifyä¹‹é—´äº§ç”Ÿç«æ€æ¡ä»¶ã€‚ 50ã€ä¸ºä»€ä¹ˆä½ åº”è¯¥åœ¨å¾ªç¯ä¸­æ£€æŸ¥ç­‰å¾…æ¡ä»¶? å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å¯èƒ½ä¼šæ”¶åˆ°é”™è¯¯è­¦æŠ¥å’Œä¼ªå”¤é†’ï¼Œå¦‚æœä¸åœ¨å¾ªç¯ä¸­æ£€æŸ¥ç­‰å¾…æ¡ä»¶ï¼Œç¨‹åºå°±ä¼šåœ¨æ²¡æœ‰æ»¡è¶³ç»“æŸæ¡ä»¶çš„æƒ…å†µä¸‹é€€å‡ºã€‚ 51ã€Java ä¸­çš„åŒæ­¥é›†åˆä¸å¹¶å‘é›†åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åŒæ­¥é›†åˆä¸å¹¶å‘é›†åˆéƒ½ä¸ºå¤šçº¿ç¨‹å’Œå¹¶å‘æä¾›äº†åˆé€‚çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œä¸è¿‡å¹¶å‘é›†åˆçš„å¯æ‰©å±•æ€§æ›´é«˜ã€‚åœ¨ Java1.5 ä¹‹å‰ç¨‹åºå‘˜ä»¬åªæœ‰åŒæ­¥é›†åˆæ¥ç”¨ä¸”åœ¨å¤šçº¿ ç¨‹å¹¶å‘çš„æ—¶å€™ä¼šå¯¼è‡´äº‰ç”¨ï¼Œé˜»ç¢äº†ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚Java5 ä»‹ç»äº†å¹¶å‘é›†åˆåƒ ConcurrentHashMapï¼Œä¸ä»…æä¾›çº¿ç¨‹å®‰å…¨è¿˜ç”¨é”åˆ†ç¦»å’Œå†…éƒ¨åˆ†åŒºç­‰ç°ä»£æŠ€æœ¯æé«˜äº†å¯æ‰©å±•æ€§ã€‚ 52ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ åˆ›å»ºçº¿ç¨‹è¦èŠ±è´¹æ˜‚è´µçš„èµ„æºå’Œæ—¶é—´ï¼Œå¦‚æœä»»åŠ¡æ¥äº†æ‰åˆ›å»ºçº¿ç¨‹é‚£ä¹ˆå“åº”æ—¶é—´ä¼šå˜é•¿ï¼Œè€Œä¸”ä¸€ä¸ªè¿›ç¨‹èƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°æœ‰é™ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œåœ¨ç¨‹åºå¯åŠ¨çš„ æ—¶å€™å°±åˆ›å»ºè‹¥å¹²çº¿ç¨‹æ¥å“åº”å¤„ç†ï¼Œå®ƒä»¬è¢«ç§°ä¸ºçº¿ç¨‹æ± ï¼Œé‡Œé¢çš„çº¿ç¨‹å«å·¥ä½œçº¿ ç¨‹ã€‚ä»JDK1.5 å¼€å§‹ï¼ŒJava API æä¾›äº† Executor æ¡†æ¶è®©ä½ å¯ä»¥åˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± ã€‚ 53ã€æ€ä¹ˆæ£€æµ‹ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦æ‹¥æœ‰é”ï¼Ÿ åœ¨ java.lang.Thread ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å« holdsLock()ï¼Œå®ƒè¿”å› true å¦‚æœå½“ä¸”ä»…å½“å½“å‰çº¿ç¨‹æ‹¥æœ‰æŸä¸ªå…·ä½“å¯¹è±¡çš„é”ã€‚ 54ã€ä½ å¦‚ä½•åœ¨ Java ä¸­è·å–çº¿ç¨‹å †æ ˆï¼Ÿ kill -3 [java pid] ä¸ä¼šåœ¨å½“å‰ç»ˆç«¯è¾“å‡ºï¼Œå®ƒä¼šè¾“å‡ºåˆ°ä»£ç æ‰§è¡Œçš„æˆ–æŒ‡å®šçš„åœ°æ–¹å»ã€‚æ¯”å¦‚ï¼Œkill -3 tomcat pid, è¾“å‡ºå †æ ˆåˆ° log ç›®å½•ä¸‹ã€‚ Jstack [java pid] è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œåœ¨å½“å‰ç»ˆç«¯æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥é‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚ -JvisualVMï¼šThread Dump ä¸åšè¯´æ˜ï¼Œæ‰“å¼€ JvisualVM åï¼Œéƒ½æ˜¯ç•Œé¢æ“ä½œï¼Œè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚ 55ã€JVM ä¸­å“ªä¸ªå‚æ•°æ˜¯ç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„æ ˆå †æ ˆå°çš„? -Xss æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å° 56ã€Thread ç±»ä¸­çš„ yield æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ä½¿å½“å‰çº¿ç¨‹ä»æ‰§è¡ŒçŠ¶æ€ï¼ˆè¿è¡ŒçŠ¶æ€ï¼‰å˜ä¸ºå¯æ‰§è¡Œæ€ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰ã€‚ å½“å‰çº¿ç¨‹åˆ°äº†å°±ç»ªçŠ¶æ€ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å“ªä¸ªçº¿ç¨‹ä¼šä»å°±ç»ªçŠ¶æ€å˜æˆæ‰§è¡ŒçŠ¶æ€å‘¢ï¼Ÿå¯èƒ½æ˜¯å½“å‰çº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–çº¿ç¨‹ï¼Œçœ‹ç³»ç»Ÿçš„åˆ†é…äº†ã€‚ 57ã€Java ä¸­ ConcurrentHashMap çš„å¹¶å‘åº¦æ˜¯ä»€ä¹ˆï¼Ÿ ConcurrentHashMap æŠŠå®é™… map åˆ’åˆ†æˆè‹¥å¹²éƒ¨åˆ†æ¥å®ç°å®ƒçš„å¯æ‰©å±•æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚è¿™ç§åˆ’åˆ†æ˜¯ä½¿ç”¨å¹¶å‘åº¦è·å¾—çš„ï¼Œå®ƒæ˜¯ ConcurrentHashMap ç±»æ„é€ å‡½æ•°çš„ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º 16ï¼Œè¿™æ ·åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å°±èƒ½é¿å…äº‰ç”¨ã€‚ åœ¨ JDK8 åï¼Œå®ƒæ‘’å¼ƒäº† Segmentï¼ˆé”æ®µï¼‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯å¯ç”¨äº†ä¸€ç§å…¨æ–°çš„æ–¹å¼å®ç°,åˆ©ç”¨ CAS ç®—æ³•ã€‚åŒæ—¶åŠ å…¥äº†æ›´å¤šçš„è¾…åŠ©å˜é‡æ¥æé«˜å¹¶å‘åº¦ï¼Œå…·ä½“å†…å®¹è¿˜æ˜¯æŸ¥çœ‹æºç å§ã€‚ 58ã€Java ä¸­ Semaphore æ˜¯ä»€ä¹ˆï¼Ÿ Java ä¸­çš„ Semaphore æ˜¯ä¸€ç§æ–°çš„åŒæ­¥ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œä»æ¦‚å¿µä¸Šè®²ï¼Œä¿¡å·é‡ç»´æŠ¤äº†ä¸€ä¸ªè®¸å¯é›†åˆã€‚å¦‚æœ‰å¿…è¦ï¼Œåœ¨è®¸å¯å¯ç”¨å‰ä¼šé˜»å¡æ¯ä¸€ä¸ªacquire()ï¼Œç„¶åå†è·å–è¯¥è®¸å¯ã€‚æ¯ä¸ª release()æ·»åŠ ä¸€ä¸ªè®¸å¯ï¼Œä»è€Œå¯èƒ½é‡Šæ”¾ä¸€ä¸ªæ­£åœ¨é˜»å¡çš„è·å–è€…ã€‚ä½†æ˜¯ï¼Œä¸ä½¿ç”¨å®é™…çš„è®¸å¯å¯¹è±¡ï¼ŒSemaphore åªå¯¹å¯ç”¨è®¸å¯çš„å·ç è¿›è¡Œè®¡æ•°ï¼Œå¹¶é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨ã€‚ä¿¡å·é‡å¸¸å¸¸ç”¨äºå¤šçº¿ç¨‹çš„ä»£ç ä¸­ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€‚ 59ã€Java çº¿ç¨‹æ± ä¸­ submit() å’Œ execute()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡ï¼Œexecute()æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ voidï¼Œå®ƒå®šä¹‰åœ¨Executor æ¥å£ä¸­ã€‚ è€Œ submit()æ–¹æ³•å¯ä»¥è¿”å›æŒæœ‰è®¡ç®—ç»“æœçš„ Future å¯¹è±¡ï¼Œå®ƒå®šä¹‰åœ¨ ExecutorService æ¥å£ä¸­ï¼Œå®ƒæ‰©å±•äº† Executor æ¥å£ï¼Œå…¶å®ƒçº¿ç¨‹æ± ç±»åƒ ThreadPoolExecutor å’Œ ScheduledThreadPoolExecutor éƒ½æœ‰è¿™äº›æ–¹æ³•ã€‚ 60ã€ä»€ä¹ˆæ˜¯é˜»å¡å¼æ–¹æ³•ï¼Ÿ é˜»å¡å¼æ–¹æ³•æ˜¯æŒ‡ç¨‹åºä¼šä¸€ç›´ç­‰å¾…è¯¥æ–¹æ³•å®ŒæˆæœŸé—´ä¸åšå…¶ä»–äº‹æƒ…ï¼ŒServerSocket çš„accept()æ–¹æ³•å°±æ˜¯ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚è¿™é‡Œçš„é˜»å¡æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å¼‚æ­¥å’Œéé˜»å¡å¼æ–¹æ³•åœ¨ä»»åŠ¡å®Œæˆå‰å°±è¿”å›ã€‚ 61ã€Java ä¸­çš„ ReadWriteLock æ˜¯ä»€ä¹ˆï¼Ÿ è¯»å†™é”æ˜¯ç”¨æ¥æå‡å¹¶å‘ç¨‹åºæ€§èƒ½çš„é”åˆ†ç¦»æŠ€æœ¯çš„æˆæœã€‚ 62ã€volatile å˜é‡å’Œ atomic å˜é‡æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ Volatile å˜é‡å¯ä»¥ç¡®ä¿å…ˆè¡Œå…³ç³»ï¼Œå³å†™æ“ä½œä¼šå‘ç”Ÿåœ¨åç»­çš„è¯»æ“ä½œä¹‹å‰, ä½†å®ƒå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚ä¾‹å¦‚ç”¨ volatile ä¿®é¥° count å˜é‡é‚£ä¹ˆ count++ æ“ä½œå°±ä¸æ˜¯åŸå­æ€§çš„ã€‚ è€Œ AtomicInteger ç±»æä¾›çš„ atomic æ–¹æ³•å¯ä»¥è®©è¿™ç§æ“ä½œå…·æœ‰åŸå­æ€§å¦‚ getAndIncrement()æ–¹æ³•ä¼šåŸå­æ€§çš„è¿›è¡Œå¢é‡æ“ä½œæŠŠå½“å‰å€¼åŠ ä¸€ï¼Œå…¶å®ƒæ•°æ®ç±»å‹å’Œå¼•ç”¨å˜é‡ä¹Ÿå¯ä»¥è¿›è¡Œç›¸ä¼¼æ“ä½œã€‚ 63ã€å¯ä»¥ç›´æ¥è°ƒç”¨ Thread ç±»çš„ run ()æ–¹æ³•ä¹ˆï¼Ÿ å½“ç„¶å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è°ƒç”¨äº† Thread çš„ run()æ–¹æ³•ï¼Œå®ƒçš„è¡Œä¸ºå°±ä¼šå’Œæ™®é€šçš„æ–¹æ³•ä¸€æ ·ï¼Œä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¸ºäº†åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨Thread.start()æ–¹æ³•ã€‚ 64ã€å¦‚ä½•è®©æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Thread ç±»çš„ Sleep()æ–¹æ³•è®©çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ã€‚éœ€è¦æ³¨æ„çš„ æ˜¯ï¼Œè¿™å¹¶ä¸ä¼šè®©çº¿ç¨‹ç»ˆæ­¢ï¼Œä¸€æ—¦ä»ä¼‘çœ ä¸­å”¤é†’çº¿ç¨‹ï¼Œçº¿ç¨‹çš„çŠ¶æ€å°†ä¼šè¢«æ”¹å˜ä¸º Runnableï¼Œå¹¶ä¸”æ ¹æ®çº¿ç¨‹è°ƒåº¦ï¼Œå®ƒå°†å¾—åˆ°æ‰§è¡Œã€‚ 65ã€ä½ å¯¹çº¿ç¨‹ä¼˜å…ˆçº§çš„ç†è§£æ˜¯ä»€ä¹ˆï¼Ÿ æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå…·æœ‰ä¼˜å…ˆæƒï¼Œä½†è¿™ä¾èµ–äºçº¿ç¨‹è°ƒåº¦çš„å®ç°ï¼Œè¿™ä¸ªå®ç°æ˜¯å’Œæ“ä½œç³»ç»Ÿç›¸å…³çš„(OS dependent)ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä½†æ˜¯è¿™å¹¶ä¸èƒ½ä¿è¯é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¼šåœ¨ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å‰æ‰§è¡Œã€‚çº¿ç¨‹ä¼˜å…ˆçº§æ˜¯ä¸€ä¸ª int å˜é‡(ä» 1-10)ï¼Œ1 ä»£è¡¨æœ€ä½ä¼˜å…ˆçº§ï¼Œ10 ä»£è¡¨æœ€é«˜ä¼˜å…ˆçº§ã€‚ java çš„çº¿ç¨‹ä¼˜å…ˆçº§è°ƒåº¦ä¼šå§”æ‰˜ç»™æ“ä½œç³»ç»Ÿå»å¤„ç†ï¼Œæ‰€ä»¥ä¸å…·ä½“çš„æ“ä½œç³»ç»Ÿä¼˜å…ˆçº§æœ‰å…³ï¼Œå¦‚éç‰¹åˆ«éœ€è¦ï¼Œä¸€èˆ¬æ— éœ€è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ã€‚ 66ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹è°ƒåº¦å™¨(Thread Scheduler)å’Œæ—¶é—´åˆ†ç‰‡(Time Slicing )ï¼Ÿ çº¿ç¨‹è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»ŸæœåŠ¡ï¼Œå®ƒè´Ÿè´£ä¸º Runnable çŠ¶æ€çš„çº¿ç¨‹åˆ†é… CPU æ—¶é—´ã€‚ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨å®ƒï¼Œå®ƒçš„æ‰§è¡Œä¾¿ä¾èµ–äºçº¿ç¨‹è°ƒåº¦å™¨çš„å®ç°ã€‚åŒä¸Šä¸€ä¸ªé—®é¢˜ï¼Œçº¿ç¨‹è°ƒåº¦å¹¶ä¸å—åˆ° Java è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæ‰€ä»¥ç”±åº”ç”¨ç¨‹åºæ¥æ§åˆ¶ å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸è¦è®©ä½ çš„ç¨‹åºä¾èµ–äºçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼‰ã€‚ æ—¶é—´åˆ†ç‰‡æ˜¯æŒ‡å°†å¯ç”¨çš„ CPU æ—¶é—´åˆ†é…ç»™å¯ç”¨çš„ Runnable çº¿ç¨‹çš„è¿‡ç¨‹ã€‚åˆ†é… CPUæ—¶é—´å¯ä»¥åŸºäºçº¿ç¨‹ä¼˜å…ˆçº§æˆ–è€…çº¿ç¨‹ç­‰å¾…çš„æ—¶é—´ã€‚ 67ã€ä½ å¦‚ä½•ç¡®ä¿ main()æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹æ˜¯ Java ç¨‹åºæœ€åç»“æŸçš„çº¿ç¨‹ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Thread ç±»çš„ join()æ–¹æ³•æ¥ç¡®ä¿æ‰€æœ‰ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹åœ¨ main() æ–¹æ³•é€€å‡ºå‰ç»“æŸã€‚ 68ã€çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ å½“çº¿ç¨‹é—´æ˜¯å¯ä»¥å…±äº«èµ„æºæ—¶ï¼Œçº¿ç¨‹é—´é€šä¿¡æ˜¯åè°ƒå®ƒä»¬çš„é‡è¦çš„æ‰‹æ®µã€‚Object ç±»ä¸­wait()\\notify()\\notifyAll()æ–¹æ³•å¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡å…³äºèµ„æºçš„é”çš„çŠ¶æ€ã€‚ 69ã€ä¸ºä»€ä¹ˆçº¿ç¨‹é€šä¿¡çš„æ–¹æ³• wait(), notify()å’Œ notifyAll()è¢«å®šä¹‰åœ¨ Object ç±»é‡Œï¼Ÿ Java çš„æ¯ä¸ªå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªé”(monitorï¼Œä¹Ÿå¯ä»¥æˆä¸ºç›‘è§†å™¨) å¹¶ä¸” wait()ï¼Œ notify()ç­‰æ–¹æ³•ç”¨äºç­‰å¾…å¯¹è±¡çš„é”æˆ–è€…é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨å¯ç”¨ã€‚åœ¨ Java çš„çº¿ç¨‹ä¸­å¹¶æ²¡æœ‰å¯ä¾›ä»»ä½•å¯¹è±¡ä½¿ç”¨çš„é”å’ŒåŒæ­¥å™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•æ˜¯ Object ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ · Java çš„æ¯ä¸€ä¸ªç±»éƒ½æœ‰ç”¨äºçº¿ç¨‹é—´é€šä¿¡çš„åŸºæœ¬æ–¹æ³•ã€‚ 70ã€ä¸ºä»€ä¹ˆ wait(), notify()å’Œ notifyAll ()å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ï¼Ÿ å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è°ƒç”¨å¯¹è±¡çš„ wait()æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªçº¿ç¨‹å¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„é”ï¼Œæ¥ç€å®ƒå°±ä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸Šçš„ notify()æ–¹æ³•ã€‚åŒæ ·çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è°ƒç”¨å¯¹è±¡çš„ notify()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œä»¥ä¾¿å…¶ä»–åœ¨ç­‰å¾…çš„çº¿ç¨‹å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªå¯¹è±¡é”ã€‚ç”±äºæ‰€æœ‰çš„è¿™äº›æ–¹æ³•éƒ½éœ€è¦çº¿ç¨‹æŒæœ‰å¯¹è±¡çš„é”ï¼Œè¿™æ ·å°±åªèƒ½é€šè¿‡åŒæ­¥æ¥å®ç°ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ã€‚ 71ã€ä¸ºä»€ä¹ˆ Thread ç±»çš„ sleep()å’Œ yield ()æ–¹æ³•æ˜¯é™æ€çš„ï¼Ÿ Thread ç±»çš„ sleep()å’Œ yield()æ–¹æ³•å°†åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¸Šè¿è¡Œã€‚æ‰€ä»¥åœ¨å…¶ä»–å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¸Šè°ƒç”¨è¿™äº›æ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•æ˜¯é™æ€çš„ã€‚å®ƒä»¬å¯ä»¥åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¸­å·¥ä½œï¼Œå¹¶é¿å…ç¨‹åºå‘˜é”™è¯¯çš„è®¤ä¸ºå¯ä»¥åœ¨å…¶ä»–éè¿è¡Œçº¿ç¨‹è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ 72ã€å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Ÿ åœ¨ Java ä¸­å¯ä»¥æœ‰å¾ˆå¤šæ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨â€”â€”åŒæ­¥ï¼Œä½¿ç”¨åŸå­ç±»(atomic concurrent classes)ï¼Œå®ç°å¹¶å‘é”ï¼Œä½¿ç”¨ volatile å…³é”®å­—ï¼Œä½¿ç”¨ä¸å˜ç±»å’Œçº¿ç¨‹å®‰å…¨ç±»ã€‚ 73ã€åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—ï¼Œå“ªä¸ªæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Ÿ åŒæ­¥å—æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä¸ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥è®©å®ƒé”ä½æ•´ä¸ªå¯¹è±¡ï¼‰ã€‚åŒæ­¥æ–¹æ³•ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œå“ªæ€•è¿™ä¸ªç±»ä¸­æœ‰å¤šä¸ªä¸ç›¸å…³è”çš„åŒæ­¥å—ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä»–ä»¬åœæ­¢æ‰§è¡Œå¹¶éœ€è¦ç­‰å¾…è·å¾—è¿™ä¸ªå¯¹è±¡ä¸Šçš„é”ã€‚ åŒæ­¥å—æ›´è¦ç¬¦åˆå¼€æ”¾è°ƒç”¨çš„åŸåˆ™ï¼Œåªåœ¨éœ€è¦é”ä½çš„ä»£ç å—é”ä½ç›¸åº”çš„å¯¹è±¡ï¼Œè¿™æ ·ä»ä¾§é¢æ¥è¯´ä¹Ÿå¯ä»¥é¿å…æ­»é”ã€‚ 74ã€å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ï¼Ÿ ä½¿ç”¨ Thread ç±»çš„ setDaemon(true)æ–¹æ³•å¯ä»¥å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œéœ€è¦æ³¨ æ„çš„æ˜¯ï¼Œéœ€è¦åœ¨è°ƒç”¨ start()æ–¹æ³•å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º IllegalThreadStateException å¼‚å¸¸ã€‚ 75ã€ä»€ä¹ˆæ˜¯ Java Timer ç±»ï¼Ÿå¦‚ä½•åˆ›å»ºä¸€ä¸ªæœ‰ç‰¹å®šæ—¶é—´é—´éš”çš„ä»»åŠ¡ï¼Ÿ java.util.Timer æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå¯ä»¥ç”¨äºå®‰æ’ä¸€ä¸ªçº¿ç¨‹åœ¨æœªæ¥çš„æŸä¸ªç‰¹å®šæ—¶é—´æ‰§è¡Œã€‚Timer ç±»å¯ä»¥ç”¨å®‰æ’ä¸€æ¬¡æ€§ä»»åŠ¡æˆ–è€…å‘¨æœŸä»»åŠ¡ã€‚ java.util.TimerTask æ˜¯ä¸€ä¸ªå®ç°äº† Runnable æ¥å£çš„æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬éœ€è¦å»ç»§æ‰¿è¿™ä¸ªç±»æ¥åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„å®šæ—¶ä»»åŠ¡å¹¶ä½¿ç”¨ Timer å»å®‰æ’å®ƒçš„æ‰§è¡Œã€‚ ä½œè€…ï¼šç¨‹åºå‘˜è¿½é£ é“¾æ¥ï¼šhttps://juejin.cn/post/6844904063687983111 æ¥æºï¼šæ˜é‡‘ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ ","date":"2023-08-07","objectID":"/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9D%A2%E8%AF%95%E9%A2%98/:0:1","tags":["draft"],"title":"å¤šçº¿ç¨‹é¢è¯•é¢˜","uri":"/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"categories":["å»ºç«™è®°å½•"],"content":"å‰å‰ååèŠ±äº†æ•´æ•´ä¸€å‘¨","date":"2023-08-06","objectID":"/blog_init/","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"é€‰å‹ Jekyllï¼šåŸºäº Rubyï¼Œéœ€è¦å‰ç«¯æŠ€èƒ½ Hexoï¼šåŸºäº Node.js ï¼Œä¸»é¢˜å¥½çœ‹ï¼Œæ¸²æŸ“æ…¢ Hugoï¼šåŸºäº Goï¼Œé€Ÿåº¦å¿«ï¼ˆä¸€ç§’æ¸²æŸ“ 5000 ç¯‡æ–‡ç« ï¼‰ â˜‘ï¸ JPressï¼šå•†ç”¨æ¯”è¾ƒå¤šï¼Œä»˜è´¹ WordPressï¼šåŸºäº PHPï¼Œç¤¾åŒºæ´»è·ƒï¼Œç•Œé¢è¿‡äºç®€çº¦ Nest.jsï¼šæŠ€æœ¯è¾ƒæ–°ï¼Œä½†ç”Ÿæ€ä¸å¤Ÿå®Œå–„ ","date":"2023-08-06","objectID":"/blog_init/:0:1","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"å®‰è£… # ä¸‹è½½ brew update brew install hugo # éªŒè¯ hugo version # åˆ›å»ºç½‘é¡µ hugo new site leni.fun # ä¸»é¢˜ cd leni.fun git init -b main git submodule add https://github.com/hugo-fixit/FixIt.git themes/FixIt # æ–°å»ºæ–‡ç« ï¼Œæ³¨æ„è¦æ”¾åœ¨ posts ç›®å½•ä¸‹ï¼ˆè¿™æ˜¯FixIté»˜è®¤çš„ï¼Œæˆ–é…ç½®å…¶ä»–ç›®å½•åç§°ï¼‰ hugo new posts/xxx.md # ä¿®æ”¹markdown æ–‡ä»¶çš„ draft=false å’Œå†…å®¹åï¼Œéƒ¨ç½²åˆ°æœ¬åœ° # --disableFastRender å³æ—¶æ¸²æŸ“ # -D è‰ç¨¿ï¼ˆdraft=trueï¼‰ä¹Ÿéƒ¨ç½² hugo server --disableFastRender ","date":"2023-08-06","objectID":"/blog_init/:0:2","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"å…³è” github page åˆ›å»º \u003cusername\u003e.github.io ä»“åº“ # cd åˆ°ç«™ç‚¹æ ¹ç›®å½•,ç”Ÿæˆ public æ–‡ä»¶å¤¹ alias hugogo='hugo -F --cleanDestinationDir' # ä»¥åæ¯æ¬¡å°±ç”¨å®ƒäº† hugogo git remote add gitee git@gitee.com:dujianghui/blog.git git remote add github git@github.com:hihihiman/blog.git # æ ¡éªŒ git remote -v # push git commit -am \"init\" git push -u gitee master git push -u github main ","date":"2023-08-06","objectID":"/blog_init/:0:3","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"å‚è€ƒé…ç½® baseURL: https://hihihiman.github.io languageCode: zh-CN title: éƒ½å°†ä¼šçš„åšå®¢ theme: FixIt author: name: éƒ½å°†ä¼š params: author: éƒ½å°†ä¼š subtitle: ä¸“æ³¨äº Javaã€MySQLã€å¾®æœåŠ¡ç­‰åç«¯æŠ€æœ¯ keywords: Java,MySQL,å¾®æœåŠ¡,éƒ½å°†ä¼š description: æ€ç»ªæ¥å»å¦‚é£ï¼Œä½†æ„¿æœ‰æ‰€åœç•™ã€‚ ","date":"2023-08-06","objectID":"/blog_init/:0:4","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"tips https://transform.tools/toml-to-yaml å¯ä»¥å°† tomb æ–‡ä»¶è½¬æ¢ä¸º yml æ–‡ä»¶ï¼Œæ–¹ä¾¿é˜…è¯»å’Œä¿®æ”¹ã€‚ å‘æ–‡ç« ï¼šhugo new posts/xxx.md + ç¼–è¾‘ æœ¬åœ°æµ‹è¯•ï¼š hugogo +hugo serve -Dï¼ŒæŸ¥çœ‹ localhost:1313 éƒ¨ç½²åˆ°Pageï¼šcd public + git commit -am \"message\"+git push gitee é»˜è®¤ä¸»åˆ†æ”¯æ˜¯ masterï¼Œè€Œ github é»˜è®¤ä¸»åˆ†æ”¯æ˜¯ mainï¼Œéœ€è¦æ³¨æ„ ","date":"2023-08-06","objectID":"/blog_init/:0:5","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":["å»ºç«™è®°å½•"],"content":"è¿›é˜¶æŒ‡å— https://www.wingoftime.cn/p/setup-blog-second/ å¸®åŠ©ä½ å®ç°ä¸Šä¼ åˆ†æ”¯æºç åè‡ªåŠ¨éƒ¨ç½²åˆ° Github Page ï¼ ","date":"2023-08-06","objectID":"/blog_init/:0:6","tags":["hugo"],"title":"åˆå§‹åŒ– Hogo åšå®¢","uri":"/blog_init/"},{"categories":null,"content":"ç¦»çº¿ - ","date":"0001-01-01","objectID":"/offline/","tags":null,"title":"","uri":"/offline/"}]