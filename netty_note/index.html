<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Netty 杂记 -</title><meta name=author content="都将会"><meta name=author-link content><meta name=description content="草稿太多，有空再整理吧。。"><meta name=keywords content="Netty,笔记"><meta itemprop=name content="Netty 杂记"><meta itemprop=description content="草稿太多，有空再整理吧。。"><meta itemprop=datePublished content="2022-08-18T08:08:08+08:00"><meta itemprop=dateModified content="2022-08-18T08:08:08+08:00"><meta itemprop=wordCount content="2512"><meta itemprop=image content="https://leni.fun/images/avatar.jpg"><meta itemprop=keywords content="Network,"><meta property="og:title" content="Netty 杂记"><meta property="og:description" content="草稿太多，有空再整理吧。。"><meta property="og:type" content="article"><meta property="og:url" content="https://leni.fun/netty_note/"><meta property="og:image" content="https://leni.fun/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-18T08:08:08+08:00"><meta property="article:modified_time" content="2022-08-18T08:08:08+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leni.fun/images/avatar.jpg"><meta name=twitter:title content="Netty 杂记"><meta name=twitter:description content="草稿太多，有空再整理吧。。"><meta name=application-name content="都将会的 APP"><meta name=apple-mobile-web-app-title content="都将会的 APP"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leni.fun/netty_note/><link rel=prev href=https://leni.fun/rpc_draft/><link rel=next href=https://leni.fun/distributed-transaction/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Netty 杂记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leni.fun\/netty_note\/"},"genre":"posts","keywords":"Network","wordcount":2512,"url":"https:\/\/leni.fun\/netty_note\/","datePublished":"2022-08-18T08:08:08+08:00","dateModified":"2022-08-18T08:08:08+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"都将会"},"description":"草稿太多，有空再整理吧。。"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=关键词搜索 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title><img loading=lazy src=/images/icon.png srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" sizes=auto data-title=/images/icon.png data-alt=/images/icon.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=关键词搜索 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 技术</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class=menu-item><a class=menu-link href=/life/><i class="fa-solid fa-camera-alt fa-fw fa-sm" aria-hidden=true></i> 生活</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title>主页</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>Netty 杂记</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Netty 杂记</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=都将会 data-alt=都将会 class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;都将会</span></span>
<span class=post-category>收录于 <a href=/categories/draft/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> draft</a></span></div><div class=post-meta-line><span title="发布于 2022-08-18 08:08:08"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2022-08-18>2022-08-18</time></span>&nbsp;<span title="更新于 2022-08-18 08:08:08"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2022-08-18>2022-08-18</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2512 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 6 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Netty 杂记">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#五种-io-模型>五种 IO 模型</a></li><li><a href=#什么是-netty>什么是 Netty？</a><ul><li><a href=#常规-io>常规 IO</a></li><li><a href=#nio少了一次缓冲区的复制>NIO：少了一次缓冲区的复制</a></li></ul></li><li><a href=#与-jdk-原生-nio-相比netty-的优势在哪里>与 JDK 原生 NIO 相比，Netty 的优势在哪里？</a></li><li><a href=#什么是-channel-和-channelpipeline>什么是 Channel 和 ChannelPipeline？</a></li><li><a href=#什么是-eventloop-和线程模型>什么是 EventLoop 和线程模型？</a><ul><li><a href=#eventloop>EventLoop</a></li><li><a href=#核心概念>核心概念</a></li></ul></li><li><a href=#什么是-bytebuf>什么是 ByteBuf？</a><ul><li><a href=#bytebuffer-的种类>ByteBuffer 的种类？</a></li></ul></li><li><a href=#四种事件类型>四种事件类型</a></li><li><a href=#如何处理粘包与拆包>如何处理粘包与拆包？</a></li><li><a href=#api-网关>API 网关</a></li><li><a href=#面试考点>面试考点❓</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=五种-io-模型>五种 IO 模型</h3><p>通信模式：同步、异步</p><p>线程处理模式：阻塞、非阻塞</p><p>五种 IO 模型</p><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173074860-40037a85-e5ec-414c-a92d-9dc368b52fc5.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><ul><li>BIO（阻塞式）：在while(true)中调用accept()方法等待客户端。一个线程只能同时处理一个连接请求</li><li>非阻塞式IO：内核会立即返回，已获得足够的CPU事件继续做其他事情，用户进程的第一阶段不阻塞，需要不断主动询问kernel数据是否准备好，第二阶段仍然阻塞。</li><li>多路复用IO/事件驱动IO：在单线程里同事监控多个套接字，通过select或poll轮询所负责的socket，当某个socket有数据到达了就通知用户进程。进程首先阻塞在select/poll上，再阻塞在读操作的第二阶段上。</li><li>信号驱动IO：在IO执行的数据准备阶段，不会阻塞用户进程，当用户进程收到信号后，才去查收数据。</li><li>异步IO：用户进程发出系统调用后立即返回，内核等待数据准备完成后，将数据拷贝到用户进程缓冲区，然后告诉用户进程IO操作执行完毕。</li></ul><h3 id=什么是-netty>什么是 Netty？</h3><p>Netty 是一个高性能的网络通信框架，基于 NIO 技术实现，广泛应用于互联网服务开发中，包括 Web 服务器、RPC、消息中间件等领域。</p><h4 id=常规-io>常规 IO</h4><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675328453-b3adb02c-c8a0-4636-bfa3-1867f1cd23df.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h4 id=nio少了一次缓冲区的复制>NIO：少了一次缓冲区的复制</h4><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1687675382142-5ae5aef3-0f8c-4fb8-9816-b7762bb2d6a6.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h3 id=与-jdk-原生-nio-相比netty-的优势在哪里>与 JDK 原生 NIO 相比，Netty 的优势在哪里？</h3><p>Netty 相比于 JDK 原生 NIO 具有以下优势：</p><ul><li>更好的性能：Netty 在 NIO 的基础上进行了优化，可以更好地利用系统资源，提高 I/O 处理的效率和吞吐量。</li><li>更易用的接口：Netty 提供了一套更加易用的 API 接口，简化了 NIO 的复杂性，使得开发者可以更加方便地使用。</li><li>更多的功能扩展：Netty 提供了丰富的扩展功能，如编解码器、心跳检测、SSL/TLS 加密等，可以帮助开发者更加快速地构建高效、安全的网络应用程序。</li></ul><h3 id=什么是-channel-和-channelpipeline>什么是 Channel 和 ChannelPipeline？</h3><p>在 Netty 中，Channel 是网络通信的基础，表示一个<strong>可靠的网络连接</strong>。<strong>ChannelPipeline 是一系列 ChannelHandler 的链表，用于处理 Channel 上的事件和数据，类似于 Servlet 中的 Filter</strong>。</p><h3 id=什么是-eventloop-和线程模型>什么是 EventLoop 和线程模型？</h3><p>EventLoop 是 Netty 中的一个重要组件，用于处理 Channel 上的事件和任务。每个 Channel 都会绑定一个 EventLoop**，一个 EventLoop 可以处理多个 Channel 上的事件和任务**。Netty 采用了多种线程模型，如单线程模型、多线程模型、主从线程模型等，根据实际需求选择不同的线程模型可以更好地提高程序的性能和并发性。</p><h4 id=eventloop>EventLoop</h4><p>EventLoop定义了Netty的核心抽象，用于处理连接的生命周期中所发生的事件，负责监听网络事件并调用事件处理器进行相关I/O操作。</p><p>Channel 是 Netty 网络操作抽象类，EventLoop负责处理注册到其上的Channel 的 I/O操作。</p><p>EventloopGrup包含多个EventLoop（EventLoop：Thread = 1 : 1），它管理着所有的EventLoop的生命周期。</p><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1681442215715-c1d3e97b-025f-4b87-8ac8-008146bc820a.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><p>NioEventLoopGroup 默认的构造函数实际会起的线程数为 <strong>CPU核心数*2</strong></p><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076242-b20dd2d9-c6b0-4bf6-a99d-e14b86e4d8a3.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h4 id=核心概念>核心概念</h4><ul><li>ServerBootstrap，<strong>服务器端程序的入口</strong>，这是 Netty 为简化网络程序配置和关闭等生命周期管理，所引入的 Bootstrapping 机制。我们通常要做的创建 Channel、绑定端口、注册 Handler 等，都可以通过这个统一的入口，以 Fluent API 等形式完成，相对简化了 API 使用。与之相对应， <strong>Bootstrap则是 Client 端的通常入口。</strong></li><li>Channel：可以理解为读操作或写操作，因此可以被打开或被关闭 。作为一个基于 NIO 的扩展框架，Channel 和 Selector 等概念仍然是 Netty 的基础组件，但是针对应用开发具体需求，提供了相对易用的抽象。</li><li>EventLoop：只由一个线程驱动，处理一个 Channel中 的所有 I/O 事件。这是 Netty <strong>处理事件的核心机制</strong>。例子中使用了 EventLoopGroup。我们在 NIO 中通常要做的几件事情，如<strong>注册感兴趣的事件、调度相应的 Handler</strong> 等，都是 EventLoop 负责。</li><li>ChannelFuture，这是 Netty 实现<strong>异步 IO</strong> 的基础之一，保证了同一个 Channel 操作的调用顺序。Netty 扩展了 Java 标准的 Future，提供了针对自己场景的特有Future定义。</li><li>ChannelHandler，这是应用开发者放置<strong>业务逻辑</strong>的主要地方，也是我上面提到的“Separation Of Concerns”原则的体现。每个事件都可以被分发给 ChannelHandler 类中的某个用户实现的方法，实现业务逻辑与网络处理代码分离。</li><li>ChannelPipeline：它是 ChannelHandler 链条的容器，每个 Channel 在创建后，自动被分配一个 ChannelPipeline。</li></ul><h3 id=什么是-bytebuf>什么是 ByteBuf？</h3><p>ByteBuf 是 Netty 中的一个重要组件，用于处理数据的缓冲区。与 JDK 中的 ByteBuffer 相比，ByteBuf 具有更好的可扩展性、更高的性能和更丰富的功能。<strong>ByteBuf 支持读写索引分离，内存池化和引用计数等功能</strong>，可以更好地管理内存和提高程序的性能。</p><h4 id=bytebuffer-的种类>ByteBuffer 的种类？</h4><ul><li>java.nio.HeapByteBuffer：java 堆内存，读写效率较低，受到 GC 的影响</li><li>java.nio.DirectByteBuffer：直接内存，读写效率高（少一次拷贝），不受 GC 影响，分配效率低</li></ul><h3 id=四种事件类型>四种事件类型</h3><ul><li>accept：在有连接请求时触发</li><li>connect：客户端，连接建立后触发</li><li>read：可读事件</li><li>write：可写事件</li></ul><p>在 select 后，事件要么处理 accept，要么取消 cancel（catch 异常之后），</p><h3 id=如何处理粘包与拆包>如何处理粘包与拆包？</h3><p>ByteToMessageDecoder 提供了一些常见的实现类：</p><ol><li>FixedLengthFrameDecoder：定长协议解码器，指定固定的字节数</li><li>LineBasedFrameDecoder：行分隔符解码器，识别 \n或\r\n</li><li>DelimiterBasedFrameDecoder：分隔符解码器</li><li>LengthFieldBasedFrameDecoder：长度编码解码器，将报文划分为header和body</li><li>JsonObjectDecoder：监测到匹配的{}或[]就认为是完整的json对象或json数组</li></ol><p><a class=lightgallery href=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png data-thumbnail=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png data-sub-html="<h2>img</h2>"><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/1678173076875-42b3aa1d-a978-46e3-be90-3c0dadc47a5e.png 2x" sizes=auto data-title=img data-alt=img style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a></p><h3 id=api-网关>API 网关</h3><p>API 网关的四大职能：</p><ol><li>请求接入：作为所有API接口服务请求的接入点</li><li>业务聚合：作为所有后端业务服务的聚合点</li><li>中介策略：实现安全、验证、路由、过滤、流控等策略</li><li>统一管理：对所有API服务和策略进行统一管理</li></ol><h3 id=面试考点>面试考点❓</h3><ul><li>Reactor 模式和 Netty 线程模型。</li><li>Pipelining、EventLoop 等部分的设计实现细节。</li><li>Netty 的内存管理机制、引用计数等特别手段。</li><li>有的时候面试官也喜欢对比 Java 标准 NIO API，例如，你是否知道 Java NIO 早期版本中的 Epoll空转问题，以及 Netty 的解决方式等。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2022-08-18 08:08:08">更新于 2022-08-18&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://leni.fun/netty_note/ data-title="Netty 杂记"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/network/ class=post-tag>Network</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/rpc_draft/ class=post-nav-item rel=prev title="RPC 杂记"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>RPC 杂记</a>
<a href=/distributed-transaction/ class=post-nav-item rel=next title="Distributed Transaction - 分布式事务">Distributed Transaction - 分布式事务<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=hihihiman/hihihiman.github.io data-repo-id=R_kgDOKD90KA data-category=Announcements data-category-id=DIC_kwDOKD90KM4CYcdO data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright order-5" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>都将会</a></span><span class="license footer-divider">后端开发工程师</span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor order-4"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/hihihiman/hihihiman.github.io title=博客源码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;bottom:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/pink/pace-theme-center-atom.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:1024},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":"的博客","typeit-header-subtitle-mobile":"的博客"},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!0,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,useExtendedSearch:!0},siteTime:"2021-08-26T23:31:00+08:00",typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,loop:!0,speed:100}}</script><script src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>