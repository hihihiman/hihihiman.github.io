<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>《Java8实战》笔记 -</title><meta name=author content="都将会"><meta name=author-link content><meta name=description content="一、基础知识
1. 函数式编程

函数式编程中的函数的主要意思是“把函数作为一等值”，不过它也常常隐含着第二层意思，即“执行时在元素之间无互动”。
引用透明性——“没有可感知的副作用”

不改变对调用者可见的变量。返回的结果基于参数却没有修改任何一个传入的参数
不进行I/O
不抛出异常
选择使用引用透明的函数


也允许函数内部执行一些非函数式的操作，只要这些操作的结果不会暴露给系统中的其他部分。作为函数式的程序，你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为，否则就不能调用这些方法。
被称为“函数式”的函数或方法都只能修改本地变量。除此之外，它引用的对象都应该是不可修改的对象。
要被称为函数式，函数或者方法不应该抛出任何异常。旦抛出异常，就意味着结果被终止了；不再像我们之前讨论的黑盒模式那样，由return返回一个恰当的结果值。 —— 请使用Optional类型
Optional类：它是一个容器对象，可以包含，也可以不包含一个值。Optional中有方法来明确处理值不存在的情况，这样就可以避免NullPointer异常了。
"><meta name=keywords content="Java,笔记"><meta itemprop=name content="《Java8实战》笔记"><meta itemprop=description content="一、基础知识
1. 函数式编程

函数式编程中的函数的主要意思是“把函数作为一等值”，不过它也常常隐含着第二层意思，即“执行时在元素之间无互动”。
引用透明性——“没有可感知的副作用”

不改变对调用者可见的变量。返回的结果基于参数却没有修改任何一个传入的参数
不进行I/O
不抛出异常
选择使用引用透明的函数


也允许函数内部执行一些非函数式的操作，只要这些操作的结果不会暴露给系统中的其他部分。作为函数式的程序，你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为，否则就不能调用这些方法。
被称为“函数式”的函数或方法都只能修改本地变量。除此之外，它引用的对象都应该是不可修改的对象。
要被称为函数式，函数或者方法不应该抛出任何异常。旦抛出异常，就意味着结果被终止了；不再像我们之前讨论的黑盒模式那样，由return返回一个恰当的结果值。 —— 请使用Optional类型
Optional类：它是一个容器对象，可以包含，也可以不包含一个值。Optional中有方法来明确处理值不存在的情况，这样就可以避免NullPointer异常了。
"><meta itemprop=datePublished content="2023-08-08T15:20:42+08:00"><meta itemprop=dateModified content="2023-08-08T15:20:42+08:00"><meta itemprop=wordCount content="8244"><meta itemprop=image content="https://leni.fun/images/avatar.jpg"><meta itemprop=keywords content="Java,"><meta property="og:title" content="《Java8实战》笔记"><meta property="og:description" content="一、基础知识
1. 函数式编程

函数式编程中的函数的主要意思是“把函数作为一等值”，不过它也常常隐含着第二层意思，即“执行时在元素之间无互动”。
引用透明性——“没有可感知的副作用”

不改变对调用者可见的变量。返回的结果基于参数却没有修改任何一个传入的参数
不进行I/O
不抛出异常
选择使用引用透明的函数


也允许函数内部执行一些非函数式的操作，只要这些操作的结果不会暴露给系统中的其他部分。作为函数式的程序，你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为，否则就不能调用这些方法。
被称为“函数式”的函数或方法都只能修改本地变量。除此之外，它引用的对象都应该是不可修改的对象。
要被称为函数式，函数或者方法不应该抛出任何异常。旦抛出异常，就意味着结果被终止了；不再像我们之前讨论的黑盒模式那样，由return返回一个恰当的结果值。 —— 请使用Optional类型
Optional类：它是一个容器对象，可以包含，也可以不包含一个值。Optional中有方法来明确处理值不存在的情况，这样就可以避免NullPointer异常了。
"><meta property="og:type" content="article"><meta property="og:url" content="https://leni.fun/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/"><meta property="og:image" content="https://leni.fun/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-08T15:20:42+08:00"><meta property="article:modified_time" content="2023-08-08T15:20:42+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leni.fun/images/avatar.jpg"><meta name=twitter:title content="《Java8实战》笔记"><meta name=twitter:description content="一、基础知识
1. 函数式编程

函数式编程中的函数的主要意思是“把函数作为一等值”，不过它也常常隐含着第二层意思，即“执行时在元素之间无互动”。
引用透明性——“没有可感知的副作用”

不改变对调用者可见的变量。返回的结果基于参数却没有修改任何一个传入的参数
不进行I/O
不抛出异常
选择使用引用透明的函数


也允许函数内部执行一些非函数式的操作，只要这些操作的结果不会暴露给系统中的其他部分。作为函数式的程序，你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为，否则就不能调用这些方法。
被称为“函数式”的函数或方法都只能修改本地变量。除此之外，它引用的对象都应该是不可修改的对象。
要被称为函数式，函数或者方法不应该抛出任何异常。旦抛出异常，就意味着结果被终止了；不再像我们之前讨论的黑盒模式那样，由return返回一个恰当的结果值。 —— 请使用Optional类型
Optional类：它是一个容器对象，可以包含，也可以不包含一个值。Optional中有方法来明确处理值不存在的情况，这样就可以避免NullPointer异常了。
"><meta name=application-name content="都将会的 APP"><meta name=apple-mobile-web-app-title content="都将会的 APP"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leni.fun/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/><link rel=prev href=https://leni.fun/java_base/><link rel=next href=https://leni.fun/java_draft/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"《Java8实战》笔记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leni.fun\/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0\/"},"genre":"posts","keywords":"Java","wordcount":8244,"url":"https:\/\/leni.fun\/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0\/","datePublished":"2023-08-08T15:20:42+08:00","dateModified":"2023-08-08T15:20:42+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"都将会"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=/images/avatar.jpg data-alt=/images/avatar.jpg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=输入关键词搜索 id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=/images/avatar.jpg data-alt=/images/avatar.jpg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>都将会</span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=输入关键词搜索 id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title>主页</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>《Java8实战》笔记</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span title=转载 class=icon-repost><i class="fa-solid fa-share fa-fw" aria-hidden=true></i></span><span>《Java8实战》笔记</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.jpg srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" sizes=auto data-title=都将会 data-alt=都将会 class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;都将会</span></span>
<span class=post-category>收录于 <a href=/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 读书笔记</a></span></div><div class=post-meta-line><span title="发布于 2023-08-08 15:20:42"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-08-08>2023-08-08</time></span>&nbsp;<span title="更新于 2023-08-08 15:20:42"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-08-08>2023-08-08</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 8244 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 17 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#一基础知识>一、基础知识</a><ul><li><a href=#1-函数式编程>1. 函数式编程</a></li><li><a href=#2-lambda表达式行为参数化灵活简洁>★2. lambda表达式：行为参数化（灵活、简洁）</a></li></ul></li><li><a href=#二函数式数据处理>二、函数式数据处理</a><ul><li><a href=#1-流>★1. 流</a><ul><li><a href=#1-1-原始类型流特化>1-1. 原始类型流特化</a></li><li><a href=#1-2-映射到数据流>1-2. 映射到数据流</a></li><li><a href=#1-3-无限流斐波那契数列>1-3. 无限流(斐波那契数列)</a></li><li><a href=#1-4-reduce>1-4. reduce</a></li><li><a href=#1-5-收集器>1-5. 收集器</a><ul><li><a href=#collector接口>Collector接口</a></li><li><a href=#自己实现收集器>自己实现收集器</a></li></ul></li></ul></li><li><a href=#2-用-optional-取代-null>★2. 用 Optional 取代 null</a><ul><li><a href=#2-1-optional-的方法>2-1. Optional 的方法</a></li><li><a href=#2-2-实战案例>2-2. 实战案例</a></li></ul></li><li><a href=#3-内部迭代>3. 内部迭代</a></li></ul></li><li><a href=#三高效-java-8-编程>三、高效 Java 8 编程</a><ul><li><a href=#1-各版本变化>1. 各版本变化</a></li><li><a href=#2-设计模式>🌟2. 设计模式</a><ul><li><a href=#2-1-策略模式>2-1. 策略模式</a></li><li><a href=#2-2-模板方法>2-2. 模板方法</a></li><li><a href=#2-3-观察者模式>2-3. 观察者模式</a></li><li><a href=#2-4-责任链模式>2-4. 责任链模式</a></li><li><a href=#2-5-工厂模式>2-5. 工厂模式</a></li></ul></li><li><a href=#3-peek查看中间值>3. peek查看中间值</a></li><li><a href=#4-接口的默认方法>★4. 接口的默认方法</a><ul><li><a href=#4-1-继承和实现冲突的问题>4-1. 继承和实现冲突的问题</a></li><li><a href=#4-2-三条规则>4-2. 三条规则</a></li></ul></li><li><a href=#5-组合式异步编程>5. 组合式异步编程</a><ul><li><a href=#5-1-并发与并行>5-1. 并发与并行</a></li><li><a href=#5-2-future---completablefuture>★5-2. Future ->  CompletableFuture</a><ul><li><a href=#实例>实例</a></li></ul></li><li><a href=#5-3-使用定制的执行器>5-3. 使用定制的执行器</a><ul><li><a href=#守护进程>守护进程</a></li></ul></li><li><a href=#5-4-completablefuture-与-parallelstream-的选择>5-4. CompletableFuture 与 parallelStream 的选择</a></li><li><a href=#5-5-join-与-get-方法构造同步和异步操作>5-5. join 与 get 方法，构造同步和异步操作</a><ul><li><a href=#futurethencompose>future.thenCompose</a></li><li><a href=#futurethencombine>future.thenCombine</a></li></ul></li></ul></li><li><a href=#6-新的日期和时间api>6. 新的日期和时间API</a><ul><li><a href=#6-1-localdate--localtime-和-localdatetime>6-1. LocalDate 、 LocalTime 和 LocalDateTime</a></li><li><a href=#6-2-定义-duration-或-period>6-2. 定义 Duration 或 Period</a></li><li><a href=#6-3-操纵日期>6-3. 操纵日期</a></li><li><a href=#6-4-设计一个nextworkingday类>6-4. 设计一个NextWorkingDay类</a></li><li><a href=#6-5-日期和-string-转换>6-5. 日期和 String 转换</a></li></ul></li></ul></li><li><a href=#四超越-java-8>四、超越 Java 8</a><ul><li><a href=#1-基于尾-递的阶乘>1. 基于“尾-递”的阶乘</a></li><li><a href=#2-科里化curry>2. 科里化（curry）</a></li><li><a href=#3-scala>3. Scala</a></li><li><a href=#4-闭包>4. 闭包</a></li><li><a href=#5-trait>5. trait</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=一基础知识>一、基础知识</h2><h3 id=1-函数式编程>1. 函数式编程</h3><ul><li><strong>函数式编程</strong>中的<strong>函数</strong>的主要意思是“把函数作为一等值”，不过它也常常隐含着第二层意思，即“执行时在元素之间无互动”。</li><li>引用透明性——“没有可感知的副作用”<ul><li>不改变对调用者可见的变量。返回的结果基于参数却没有修改任何一个传入的参数</li><li>不进行I/O</li><li>不抛出异常</li><li>选择使用引用透明的函数</li></ul></li><li>也允许函数内部执行一些非函数式的操作，只要这些操作的结果不会暴露给系统中的其他部分。作为函数式的程序，你的函数或方法调用的库函数如果有副作用，你必须设法隐藏它们的非函数式行为，否则就不能调用这些方法。</li><li>被称为“函数式”的函数或方法都只能修改本地变量。除此之外，它引用的对象都应该是不可修改的对象。</li><li>要被称为函数式，函数或者方法不应该抛出任何异常。旦抛出异常，就意味着结果被终止了；不再像我们之前讨论的黑盒模式那样，由return返回一个恰当的结果值。 —— 请使用Optional类型</li><li>Optional类：它是一个容器对象，可以包含，也可以不包含一个值。Optional中有方法来明确处理值不存在的情况，这样就可以避免NullPointer异常了。</li></ul><h3 id=2-lambda表达式行为参数化灵活简洁>★2. lambda表达式：行为参数化（灵活、简洁）</h3><ul><li>函数式接口（用@FunctionalInterface标记）与匿名内部类：</li></ul><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-45-13:44:34-image-20210521134432682.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ul><li><p>函数式接口（加前缀：Int、Double、Long）</p><ul><li>Predicate： T -> boolean （谓词）</li><li>Consumer： T -> void</li><li>Function： T,R -> R</li><li>Supplier：() -> R</li></ul></li><li><p>范型T只能绑定到引用类型</p></li><li><p>闭包：闭包就是一个函数的实例，且它可以无限制地访问那个函数的非本地变量。现在，Java 8的Lambda和匿名类可以做类似于闭包的事情：它们可以作为参数传递给方法，并且可以访问其作用域之外的变量。但有一个限制：它们不能修改定义Lambda的方法的局部变量的内容。这些变量必须是隐式最终的。可以认为Lambda是对值封闭，而不是对变量封闭。</p></li><li><p>方法引用：根据已有的方法实现来创建Lambda表达式</p><ul><li>指向静态方法</li><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-51-09:37:35-image-20210524093733916.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li><li>指向任意类型实例方法</li><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/13-58-56-09:37:51-image-20210524093749969.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li><li>指向现有对象的实例方法</li><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09:38:45-image-20210524093843966.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li></ul></li><li><p>构造函数引用：ClassName :: new</p></li><li><p>比较器链：</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10:49:24-image-20210524104923719.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p></li></ul><h2 id=二函数式数据处理>二、函数式数据处理</h2><h3 id=1-流>★1. 流</h3><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:01:48-image-20210524110147149.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ul><li>中间操作：返回stream类型<ul><li>filter：排除元素，Predicate，T -> boolean</li><li>map：提取信息，Function&lt;T,R>, T -> R</li><li>limit：截断流（有状态-有界）</li><li>skip：与limit互补（有状态-有界）</li><li>sorted：排序，Comparator, (T,T) -> int（有状态-无界）</li><li>distinct：去重（有状态-无界）</li><li>flatMap：让你把一个流中的每个值都换成另一个流，然后把所有的流连接起来成为一个流</li></ul></li><li>终端操作：返回非stream类型<ul><li>collect：转换成其他格式（返回集合）</li><li>count：计数（返回long）</li><li>forEach：遍历（返回void）</li><li>（以下都是短路求值）</li><li>anyMatch：至少匹配一个（返回boolean）</li><li>allMatch：都匹配（返回boolean）</li><li>noneMatch：都不匹配（返回boolean）</li><li>findAny：找到任意（返回Optional类）</li><li>findFirst：找到第一个，在并行上限制更多，如果不关心返回的元素是哪个，请使用findAny。（返回Optional类）</li><li>reduce： BinaryOperator ，(T, T) -> T （返回Optional类）（有状态-有界）</li></ul></li><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:47:32-image-20210525164731012.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li><li>流只能消费一次。</li></ul><h4 id=1-1-原始类型流特化>1-1. 原始类型流特化</h4><p>Java 8引入了三个原始类型特化流接口来解决这个问题：IntStream、DoubleStream和LongStream，分别将流中的元素特化为int、long和double，从而避免了暗含的装箱成本。要记住的是，这些特化的原因并不在于流的复杂性，而是装箱造成的复杂性——即类似int和Integer之间的效率差异。</p><h4 id=1-2-映射到数据流>1-2. 映射到数据流</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:21:44-image-20210525172143612.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><ul><li>转换回对象流</li></ul><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//将Stream转换为数值流
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>IntStream</span> <span class=n>intStream</span> <span class=o>=</span> <span class=n>menu</span><span class=o>.</span><span class=na>stream</span><span class=o>().</span><span class=na>mapToInt</span><span class=o>(</span><span class=n>Dish</span><span class=o>::</span><span class=n>getCalories</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=c1>//将数值流转换为Stream
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>stream</span> <span class=o>=</span> <span class=n>intStream</span><span class=o>.</span><span class=na>boxed</span><span class=o>();</span></span></span></code></pre></td></tr></table></div></div><ul><li>数值范围</li></ul><p>range是不包含结束值的，而rangeClosed则包含结束值。</p><ul><li>生成勾股数</li></ul><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>[]&gt;</span> <span class=n>pythagoreanTriples</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>	 <span class=n>IntStream</span><span class=o>.</span><span class=na>rangeClosed</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=n>100</span><span class=o>).</span><span class=na>boxed</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>		 <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>a</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl>			 <span class=n>IntStream</span><span class=o>.</span><span class=na>rangeClosed</span><span class=o>(</span><span class=n>a</span><span class=o>,</span> <span class=n>100</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> 				<span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>b</span> <span class=o>-&gt;</span> <span class=n>Math</span><span class=o>.</span><span class=na>sqrt</span><span class=o>(</span><span class=n>a</span><span class=o>*</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=o>*</span><span class=n>b</span><span class=o>)</span> <span class=o>%</span> <span class=n>1</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> 				<span class=o>.</span><span class=na>mapToObj</span><span class=o>(</span><span class=n>b</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl>					 <span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=n>a</span><span class=o>,</span> <span class=n>b</span><span class=o>,</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span><span class=n>Math</span><span class=o>.</span><span class=na>sqrt</span><span class=o>(</span><span class=n>a</span> <span class=o>*</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>b</span><span class=o>)})</span> 
</span></span><span class=line><span class=cl>			 <span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>[]&gt;</span> <span class=n>pythagoreanTriples2</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> 	<span class=n>IntStream</span><span class=o>.</span><span class=na>rangeClosed</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=n>100</span><span class=o>).</span><span class=na>boxed</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> 		<span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>a</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl>			 <span class=n>IntStream</span><span class=o>.</span><span class=na>rangeClosed</span><span class=o>(</span><span class=n>a</span><span class=o>,</span> <span class=n>100</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> 				<span class=o>.</span><span class=na>mapToObj</span><span class=o>(</span> 
</span></span><span class=line><span class=cl> 					<span class=n>b</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=kt>double</span><span class=o>[]{</span><span class=n>a</span><span class=o>,</span> <span class=n>b</span><span class=o>,</span> <span class=n>Math</span><span class=o>.</span><span class=na>sqrt</span><span class=o>(</span><span class=n>a</span><span class=o>*</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=o>*</span><span class=n>b</span><span class=o>)})</span> 
</span></span><span class=line><span class=cl>				 <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>t</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>[</span><span class=n>2</span><span class=o>]</span> <span class=o>%</span> <span class=n>1</span> <span class=o>==</span> <span class=n>0</span><span class=o>));</span></span></span></code></pre></td></tr></table></div></div><h4 id=1-3-无限流斐波那契数列>1-3. 无限流(斐波那契数列)</h4><ul><li>iterate：使用iterate的方法则是纯粹不变的：它没有修改现有状态，但在每次迭代时会创建新的元组</li></ul><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>.</span><span class=na>iterate</span><span class=o>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=n>0</span><span class=o>,</span> <span class=n>1</span><span class=o>},</span> 
</span></span><span class=line><span class=cl> 	<span class=n>t</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[]{</span><span class=n>t</span><span class=o>[</span><span class=n>1</span><span class=o>],</span><span class=n>t</span><span class=o>[</span><span class=n>0</span><span class=o>]</span> <span class=o>+</span> <span class=n>t</span><span class=o>[</span><span class=n>1</span><span class=o>]})</span> 
</span></span><span class=line><span class=cl>		 <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=n>10</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> 		<span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>t</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>[</span><span class=n>0</span><span class=o>])</span> 
</span></span><span class=line><span class=cl> 		<span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=c1>//这段代码将生成斐波纳契数列：0, 1, 1, 2, 3, 5, 8, 13, 21, 34…
</span></span></span></code></pre></td></tr></table></div></div><ul><li>generate：getAsInt()在调用时会改变对象的状态，由此在每次调用时产生新的值</li></ul><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>IntSupplier</span> <span class=n>fib</span> <span class=o>=</span> <span class=k>new</span> <span class=n>IntSupplier</span><span class=o>(){</span> 
</span></span><span class=line><span class=cl> 	<span class=kd>private</span> <span class=kt>int</span> <span class=n>previous</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> 	<span class=kd>private</span> <span class=kt>int</span> <span class=n>current</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> 	<span class=kd>public</span> <span class=kt>int</span> <span class=nf>getAsInt</span><span class=o>(){</span> 
</span></span><span class=line><span class=cl>		 <span class=kt>int</span> <span class=n>oldPrevious</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>previous</span><span class=o>;</span> 
</span></span><span class=line><span class=cl>		 <span class=kt>int</span> <span class=n>nextValue</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>previous</span> <span class=o>+</span> <span class=k>this</span><span class=o>.</span><span class=na>current</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> 		<span class=k>this</span><span class=o>.</span><span class=na>previous</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>current</span><span class=o>;</span> 
</span></span><span class=line><span class=cl>		 <span class=k>this</span><span class=o>.</span><span class=na>current</span> <span class=o>=</span> <span class=n>nextValue</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> 		<span class=k>return</span> <span class=n>oldPrevious</span><span class=o>;</span> 
</span></span><span class=line><span class=cl>	 <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>};</span> 
</span></span><span class=line><span class=cl><span class=n>IntStream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=n>fib</span><span class=o>).</span><span class=na>limit</span><span class=o>(</span><span class=n>10</span><span class=o>).</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h4 id=1-4-reduce>1-4. reduce</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16:39:44-image-20210525163942956.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:12:11-image-20210525171210707.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h4 id=1-5-收集器>1-5. 收集器</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17:43:17-image-20210526174316198.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:11:55-image-20210526181128897.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h5 id=collector接口>Collector接口</h5><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//T是流中要收集的项目的泛型。
</span></span></span><span class=line><span class=cl><span class=c1>//A是累加器的类型，累加器是在收集过程中用于累积部分结果的对象。
</span></span></span><span class=line><span class=cl><span class=c1>//R是收集操作得到的对象（通常但并不一定是集合）的类型。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Collector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>,</span> <span class=n>A</span><span class=o>,</span> <span class=n>R</span><span class=o>&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span> <span class=nf>supplier</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=n>BiConsumer</span><span class=o>&lt;</span><span class=n>A</span><span class=o>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=nf>accumulator</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=n>Function</span><span class=o>&lt;</span><span class=n>A</span><span class=o>,</span> <span class=n>R</span><span class=o>&gt;</span> <span class=nf>finisher</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=n>BinaryOperator</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span> <span class=nf>combiner</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Characteristics</span><span class=o>&gt;</span> <span class=nf>characteristics</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h5 id=自己实现收集器>自己实现收集器</h5><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/18:04:26-image-20210528180424599.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><code>List&lt;Dish> dishes = menuStream.collect(new ToListCollector&lt;Dish>());</code></p><h3 id=2-用-optional-取代-null>★2. 用 Optional 取代 null</h3><p><strong>null的检查只会掩盖问题，并未真正地修复问题</strong></p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//1. 声明一个空的Optional
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Car</span><span class=o>&gt;</span> <span class=n>optCar</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>//2. 依据一个非空值创建Optional
</span></span></span><span class=line><span class=cl><span class=c1>//如果car是一个null，这段代码会立即抛出一个NullPointerException
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Car</span><span class=o>&gt;</span> <span class=n>optCar</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>car</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//3. 可接受null的Optional
</span></span></span><span class=line><span class=cl><span class=c1>//如果car是null，那么得到的Optional对象就是个空对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Car</span><span class=o>&gt;</span> <span class=n>optCar</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>car</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-12-52-image-20210604111250644.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-13-40-image-20210604111339606.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>getCarInsuranceName</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>person</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>person</span><span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>Person</span><span class=o>::</span><span class=n>getCar</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>Car</span><span class=o>::</span><span class=n>getInsurance</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Insurance</span><span class=o>::</span><span class=n>getName</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;Unknown&#34;</span><span class=o>);</span> <span class=c1>//如果Optional的结果值为空，设置默认值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>Optional 通过类型系统让你的域模型中隐藏的知识显式地体现在你的代码中，换句话说，你永远都不应该忘记语言的首要功能就是沟通，即使对程序设计语言而言也没有什么不同。声明方法接受一个Optional参数，或者将结果作为Optional类型返回，让你的同事或者未来你方法的使用者，很清楚地知道它可以接受空值，或者它可能返回一个空值。</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-19-02-image-20210604111901795.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h4 id=2-1-optional-的方法>2-1. Optional 的方法</h4><ul><li>get()：如果变量存在，它直接返回封装的变量值，否则就抛出一个NoSuchElementException异常</li><li>orElse(T other)：允许你在Optional对象不包含值时提供一个默认值</li><li>orElseGet(Supplier&lt;? extends T> other)：是orElse方法的延迟调用版，Supplier 方法只有在Optional对象不含值时才执行调用。如果创建默认值是件耗时费力的工作，你应该考虑采用这种方式（借此提升程序的性能），或者你需要非常确定某个方法仅在Optional为空时才进行调用，也可以考虑该方式（这种情况有严格的限制条件）。</li><li>orElseThrow(Supplier&lt;? extends X> exceptionSupplier)：自定义抛出异常</li><li>ifPresent(Consumer&lt;? super T>)：能在变量值存在时执行一个作为参数传入的方法，否则就不进行任何操作。</li></ul><p>不推荐使用基础类型的Optional，因为基础类型的Optional不支持map、flatMap以及filter方法，而这些却是Optional类最有用的方法。</p><h4 id=2-2-实战案例>2-2. 实战案例</h4><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 使用 Optional 前
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kt>int</span> <span class=nf>readDuration</span><span class=o>(</span><span class=n>Properties</span> <span class=n>props</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>String</span> <span class=n>value</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=o>(</span><span class=n>value</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>try</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>value</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=o>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>i</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>nfe</span><span class=o>)</span> <span class=o>{</span> <span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>0</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用 Optional 后
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kt>int</span> <span class=nf>readDuration</span><span class=o>(</span><span class=n>Properties</span> <span class=n>props</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>props</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=n>name</span><span class=o>))</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>OptionalUtility</span><span class=o>::</span><span class=n>stringToInt</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=n>0</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-内部迭代>3. 内部迭代</h3><ul><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:54-image-20210524111153440.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li><li><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11:11:33-image-20210524111132647.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></li></ul><h2 id=三高效-java-8-编程>三、高效 Java 8 编程</h2><h3 id=1-各版本变化>1. 各版本变化</h3><ul><li>Java 5：引入 for-each 循环，替代迭代器</li><li>Java 7：引入菱形操作符&lt;>，使用范型</li><li>Java 8：lambda表达式，函数式编程，让设计模式更灵活</li></ul><h3 id=2-设计模式>🌟2. 设计模式</h3><h4 id=2-1-策略模式>2-1. 策略模式</h4><p>场景：根据不同条件进行筛选。</p><ul><li>某算法的接口</li><li>接口的多种实现</li><li>策略对象的客户</li></ul><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 不使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>ValidationStrategy</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>boolean</span> <span class=nf>execute</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>IsAllLowerCase</span> <span class=kd>implements</span> <span class=n>ValidationStrategy</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>execute</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>s</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&#34;[a-z]+&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>IsNumeric</span> <span class=kd>implements</span> <span class=n>ValidationStrategy</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>execute</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>s</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&#34;\\d+&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Validator</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>private</span> <span class=kd>final</span> <span class=n>ValidationStrategy</span> <span class=n>strategy</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=nf>Validator</span><span class=o>(</span><span class=n>ValidationStrategy</span> <span class=n>v</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>this</span><span class=o>.</span><span class=na>strategy</span> <span class=o>=</span> <span class=n>v</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>validate</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>strategy</span><span class=o>.</span><span class=na>execute</span><span class=o>(</span><span class=n>s</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=n>Validator</span> <span class=n>numericValidator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Validator</span><span class=o>(</span><span class=k>new</span> <span class=n>IsNumeric</span><span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=kt>boolean</span> <span class=n>b1</span> <span class=o>=</span> <span class=n>numericValidator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=s>&#34;aaaa&#34;</span><span class=o>);</span> <span class=c1>//FALSE
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Validator</span> <span class=n>lowerCaseValidator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Validator</span><span class=o>(</span><span class=k>new</span> <span class=n>IsAllLowerCase</span> <span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=kt>boolean</span> <span class=n>b2</span> <span class=o>=</span> <span class=n>lowerCaseValidator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=s>&#34;bbbb&#34;</span><span class=o>);</span> <span class=c1>//TRUE
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Validator</span> <span class=n>numericValidator</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>Validator</span><span class=o>((</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&#34;[a-z]+&#34;</span><span class=o>));</span> 
</span></span><span class=line><span class=cl><span class=kt>boolean</span> <span class=n>b1</span> <span class=o>=</span> <span class=n>numericValidator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=s>&#34;aaaa&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>Validator</span> <span class=n>lowerCaseValidator</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>Validator</span><span class=o>((</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&#34;\\d+&#34;</span><span class=o>));</span> 
</span></span><span class=line><span class=cl><span class=kt>boolean</span> <span class=n>b2</span> <span class=o>=</span> <span class=n>lowerCaseValidator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=s>&#34;bbbb&#34;</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-2-模板方法>2-2. 模板方法</h4><p>场景：需要采用某个算法的框架，同时又希望有一定的灵活度，能对它的某些部分进行改进。</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 不使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>OnlineBanking</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>processCustomer</span><span class=o>(</span><span class=kt>int</span> <span class=n>id</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=n>Customer</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Database</span><span class=o>.</span><span class=na>getCustomerWithId</span><span class=o>(</span><span class=n>id</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=n>makeCustomerHappy</span><span class=o>(</span><span class=n>c</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>makeCustomerHappy</span><span class=o>(</span><span class=n>Customer</span> <span class=n>c</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>processCustomer</span><span class=o>(</span><span class=kt>int</span> <span class=n>id</span><span class=o>,</span> <span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Customer</span><span class=o>&gt;</span> <span class=n>makeCustomerHappy</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=n>Customer</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Database</span><span class=o>.</span><span class=na>getCustomerWithId</span><span class=o>(</span><span class=n>id</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=n>makeCustomerHappy</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>c</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. 使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>processCustomer</span><span class=o>(</span><span class=kt>int</span> <span class=n>id</span><span class=o>,</span> <span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Customer</span><span class=o>&gt;</span> <span class=n>makeCustomerHappy</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=n>Customer</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Database</span><span class=o>.</span><span class=na>getCustomerWithId</span><span class=o>(</span><span class=n>id</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=n>makeCustomerHappy</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>c</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=n>OnlineBankingLambda</span><span class=o>().</span><span class=na>processCustomer</span><span class=o>(</span><span class=n>1337</span><span class=o>,</span> <span class=o>(</span><span class=n>Customer</span> <span class=n>c</span><span class=o>)</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Hello &#34;</span> <span class=o>+</span> <span class=n>c</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-3-观察者模式>2-3. 观察者模式</h4><p>场景：某些事件发生时（比如状态转变），subject需要自动地通知其他observer。</p><ul><li>subject：主题</li><li>observer：观察者</li></ul><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 不使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>interface</span> <span class=nc>Observer</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>void</span> <span class=nf>notify</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>NYTimes</span> <span class=kd>implements</span> <span class=n>Observer</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>notify</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>tweet</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>tweet</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;money&#34;</span><span class=o>)){</span> 
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Breaking news in NY! &#34;</span> <span class=o>+</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Guardian</span> <span class=kd>implements</span> <span class=n>Observer</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>notify</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>tweet</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>tweet</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;queen&#34;</span><span class=o>)){</span> 
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Yet another news in London... &#34;</span> <span class=o>+</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Subject</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>void</span> <span class=nf>registerObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>o</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Feed</span> <span class=kd>implements</span> <span class=n>Subject</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>private</span> <span class=kd>final</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Observer</span><span class=o>&gt;</span> <span class=n>observers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>this</span><span class=o>.</span><span class=na>observers</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>o</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>observers</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>o</span> <span class=o>-&gt;</span> <span class=n>o</span><span class=o>.</span><span class=na>notify</span><span class=o>(</span><span class=n>tweet</span><span class=o>));</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>Feed</span> <span class=n>f</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Feed</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=na>registerObserver</span><span class=o>(</span><span class=k>new</span> <span class=n>NYTimes</span><span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=na>registerObserver</span><span class=o>(</span><span class=k>new</span> <span class=n>Guardian</span><span class=o>());</span> <span class=c1>//observe ↓↓↓
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>f</span><span class=o>.</span><span class=na>notifyObservers</span><span class=o>(</span><span class=s>&#34;The queen said her favourite book is Java 8 in Action!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//输出：
</span></span></span><span class=line><span class=cl><span class=c1>//Yet another news in London...  
</span></span></span><span class=line><span class=cl><span class=c1>//The queen said her favourite book is Java 8 in Action!
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1>// 简化了观察者的代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>interface</span> <span class=nc>Subject</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>void</span> <span class=nf>registerObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>o</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Feed</span> <span class=kd>implements</span> <span class=n>Subject</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>private</span> <span class=kd>final</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Observer</span><span class=o>&gt;</span> <span class=n>observers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>this</span><span class=o>.</span><span class=na>observers</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>o</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>observers</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>o</span> <span class=o>-&gt;</span> <span class=n>o</span><span class=o>.</span><span class=na>notify</span><span class=o>(</span><span class=n>tweet</span><span class=o>));</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>Feed</span> <span class=n>f</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Feed</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=na>registerObserver</span><span class=o>((</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>tweet</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>tweet</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;money&#34;</span><span class=o>)){</span> 
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Breaking news in NY! &#34;</span> <span class=o>+</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>});</span> 
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=na>registerObserver</span><span class=o>((</span><span class=n>String</span> <span class=n>tweet</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>tweet</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>tweet</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;queen&#34;</span><span class=o>)){</span> 
</span></span><span class=line><span class=cl> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Yet another news in London... &#34;</span> <span class=o>+</span> <span class=n>tweet</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=na>notifyObservers</span><span class=o>(</span><span class=s>&#34;The queen said her favourite book is Java 8 in Action!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//输出：
</span></span></span><span class=line><span class=cl><span class=c1>//Yet another news in London...  
</span></span></span><span class=line><span class=cl><span class=c1>//The queen said her favourite book is Java 8 in Action!
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-4-责任链模式>2-4. 责任链模式</h4><p>场景：创建处理对象序列（比如操作序列）</p><ul><li>定义一个代表处理对象的抽象类</li></ul><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 不使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ProcessingObject</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>protected</span> <span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>successor</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setSuccessor</span><span class=o>(</span><span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>successor</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>this</span><span class=o>.</span><span class=na>successor</span> <span class=o>=</span> <span class=n>successor</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=n>T</span> <span class=nf>handle</span><span class=o>(</span><span class=n>T</span> <span class=n>input</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=n>T</span> <span class=n>r</span> <span class=o>=</span> <span class=n>handleWork</span><span class=o>(</span><span class=n>input</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>successor</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>successor</span><span class=o>.</span><span class=na>handle</span><span class=o>(</span><span class=n>r</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>r</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=kd>abstract</span> <span class=kd>protected</span> <span class=n>T</span> <span class=nf>handleWork</span><span class=o>(</span><span class=n>T</span> <span class=n>input</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HeaderTextProcessing</span> <span class=kd>extends</span> <span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=n>String</span> <span class=nf>handleWork</span><span class=o>(</span><span class=n>String</span> <span class=n>text</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=s>&#34;From Raoul, Mario and Alan: &#34;</span> <span class=o>+</span> <span class=n>text</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpellCheckerProcessing</span> <span class=kd>extends</span> <span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=n>String</span> <span class=nf>handleWork</span><span class=o>(</span><span class=n>String</span> <span class=n>text</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>text</span><span class=o>.</span><span class=na>replaceAll</span><span class=o>(</span><span class=s>&#34;labda&#34;</span><span class=o>,</span> <span class=s>&#34;lambda&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>p1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HeaderTextProcessing</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=n>ProcessingObject</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>p2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SpellCheckerProcessing</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=n>p1</span><span class=o>.</span><span class=na>setSuccessor</span><span class=o>(</span><span class=n>p2</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=n>p1</span><span class=o>.</span><span class=na>handle</span><span class=o>(</span><span class=s>&#34;Aren&#39;t labdas really sexy?!!&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. 使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>UnaryOperator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>headerProcessing</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=o>(</span><span class=n>String</span> <span class=n>text</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=s>&#34;From Raoul, Mario and Alan: &#34;</span> <span class=o>+</span> <span class=n>text</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>UnaryOperator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>spellCheckerProcessing</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=o>(</span><span class=n>String</span> <span class=n>text</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>text</span><span class=o>.</span><span class=na>replaceAll</span><span class=o>(</span><span class=s>&#34;labda&#34;</span><span class=o>,</span> <span class=s>&#34;lambda&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>pipeline</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=n>headerProcessing</span><span class=o>.</span><span class=na>andThen</span><span class=o>(</span><span class=n>spellCheckerProcessing</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;Aren&#39;t labdas really sexy?!!&#34;</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-5-工厂模式>2-5. 工厂模式</h4><p>场景：无需向客户暴露实例化的逻辑就能完成对象的创建</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 不使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ProductFactory</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kd>public</span> <span class=kd>static</span> <span class=n>Product</span> <span class=nf>createProduct</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>switch</span><span class=o>(</span><span class=n>name</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=s>&#34;loan&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Loan</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=s>&#34;stock&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Stock</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=s>&#34;bond&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Bond</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=k>default</span><span class=o>:</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;No such product &#34;</span> <span class=o>+</span> <span class=n>name</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>Product</span> <span class=n>p</span> <span class=o>=</span> <span class=n>ProductFactory</span><span class=o>.</span><span class=na>createProduct</span><span class=o>(</span><span class=s>&#34;loan&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. 使用 Lambda 表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span> <span class=n>loanSupplier</span> <span class=o>=</span> <span class=n>Loan</span><span class=o>::</span><span class=k>new</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=n>Loan</span> <span class=n>loan</span> <span class=o>=</span> <span class=n>loanSupplier</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=kd>static</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span> 
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;loan&#34;</span><span class=o>,</span> <span class=n>Loan</span><span class=o>::</span><span class=k>new</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;stock&#34;</span><span class=o>,</span> <span class=n>Stock</span><span class=o>::</span><span class=k>new</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;bond&#34;</span><span class=o>,</span> <span class=n>Bond</span><span class=o>::</span><span class=k>new</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>Product</span> <span class=nf>createProduct</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Product</span><span class=o>&gt;</span> <span class=n>p</span> <span class=o>=</span> <span class=n>map</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>(</span><span class=n>p</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=k>return</span> <span class=n>p</span><span class=o>.</span><span class=na>get</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;No such product &#34;</span> <span class=o>+</span> <span class=n>name</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-peek查看中间值>3. peek查看中间值</h3><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>numbers</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>4</span><span class=o>,</span> <span class=n>5</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=n>numbers</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;from stream: &#34;</span> <span class=o>+</span> <span class=n>x</span><span class=o>))</span>
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=n>17</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;after map: &#34;</span> <span class=o>+</span> <span class=n>x</span><span class=o>))</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span> <span class=o>%</span> <span class=n>2</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;after filter: &#34;</span> <span class=o>+</span> <span class=n>x</span><span class=o>))</span>
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=n>3</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;after limit: &#34;</span> <span class=o>+</span> <span class=n>x</span><span class=o>))</span>
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>输出：
</span></span></span><span class=line><span class=cl><span class=cm>from stream: 2 
</span></span></span><span class=line><span class=cl><span class=cm>after map: 19 
</span></span></span><span class=line><span class=cl><span class=cm>from stream: 3 
</span></span></span><span class=line><span class=cl><span class=cm>after map: 20 
</span></span></span><span class=line><span class=cl><span class=cm>after filter: 20 
</span></span></span><span class=line><span class=cl><span class=cm>after limit: 20 
</span></span></span><span class=line><span class=cl><span class=cm>from stream: 4 
</span></span></span><span class=line><span class=cl><span class=cm>after map: 21 
</span></span></span><span class=line><span class=cl><span class=cm>from stream: 5 
</span></span></span><span class=line><span class=cl><span class=cm>after map: 22 
</span></span></span><span class=line><span class=cl><span class=cm>after filter: 22 
</span></span></span><span class=line><span class=cl><span class=cm>after limit: 22
</span></span></span><span class=line><span class=cl><span class=cm>*/</span></span></span></code></pre></td></tr></table></div></div><h3 id=4-接口的默认方法>★4. 接口的默认方法</h3><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Sized</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=nf>size</span><span class=o>();</span> 
</span></span><span class=line><span class=cl> <span class=k>default</span> <span class=kt>boolean</span> <span class=nf>isEmpty</span><span class=o>()</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>size</span><span class=o>()</span> <span class=o>==</span> <span class=n>0</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h4 id=4-1-继承和实现冲突的问题>4-1. 继承和实现冲突的问题</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/09-57-00-image-20210603095658607.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h4 id=4-2-三条规则>4-2. 三条规则</h4><ol><li>首先，类或父类中显式声明的方法，其优先级高于所有的默认方法。</li><li>如果用第一条无法判断，方法签名又没有区别，那么选择提供最具体实现的默认方法的接口。函数签名相同时，优先选择拥有最具体实现的默认方法的接口，即如果B继承了A，那么B就比A更加具体。</li><li>最后，如果冲突依旧无法解决，继承了多个接口的类必须通过显式覆盖和调用期望的方法，显式地选择使用哪一个默认方法的实现。</li></ol><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/10-00-55-image-20210603100054651.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h3 id=5-组合式异步编程>5. 组合式异步编程</h3><h4 id=5-1-并发与并行>5-1. 并发与并行</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/15-56-55-image-20210604155653142.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h4 id=5-2-future---completablefuture>★5-2. Future ->  CompletableFuture</h4><p>Stream和CompletableFuture的设计都遵循了类似的模式：它们都使用了Lambda表达式以及流水线的思想。从这个角度，你可以说 CompletableFuture和Future的关系就跟Stream和Collection的关系一样。</p><ul><li>Collection主要是为了存储和访问数据，而Stream则主要用于描述对数据的计算</li><li>通过Stream你可以对一系列的操作进行流水线，通过map、filter或者其他类似的方法提供行为参数化，它可有效避免使用迭代器时总是出现模板代码。</li><li>类似地，CompletableFuture提供了像thenCompose、thenCombine、allOf这样的操作，对Future涉及的通用设计模式提供了函数式编程的细粒度控制，有助于避免使用命令式编程的模板代码。</li></ul><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-25-55-image-20210607112553439.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h5 id=实例>实例</h5><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Shop</span><span class=o>&gt;</span> <span class=n>shops</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=k>new</span> <span class=n>Shop</span><span class=o>(</span><span class=s>&#34;BestPrice&#34;</span><span class=o>),</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>Shop</span><span class=o>(</span><span class=s>&#34;LetsSaveBig&#34;</span><span class=o>),</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>Shop</span><span class=o>(</span><span class=s>&#34;MyFavoriteShop&#34;</span><span class=o>),</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>Shop</span><span class=o>(</span><span class=s>&#34;BuyItAll&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. 顺序查询 耗时 4032ms
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>findPrices</span><span class=o>(</span><span class=n>String</span> <span class=n>product</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>shops</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>shop</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s price is %.2f&#34;</span><span class=o>,</span> 
</span></span><span class=line><span class=cl> <span class=n>shop</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>)))</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 并行流 耗时 1180ms
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>findPrices</span><span class=o>(</span><span class=n>String</span> <span class=n>product</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>shops</span><span class=o>.</span><span class=na>parallelStream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>shop</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s price is %.2f&#34;</span><span class=o>,</span> 
</span></span><span class=line><span class=cl> <span class=n>shop</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>)))</span>
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span><span class=line><span class=cl><span class=c1>// 3. 使用工厂方法supplyAsync创建CompletableFuture对象 耗时 2005ms
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>List</span><span class=o>&lt;</span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>priceFutures</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=n>shops</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>shop</span> <span class=o>-&gt;</span> <span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(</span> 
</span></span><span class=line><span class=cl> 	<span class=o>()</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s price is %.2f&#34;</span><span class=o>,</span> 
</span></span><span class=line><span class=cl> 	<span class=n>shop</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>))))</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>priceFutures</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>CompletableFuture</span><span class=o>::</span><span class=n>join</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//处理5个商店，顺序执行版本耗时5025ms，并行流版本耗时2177ms，而CompletableFuture版本耗时2006ms
</span></span></span><span class=line><span class=cl><span class=c1>//处理9个商店，并行流版本耗时3143ms，而CompletableFuture版本耗时3009ms
</span></span></span></code></pre></td></tr></table></div></div><p>这里使用了两个不同的Stream流水线，而不是在同一个处理流的流水线上一个接一个地放置两个map操作——这其实是有缘由的。考虑流操作之间的延迟特性，如果你在单一流水线中处理流，发向不同商家的请求只能以同步、顺序执行的方式才会成功。因此，每个创建CompletableFuture对象只能在前一个操作结束之后执行查询指定商家的动作、通知join方法返回计算结果。</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-47-37-image-20210607114736726.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h4 id=5-3-使用定制的执行器>5-3. 使用定制的执行器</h4><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/11-54-12-image-20210607115411413.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>final</span> <span class=n>Executor</span> <span class=n>executor</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=n>Math</span><span class=o>.</span><span class=na>min</span><span class=o>(</span><span class=n>shops</span><span class=o>.</span><span class=na>size</span><span class=o>(),</span> <span class=n>100</span><span class=o>),</span> 
</span></span><span class=line><span class=cl> <span class=k>new</span> <span class=n>ThreadFactory</span><span class=o>()</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> 	<span class=kd>public</span> <span class=n>Thread</span> <span class=nf>newThread</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>r</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> 	<span class=n>Thread</span> <span class=n>t</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>r</span><span class=o>);</span> 
</span></span><span class=line><span class=cl>     <span class=c1>//使用守护线程——这种方式不会阻止程序的关停
</span></span></span><span class=line><span class=cl><span class=c1></span>	 <span class=n>t</span><span class=o>.</span><span class=na>setDaemon</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span> 
</span></span><span class=line><span class=cl>	 <span class=k>return</span> <span class=n>t</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span><span class=line><span class=cl><span class=c1>//改进之后，使用CompletableFuture方案的程序处理5个商店仅耗时1021ms，处理9个商店时耗时1022ms。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>shop</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34; price is &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>),</span> <span class=n>executor</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h5 id=守护进程>守护进程</h5><p>Java程序无法终止或者退出一个正在运行中的线程，所以最后剩下的那个线程会由于一直等待无法发生的事件而引发问题。与此相反，如果将线程标记为守护进程，意味着程序退出时它也会被回收</p><h4 id=5-4-completablefuture-与-parallelstream-的选择>5-4. CompletableFuture 与 parallelStream 的选择</h4><ul><li>如果你进行的是计算密集型的操作，并且没有I/O，那么推荐使用Stream接口，因为实现简单，同时效率也可能是最高的（如果所有的线程都是计算密集型的，那就没有必要创建比处理器核数更多的线程）。</li><li>反之，如果你并行的工作单元还涉及等待I/O的操作（包括网络连接等待），那么使用CompletableFuture灵活性更好，你可以像前文讨论的那样，依据等待/计算，或者W/C的比率设定需要使用的线程数。这种情况不使用并行流的另一个原因是，处理流的流水线中如果发生I/O等待，流的延迟特性会让我们很难判断到底什么时候触发了等待。</li></ul><h4 id=5-5-join-与-get-方法构造同步和异步操作>5-5. join 与 get 方法，构造同步和异步操作</h4><p>CompletableFuture类中的join方法和Future接口中的get有相同的含义，并且也声明在Future接口中，它们唯一的不同是join不会抛出任何检测到的异常。</p><h5 id=futurethencompose>future.thenCompose</h5><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>findPrices</span><span class=o>(</span><span class=n>String</span> <span class=n>product</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>List</span><span class=o>&lt;</span><span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>priceFutures</span> <span class=o>=</span>
</span></span><span class=line><span class=cl> <span class=n>shops</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>     <span class=c1>//1. 获取价格
</span></span></span><span class=line><span class=cl><span class=c1></span>	 <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>shop</span> <span class=o>-&gt;</span> <span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(</span> 
</span></span><span class=line><span class=cl>		 <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>),</span> <span class=n>executor</span><span class=o>))</span> 
</span></span><span class=line><span class=cl>     <span class=c1>//2. 解析报价
</span></span></span><span class=line><span class=cl><span class=c1></span>	 <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>future</span> <span class=o>-&gt;</span> <span class=n>future</span><span class=o>.</span><span class=na>thenApply</span><span class=o>(</span><span class=n>Quote</span><span class=o>::</span><span class=n>parse</span><span class=o>))</span> 
</span></span><span class=line><span class=cl>     <span class=c1>//3. 为计算折扣价格构造Future
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=c1>//如果不希望等到第一个任务完全结束才开始第二项任务，使用thenCombine方法
</span></span></span><span class=line><span class=cl><span class=c1></span>	 <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>future</span> <span class=o>-&gt;</span> <span class=n>future</span><span class=o>.</span><span class=na>thenCompose</span><span class=o>(</span><span class=n>quote</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl>		 <span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(</span> 
</span></span><span class=line><span class=cl> 			<span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Discount</span><span class=o>.</span><span class=na>applyDiscount</span><span class=o>(</span><span class=n>quote</span><span class=o>),</span> <span class=n>executor</span><span class=o>)))</span> 
</span></span><span class=line><span class=cl>	 <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>priceFutures</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>     <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>CompletableFuture</span><span class=o>::</span><span class=n>join</span><span class=o>)</span>
</span></span><span class=line><span class=cl>     <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>toList</span><span class=o>());</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>//thenCompose方法像CompletableFuture类中的其他方法一样，也提供了一个以Async后缀结尾的版本thenComposeAsync。
</span></span></span><span class=line><span class=cl><span class=c1>//通常而言，名称中不带Async的方法和它的前一个任务一样，在同一个线程中运行；而名称以Async结尾的方法会将后续的任务提交到一个线程池，所以每个任务是由不同的线程处理的。
</span></span></span><span class=line><span class=cl><span class=c1>//就这个例子而言，第二个CompletableFuture对象的结果取决于第一个CompletableFuture，所以无论你使用哪个版本的方法来处理CompletableFuture对象，对于最终的结果，或者大致的时间而言都没有多少差别。
</span></span></span><span class=line><span class=cl><span class=c1>//我们选择thenCompose方法的原因是因为它更高效一些，因为少了很多线程切换的开销。
</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/17-05-35-image-20210607170534004.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h5 id=futurethencombine>future.thenCombine</h5><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>futurePriceInUSD</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> 	<span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=n>shop</span><span class=o>.</span><span class=na>getPrice</span><span class=o>(</span><span class=n>product</span><span class=o>))</span> 
</span></span><span class=line><span class=cl> 	<span class=o>.</span><span class=na>thenCombine</span><span class=o>(</span> 
</span></span><span class=line><span class=cl>		 <span class=n>CompletableFuture</span><span class=o>.</span><span class=na>supplyAsync</span><span class=o>(</span> 
</span></span><span class=line><span class=cl>			 <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>exchangeService</span><span class=o>.</span><span class=na>getRate</span><span class=o>(</span><span class=n>Money</span><span class=o>.</span><span class=na>EUR</span><span class=o>,</span> <span class=n>Money</span><span class=o>.</span><span class=na>USD</span><span class=o>)),</span> 
</span></span><span class=line><span class=cl> 		<span class=o>(</span><span class=n>price</span><span class=o>,</span> <span class=n>rate</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>price</span> <span class=o>*</span> <span class=n>rate</span> 
</span></span><span class=line><span class=cl> <span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h3 id=6-新的日期和时间api>6. 新的日期和时间API</h3><h4 id=6-1-localdate--localtime-和-localdatetime>6-1. LocalDate 、 LocalTime 和 LocalDateTime</h4><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date1</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=s>&#34;2014-03-18&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalTime</span> <span class=n>time1</span> <span class=o>=</span> <span class=n>LocalTime</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=s>&#34;13:45:20&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>LocalDateTime</span> <span class=n>dt</span> <span class=o>=</span> <span class=n>LocalDateTime</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>Month</span><span class=o>.</span><span class=na>MARCH</span><span class=o>,</span> <span class=n>18</span><span class=o>,</span> <span class=n>13</span><span class=o>,</span> <span class=n>45</span><span class=o>,</span> <span class=n>20</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date2</span> <span class=o>=</span> <span class=n>dt</span><span class=o>.</span><span class=na>toLocalDate</span><span class=o>();</span> 
</span></span><span class=line><span class=cl><span class=n>LocalTime</span> <span class=n>time2</span> <span class=o>=</span> <span class=n>dt</span><span class=o>.</span><span class=na>toLocalTime</span><span class=o>();</span></span></span></code></pre></td></tr></table></div></div><p>Temporal接口定义了如何读取和操纵为时间建模的对象的值。</p><h4 id=6-2-定义-duration-或-period>6-2. 定义 Duration 或 Period</h4><p>很自然地你会想到，我们需要创建两个Temporal对象之间的duration。Duration类的静态工厂方法between就是为这个目的而设计的。</p><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Duration 对应 time
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Duration</span> <span class=n>d1</span> <span class=o>=</span> <span class=n>Duration</span><span class=o>.</span><span class=na>between</span><span class=o>(</span><span class=n>time1</span><span class=o>,</span> <span class=n>time2</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>Duration</span> <span class=n>d2</span> <span class=o>=</span> <span class=n>Duration</span><span class=o>.</span><span class=na>between</span><span class=o>(</span><span class=n>dateTime1</span><span class=o>,</span> <span class=n>dateTime2</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Period 对应 date
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Period</span> <span class=n>tenDays</span> <span class=o>=</span> <span class=n>Period</span><span class=o>.</span><span class=na>ofDays</span><span class=o>(</span><span class=n>10</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>Period</span> <span class=n>threeWeeks</span> <span class=o>=</span> <span class=n>Period</span><span class=o>.</span><span class=na>ofWeeks</span><span class=o>(</span><span class=n>3</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>Period</span> <span class=n>twoYearsSixMonthsOneDay</span> <span class=o>=</span> <span class=n>Period</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>6</span><span class=o>,</span> <span class=n>1</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><p>截至目前，我们介绍的这些日期时间对象都是不可修改的，这是为了更好地支持函数式编程，确保线程安全，保持领域模式一致性而做出的重大设计决定。</p><h4 id=6-3-操纵日期>6-3. 操纵日期</h4><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 1. 绝对修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date1</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date2</span> <span class=o>=</span> <span class=n>date1</span><span class=o>.</span><span class=na>withYear</span><span class=o>(</span><span class=n>2011</span><span class=o>);</span> <span class=c1>//2011-03-18
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date3</span> <span class=o>=</span> <span class=n>date2</span><span class=o>.</span><span class=na>withDayOfMonth</span><span class=o>(</span><span class=n>25</span><span class=o>);</span> <span class=c1>//2011-03-25
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date4</span> <span class=o>=</span> <span class=n>date3</span><span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=n>ChronoField</span><span class=o>.</span><span class=na>MONTH_OF_YEAR</span><span class=o>,</span> <span class=n>9</span><span class=o>);</span><span class=c1>//2011-09-25
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 相对修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date1</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date2</span> <span class=o>=</span> <span class=n>date1</span><span class=o>.</span><span class=na>plusWeeks</span><span class=o>(</span><span class=n>1</span><span class=o>);</span> <span class=c1>//2014-03-25
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date3</span> <span class=o>=</span> <span class=n>date2</span><span class=o>.</span><span class=na>minusYears</span><span class=o>(</span><span class=n>3</span><span class=o>);</span> <span class=c1>//2011-03-25
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date4</span> <span class=o>=</span> <span class=n>date3</span><span class=o>.</span><span class=na>plus</span><span class=o>(</span><span class=n>6</span><span class=o>,</span> <span class=n>ChronoUnit</span><span class=o>.</span><span class=na>MONTHS</span><span class=o>);</span> <span class=c1>//2011-09-25
</span></span></span><span class=line><span class=cl><span class=c1>//上面的plus方法也是通用方法，它和minus方法都声明于Temporal接口中
</span></span></span></code></pre></td></tr></table></div></div><h4 id=6-4-设计一个nextworkingday类>6-4. 设计一个NextWorkingDay类</h4><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>TemporalAdjuster</span> <span class=n>nextWorkingDay</span> <span class=o>=</span> <span class=n>TemporalAdjusters</span><span class=o>.</span><span class=na>ofDateAdjuster</span><span class=o>(</span> 
</span></span><span class=line><span class=cl> <span class=n>temporal</span> <span class=o>-&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=n>DayOfWeek</span> <span class=n>dow</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl> <span class=n>DayOfWeek</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>temporal</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>ChronoField</span><span class=o>.</span><span class=na>DAY_OF_WEEK</span><span class=o>));</span> 
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=n>dayToAdd</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=o>(</span><span class=n>dow</span> <span class=o>==</span> <span class=n>DayOfWeek</span><span class=o>.</span><span class=na>FRIDAY</span><span class=o>)</span> <span class=n>dayToAdd</span> <span class=o>=</span> <span class=n>3</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=o>(</span><span class=n>dow</span> <span class=o>==</span> <span class=n>DayOfWeek</span><span class=o>.</span><span class=na>SATURDAY</span><span class=o>)</span> <span class=n>dayToAdd</span> <span class=o>=</span> <span class=n>2</span><span class=o>;</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>temporal</span><span class=o>.</span><span class=na>plus</span><span class=o>(</span><span class=n>dayToAdd</span><span class=o>,</span> <span class=n>ChronoUnit</span><span class=o>.</span><span class=na>DAYS</span><span class=o>);</span> 
</span></span><span class=line><span class=cl> <span class=o>});</span> 
</span></span><span class=line><span class=cl><span class=n>date</span> <span class=o>=</span> <span class=n>date</span><span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=n>nextWorkingDay</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h4 id=6-5-日期和-string-转换>6-5. 日期和 String 转换</h4><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 使用 LocalDate 的 format 和 parse 方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>s1</span> <span class=o>=</span> <span class=n>date</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>BASIC_ISO_DATE</span><span class=o>);</span> <span class=c1>//20140318
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>String</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>date</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>ISO_LOCAL_DATE</span><span class=o>);</span> <span class=c1>//2014-03-18
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>LocalDate</span> <span class=n>date1</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=s>&#34;20140318&#34;</span><span class=o>,</span> <span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>BASIC_ISO_DATE</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date2</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=s>&#34;2014-03-18&#34;</span><span class=o>,</span> <span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>ISO_LOCAL_DATE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 自定义模式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>DateTimeFormatter</span> <span class=n>formatter</span> <span class=o>=</span> <span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>ofPattern</span><span class=o>(</span><span class=s>&#34;dd/MM/yyyy&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date1</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>2014</span><span class=o>,</span> <span class=n>3</span><span class=o>,</span> <span class=n>18</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>String</span> <span class=n>formattedDate</span> <span class=o>=</span> <span class=n>date1</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=n>formatter</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>LocalDate</span> <span class=n>date2</span> <span class=o>=</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>formattedDate</span><span class=o>,</span> <span class=n>formatter</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h2 id=四超越-java-8>四、超越 Java 8</h2><h3 id=1-基于尾-递的阶乘>1. 基于“尾-递”的阶乘</h3><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kt>long</span> <span class=nf>factorialTailRecursive</span><span class=o>(</span><span class=kt>long</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>factorialHelper</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=n>n</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kt>long</span> <span class=nf>factorialHelper</span><span class=o>(</span><span class=kt>long</span> <span class=n>acc</span><span class=o>,</span> <span class=kt>long</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>n</span> <span class=o>==</span> <span class=n>1</span> <span class=o>?</span> <span class=n>acc</span> <span class=o>:</span> <span class=n>factorialHelper</span><span class=o>(</span><span class=n>acc</span> <span class=o>*</span> <span class=n>n</span><span class=o>,</span> <span class=n>n</span><span class=o>-</span><span class=n>1</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>这种形式的递归是非常有意义的，现在我们不需要在不同的栈帧上保存每次递归计算的中间值，编译器能够自行决定复用某个栈帧进行计算。实际上，在factorialHelper的定义中，立即数（阶乘计算的中间结果）直接作为参数传递给了该方法。再也不用为每个递归调用分配单独的栈帧用于跟踪每次递归调用的中间值——通过方法的参数能够直接访问这些值。</p><p><img loading=lazy src=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png srcset="https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png 1.5x, https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png 2x" sizes=auto data-title=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png data-alt=https://publicpictures.oss-cn-hangzhou.aliyuncs.com/img/16-26-44-image-20210608162642044.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h3 id=2-科里化curry>2. 科里化（curry）</h3><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=n>DoubleUnaryOperator</span> <span class=nf>curriedConverter</span><span class=o>(</span><span class=kt>double</span> <span class=n>f</span><span class=o>,</span> <span class=kt>double</span> <span class=n>b</span><span class=o>){</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=o>(</span><span class=kt>double</span> <span class=n>x</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>x</span> <span class=o>*</span> <span class=n>f</span> <span class=o>+</span> <span class=n>b</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DoubleUnaryOperator</span> <span class=n>convertCtoF</span> <span class=o>=</span> <span class=n>curriedConverter</span><span class=o>(</span><span class=n>9</span><span class=o>.</span><span class=na>0</span><span class=o>/</span><span class=n>5</span><span class=o>,</span> <span class=n>32</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>DoubleUnaryOperator</span> <span class=n>convertUSDtoGBP</span> <span class=o>=</span> <span class=n>curriedConverter</span><span class=o>(</span><span class=n>0</span><span class=o>.</span><span class=na>6</span><span class=o>,</span> <span class=n>0</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=n>DoubleUnaryOperator</span> <span class=n>convertKmtoMi</span> <span class=o>=</span> <span class=n>curriedConverter</span><span class=o>(</span><span class=n>0</span><span class=o>.</span><span class=na>6214</span><span class=o>,</span> <span class=n>0</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-scala>3. Scala</h3><ul><li>声明变量 <code>s : String</code></li><li>创建集合<code>val authorsToAge = Map("Raoul" -> 23, "Mario" -> 40, "Alan" -> 53)</code></li><li>val 表示不可变，var表示可变</li><li>支持任意大小的元组</li></ul><div class=highlight id=id-27><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>val</span> <span class=n>book</span> <span class=k>=</span> <span class=o>(</span><span class=mi>2014</span><span class=o>,</span> <span class=s>&#34;Java 8 in Action&#34;</span><span class=o>,</span> <span class=s>&#34;Manning&#34;</span><span class=o>)</span> <span class=c1>//元组类型为(Int, String, String)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>val</span> <span class=n>numbers</span> <span class=k>=</span> <span class=o>(</span><span class=mi>42</span><span class=o>,</span> <span class=mi>1337</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>14</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=o>(</span><span class=n>book</span><span class=o>.</span><span class=n>_1</span><span class=o>)</span> <span class=c1>//2014
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>println</span><span class=o>(</span><span class=n>numbers</span><span class=o>.</span><span class=n>_4</span><span class=o>)</span> <span class=o>//</span><span class=mi>3</span></span></span></code></pre></td></tr></table></div></div><ul><li>Scala中的Stream可以记录它曾经计算出的值，所以之前的元素可以随时进行访问。除此之外，Stream还进行了索引，所以Stream中的元素可以像List那样通过索引访问。注意，这种抉择也附带着开销，由于需要存储这些额外的属性，和Java 8中的Stream比起来，Scala版本的Stream内存的使用效率变低了，因为Scala中的Stream需要能够回溯之前的元素，这意味着之前访问过的元素都需要在内存“记录下来”（即进行缓存）。</li><li>Option:</li></ul><div class=highlight id=id-28><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=c1>//Java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=nc>String</span> <span class=n>getCarInsuranceName</span><span class=o>(</span><span class=nc>Optional</span><span class=o>&lt;</span><span class=nc>Person</span><span class=o>&gt;</span> <span class=n>person</span><span class=o>,</span> <span class=n>int</span> <span class=n>minAge</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>person</span><span class=o>.</span><span class=n>filter</span><span class=o>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=n>p</span><span class=o>.</span><span class=n>getAge</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=n>minAge</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>flatMap</span><span class=o>(</span><span class=nc>Person</span><span class=k>:</span><span class=kt>:getCar</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>flatMap</span><span class=o>(</span><span class=nc>Car</span><span class=k>:</span><span class=kt>:getInsurance</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>map</span><span class=o>(</span><span class=nc>Insurance</span><span class=k>:</span><span class=kt>:getName</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>orElse</span><span class=o>(</span><span class=s>&#34;Unknown&#34;</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>//Scala
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>def</span> <span class=n>getCarInsuranceName</span><span class=o>(</span><span class=n>person</span><span class=k>:</span> <span class=kt>Option</span><span class=o>[</span><span class=kt>Person</span><span class=o>],</span> <span class=n>minAge</span><span class=k>:</span> <span class=kt>Int</span><span class=o>)</span> <span class=k>=</span> 
</span></span><span class=line><span class=cl> <span class=n>person</span><span class=o>.</span><span class=n>filter</span><span class=o>(</span><span class=k>_</span><span class=o>.</span><span class=n>getAge</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=n>minAge</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>flatMap</span><span class=o>(</span><span class=k>_</span><span class=o>.</span><span class=n>getCar</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>flatMap</span><span class=o>(</span><span class=k>_</span><span class=o>.</span><span class=n>getInsurance</span><span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=o>.</span><span class=n>map</span><span class=o>(</span><span class=k>_</span><span class=o>.</span><span class=n>getName</span><span class=o>).</span><span class=n>getOrElse</span><span class=o>(</span><span class=s>&#34;Unknown&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>在前面的代码中</span><span class=err>，</span><span class=n>你使用的是_</span><span class=o>.</span><span class=n>getCar</span><span class=err>（</span><span class=n>并未使用圆括号</span><span class=err>），</span><span class=n>而不是_</span><span class=o>.</span><span class=n>getCar</span><span class=o>()</span> <span class=err>（</span><span class=n>带圆括号</span><span class=err>）。</span><span class=nc>Scala语言中</span><span class=err>，</span><span class=n>执行方法调用时</span><span class=err>，</span><span class=n>如果不需要传递参数</span><span class=err>，</span><span class=n>那么函数的圆括号是可以省略的</span><span class=err>。</span></span></span></code></pre></td></tr></table></div></div><h3 id=4-闭包>4. 闭包</h3><p>闭包是一个函数实例，它可以不受限制地访问该函数的非本地变量。</p><p>不过Java 8中的Lambda表达式自身带有一定的限制：它们不能修改定义Lambda表达式的函数中的本地变量值。这些变量必须隐式地声明为final。</p><p>这些背景知识有助于我们理解“Lambda避免了对变量值的修改，而不是对变量的访问”。</p><h3 id=5-trait>5. trait</h3><p>Scala还提供了另一个非常有助于抽象对象的特性，名称叫trait。它是Scala为实现Java中的接口而设计的替代品。trait中既可以定义抽象方法，也可以定义带有默认实现的方法。trait同时还支持Java中接口那样的多继承，所以你可以将它们看成与Java 8中接口类似的特性，它们都支持默认方法。trait中还可以包含像抽象类这样的字段，而Java 8的接口不支持这样的特性。那么，trait就类似于抽象类吗？显然不是，因为trait支持多继承，而抽象类不支持多继承。Java支持类型的多继承，因为一个类可以实现多个接口。现在，Java 8通过默认方法又引入了对行为的多继承，不过它依旧不支持对状态的多继承，而这恰恰是trait支持的。</p><div class=highlight id=id-29><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-scala data-lang=scala><span class=line><span class=cl><span class=k>trait</span> <span class=nc>Sized</span><span class=o>{</span> 
</span></span><span class=line><span class=cl> <span class=k>var</span> <span class=n>size</span> <span class=k>:</span> <span class=kt>Int</span> <span class=o>=</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl> <span class=k>def</span> <span class=n>isEmpty</span><span class=o>()</span> <span class=k>=</span> <span class=n>size</span> <span class=o>==</span> <span class=mi>0</span> <span class=c1>//带默认实现的isEmpty方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Empty</span> <span class=k>extends</span> <span class=nc>Sized</span> 
</span></span><span class=line><span class=cl><span class=n>println</span><span class=o>(</span><span class=k>new</span> <span class=nc>Empty</span><span class=o>().</span><span class=n>isEmpty</span><span class=o>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Box</span> 
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=n>b1</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>Box</span><span class=o>()</span> <span class=k>with</span> <span class=nc>Sized</span> <span class=c1>//在对象实例化时构建trait
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>println</span><span class=o>(</span><span class=n>b1</span><span class=o>.</span><span class=n>isEmpty</span><span class=o>())</span> 
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=n>b2</span> <span class=k>=</span> <span class=k>new</span> <span class=nc>Box</span><span class=o>()</span> 
</span></span><span class=line><span class=cl><span class=n>b2</span><span class=o>.</span><span class=n>isEmpty</span><span class=o>()</span> <span class=o>//</span><span class=n>编译错误</span><span class=err>：</span><span class=n>因为Box类的声明并未继承Sized</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-08-08 15:20:42">更新于 2023-08-08&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://leni.fun/java8%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/ data-title=《Java8实战》笔记><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/java/ class=post-tag>Java</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/java_base/ class=post-nav-item rel=prev title="🚩Java 基础"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>🚩Java 基础</a>
<a href=/java_draft/ class=post-nav-item rel=next title="Java 杂记">Java 杂记<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=/>都将会</a></span><span class="license footer-divider">Back-End Engineer</span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/hihihiman/hihihiman.github.io title=博客源码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;bottom:0;--bg-progress:#000;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/pink/pace-theme-center-atom.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:64},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":"的博客","typeit-header-subtitle-mobile":"的博客"},enablePWA:!0,pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!0,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!0},siteTime:"2023-08-06T23:31:00+08:00",typeit:{cursorChar:"_",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,loop:!0,speed:100}}</script><script src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>